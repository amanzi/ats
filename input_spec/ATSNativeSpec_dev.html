<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ATS Native XML Input Specification V-dev &mdash; ATS 1.4 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ATS Native XML Input Specification V-1.4" href="ATSNativeSpec_1_4.html" />
    <link rel="prev" title="Input Specification" href="../input_spec.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ATS
          </a>
              <div class="version">
                1.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../demos.html">ATS Demo Problems</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../input_spec.html">Input Specification</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">ATS Native XML Input Specification V-dev</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#about-the-specification">About the Specification</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#specs">Specs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#syntax">Syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#naming">Naming</a></li>
<li class="toctree-l4"><a class="reference internal" href="#symbol-index">Symbol Index</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#main">Main</a></li>
<li class="toctree-l3"><a class="reference internal" href="#coordinator">Coordinator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mesh">Mesh</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#generated-mesh">Generated Mesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="#read-mesh-file">Read Mesh File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#logical-mesh">Logical Mesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="#surface-mesh">Surface Mesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="#aliased-mesh">Aliased Mesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="#subgrid-meshes">Subgrid Meshes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#column-meshes">Column Meshes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#region">Region</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#all">All</a></li>
<li class="toctree-l4"><a class="reference internal" href="#box">Box</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plane">Plane</a></li>
<li class="toctree-l4"><a class="reference internal" href="#labeled-set">Labeled Set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-color">Function Color</a></li>
<li class="toctree-l4"><a class="reference internal" href="#point">Point</a></li>
<li class="toctree-l4"><a class="reference internal" href="#logical">Logical</a></li>
<li class="toctree-l4"><a class="reference internal" href="#polygon">Polygon</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enumerated">Enumerated</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boundary">Boundary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#box-volume-fractions">Box Volume Fractions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#line-segment">Line Segment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#visualization">Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#checkpoint">Checkpoint</a></li>
<li class="toctree-l3"><a class="reference internal" href="#observation">Observation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#process-kernels">Process Kernels</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#base-pks">Base PKs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#physical-pks">Physical PKs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mpc">MPC</a></li>
<li class="toctree-l4"><a class="reference internal" href="#physical-mpcs">Physical MPCs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#globalization-delegates">Globalization Delegates</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#state">State</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#evaluators">Evaluators</a></li>
<li class="toctree-l4"><a class="reference internal" href="#initialconditions">InitialConditions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boundaryconditions">BoundaryConditions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#time-integrators-solvers-and-other-mathematical-specs">Time integrators, solvers, and other mathematical specs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#timeintegrator">TimeIntegrator</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nonlinear-solver">Nonlinear Solver</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linear-solvers">Linear Solvers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preconditioners">Preconditioners</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#other-common-specs">Other Common Specs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ioevent">IOEvent</a></li>
<li class="toctree-l4"><a class="reference internal" href="#verbose-object">Verbose Object</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debugger">Debugger</a></li>
<li class="toctree-l4"><a class="reference internal" href="#residual-debugger">Residual Debugger</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function">Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#operator">Operator</a></li>
<li class="toctree-l4"><a class="reference internal" href="#field-initializers">Field Initializers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ATSNativeSpec_1_4.html">ATS Native XML Input Specification V-1.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="ATSNativeSpec_1_2.html">ATS Native XML Input Specification V-1.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="ATSNativeSpec_1_1.html">ATS Native XML Input Specification V-1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="ATSNativeSpec_1_0.html">ATS Native XML Input Specification V1</a></li>
<li class="toctree-l2"><a class="reference internal" href="ATSNativeSpec_0_86.html">ATS Native XML Input Specification V0.86</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ATS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../input_spec.html">Input Specification</a></li>
      <li class="breadcrumb-item active">ATS Native XML Input Specification V-dev</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/input_spec/ATSNativeSpec_dev.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ats-native-xml-input-specification-v-dev">
<h1>ATS Native XML Input Specification V-dev<a class="headerlink" href="#ats-native-xml-input-specification-v-dev" title="Permalink to this heading"></a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title"><strong>Table of Contents</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#about-the-specification" id="id13">About the Specification</a></p>
<ul>
<li><p><a class="reference internal" href="#specs" id="id14">Specs</a></p></li>
<li><p><a class="reference internal" href="#syntax" id="id15">Syntax</a></p></li>
<li><p><a class="reference internal" href="#naming" id="id16">Naming</a></p></li>
<li><p><a class="reference internal" href="#symbol-index" id="id17">Symbol Index</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#main" id="id18">Main</a></p></li>
<li><p><a class="reference internal" href="#coordinator" id="id19">Coordinator</a></p></li>
<li><p><a class="reference internal" href="#mesh" id="id20">Mesh</a></p>
<ul>
<li><p><a class="reference internal" href="#generated-mesh" id="id21">Generated Mesh</a></p></li>
<li><p><a class="reference internal" href="#read-mesh-file" id="id22">Read Mesh File</a></p></li>
<li><p><a class="reference internal" href="#logical-mesh" id="id23">Logical Mesh</a></p></li>
<li><p><a class="reference internal" href="#surface-mesh" id="id24">Surface Mesh</a></p></li>
<li><p><a class="reference internal" href="#aliased-mesh" id="id25">Aliased Mesh</a></p></li>
<li><p><a class="reference internal" href="#subgrid-meshes" id="id26">Subgrid Meshes</a></p></li>
<li><p><a class="reference internal" href="#column-meshes" id="id27">Column Meshes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#region" id="id28">Region</a></p>
<ul>
<li><p><a class="reference internal" href="#all" id="id29">All</a></p></li>
<li><p><a class="reference internal" href="#box" id="id30">Box</a></p></li>
<li><p><a class="reference internal" href="#plane" id="id31">Plane</a></p></li>
<li><p><a class="reference internal" href="#labeled-set" id="id32">Labeled Set</a></p></li>
<li><p><a class="reference internal" href="#function-color" id="id33">Function Color</a></p></li>
<li><p><a class="reference internal" href="#point" id="id34">Point</a></p></li>
<li><p><a class="reference internal" href="#logical" id="id35">Logical</a></p></li>
<li><p><a class="reference internal" href="#polygon" id="id36">Polygon</a></p></li>
<li><p><a class="reference internal" href="#enumerated" id="id37">Enumerated</a></p></li>
<li><p><a class="reference internal" href="#boundary" id="id38">Boundary</a></p></li>
<li><p><a class="reference internal" href="#box-volume-fractions" id="id39">Box Volume Fractions</a></p></li>
<li><p><a class="reference internal" href="#line-segment" id="id40">Line Segment</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#visualization" id="id41">Visualization</a></p></li>
<li><p><a class="reference internal" href="#checkpoint" id="id42">Checkpoint</a></p></li>
<li><p><a class="reference internal" href="#observation" id="id43">Observation</a></p></li>
<li><p><a class="reference internal" href="#process-kernels" id="id44">Process Kernels</a></p>
<ul>
<li><p><a class="reference internal" href="#base-pks" id="id45">Base PKs</a></p></li>
<li><p><a class="reference internal" href="#physical-pks" id="id46">Physical PKs</a></p></li>
<li><p><a class="reference internal" href="#mpc" id="id47">MPC</a></p></li>
<li><p><a class="reference internal" href="#physical-mpcs" id="id48">Physical MPCs</a></p></li>
<li><p><a class="reference internal" href="#globalization-delegates" id="id49">Globalization Delegates</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#state" id="id50">State</a></p>
<ul>
<li><p><a class="reference internal" href="#evaluators" id="id51">Evaluators</a></p></li>
<li><p><a class="reference internal" href="#initialconditions" id="id52">InitialConditions</a></p></li>
<li><p><a class="reference internal" href="#boundaryconditions" id="id53">BoundaryConditions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#time-integrators-solvers-and-other-mathematical-specs" id="id54">Time integrators, solvers, and other mathematical specs</a></p>
<ul>
<li><p><a class="reference internal" href="#timeintegrator" id="id55">TimeIntegrator</a></p></li>
<li><p><a class="reference internal" href="#nonlinear-solver" id="id56">Nonlinear Solver</a></p></li>
<li><p><a class="reference internal" href="#linear-solvers" id="id57">Linear Solvers</a></p></li>
<li><p><a class="reference internal" href="#preconditioners" id="id58">Preconditioners</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#other-common-specs" id="id59">Other Common Specs</a></p>
<ul>
<li><p><a class="reference internal" href="#ioevent" id="id60">IOEvent</a></p></li>
<li><p><a class="reference internal" href="#verbose-object" id="id61">Verbose Object</a></p></li>
<li><p><a class="reference internal" href="#debugger" id="id62">Debugger</a></p></li>
<li><p><a class="reference internal" href="#residual-debugger" id="id63">Residual Debugger</a></p></li>
<li><p><a class="reference internal" href="#function" id="id64">Function</a></p></li>
<li><p><a class="reference internal" href="#operator" id="id65">Operator</a></p></li>
<li><p><a class="reference internal" href="#field-initializers" id="id66">Field Initializers</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="about-the-specification">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">About the Specification</a><a class="headerlink" href="#about-the-specification" title="Permalink to this heading"></a></h2>
<p>ATS, and Amanzi’s “native” specificiation, is an xml file following
Trilinos’s Teuchos ParameterList schema.  There are only two types of
tags used – <cite>“Parameter</cite>” and <cite>“ParameterList</cite>”.  <cite>“Parameter</cite>”
elements consist of <cite>“name</cite>”, <cite>“type</cite>”, and <cite>“value</cite>” attributes.
<cite>“ParameterList</cite>” elements use the <cite>“name</cite>” attribute and include
subelements that are other <cite>“ParameterList</cite>” and <cite>“Parameter</cite>”
elements.</p>
<p>The top-most, <cite>“main</cite>” list is read by the code and used to provide
all information needed to run the simulation.  This input spec is
designed for the code, not necessarily for the user.  In general,
avoid writing input files from scratch, and prefer to modify existing
demos or examples.</p>
<p>Here we document the input spec by defining what each possible element
used by the code needs to be well posed.</p>
<section id="specs">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Specs</a><a class="headerlink" href="#specs" title="Permalink to this heading"></a></h3>
<p>In many cases, the input specifies data for a particular parameterized
model, and ATS supports a number of parameterizations.  For example,
initial data might be uniform (the value is required), or linear in y
(the value and its gradient are required).  Where ATS supports a
number of parameterized models for quantity Z, the available models
will be listed by name, and then will be described in the subsequent
section.  For example, the specification for an <cite>“X</cite>” list might look
like:</p>
<div class="admonition-x-spec admonition" id="x-spec">
<p class="admonition-title">X-spec</p>
<ul class="simple">
<li><p><cite>“Y</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>default_value</strong> Documentation desribing Y.</p></li>
<li><p><cite>“Z</cite>” <code class="docutils literal notranslate"><span class="pre">[Z-spec]</span></code> Model for Z, One of <cite>“z1</cite>” or <cite>“z2</cite>” (see below)</p></li>
</ul>
</div>
<p>Here, an <cite>“X</cite>” is defined by a <cite>“Y</cite>” and a <cite>“Z</cite>”.  The <cite>“Y</cite>” is a
string parameter but the <cite>“Z</cite>” is given by a model (which will require
its own set of parameters).  The options for <cite>“Z</cite>” will then be
described seperately as a <cite>“Z-spec</cite>”</p>
<p>An example of using such a specification:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;X&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Y&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;hello&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;z2&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;z2a&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.7&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;z2b&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="syntax">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Syntax</a><a class="headerlink" href="#syntax" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Reserved keywords and labels are <cite>“quoted and italicized</cite>” – these
labels or values of parameters in user-generated input files must
match (using XML matching rules) the specified or allowable values.</p></li>
<li><p>User-defined labels are indicated with ALL-CAPS, and are meant to
represent a typical or default name given by a user - these can be
names or numbers or whatever serves best the organization of the
user input data.  Things liked PRESSURE or SURFACE-PONDED_DEPTH can
be renamed from their defaults if it makes sense to the problem.</p></li>
<li><p>Bold values are default values, and are used if the Parameter
is not provided.</p></li>
</ul>
</section>
<section id="naming">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Naming</a><a class="headerlink" href="#naming" title="Permalink to this heading"></a></h3>
<p>Variables are named according to a very strong convention.  While some
variables may be overridden by the user, users should choose to follow
these conventions or things like visualization scripts may not behave
as expected.</p>
<p>A variable name looks like one of:</p>
<ul class="simple">
<li><p>SUFFIX</p></li>
<li><p>DOMAIN-SUFFIX</p></li>
<li><p>DOMAIN_SET:ID-VARNAME</p></li>
</ul>
<p>where:</p>
<ul class="simple">
<li><p>When DOMAIN is supplied, it is the “default” mesh, called <cite>“domain</cite>”
in the mesh list, and otherwise is the name of the mesh (e.g. <cite>“surface</cite>”).</p></li>
<li><p>DOMAIN_SET:ID is itself a DOMAIN, where the set defines the
collection as a whole (from the mesh list) and the ID is defined by
an index across the collection, e.g. <cite>“column:4</cite>”</p></li>
</ul>
<p>Tags indicate the use of a variable at a specific time in the
discretized time interval.  Default tags include <cite>“current</cite>” and
<cite>“next</cite>” indicating the variable at the beginning and end of the
interval, respectively.  Often subcycling and other schemes will
designate special-purpose tags which may be used internally by a
subset of the equations begin solved.  Tags are combined with
variables to indicate a specific data structure,
e.g. <cite>“surface-pressure&#64;NEXT</cite>”.</p>
<p>Lastly, derivatives are named using the <cite>“d</cite>” and the <cite>“|</cite>” character,
e.g. <cite>“dsurface-water_content|dsurface-pressure</cite>” is the derivative of
the <cite>“water_content</cite>” variable on the <cite>“surface</cite>” domain with respect
to the <cite>“pressure</cite>” on the same domain.</p>
<p>As a result of these conventions, none of the above individual strings,
(suffixes, domains, domain sets, or IDs) can contain any of the
following reserved characters: <cite>:</cite>, <cite>-</cite>, <cite>|</cite>, <cite>&#64;</cite>.</p>
</section>
<section id="symbol-index">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Symbol Index</a><a class="headerlink" href="#symbol-index" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(E\)</span></p></td>
<td><p>extensive energy of a cell <span class="math notranslate nohighlight">\([\mathop{\mathrm{MJ}}]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(e\)</span></p></td>
<td><p>specific enthalpy <span class="math notranslate nohighlight">\([\mathop{\mathrm{MJ}} \mathop{\mathrm{mol}}^{-1}]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(g\)</span></p></td>
<td><p>gravitational acceleration vector <span class="math notranslate nohighlight">\([m s^{-2}]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(h\)</span></p></td>
<td><p>ponded depth, or the water head over the surface <span class="math notranslate nohighlight">\([m]\)</span></p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>alternative, in context of the subsurface, water head <span class="math notranslate nohighlight">\([m]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(h_{snow}\)</span></p></td>
<td><p>snow depth <span class="math notranslate nohighlight">\([m]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(K\)</span></p></td>
<td><p>absolute permeability <span class="math notranslate nohighlight">\([m^2]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\kappa\)</span></p></td>
<td><p>thermal conductivity <span class="math notranslate nohighlight">\([\mathop{\mathrm{MW}} m^{-1} K^{-1}]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(k_r\)</span></p></td>
<td><p>relative permeability <span class="math notranslate nohighlight">\([-]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(n_X\)</span></p></td>
<td><p>molar density of phase X <span class="math notranslate nohighlight">\([\mathop{\mathrm{mol}} m^{-3}]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\vert \partial \Omega \vert\)</span></p></td>
<td><p>volume of a discrete element <span class="math notranslate nohighlight">\(\partial \Omega\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(p\)</span></p></td>
<td><p>pressure of the liquid phase <span class="math notranslate nohighlight">\([\mathop{\mathrm{Pa}}]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(P_{r}\)</span></p></td>
<td><p>precipitation of rain <span class="math notranslate nohighlight">\([m s^{-1}]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(P_{s}\)</span></p></td>
<td><p>precipitation of snow, in snow-water-equivalent (SWE)  <span class="math notranslate nohighlight">\([m \mathop{\mathrm{SWE}} s^{-1}]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(Q_e\)</span></p></td>
<td><p>source of energy <span class="math notranslate nohighlight">\([\mathop{\mathrm{MJ}} s^{-1}]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(Q_w\)</span></p></td>
<td><p>mass source of water <span class="math notranslate nohighlight">\([\mathop{\mathrm{mol}} s^{-1}]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(s_X\)</span></p></td>
<td><p>saturation of phase X <span class="math notranslate nohighlight">\([-]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(t\)</span></p></td>
<td><p>time variable <span class="math notranslate nohighlight">\([s]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(z\)</span></p></td>
<td><p>elevation <span class="math notranslate nohighlight">\([m]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\nu\)</span></p></td>
<td><p>dynamic viscosity of water <span class="math notranslate nohighlight">\([\mathop{\mathrm{Pa}} s]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\phi\)</span></p></td>
<td><p>porosity of the soil <span class="math notranslate nohighlight">\([-]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\mathbf{q}\)</span></p></td>
<td><p>Darcy flux vector <span class="math notranslate nohighlight">\([\mathop{\mathrm{mol}}  m^{-2} s^{-1}]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\mathbf{q_s}\)</span></p></td>
<td><p>surface flux vector <span class="math notranslate nohighlight">\([\mathop{\mathrm{mol}}  m s^{-1}]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\rho\)</span></p></td>
<td><p>mass density of a phase <span class="math notranslate nohighlight">\([\mathop{\mathrm{kg}} m^{-3}]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(t\)</span></p></td>
<td><p>time variable <span class="math notranslate nohighlight">\([s]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(T\)</span></p></td>
<td><p>temperature <span class="math notranslate nohighlight">\([K]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\Theta\)</span></p></td>
<td><p>extensive water content of a cell <span class="math notranslate nohighlight">\([\mathop{\mathrm{mol}}]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(u_X\)</span></p></td>
<td><p>specific internal energy of phase X <span class="math notranslate nohighlight">\([\mathop{\mathrm{MJ}} \mathop{\mathrm{mol}}^{-1}]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\mathbf{V}\)</span></p></td>
<td><p>Darcy velocity vector <span class="math notranslate nohighlight">\([m s^{-1}]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\mathbf{V_s}\)</span></p></td>
<td><p>surface velocity vector <span class="math notranslate nohighlight">\([m s^{-1}]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(y\)</span>, <span class="math notranslate nohighlight">\(z\)</span></p></td>
<td><p>spatial coordinates <span class="math notranslate nohighlight">\([m]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="main">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">Main</a><a class="headerlink" href="#main" title="Permalink to this heading"></a></h2>
<p>ATS’s top level driver is provided the entire input spec as a single list
called <cite>“main</cite>”.  That list contains the following required elements:</p>
<div class="admonition-main-spec admonition" id="main-spec">
<p class="admonition-title">main-spec</p>
<ul class="simple">
<li><p><cite>“cycle driver</cite>” <code class="docutils literal notranslate"><span class="pre">[coordinator-spec]</span></code>  See below.</p></li>
<li><p><cite>“mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[mesh-typed-spec-list]</span></code> A list of <a class="reference internal" href="#mesh">Mesh</a> objects.</p></li>
<li><p><cite>“regions</cite>” <code class="docutils literal notranslate"><span class="pre">[region-typedinline-spec-list]</span></code> A list of <a class="reference internal" href="#region">Region</a> objects.</p></li>
<li><p><cite>“visualization</cite>” <code class="docutils literal notranslate"><span class="pre">[visualization-spec-list]</span></code> A list of <a class="reference internal" href="#visualization">Visualization</a> objects.</p></li>
<li><p><cite>“observations</cite>” <code class="docutils literal notranslate"><span class="pre">[observation-spec-list]</span></code> An list of <a class="reference internal" href="#observation">Observation</a> objects.</p></li>
<li><p><cite>“checkpoint</cite>” <code class="docutils literal notranslate"><span class="pre">[checkpoint-spec]</span></code> A <a class="reference internal" href="#checkpoint">Checkpoint</a> spec.</p></li>
<li><p><cite>“PKs</cite>” <code class="docutils literal notranslate"><span class="pre">[pk-typedinline-spec-list]</span></code> A list of <a class="reference internal" href="#process-kernels">Process Kernels</a>.</p></li>
<li><p><cite>“state</cite>” <code class="docutils literal notranslate"><span class="pre">[state-spec]</span></code> A <a class="reference internal" href="#state">State</a> spec.</p></li>
</ul>
</div>
</section>
<section id="coordinator">
<h2><a class="toc-backref" href="#id19" role="doc-backlink">Coordinator</a><a class="headerlink" href="#coordinator" title="Permalink to this heading"></a></h2>
<p>In the <cite>“cycle driver</cite>” sublist, the user specifies global control of the
simulation, including starting and ending times and restart options.</p>
<div class="admonition-coordinator-spec admonition" id="coordinator-spec">
<p class="admonition-title">coordinator-spec</p>
<ul class="simple">
<li><p><cite>“start time</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.</strong> Specifies the start of time in model time.</p></li>
<li><p><cite>“start time units</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“s”</strong> One of “s”, “d”, or “yr”</p></li>
</ul>
<p>ONE OF</p>
<ul class="simple">
<li><p><cite>“end time</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Specifies the end of the simulation in model time.</p></li>
<li><p><cite>“end time units</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“s”</strong> One of <cite>“s</cite>”, <cite>“d</cite>”, or <cite>“yr</cite>”</p></li>
</ul>
<p>OR</p>
<ul>
<li><p><cite>“end cycle</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>optional</strong> If provided, specifies the end of the
simulation in timestep cycles.</p>
<p>END</p>
</li>
<li><p><cite>“subcycled timestep</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong>  If true, this coordinator creates
a third State object to store intermediate solutions, allowing for failed
steps.</p></li>
<li><p><cite>“restart from checkpoint file</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong> If provided,
specifies a path to the checkpoint file to continue a stopped simulation.</p></li>
<li><p><cite>“wallclock duration [hrs]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>optional</strong> After this time, the
simulation will checkpoint and end.</p></li>
<li><p><cite>“required times</cite>” <code class="docutils literal notranslate"><span class="pre">[io-event-spec]</span></code> <strong>optional</strong> An <a class="reference internal" href="#ioevent">IOEvent</a> spec that
sets a collection of times/cycles at which the simulation is guaranteed to
hit exactly.  This is useful for situations such as where data is provided at
a regular interval, and interpolation error related to that data is to be
minimized.</p></li>
<li><p><cite>“PK tree</cite>” <code class="docutils literal notranslate"><span class="pre">[pk-typed-spec-list]</span></code> List of length one, the top level
<a class="reference internal" href="#pk">PK</a> spec.</p></li>
</ul>
</div>
<p>Note: Either <cite>“end cycle</cite>” or <cite>“end time</cite>” are required, and if
both are present, the simulation will stop with whichever arrives
first.  An <cite>“end cycle</cite>” is commonly used to ensure that, in the case
of a time step crash, we do not continue on forever spewing output.</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;cycle driver&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w">  </span><span class="na">name=</span><span class="s">&quot;end cycle&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;6000&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w">  </span><span class="na">name=</span><span class="s">&quot;start time&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w">  </span><span class="na">name=</span><span class="s">&quot;start time units&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;s&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w">  </span><span class="na">name=</span><span class="s">&quot;end time&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w">  </span><span class="na">name=</span><span class="s">&quot;end time units&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;yr&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;required times&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;start period stop&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{0,-1,86400}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;PK tree&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;my richards pk&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;PK type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;richards&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="mesh">
<h2><a class="toc-backref" href="#id20" role="doc-backlink">Mesh</a><a class="headerlink" href="#mesh" title="Permalink to this heading"></a></h2>
<blockquote>
<div><p>A list of mesh objects and their domain names.</p>
</div></blockquote>
<p>All processes are simulated on a domain, which is discretized through a mesh.</p>
<p>Multiple domains and therefore meshes can be used in a single simulation, and
multiple meshes can be constructed on the fly.  The top level <cite>“mesh</cite>” is a
list of <code class="docutils literal notranslate"><span class="pre">[mesh-typed-spec]</span></code> sublists whose name indicate the mesh or domain
name.</p>
<p>Included in that list is at least one mesh: the <cite>“domain</cite>” mesh.  The
<cite>“domain</cite>” mesh represents the primary domain of simulation – usually the
subsurface.  Simple, structured meshes may be generated on the fly, or complex
unstructured meshes are provided as Exodus II files.  The <cite>“domain</cite>” mesh list
includes either a <a class="reference internal" href="#generated-mesh">Generated Mesh</a>, <a class="reference internal" href="#read-mesh-file">Read Mesh File</a>, or <a class="reference internal" href="#logical-mesh">Logical Mesh</a> spec, as
described below.</p>
<p>Additionally, a <a class="reference internal" href="#surface-mesh">Surface Mesh</a> may be formed by lifting the surface of a
provided mesh and then flattening that mesh to a 2D surface.  <a class="reference internal" href="#column-meshes">Column Meshes</a>
which split a base mesh into vertical columns of cells for use in 1D models
may also be generated automatically.</p>
<p>Finally, mesh generation is hard and error-prone.  A mesh audit is provided,
which checks for many common geometric and topologic errors in mesh
generation.  This is reasonably fast, even for big meshes, and can be done
through providing a “verify mesh” option.</p>
<div class="admonition-mesh-typed-spec admonition" id="mesh-typed-spec">
<p class="admonition-title">mesh-typed-spec</p>
<ul class="simple">
<li><p><cite>“mesh type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> One of:</p>
<ul>
<li><p><cite>“generate mesh</cite>” See <a class="reference internal" href="#generated-mesh">Generated Mesh</a>.</p></li>
<li><p><cite>“read mesh file</cite>” See <a class="reference internal" href="#read-mesh-file">Read Mesh File</a>.</p></li>
<li><p><cite>“logical</cite>” See <a class="reference internal" href="#logical-mesh">Logical Mesh</a>.</p></li>
<li><p><cite>“surface</cite>” See <a class="reference internal" href="#surface-mesh">Surface Mesh</a>.</p></li>
<li><p><cite>“subgrid</cite>” See <a class="reference internal" href="#subgrid-meshes">Subgrid Meshes</a>.</p></li>
<li><p><cite>“column</cite>” See <a class="reference internal" href="#column-meshes">Column Meshes</a>.</p></li>
</ul>
</li>
<li><p><cite>“_mesh_type_ parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[_mesh_type_-spec]</span></code> List of parameters
associated with the type.</p></li>
<li><p><cite>“verify mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Perform a mesh audit.</p></li>
<li><p><cite>“deformable mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Will this mesh be deformed?</p></li>
<li><p><cite>“build columns from set</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong> If provided, build
columnar structures from the provided set.</p></li>
<li><p><cite>“partitioner</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>zoltan_rcb</strong> Method to partition the
mesh.  Note this only makes sense on the domain mesh.  One of:</p>
<ul>
<li><p><cite>“zoltan_rcb</cite>” a “map view” partitioning that keeps columns of cells together</p></li>
<li><p><cite>“metis</cite>” uses the METIS graph partitioner</p></li>
<li><p><cite>“zoltan</cite>” uses the default Zoltan graph-based partitioner.</p></li>
</ul>
</li>
</ul>
</div>
<section id="generated-mesh">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Generated Mesh</a><a class="headerlink" href="#generated-mesh" title="Permalink to this heading"></a></h3>
<p>Generated mesh are by definition structured, with uniform dx, dy, and dz.
Such a mesh is specified by a bounding box high and low coordinate, and a list
of number of cells in each direction.</p>
<p>Specified by <cite>“mesh type</cite>” of <cite>“generate mesh</cite>”.</p>
<div class="admonition-mesh-generate-mesh-spec admonition" id="mesh-generate-mesh-spec">
<p class="admonition-title">mesh-generate-mesh-spec</p>
<ul class="simple">
<li><p><cite>“domain low coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of low corner of domain</p></li>
<li><p><cite>“domain high coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of high corner of domain</p></li>
<li><p><cite>“number of cells</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code> the number of uniform cells in each coordinate direction</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mesh&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;domain&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mesh type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;generate mesh&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;generate mesh parameters&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;number of cells&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{100, 1, 100}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;domain low coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{0.0, 0.0, 0.0}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;domain high coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{100.0, 1.0, 10.0}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="read-mesh-file">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Read Mesh File</a><a class="headerlink" href="#read-mesh-file" title="Permalink to this heading"></a></h3>
<p>Meshes can be pre-generated in a multitude of ways, then written to file, and
loaded in ATS. Note that in the case of an Exodus II mesh file, the suffix of
the serial mesh file must be .exo and the suffix of the parallel mesh file must
be .par.  When running in serial the code will read this the indicated file
directly.  When running in parallel with a prepartitioned mesh, the suffix is
.par and the code will instead read the partitioned files that have been
generated with a Nemesis tool and named as filename.par.N.r where N is the
number of processors and r is the rank.  When running in parallel and the
suffix is .exo, the code will partition automatically the serial file.</p>
<p>Specified by <cite>“mesh type</cite>” of <cite>“read mesh file</cite>”.</p>
<div class="admonition-mesh-read-mesh-file-spec admonition" id="mesh-read-mesh-file-spec">
<p class="admonition-title">mesh-read-mesh-file-spec</p>
<ul class="simple">
<li><p><cite>“file</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> filename of a pre-generated mesh file</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mesh&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;domain&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mesh type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;read mesh file&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;read mesh file parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;file&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;mesh_filename.exo&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;verify mesh&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;bool&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="logical-mesh">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Logical Mesh</a><a class="headerlink" href="#logical-mesh" title="Permalink to this heading"></a></h3>
<p>Logical meshes are meshes for whom nodal coordinates may not be
specified, but sufficient information about the geometry of the
conceptual domain can be specified to allow solving problems.  This
allows for the conceptual generation of domains that “act” like a mesh
and can be used like a mesh, but don’t fit MSTK’s view of an
unstructured mesh.</p>
<p>This is an active research and development area, and is used most
frequently for river networks, root networks, and crack networks.</p>
<p>Specified by <cite>“mesh type</cite>” of <cite>“logical</cite>”.</p>
<div class="admonition-mesh-logical-spec admonition" id="mesh-logical-spec">
<p class="admonition-title">mesh-logical-spec</p>
<p>Not yet completed…</p>
</div>
</section>
<section id="surface-mesh">
<h3><a class="toc-backref" href="#id24" role="doc-backlink">Surface Mesh</a><a class="headerlink" href="#surface-mesh" title="Permalink to this heading"></a></h3>
<p>To lift a surface off of the mesh, a side-set specifying all surface faces
must be given.  These faces are lifted locally, so the partitioning of the
surface cells will be identical to the partitioning of the subsurface faces
that correspond to these cells.  All communication and ghost cells are set up.
The mesh is flattened, so all surface faces must have non-zero area when
projected in the z-direction.  No checks for holes are performed.  Surface
meshes may similarly be audited to make sure they are reasonable for
computation.</p>
<p>Specified by <cite>“mesh type</cite>” of <cite>“surface</cite>”.</p>
<div class="admonition-mesh-surface-spec admonition" id="mesh-surface-spec">
<p class="admonition-title">mesh-surface-spec</p>
<p>ONE OF</p>
<ul class="simple">
<li><p><cite>“surface sideset name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The <a class="reference internal" href="#region">Region</a> name containing all surface faces.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“surface sideset names</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> A list of <a class="reference internal" href="#region">Region</a> names containing the surface faces.</p></li>
</ul>
<p>END</p>
<ul class="simple">
<li><p><cite>“verify mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Verify validity of surface mesh.</p></li>
<li><p><cite>“export mesh to file</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong> Export the lifted
surface mesh to this filename.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mesh&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;surface&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mesh type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;surface&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;surface parameters&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;surface sideset name&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{surface_region}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;verify mesh&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;bool&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;export mesh to file&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;surface_mesh.exo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;domain&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mesh type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;read mesh file&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;read mesh file parameters&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;file&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;../data/open-book-2D.exo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;format&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Exodus II&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="aliased-mesh">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">Aliased Mesh</a><a class="headerlink" href="#aliased-mesh" title="Permalink to this heading"></a></h3>
<p>Aliased domains are simply domains that share a mesh with another domain.  For
instance, one might find it useful to define both a “surface water” and a
“snow” domain that share a common “surface” mesh.  In that case, typically the
“surface” domain would point to the “surface” mesh, and the “snow” domain would
be an “aliased” domain whose target is the “surface” mesh.</p>
<p>Specified by <cite>“mesh type</cite>” of <cite>“aliased</cite>”.</p>
<div class="admonition-mesh-aliased-spec admonition" id="mesh-aliased-spec">
<p class="admonition-title">mesh-aliased-spec</p>
<ul class="simple">
<li><p><cite>“target</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Mesh that this alias points to.</p></li>
</ul>
</div>
</section>
<section id="subgrid-meshes">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">Subgrid Meshes</a><a class="headerlink" href="#subgrid-meshes" title="Permalink to this heading"></a></h3>
<p>A collection of meshes formed by associating a new mesh with each entity of a
region.  Used for a few cases, including generating a 1D column for each
surface face of a semi-structured subsurface mesh, or for hanging logical
meshes off of each surface cell as a subgrid model, etc.</p>
<p>The subgrid meshes are then named <cite>“MESH_NAME_X”</cite> for each X, which is an
entity local ID, in a provided region of the provided entity type.</p>
<p>Specified by <cite>“mesh type</cite>” of <cite>“subgrid</cite>”.</p>
<div class="admonition-mesh-subgrid-spec admonition" id="mesh-subgrid-spec">
<p class="admonition-title">mesh-subgrid-spec</p>
<ul class="simple">
<li><p><cite>“subgrid region name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Region on which each subgrid mesh will be associated.</p></li>
<li><p><cite>“entity kind</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> One of <cite>“cell</cite>”, <cite>“face</cite>”, etc.  Entity of the
region (usually <cite>“cell</cite>”) on which each subgrid mesh will be associated.</p></li>
<li><p><cite>“parent domain</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>domain</strong> Mesh which includes the above region.</p></li>
<li><p><cite>“flyweight mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>False</strong> NOT YET SUPPORTED.  Allows a single
mesh instead of one per entity.</p></li>
</ul>
</div>
</section>
<section id="column-meshes">
<h3><a class="toc-backref" href="#id27" role="doc-backlink">Column Meshes</a><a class="headerlink" href="#column-meshes" title="Permalink to this heading"></a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Note these are rarely if ever created manually by a user.  Instead use
<a class="reference internal" href="#subgrid-meshes">Subgrid Meshes</a>, which generate a column mesh spec for every face
of a set.</p>
</div>
<p>Specified by <cite>“mesh type</cite>” of <cite>“column</cite>”.</p>
<div class="admonition-mesh-column-spec admonition" id="mesh-column-spec">
<p class="admonition-title">mesh-column-spec</p>
<ul class="simple">
<li><p><cite>“parent domain</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The name of the 3D mesh from which columns are generated.
Note that the <cite>“build columns from set</cite>” parameter must be set in that mesh.</p></li>
<li><p><cite>“entity LID</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> Local ID of the surface cell that is the top of the column.</p></li>
<li><p><cite>“verify mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Verify validity of surface mesh.</p></li>
<li><p><cite>“deformable mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong>  Used for deformation PKs to allow non-const access.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mesh&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;column&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;column parameters&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;parent domain&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;domain&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;entity LID&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;domain&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mesh type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;read mesh file&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;read mesh file parameters&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;file&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;../data/open-book-2D.exo&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;format&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Exodus II&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="region">
<h2><a class="toc-backref" href="#id28" role="doc-backlink">Region</a><a class="headerlink" href="#region" title="Permalink to this heading"></a></h2>
<blockquote>
<div><p>A geometric or discrete subdomain of the full domain.</p>
</div></blockquote>
<p>Regions are geometrical constructs used to define subsets of
the computational domain in order to specify the problem to be solved, and the
output desired. Regions may represents zero-, one-, two- or three-dimensional
subsets of physical space.  For a three-dimensional problem, the simulation
domain will be a three-dimensional region bounded by a set of two-dimensional
regions.  If the simulation domain is N-dimensional, the boundary conditions
must be specified over a set of regions are (N-1)-dimensional.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Surface files contain labeled triangulated face sets.  The user is
responsible for ensuring that the intersections with other surfaces in the
problem, including the boundaries, are <em>exact</em> (<em>i.e.</em> that surface
intersections are <em>watertight</em> where applicable), and that the surfaces are
contained within the computational domain.  If nodes in the surface fall
outside the domain, the elements they define are ignored.</p>
<p>Examples of surface files are given in the <em>Exodus II</em> file format here.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Region names must NOT be repeated.</p>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList&gt;</span><span class="w">  </span><span class="cm">&lt;!-- parent list --&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;TOP SECTION&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: box&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;low coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{2, 3, 5}&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;high coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{4, 5, 8}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;MIDDLE SECTION&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: box&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;low coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{2, 3, 3}&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;high coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{4, 5, 5}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BOTTOM SECTION&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: box&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;low coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{2, 3, 0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;high coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{4, 5, 3}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;INFLOW SURFACE&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: labeled set&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="w">  </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;sideset_2&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;file&quot;</span><span class="w">   </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;F_area_mesh.exo&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;format&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Exodus II&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;entity&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;face&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;OUTFLOW PLANE&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: plane&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;point&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{0.5, 0.5, 0.5}&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;normal&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{0, 0, 1}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BLOODY SAND&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: color function&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;file&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;F_area_col.txt&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;25&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;FLUX PLANE&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: polygon&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;number of points&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;5&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;points&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{-0.5, -0.5, -0.5,</span>
<span class="s">                                                               0.5, -0.5, -0.5,</span>
<span class="s">                                                               0.8, 0.0, 0.0,</span>
<span class="s">                                                               0.5,  0.5, 0.5,</span>
<span class="s">                                                              -0.5, 0.5, 0.5}&quot;</span><span class="nt">/&gt;</span>
<span class="w">       </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>In this example, <em>TOP SECTION</em>, <em>MIDDLE SECTION</em> and <em>BOTTOM SECTION</em>
are three box-shaped volumetric regions. <em>INFLOW SURFACE</em> is a
surface region defined in an Exodus II-formatted labeled set
file and <em>OUTFLOW PLANE</em> is a planar region. <em>BLOODY SAND</em> is a volumetric
region defined by the value 25 in color function file.</p>
<nav class="contents local" id="region-types">
<p class="topic-title"><strong>Region Types</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#all" id="id67">All</a></p></li>
<li><p><a class="reference internal" href="#box" id="id68">Box</a></p></li>
<li><p><a class="reference internal" href="#plane" id="id69">Plane</a></p></li>
<li><p><a class="reference internal" href="#labeled-set" id="id70">Labeled Set</a></p></li>
<li><p><a class="reference internal" href="#function-color" id="id71">Function Color</a></p></li>
<li><p><a class="reference internal" href="#point" id="id72">Point</a></p></li>
<li><p><a class="reference internal" href="#logical" id="id73">Logical</a></p></li>
<li><p><a class="reference internal" href="#polygon" id="id74">Polygon</a></p></li>
<li><p><a class="reference internal" href="#enumerated" id="id75">Enumerated</a></p></li>
<li><p><a class="reference internal" href="#boundary" id="id76">Boundary</a></p></li>
<li><p><a class="reference internal" href="#box-volume-fractions" id="id77">Box Volume Fractions</a></p></li>
<li><p><a class="reference internal" href="#line-segment" id="id78">Line Segment</a></p></li>
</ul>
</nav>
<section id="all">
<h3><a class="toc-backref" href="#id67" role="doc-backlink">All</a><a class="headerlink" href="#all" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>A region consisting of all entities on a mesh.</p>
</div></blockquote>
<p>No parameters required.</p>
<p><code class="docutils literal notranslate"><span class="pre">[region-all-spec]</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p><cite>“empty</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>True</strong> This is simply here to avoid issues with
empty lists.</p></li>
</ul>
</div></blockquote>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;domain&quot;</span><span class="nt">&gt;</span><span class="w">  </span><span class="cm">&lt;!-- parent list --&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: all&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="box">
<h3><a class="toc-backref" href="#id68" role="doc-backlink">Box</a><a class="headerlink" href="#box" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>RegionBox: a rectangular region in space, defined by two corners</p>
</div></blockquote>
<p>List <em>region: box</em> defines a region bounded by coordinate-aligned
planes. Boxes are allowed to be of zero thickness in only one
direction in which case they are equivalent to planes.</p>
<div class="admonition-region-box-spec admonition" id="region-box-spec">
<p class="admonition-title">region-box-spec</p>
<ul class="simple">
<li><p><cite>“low coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of the boundary point with the lowest coordinates.</p></li>
<li><p><cite>“high coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of the boundary points with the highest coordinates.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;WELL&quot;</span><span class="nt">&gt;</span><span class="w">  </span><span class="cm">&lt;!-- parent list --&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: box&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;low coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{-5.0,-5.0, -5.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;high coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{5.0, 5.0,  5.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="plane">
<h3><a class="toc-backref" href="#id69" role="doc-backlink">Plane</a><a class="headerlink" href="#plane" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>RegionPlane: A planar (infinite) region in space, defined by a point and a normal.</p>
</div></blockquote>
<p>List <em>region: plane</em> defines a plane using a point lying on the plane and normal to the plane.</p>
<div class="admonition-region-plane-spec admonition" id="region-plane-spec">
<p class="admonition-title">region-plane-spec</p>
<ul class="simple">
<li><p><cite>“normal</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Normal to the plane.</p></li>
<li><p><cite>“point</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Point in space.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;TOP_SECTION&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- parent list --&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: plane&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;point&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{2, 3, 5}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;normal&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{1, 1, 0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;expert parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tolerance&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0e-05&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="labeled-set">
<h3><a class="toc-backref" href="#id70" role="doc-backlink">Labeled Set</a><a class="headerlink" href="#labeled-set" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>RegionLabeledSet: A region defined by a set of mesh entities in a mesh file</p>
</div></blockquote>
<p>The list <em>region: labeled set</em> defines a named set of mesh entities
existing in an input mesh file. This is the same file that contains
the computational mesh. The name of the entity set is given
by <em>label</em>.  For example, a mesh file in the Exodus II
format can be processed to tag cells, faces and/or nodes with
specific labels, using a variety of external tools. Regions based
on such sets are assigned a user-defined label for Amanzi, which may
or may not correspond to the original label in the exodus file.
Note that the file used to express this labeled set may be in any
Amanzi-supported mesh format (the mesh format is specified in the
parameters for this option).  The <em>entity</em> parameter may be
necessary to specify a unique set.  For example, an Exodus file
requires <em>cell</em>, <em>face</em> or <em>node</em> as well as a label (which is
an integer).  The resulting region will have the dimensionality
associated with the entities in the indicated set.</p>
<div class="admonition-region-labeled-set-spec admonition" id="region-labeled-set-spec">
<p class="admonition-title">region-labeled-set-spec</p>
<ul class="simple">
<li><p><cite>“label</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Set per label defined in the mesh file.</p></li>
<li><p><cite>“file</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> File name.</p></li>
<li><p><cite>“format</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Currently, we only support mesh files in the “Exodus II” format.</p></li>
<li><p><cite>“entity</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Type of the mesh object (cell, face, etc).</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;AQUIFER&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: labeled set&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;entity&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;cell&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;file&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;porflow4_4.exo&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;format&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Exodus II&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;label&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="function-color">
<h3><a class="toc-backref" href="#id71" role="doc-backlink">Function Color</a><a class="headerlink" href="#function-color" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>RegionFunctionColor: A region defined by the value of an indicator function in a file.</p>
</div></blockquote>
<p>The list <em>region: color function</em> defines a region based a specified integer
color, <em>value</em>, in a structured color function file, <em>file</em>.  The format of
the color function file is given below in the “Tabulated function file format”
section. As shown in the file, the color values may be specified at the nodes
or cells of the color function grid. A computational cell is assigned the
‘color’ of the data grid cell containing its cell centroid (cell-based colors)
or the data grid nearest its cell-centroid (node-based colors). Computational
cells sets are then built from all cells with the specified color <em>Value</em>.</p>
<p>In order to avoid, gaps and overlaps in specifying materials, it is strongly
recommended that regions be defined using a single color function file.</p>
<div class="admonition-region-color-function-spec admonition" id="region-color-function-spec">
<p class="admonition-title">region-color-function-spec</p>
<ul class="simple">
<li><p><cite>“file</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> File name containing color function.</p></li>
<li><p><cite>“value</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> Color that defines the set in the tabulated function file.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;SOIL_TOP&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: color function&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;file&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;geology_resamp_2D.tf3&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="point">
<h3><a class="toc-backref" href="#id72" role="doc-backlink">Point</a><a class="headerlink" href="#point" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>RegionPoint: a point in space.</p>
</div></blockquote>
<p>List <em>region: point</em> defines a point in space.
This region consists of cells containing this point.</p>
<div class="admonition-region-point-spec admonition" id="region-point-spec">
<p class="admonition-title">region-point-spec</p>
<ul class="simple">
<li><p><cite>“coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of point in space.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;DOWN_WIND150&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- parent list defining the name --&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: point&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{-150.0, 0.0, 0.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="logical">
<h3><a class="toc-backref" href="#id73" role="doc-backlink">Logical</a><a class="headerlink" href="#logical" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>RegionLogical: A region defined by a logical operation on one or two other regions</p>
</div></blockquote>
<p>The list <em>region: logical</em> defines logical operations on regions allow for
more advanced region definitions. At this time the logical region allows for
logical operations on a list of regions.  <em>union</em> and <em>intersection</em> are
self-evident. In the case of <em>subtraction</em>, subtraction is performed from the
first region in the list.  The <em>complement</em> is a special case in that it is
the only case that operates on single region, and returns the complement to it
within the domain ENTIRE_DOMAIN.  Currently, multi-region booleans are not
supported in the same expression.</p>
<div class="admonition-region-logical-spec admonition" id="region-logical-spec">
<p class="admonition-title">region-logical-spec</p>
<ul class="simple">
<li><p><cite>“operation</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> defines operation on the list of regions.
One of: <cite>“union</cite>”, <cite>“intersect</cite>”, <cite>“subtract</cite>”, <cite>“complement</cite>”</p></li>
<li><p><cite>“regions</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> specifies the list of involved regions.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;LOWER_LAYERs&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: logical&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;operation&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;union&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{Middle1, Middle2, Bottom}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="polygon">
<h3><a class="toc-backref" href="#id74" role="doc-backlink">Polygon</a><a class="headerlink" href="#polygon" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>RegionPolygon: A closed polygonal segment of a plane.</p>
</div></blockquote>
<p>The list <em>region: polygon</em> defines a polygonal region on which mesh faces and
nodes can be queried. NOTE that one cannot ask for cells in a polygonal surface
region. In 2D, the polygonal region is a line and is specified by 2 points.
In 3D, the polygonal region is specified by an arbitrary number of points.
In both cases the point coordinates are given as a linear array. The polygon
can be non-convex.</p>
<p>This provides a set of faces with a normal for computing flux.</p>
<p>The polygonal surface region can be queried for a normal. In 2D, the normal is
defined as [Vy,-Vx] where [Vx,Vy] is the vector from point 1 to point 2.
In 3D, the normal of the polygon is defined by the order in which points
are specified.</p>
<p><code class="docutils literal notranslate"><span class="pre">[region-polygon-spec]</span></code></p>
<ul class="simple">
<li><p><cite>“number of points</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> Number of polygon points.</p></li>
<li><p><cite>“points</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Point coordinates in a linear array.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;XY_PENTAGON&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: polygon&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;number of points&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;5&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;points&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{-0.5, -0.5, -0.5,</span>
<span class="s">                                                           0.5, -0.5, -0.5,</span>
<span class="s">                                                           0.8, 0.0, 0.0,</span>
<span class="s">                                                           0.5,  0.5, 0.5,</span>
<span class="s">                                                          -0.5, 0.5, 0.5}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;expert parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tolerance&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0e-3&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="enumerated">
<h3><a class="toc-backref" href="#id75" role="doc-backlink">Enumerated</a><a class="headerlink" href="#enumerated" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>RegionEnumerated: A region enumerated as a list of IDs.</p>
</div></blockquote>
<p>List <em>region: enumerated set</em> defines a set of mesh entities via the list
of input global ids. Note that global ids are not defined correctly when
parallel mesh is created on a fly.</p>
<div class="admonition-region-enumerated-spec admonition" id="region-enumerated-spec">
<p class="admonition-title">region-enumerated-spec</p>
<ul class="simple">
<li><p><cite>“entity</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Type of the mesh object.  One of: <cite>“cell</cite>”, <cite>“face</cite>”, <cite>“edge</cite>”, <cite>“node</cite>”</p></li>
<li><p><cite>“entity gids</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code> List of the global IDs of the entities.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;WELL&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- parent list --&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: enumerated set&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;entity&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;face&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;entity gids&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{1, 12, 23, 34}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="boundary">
<h3><a class="toc-backref" href="#id76" role="doc-backlink">Boundary</a><a class="headerlink" href="#boundary" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>RegionBoundary:  A region consisting of all entities on the domain boundary</p>
</div></blockquote>
<p>List <em>region: boundary</em> defines a set of all boundary faces.
Using this definition, faces located on the domain boundary are extracted.</p>
<div class="admonition-region-boundary-spec admonition" id="region-boundary-spec">
<p class="admonition-title">region-boundary-spec</p>
<ul class="simple">
<li><p><cite>“entity</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Type of the mesh object.  Unclear whether this is
used or can be other things than <cite>“face</cite>”?</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;DOMAIN_BOUNDARY&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- parent list names the region --&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: boundary&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;entity&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;face&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="box-volume-fractions">
<h3><a class="toc-backref" href="#id77" role="doc-backlink">Box Volume Fractions</a><a class="headerlink" href="#box-volume-fractions" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>RegionBoxVolumeFractions: A rectangular region in space, defined by two corner points and normals to sides.</p>
</div></blockquote>
<p>List <em>region: box volume fraction</em> defines a region bounded by a box <em>not</em>
aligned with coordinate axes.
Boxes are allowed to be of zero thickness in only one direction in which case
they are equivalent to rectangles on a plane or segments on a line.</p>
<div class="admonition-region-box-volume-fractions-spec admonition" id="region-box-volume-fractions-spec">
<p class="admonition-title">region-box-volume-fractions-spec</p>
<ul class="simple">
<li><p><cite>“corner coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of one box corner.</p></li>
<li><p><cite>“opposite corner coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of the opposite box corner.</p></li>
<li><p><cite>“normals</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Normals to sides in a linear array. Default is columns of
the identity matrix. The normals may be scaled arbitrarily but must be orthogonal to
one another and form the right coordinate frame.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BASIN&quot;</span><span class="nt">&gt;</span><span class="w">  </span><span class="cm">&lt;!-- parent list --&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: box volume fractions&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;corner coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{-1.0,-1.0, 1.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;opposite corner coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{1.0, 1.0, 1.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;normals&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{1.0, 0.0, 0.0</span>
<span class="s">                                                           0.0, 2.0, 0.0,</span>
<span class="s">                                                           0.0, 0.0, 3.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>This example defines a degenerate box, a square on a surface <em>z=1</em>.</p>
</section>
<section id="line-segment">
<h3><a class="toc-backref" href="#id78" role="doc-backlink">Line Segment</a><a class="headerlink" href="#line-segment" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>RegionLineSegment: A line segment, defined by two points in space.</p>
</div></blockquote>
<p>List <em>region: line segment</em> desribes a region defined by a line
segment. This region is a set of cells which intersect with a line
segment.  The line segment is allowed to intersect with one or more cells. Zero length
line segments are allowed. The line segment is defined by its ends
points.</p>
<div class="admonition-region-line-segment-spec admonition" id="region-line-segment-spec">
<p class="admonition-title">region-line-segment-spec</p>
<ul class="simple">
<li><p><cite>“end coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of one end of a line
segment.</p></li>
<li><p><cite>“opposite end coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of the opposite
end of a line segment.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;WELL&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- parent list --&gt;</span>
<span class="w">   </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region: line segment&quot;</span><span class="nt">&gt;</span>
<span class="w">     </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;end coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{497542.44, 5393755.77, 0.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;opposite end coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{497542.44, 5393755.77, 100.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w"> </span><span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="visualization">
<h2><a class="toc-backref" href="#id41" role="doc-backlink">Visualization</a><a class="headerlink" href="#visualization" title="Permalink to this heading"></a></h2>
<blockquote>
<div><p>Manages simulation output to disk.</p>
</div></blockquote>
<p>A user may request periodic writes of field data for the purposes of
visualization in the <cite>“visualization</cite>” sublists.</p>
<p>ATS accepts a visualization list for each domain/mesh, including surface and
column meshes.  These are in separate ParameterLists, entitled
<cite>“visualization</cite>” for the main mesh, and <cite>“visualization surface</cite>” on the
surface mesh.  It is expected that, for any addition meshes, each will have a
domain name and therefore admit a spec of the form: <cite>“visualization
DOMAIN-NAME</cite>”.</p>
<div class="admonition-visualization-spec admonition" id="visualization-spec">
<p class="admonition-title">visualization-spec</p>
<ul class="simple">
<li><p><cite>“file name base</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>visdump_DOMAIN_data</strong></p></li>
<li><p><cite>“dynamic mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Write mesh data for every
visualization dump; this facilitates visualizing deforming meshes.</p></li>
<li><p><cite>“time unit</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>s</strong> A valid time unit to convert time
into for output files.  One of <cite>“s</cite>”, <cite>“d</cite>”, <cite>“y</cite>”, or <cite>“yr 365</cite>”</p></li>
</ul>
<p>INCLUDES:
- <code class="docutils literal notranslate"><span class="pre">[io-event-spec]</span></code> An <a class="reference internal" href="#ioevent">IOEvent</a> spec</p>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;visualization&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;file name base&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;visdump_data&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;cycles start period stop&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{0, 100, -1}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;cycles&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{999, 1001}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;times start period stop 0&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{0.0, 10.0, 100.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;times start period stop 1&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{100.0, 25.0, -1.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;times&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{101.0, 303.0, 422.0}&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dynamic mesh&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;bool&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="checkpoint">
<h2><a class="toc-backref" href="#id42" role="doc-backlink">Checkpoint</a><a class="headerlink" href="#checkpoint" title="Permalink to this heading"></a></h2>
<blockquote>
<div><p>Manages checkpoint/restart capability.</p>
</div></blockquote>
<p>A user may request periodic dumps of ATS Checkpoint Data in the
<cite>“checkpoint</cite>” sublist.  The user has no explicit control over the
content of these files, but has the guarantee that the ATS run will be
reproducible (with accuracies determined by machine round errors and
randomness due to execution in a parallel computing environment).
Therefore, output controls for Checkpoint Data are limited to file
name generation and writing frequency, by numerical cycle number.
Unlike <cite>“visualization</cite>”, there is only one <cite>“checkpoint</cite>” list for
all domains/meshes.</p>
<div class="admonition-checkpoint-spec admonition" id="checkpoint-spec">
<p class="admonition-title">checkpoint-spec</p>
<ul class="simple">
<li><p><cite>“file name base</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“checkpoint”</strong></p></li>
<li><p><cite>“file name digits</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>5</strong></p></li>
<li><p><cite>“single file checkpoint</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> If true, writes all
checkpoint to one file.  If false, uses a subdirectory with one file per
mesh.  false is required if meshes exist on other communicators than
MPI_COMM_WORLD, but this is toggled if the code detects that this is
necessary.</p></li>
</ul>
<p>INCLUDES:
- <code class="docutils literal notranslate"><span class="pre">[io-event-spec]</span></code> An <a class="reference internal" href="#ioevent">IOEvent</a> spec</p>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;checkpoint&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;cycles start period stop&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{0, 100, -1}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;cycles&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{999, 1001}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;times start period stop 0&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{0.0, 10.0, 100.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;times start period stop 1&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{100.0, 25.0, -1.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;times&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{101.0, 303.0, 422.0}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>In this example, checkpoint files are written when the cycle number is
a multiple of 100, every 10 seconds for the first 100 seconds, and
every 25 seconds thereafter, along with times 101, 303, and 422.  Files will be written in the form: <cite>“checkpoint00000.h5</cite>”.</p>
</section>
<section id="observation">
<h2><a class="toc-backref" href="#id43" role="doc-backlink">Observation</a><a class="headerlink" href="#observation" title="Permalink to this heading"></a></h2>
<div class="admonition-observation-spec admonition" id="observation-spec">
<p class="admonition-title">observation-spec</p>
<ul class="simple">
<li><p><cite>“observation output filename</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> user-defined name for the file
that the observations are written to.</p></li>
<li><p><cite>“delimiter</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>COMMA</strong> Delimiter to split columns of the file</p></li>
<li><p><cite>“write interval</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1</strong> Interval of observations on which to flush IO files.</p></li>
<li><p><cite>“time units</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>s</strong> Controls the unit of the time column in the observation file.</p></li>
<li><p><cite>“domain</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“domain”</strong> Can be used to set the communicator which writes (defaults to the standard subsurface domain).</p></li>
<li><p><cite>“observed quantities</cite>” <code class="docutils literal notranslate"><span class="pre">[observable-spec-list]</span></code> A list of <a class="reference external" href="Collects,reduces,andwritesobservationsduringasimulation.">Observable</a>
objects that are all put in the same file.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[io-event-spec]</span></code> An <a class="reference internal" href="#ioevent">IOEvent</a> spec</p></li>
</ul>
</div>
<p>Note, for backwards compatibility, an <code class="docutils literal notranslate"><span class="pre">observable-spec</span></code> may be directly
included within the <cite>observation-spec</cite> if it is the only variable to be
observed in this file.</p>
<p>Observations are a localized-in-space but frequent-in-time view of simulation
output, designed to get at useful diagnostic quantities such as hydrographs,
total water content, quantities at a point, etc.  These allow frequent
collection in time without saving huge numbers of visualization files to do
postprocessing.  In fact, these should be though of as orthogonal data queries
to visualization – vis is pointwise in time but complete in space, while
observations are pointwise/finite in space but complete in time.</p>
<p>Observables describe what is observed – the variable, region,
integration/averaging scheme, etc.</p>
<p>A user may request any number of specific observables.  Each observable spec
involves a field quantity, a reduction reduction operator, a region from which
it will extract its source data, and a list of discrete times for its
evaluation.  The observations are evaluated during the simulation and written
to disk by the <a class="reference external" href="CollectionofObservationsonanunstructuredmeshtobewrittentoacommonfile.">UnstructuredObservation</a> object.</p>
<div class="admonition-observable-spec admonition" id="observable-spec">
<p class="admonition-title">observable-spec</p>
<ul class="simple">
<li><p><cite>“variable</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> any ATS variable used by any PK, e.g. <cite>“pressure</cite>”
or <cite>“surface-water_content</cite>”</p></li>
<li><p><cite>“region</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> the label of a user-defined region</p></li>
<li><p><cite>“location name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>cell</strong> The mesh location of the thing to
be measured, i.e. <cite>“cell</cite>”, <cite>“face</cite>”, or <cite>“node</cite>”</p></li>
<li><p><cite>“number of vectors</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1</strong> Number of vector components to write.</p></li>
<li><p><cite>“degree of freedom</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>-1</strong> Degree of freedom to write.  Default
of -1 implies writing all degrees of freedom.</p></li>
<li><p><cite>“reduction</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> the type of function to apply to the variable
on the region.  One of:</p>
<ul>
<li><p><cite>“point</cite>” returns the value of the field quantity at a
point.  The region and location name should result in a single entity being
selected.</p></li>
<li><p><cite>“average</cite>” returns the volume-weighted average of
the field across all entities in the region selected.  This is likely
what you want for intensive state variables such as <cite>“temperature</cite>” or
<cite>“saturation_liquid</cite>”.</p></li>
<li><p><cite>“integral</cite>” returns the volume-weighted sum of a
variable over the region.  This should be used for example on intensive
sources, for instance <cite>“surface-precipitation</cite>”, to get the total
source/sink.</p></li>
<li><p><cite>“extensive integral</cite>” returns the sum of an variable
over the region.  This should be used for extensive quantities such as
<cite>“water_content</cite>” or <cite>“energy</cite>” which already include the volume in
their value.</p></li>
<li><p><cite>“minimum</cite>” returns the min value over the region</p></li>
<li><p><cite>“maximum</cite>” returns the max value over the region</p></li>
</ul>
</li>
<li><p><cite>“modifier</cite>” <code class="docutils literal notranslate"><span class="pre">[function-typedinline-spec]</span></code> <strong>optional</strong> If provided, defines a
function used to modify the <cite>“variable</cite>” prior to applying the
<cite>“reduction</cite>”.</p></li>
<li><p><cite>“direction normalized flux</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> For flux observations,
dots the face-normal flux with a vector to ensure fluxes are integrated
pointing the same direction.</p></li>
<li><p><cite>“direction normalized flux direction</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> <strong>optional</strong> For
flux observations, provides the vector to dot the face normal with.  If this
is not provided, then it is assumed that the faces integrated over are all
boundary faces and that the default vector is the outward normal direction
for each face.</p></li>
<li><p><cite>“direction normalized flux relative to region</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong>
If provided, the flux observation is assumed to be on a set of faces
which are the exterior of a volumetric region.  This region provides that
volume, and fluxes are oriented in the “outward normal” direction
relative to this region’s interior.</p></li>
<li><p><cite>“time integrated</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, observe the
time-integral, observing on all cycles and accumulating the
backwards-Euler product of dt times the observable at the new time.</p></li>
</ul>
</div>
</section>
<section id="process-kernels">
<h2><a class="toc-backref" href="#id44" role="doc-backlink">Process Kernels</a><a class="headerlink" href="#process-kernels" title="Permalink to this heading"></a></h2>
<p id="pk">Process Kernels, or PKs, are the fundamental unit of a model, and
represent a single or system of Partial Differential Equations (PDEs)
or Differential Algebraic Equations (DAEs).  PKs are broadly split
into individual equations (Physical PKs) and systems of equations,
called Multi-Process Coordinators (MPCs).</p>
<p>The PK tree forms the fundamental definition of the entire system of
equations to be solved by the simulator, and is represented by a
single PK or a single MPC which couples other MPCs and/or Physical
PKs.</p>
<nav class="contents local" id="list-of-pks">
<p class="topic-title"><strong>List of PKs</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#base-pks" id="id79">Base PKs</a></p>
<ul>
<li><p><a class="reference internal" href="#pk-base-class" id="id80">PK base class</a></p></li>
<li><p><a class="reference internal" href="#pk-physical" id="id81">PK: Physical</a></p></li>
<li><p><a class="reference internal" href="#pk-bdf" id="id82">PK: BDF</a></p></li>
<li><p><a class="reference internal" href="#pk-physical-and-bdf" id="id83">PK: Physical and BDF</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#physical-pks" id="id84">Physical PKs</a></p>
<ul>
<li><p><a class="reference internal" href="#flow-pks" id="id85">Flow PKs</a></p>
<ul>
<li><p><a class="reference internal" href="#richards-pk" id="id86">Richards PK</a></p></li>
<li><p><a class="reference internal" href="#permafrost-flow-pk" id="id87">Permafrost Flow PK</a></p></li>
<li><p><a class="reference internal" href="#overland-flow-pk" id="id88">Overland Flow PK</a></p></li>
<li><p><a class="reference internal" href="#overland-flow-with-ice" id="id89">Overland Flow with Ice</a></p></li>
<li><p><a class="reference internal" href="#snow-distribution-pk" id="id90">Snow Distribution PK</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#transport-pk" id="id91">Transport PK</a></p></li>
<li><p><a class="reference internal" href="#energy-pks" id="id92">Energy PKs</a></p>
<ul>
<li><p><a class="reference internal" href="#energy-base-pk" id="id93">Energy Base PK</a></p></li>
<li><p><a class="reference internal" href="#two-phase-subsurface-energy-pk" id="id94">Two-Phase subsurface Energy PK</a></p></li>
<li><p><a class="reference internal" href="#three-phase-subsurface-energy-pk" id="id95">Three-Phase subsurface Energy PK</a></p></li>
<li><p><a class="reference internal" href="#overland-energy-with-ice" id="id96">Overland energy with Ice</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#surface-energy-balance-pks" id="id97">Surface Energy Balance PKs</a></p>
<ul>
<li><p><a class="reference internal" href="#balance-equation" id="id98">Balance Equation</a></p></li>
<li><p><a class="reference internal" href="#snow-balance-equation" id="id99">Snow Balance Equation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#biogeochemistry" id="id100">Biogeochemistry</a></p>
<ul>
<li><p><a class="reference internal" href="#biogeochemistry-monolithic-version" id="id101">Biogeochemistry – Monolithic Version</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#deformation" id="id102">Deformation</a></p>
<ul>
<li><p><a class="reference internal" href="#volumetric-deformation" id="id103">Volumetric Deformation</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#mpc" id="id104">MPC</a></p>
<ul>
<li><p><a class="reference internal" href="#base-mpc" id="id105">Base MPC</a></p></li>
<li><p><a class="reference internal" href="#weakmpc" id="id106">WeakMPC</a></p></li>
<li><p><a class="reference internal" href="#strongmpc" id="id107">StrongMPC</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#physical-mpcs" id="id108">Physical MPCs</a></p>
<ul>
<li><p><a class="reference internal" href="#coupled-water-mpc" id="id109">Coupled Water MPC</a></p></li>
<li><p><a class="reference internal" href="#coupled-cells-mpc" id="id110">Coupled Cells MPC</a></p></li>
<li><p><a class="reference internal" href="#subsurface-mpc" id="id111">Subsurface MPC</a></p></li>
<li><p><a class="reference internal" href="#surface-mpc" id="id112">Surface MPC</a></p></li>
<li><p><a class="reference internal" href="#permafrost-mpc" id="id113">Permafrost MPC</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#globalization-delegates" id="id114">Globalization Delegates</a></p>
<ul>
<li><p><a class="reference internal" href="#coupled-water-globalization-delegate" id="id115">Coupled Water Globalization Delegate</a></p></li>
<li><p><a class="reference internal" href="#ewc-globalization-delegate" id="id116">EWC Globalization Delegate</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="base-pks">
<h3><a class="toc-backref" href="#id79" role="doc-backlink">Base PKs</a><a class="headerlink" href="#base-pks" title="Permalink to this heading"></a></h3>
<p>There are several types of PKs, and each PK has its own valid input
spec.  However, there are three main types of PKs, from which nearly
all PKs derive.  Note that none of these are true PKs and cannot stand
alone.</p>
<section id="pk-base-class">
<h4><a class="toc-backref" href="#id80" role="doc-backlink">PK base class</a><a class="headerlink" href="#pk-base-class" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>The interface for a Process Kernel, an equation or system of equations.</p>
</div></blockquote>
<p>A process kernel represents a single or system of partial/ordinary
differential equation(s) or conservation law(s), and is used as the
fundamental unit for coupling strategies.</p>
<p>Implementations of this interface typically are either an MPC
(multi-process coupler) whose job is to heirarchically couple several
other PKs and represent the system of equations, or a Physical PK,
which represents a single equation.</p>
<p>Note there are two PK specs – the first is the “typed” spec, which appears in
the “cycle driver” list in the PK tree and has no other parameters other than
its type and its children.  The second is the spec for the base class PK, which
is inherited and included by each actual PK, lives in the “PKs” sublist of
“main”, and has all needed parameters.</p>
<div class="admonition-pk-typed-spec admonition" id="pk-typed-spec">
<p class="admonition-title">pk-typed-spec</p>
<ul class="simple">
<li><p><cite>“PK type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> One of the registered PK types</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;PK tree&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Top level MPC&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;PK type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;strong MPC&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;sub PK 1&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span>...
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;sub PK 2&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span>...
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span>...
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<div class="admonition-pk-spec admonition" id="pk-spec">
<p class="admonition-title">pk-spec</p>
<ul class="simple">
<li><p><cite>“PK type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> One of the registered PK types.  Note this must
match the corresponding entry in the <code class="docutils literal notranslate"><span class="pre">[pk-typed-spec]</span></code></p></li>
<li><p><cite>“verbose object</cite>” <code class="docutils literal notranslate"><span class="pre">[verbose-object-spec]</span></code> <strong>optional</strong> See <a class="reference internal" href="#verbose-object">Verbose Object</a></p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;PKs&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;my cool PK&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;PK type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;my cool PK&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span>...
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="pk-physical">
<h4><a class="toc-backref" href="#id81" role="doc-backlink">PK: Physical</a><a class="headerlink" href="#pk-physical" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>A base class with default implementations of methods for a leaf of the PK tree (a conservation equation, or similar).</p>
</div></blockquote>
<p><cite>PKPhysicalBase</cite> is a base class providing some functionality for PKs which
are defined on a single mesh, and represent a single process model.  Typically
all leaves of the PK tree will inherit from <cite>PKPhysicalBase</cite>.</p>
<div class="admonition-pk-physical-default-spec admonition" id="pk-physical-default-spec">
<p class="admonition-title">pk-physical-default-spec</p>
<ul class="simple">
<li><p><cite>“domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Name from the <a class="reference internal" href="#mesh">Mesh</a> list on which this PK is defined.</p></li>
<li><p><cite>“primary variable key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The primary variable
e.g. <cite>“pressure</cite>”, or <cite>“temperature</cite>”.  Most PKs supply sane defaults.</p></li>
<li><p><cite>“initial condition</cite>” <code class="docutils literal notranslate"><span class="pre">[initial-conditions-spec]</span></code>  See <a class="reference internal" href="#initialconditions">InitialConditions</a>.</p></li>
<li><p><cite>“max valid change</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong> Sets a limiter on what is a
valid change in a single timestep.  Changes larger than this are declared
invalid and the timestep shrinks.  By default, any change is valid.
Units are the same as the primary variable.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-spec]</span></code> This <em>is a</em> <a class="reference internal" href="#pk">PK</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[debugger-spec]</span></code> Uses a <a class="reference internal" href="#debugger">Debugger</a></p></li>
</ul>
</div>
</section>
<section id="pk-bdf">
<h4><a class="toc-backref" href="#id82" role="doc-backlink">PK: BDF</a><a class="headerlink" href="#pk-bdf" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>A base class with default implementations of methods for a PK that can be implicitly integrated in time.</p>
</div></blockquote>
<p><cite>PKBDFBase</cite> is a base class from which PKs that want to use the <cite>BDF</cite>
series of implicit time integrators must derive.  It specifies both the
<cite>BDFFnBase</cite> interface and implements some basic functionality for <cite>BDF</cite>
PKs.</p>
<div class="admonition-pk-bdf-default-spec admonition" id="pk-bdf-default-spec">
<p class="admonition-title">pk-bdf-default-spec</p>
<ul class="simple">
<li><p><cite>“initial time step [s]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.</strong> Initial time step size [s]</p></li>
<li><p><cite>“assemble preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> A flag, typically not set
by user but by an MPC.</p></li>
<li><p><cite>“time integrator</cite>” <code class="docutils literal notranslate"><span class="pre">[bdf1-ti-spec]</span></code> <strong>optional</strong>
A <a class="reference internal" href="#timeintegrator">TimeIntegrator</a>.  Note that this is only required if this PK is not
strongly coupled to other PKs.</p></li>
<li><p><cite>“inverse</cite>” <code class="docutils literal notranslate"><span class="pre">[inverse-typed-spec]</span></code> <strong>optional</strong> A <a class="reference internal" href="#preconditioner">Preconditioner</a>.
Note that this is only used if this PK is not strongly coupled to other PKs.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-spec]</span></code> This <em>is a</em> <a class="reference internal" href="#pk">PK</a>.</p></li>
</ul>
</div>
</section>
<section id="pk-physical-and-bdf">
<h4><a class="toc-backref" href="#id83" role="doc-backlink">PK: Physical and BDF</a><a class="headerlink" href="#pk-physical-and-bdf" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Default implementation of both BDF and Physical PKs.</p>
</div></blockquote>
<p>A base class for all PKs that are both physical, in the sense that they
implement an equation and are not couplers, and BDF, in the sense that they
support the implicit integration interface.  This largely just supplies a
default error norm based on error in conservation relative to the extent of the
conserved quantity.</p>
<p>By default, the error norm used by solvers is given by:</p>
<p><span class="math notranslate nohighlight">\(ENORM(u, du) = |du| / ( a_tol + r_tol * |u| )\)</span></p>
<p>The defaults here are typically good, or else good defaults are set in the
code, so usually are not supplied by the user.</p>
<div class="admonition-pk-physical-bdf-default-spec admonition" id="pk-physical-bdf-default-spec">
<p class="admonition-title">pk-physical-bdf-default-spec</p>
<ul class="simple">
<li><p><cite>“conserved quantity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Name of the conserved quantity.
Usually a sane default is set by the PK.</p></li>
<li><p><cite>“absolute error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> Absolute tolerance,
<span class="math notranslate nohighlight">\(a_tol\)</span> in the equation above.  Unit are the same as the conserved
quantity.  Note that this default is often overridden by PKs with more
physical values, and very rarely are these set by the user.</p></li>
<li><p><cite>“relative error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> Relative tolerance,
<span class="math notranslate nohighlight">\(r_tol\)</span> in the equation above.  <code class="docutils literal notranslate"><span class="pre">[-]</span></code> Note that this default can
be overridden by PKs with more physical values, and very rarely are these
set by the user.</p></li>
<li><p><cite>“flux error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> Relative tolerance on the
flux.  Note that this default is often overridden by PKs with more physical
values, and very rarely are these set by the user.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-bdf-default-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#pk-bdf">PK: BDF</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-physical-default-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#pk-physical">PK: Physical</a></p></li>
</ul>
</div>
</section>
</section>
<section id="physical-pks">
<h3><a class="toc-backref" href="#id84" role="doc-backlink">Physical PKs</a><a class="headerlink" href="#physical-pks" title="Permalink to this heading"></a></h3>
<p>Physical PKs are the physical capability implemented within ATS.</p>
<section id="flow-pks">
<h4><a class="toc-backref" href="#id85" role="doc-backlink">Flow PKs</a><a class="headerlink" href="#flow-pks" title="Permalink to this heading"></a></h4>
<p>Flow PKs describe the conservation of mass of water as it flows both
above and below-ground.  Subsurface flow PKs are based on 3D Richards
equation, which describes variably saturated flow in porous media.
Minor variations to this include the incorporation of freeze-thaw
processes.  Surface flow PKs are based on a diffusion wave equation
and Manning’s model for sheet flow.  Variations to this also include
the incorporation of freeze-thaw processes.  Finally we include in
flow a “snow distribution” algorithm which takes as input
precipitation and applies it based on the existing surface level
(elevation + water + snowpack), thereby “filling in” low-lying areas
preferentially.  This makes for more accurate snowpacks at fine
scales.</p>
<section id="richards-pk">
<h5><a class="toc-backref" href="#id86" role="doc-backlink">Richards PK</a><a class="headerlink" href="#richards-pk" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Two-phase, variable density Richards equation.</p>
</div></blockquote>
<p>Solves Richards equation:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \Theta}{\partial t} - \nabla \cdot \frac{k_r n_l}{\mu} K ( \nabla p + \rho g \hat{z} ) = Q_w\]</div>
<div class="admonition-richards-spec admonition" id="richards-spec">
<p class="admonition-title">richards-spec</p>
<ul class="simple">
<li><p><cite>“domain</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“domain”</strong>  Defaults to the subsurface mesh.</p></li>
<li><p><cite>“primary variable key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The primary variable associated with
this PK, typically <cite>“DOMAIN-pressure</cite>” Note there is no default – this
must be provided by the user.</p></li>
<li><p><cite>“boundary conditions</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> Defaults to Neuman, 0 normal
flux.  See <a class="reference internal" href="#flow-specific-boundary-conditions">Flow-specific Boundary Conditions</a></p></li>
<li><p><cite>“permeability type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>scalar</strong> This controls the
number of values needed to specify the absolute permeability.
One of:</p>
<ul>
<li><p><cite>“scalar</cite>” Requires one scalar value.</p></li>
<li><p><cite>“horizontal and vertical</cite>” Requires two values, horizontal
then vertical.</p></li>
<li><p><cite>“diagonal tensor</cite>” Requires dim values: {xx, yy} or {xx, yy,
zz}</p></li>
<li><p><cite>“full tensor</cite>”. (Note symmetry is required.)  Either {xx, yy,
xy} or {xx,yy,zz,xy,xz,yz}.</p></li>
</ul>
</li>
<li><p><cite>“water retention evaluator</cite>” <code class="docutils literal notranslate"><span class="pre">[wrm-evaluator-spec]</span></code> The water
retention curve.  This needs to go away, and should get moved to
State.</p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“source term</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Is there a source term?</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“source key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-water_source</strong> Typically not
set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[mol</span> <span class="pre">s^-1]</span></code></p></li>
<li><p><cite>“source term is differentiable</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> Can the
source term be differentiated with respect to the primary
variable?</p></li>
<li><p><cite>“explicit source term</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Apply the source
term from the previous time step.</p></li>
</ul>
<p>END</p>
<p>Math and solver algorithm options:</p>
<ul class="simple">
<li><p><cite>“diffusion</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> The (forward) diffusion
operator, see <a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a>.</p></li>
<li><p><cite>“diffusion preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code>
<strong>optional</strong> The inverse of the diffusion operator.  See
<a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a>.  Typically this is only needed to set Jacobian
options, as all others probably should match those in
<cite>“diffusion</cite>”, and default to those values.</p></li>
<li><p><cite>“surface rel perm strategy</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>none</strong> Approach for
specifying the relative permeabiilty on the surface face.
<cite>“clobber</cite>” is frequently used for cases where a surface rel
perm will be provided.  One of:</p>
<ul>
<li><p><cite>“none</cite>” : use the upwind direction to determine whether to
use the boundary face or internal cell</p></li>
<li><p><cite>“clobber</cite>” : always use the boundary face rel perm</p></li>
<li><p><cite>“max</cite>” : use the max of the boundary face and internal cell
values</p></li>
<li><p><cite>“unsaturated</cite>” : Uses the boundary face when the internal
cell is not saturated.</p></li>
</ul>
</li>
<li><p><cite>“relative permeability method</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>upwind with Darcy
flux</strong> Relative permeability is defined on cells, but must be
calculated on faces to multiply a flux.  There are several
methods commonly used.  Note these can significantly change
answers – you don’t want to change these unless you know what
they mean.  One of:</p>
<ul>
<li><p><cite>“upwind with Darcy flux</cite>” First-order upwind method that is
most common</p></li>
<li><p><cite>“upwind with gravity</cite>” Upwinds according to the gravitational
flux direction</p></li>
<li><p><cite>“cell centered</cite>” This corresponds to the harmonic mean, and is
most accurate if the problem is always wet, but has issues
when it is dry.</p></li>
<li><p><cite>“arithmetic mean</cite>” Face value is the mean of the neighboring
cells.  Not a good method.</p></li>
</ul>
</li>
</ul>
<p>Globalization and other process-based hacks:</p>
<ul class="simple">
<li><p><cite>“modify predictor with consistent faces</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> In a
face+cell diffusion discretization, this modifies the predictor to make
sure that faces, which are a DAE, are consistent with the predicted cells
(i.e. face fluxes from each sides match).</p></li>
<li><p><cite>“modify predictor for flux BCs</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Infiltration into
dry ground can be hard on solvers – this tries to do the local nonlinear
problem to ensure that face pressures are consistent with the
prescribed flux in a predictor.</p></li>
<li><p><cite>“modify predictor via water content</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Modifies the
predictor using the method of Krabbenhoft [??] paper.  Effectively does a
change of variables, extrapolating not in pressure but in water content,
then takes the smaller of the two extrapolants.</p></li>
<li><p><cite>“max valid change in saturation in a time step [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong>
Rejects timesteps whose max saturation change is greater than this value.
This can be useful to ensure temporally resolved solutions.  Usually a
good value is 0.1 or 0.2.</p></li>
<li><p><cite>“max valid change in ice saturation in a time step [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code>
<strong>-1</strong> Rejects timesteps whose max ice saturation change is greater than
this value.  This can be useful to ensure temporally resolved solutions.
Usually a good value is 0.1 or 0.2.</p></li>
<li><p><cite>“limit correction to pressure change [Pa]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong> If &gt; 0,
this limits an iterate’s max pressure change to this value.  Not usually
helpful.</p></li>
<li><p><cite>“limit correction to pressure change when crossing atmospheric [Pa]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong>
If &gt; 0, this limits an iterate’s max pressure change
to this value when they cross atmospheric pressure.  Not usually helpful.</p></li>
</ul>
<p>Discretization / operators / solver controls:</p>
<ul class="simple">
<li><p><cite>“accumulation preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-accumulation-spec]</span></code> <strong>optional</strong>
The inverse of the accumulation operator.  See <a class="reference internal" href="#pde-accumulation">PDE_Accumulation</a>.
Typically not provided by users, as defaults are correct.</p></li>
<li><p><cite>“absolute error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>2750.0</strong> in units of [mol].</p></li>
<li><p><cite>“compute boundary values</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Used to include boundary
face unknowns on discretizations that are cell-only (e.g. FV).  This can
be useful for surface flow or other wierd boundary conditions.  Usually
provided by MPCs that need them.</p></li>
</ul>
<p>Physics control:</p>
<ul class="simple">
<li><p><cite>“permeability rescaling</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e7</strong> Typically 1e7 or order
<span class="math notranslate nohighlight">\(sqrt(K)\)</span> is about right.  This rescales things to stop from
multiplying by small numbers (permeability) and then by large number
(<span class="math notranslate nohighlight">\(\rho / \mu\)</span>).</p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“coupled to surface via flux</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, apply
surface boundary conditions from an exchange flux.  Note, if this is a
coupled problem, it is probably set by the MPC.  No need for a user to
set it.</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“surface-subsurface flux key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-surface_subsurface_flux</strong></p></li>
</ul>
<p>END</p>
<ul class="simple">
<li><p><cite>“coupled to surface via head</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, apply
surface boundary conditions from the surface pressure (Dirichlet).</p></li>
</ul>
</div>
</section>
<section id="permafrost-flow-pk">
<h5><a class="toc-backref" href="#id87" role="doc-backlink">Permafrost Flow PK</a><a class="headerlink" href="#permafrost-flow-pk" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>A three-phase, thermal Richard’s equation with water, water vapor, and ice for permafrost applications.</p>
</div></blockquote>
<p>Note that the only difference between permafrost and richards is in
constitutive relations – the WRM changes to provide three saturations,
while the water content changes to account for water in ice phase.  As these
are now drop-in field evaluators, there is very little to change in the PK.</p>
<p>In the future, this should not even need a different PK.</p>
<div class="admonition-permafrost-spec admonition" id="permafrost-spec">
<p class="admonition-title">permafrost-spec</p>
<ul class="simple">
<li><p><cite>“saturation ice key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“DOMAIN-saturation_ice”</strong> volume fraction of the ice phase (only when relevant) <code class="docutils literal notranslate"><span class="pre">[-]</span></code> Typically the default is correct.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[richards-spec]</span></code> See <a class="reference internal" href="#richards-pk">Richards PK</a></p></li>
</ul>
</div>
</section>
<section id="overland-flow-pk">
<h5><a class="toc-backref" href="#id88" role="doc-backlink">Overland Flow PK</a><a class="headerlink" href="#overland-flow-pk" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Overland flow using the diffusion wave equation.</p>
</div></blockquote>
<p>Solves the diffusion wave equation for overland flow with pressure as a primary variable:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \Theta}{\partial t} - \nabla n_l k \nabla h(p) = Q_w\]</div>
<div class="admonition-overland-pressure-spec admonition" id="overland-pressure-spec">
<p class="admonition-title">overland-pressure-spec</p>
<p>Keys name variables:</p>
<ul class="simple">
<li><p><cite>“domain</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“surface”</strong>  Defaults to the extracted surface mesh.</p></li>
<li><p><cite>“primary variable</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The primary variable associated with
this PK, typically <cite>“DOMAIN-pressure</cite>” Note there is no default – this
must be provided by the user.</p></li>
<li><p><cite>“boundary conditions</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> Defaults to Neuman, 0 normal flux.</p></li>
<li><p><cite>“overland conductivity evaluator</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code>
See <a class="reference external" href="Evaluatestheconductivityofsurfaceflow.">Overland Conductivity Evaluator</a>.</p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“source term</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Is there a source term?</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“source key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-water_source</strong> Typically
not set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[m</span> <span class="pre">s^-1]</span></code> or <code class="docutils literal notranslate"><span class="pre">[mol</span> <span class="pre">s^-1]</span></code></p></li>
<li><p><cite>“water source in meters</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> Is the source term in <code class="docutils literal notranslate"><span class="pre">[m</span> <span class="pre">s^-1]</span></code>?</p></li>
<li><p><cite>“source term is differentiable</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> Can the source term
be differentiated with respect to the primary variable?</p></li>
</ul>
<p>END</p>
<p>Math and solver algorithm options:</p>
<ul class="simple">
<li><p><cite>“diffusion</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> The (forward) diffusion operator,
see <a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a>.</p></li>
<li><p><cite>“diffusion preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> <strong>optional</strong> The
inverse of the diffusion operator.  See <a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a>.  Typically this
is only needed to set Jacobian options, as all others probably should
match those in <cite>“diffusion</cite>”, and default to those values.</p></li>
<li><p><cite>“absolute error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>550.</strong> Defaults to 1 cm of
water.  A small, but significant, amount of water.</p></li>
<li><p><cite>“limit correction to pressure change [Pa]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong> If &gt; 0,
this limits an iterate’s max pressure change to this value.  Not usually
helpful.</p></li>
<li><p><cite>“limit correction to pressure change when crossing atmospheric [Pa]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong>
If &gt; 0, this limits an iterate’s max pressure change
to this value when they cross atmospheric pressure.  Not usually helpful.</p></li>
<li><p><cite>“allow no negative ponded depths</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Modifies all
correction updates to ensure only positive ponded depth is allowed.</p></li>
<li><p><cite>“min ponded depth for velocity calculation</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-2</strong> For
ponded depth below this height, declare the velocity 0.</p></li>
<li><p><cite>“min ponded depth for tidal bc</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.02</strong> Control on the
tidal boundary condition.  TODO: This should live in the BC spec?</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-physical-bdf-default-spec]</span></code> A <a class="reference internal" href="#pk-physical-and-bdf">PK: Physical and BDF</a> spec.</p></li>
</ul>
<p>Everything below this point is usually not provided by the user, but are
documented here for completeness.</p>
<p>Keys name variables:</p>
<ul class="simple">
<li><p><cite>“conserved quantity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-water_content</strong> Typically
not set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[mol]</span></code></p></li>
<li><p><cite>“elevation key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-elevation</strong> Typically
not set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[mol]</span></code></p></li>
<li><p><cite>“slope magnitude key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-slope_magnitude</strong> Typically
not set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[mol]</span></code></p></li>
</ul>
<p>Algorithmic parameters:</p>
<ul class="simple">
<li><p><cite>“coupled to subsurface via flux</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Set by MPC.</p></li>
<li><p><cite>“coupled to subsurface via head</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Set by MPC.</p></li>
<li><p><cite>“accumulation preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-accumulation-spec]</span></code> <strong>optional</strong>
The inverse of the accumulation operator.  See <a class="reference internal" href="#pde-accumulation">PDE_Accumulation</a>.
Typically not provided by users, as defaults are correct.</p></li>
</ul>
<p>EVALUATORS:</p>
<ul class="simple">
<li><p><cite>“conserved quantity</cite>”</p></li>
<li><p><cite>“water content</cite>”</p></li>
<li><p><cite>“cell volume</cite>”</p></li>
<li><p><cite>“surface_subsurface_flux</cite>”</p></li>
<li><p><cite>“elevation</cite>”</p></li>
<li><p><cite>“slope magnitude</cite>”</p></li>
<li><p><cite>“overland_conductivity</cite>”</p></li>
<li><p><cite>“ponded_depth</cite>”</p></li>
<li><p><cite>“pres_elev</cite>”</p></li>
<li><p><cite>“source</cite>”</p></li>
</ul>
</div>
</section>
<section id="overland-flow-with-ice">
<h5><a class="toc-backref" href="#id89" role="doc-backlink">Overland Flow with Ice</a><a class="headerlink" href="#overland-flow-with-ice" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Two-phase overland flow equation.</p>
</div></blockquote>
<p>This modifies the diffusion wave equation for overland flow that includes
freeze-thaw processes.  This class could completely go away, but it does some
error checking on the input file to make sure freeze-thaw processes are done
correctly.  In the future this service should be done by a preprocessor
generating the input file, and this class would go away.</p>
<div class="admonition-icy-overland-spec admonition" id="icy-overland-spec">
<p class="admonition-title">icy-overland-spec</p>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[overland-pressure-spec]</span></code> See <a class="reference internal" href="#overland-flow-pk">Overland Flow PK</a>.</p></li>
</ul>
</div>
</section>
<section id="snow-distribution-pk">
<h5><a class="toc-backref" href="#id90" role="doc-backlink">Snow Distribution PK</a><a class="headerlink" href="#snow-distribution-pk" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Preferential distribution of snow precip in low-lying areas.</p>
</div></blockquote>
<p>This PK is a heuristic PK that distributes incoming snow precipitation using a
diffusion wave equation.  Think of it as an analogue to overland flow – it
effectively ensures that new snow “flows downhill,” due to a uniformly random
direction and strength wind, and lands on the lowest lying areas.</p>
<p>Tweaking the snow-manning_coefficient lets you play with how uniform the snow
layer ends up.  Most of the parameters are set by your snow precipitation input
data interval.  The details of this are a bit tricky mathematically, and it may
take some fiddling with parameters to do this correctly if your data is not
daily (which all defaults are set for).</p>
<div class="admonition-snow-distribution-spec admonition" id="snow-distribution-spec">
<p class="admonition-title">snow-distribution-spec</p>
<ul class="simple">
<li><p><cite>“distribution time</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>86400.</strong> Interval of snow precip input dataset. <cite>[s]</cite></p></li>
<li><p><cite>“precipitation function</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> Snow precipitation <a class="reference internal" href="#function">Function</a> spec.</p></li>
<li><p><cite>“diffusion</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> Diffusion drives the distribution.
Typically we use finite volume here.  See <a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a></p></li>
<li><p><cite>“diffusion preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> Inverse of the
above.  Likely only Jacobian term options are needed here, as the others
default to the same as the <cite>“diffusion</cite>” list.  See <a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a>.</p></li>
<li><p><cite>“inverse</cite>” <code class="docutils literal notranslate"><span class="pre">[inverse-typed-spec]</span></code> <a class="reference internal" href="#inverse">Inverse</a> method for the solve.</p></li>
</ul>
<p>Not typically provided by the user, defaults are good:</p>
<ul class="simple">
<li><p><cite>“accumulation preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-accumulation-spec]</span></code> See <a class="reference internal" href="#pde-accumulation">PDE_Accumulation</a>.</p></li>
</ul>
</div>
</section>
</section>
<section id="transport-pk">
<h4><a class="toc-backref" href="#id91" role="doc-backlink">Transport PK</a><a class="headerlink" href="#transport-pk" title="Permalink to this heading"></a></h4>
<p>The Transport PK describes the conservation of mass of components transported
with water as it flows. The transport PK is based on the advection-diffusion
equation, applies to one or more components that are dissolved in the aqueous
phase, and is currently used in both surface and subsurface compartments.
The key difference between surface and subsurface transport is in capturing
the volume of water. In the subsurface, the volume of water is set by the
porosity and saturation of the porous medium, while in the surface it is set
by the ponded depth.</p>
<p>The advection-diffusion equation for component <em>i</em> in partially saturated porous media may be written as</p>
<div class="math notranslate nohighlight">
\[\frac{\partial (\phi s_l C_i)}{\partial t}
=
- \boldsymbol{\nabla} \cdot (\boldsymbol{q} C_i)
+ \boldsymbol{\nabla} \cdot (\phi s_l\, (\boldsymbol{D^*}_l + \tau \boldsymbol{D}_i) \boldsymbol{\nabla} C_i) + Q_s,\]</div>
<p>The advection-diffusion equation for component <em>i</em> in the surface may be written as</p>
<div class="math notranslate nohighlight">
\[\frac{\partial (C_i)}{\partial t}
=
- \boldsymbol{\nabla} \cdot (\boldsymbol{q_s} C_i)
+ \boldsymbol{\nabla} \cdot ( (\boldsymbol{D^*}_l + \tau \boldsymbol{D}_i) \boldsymbol{\nabla} C_i) + Q_s,\]</div>
<div class="admonition-transport-spec admonition" id="transport-spec">
<p class="admonition-title">transport-spec</p>
<ul class="simple">
<li><p><cite>“PK type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“transport ats”</strong></p></li>
<li><p><cite>“domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>domain</strong> specifies mesh name that defines
the domain of this PK.</p></li>
<li><p><cite>“component names</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> No default. Provides the names of the
components that will be transported. Must be in the order: aqueous, gaseous, solid.</p></li>
<li><p><cite>“number of aqueous components</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>-1</strong> The total number of
aqueous components.  Default value is the length of <cite>“component names</cite>”</p></li>
<li><p><cite>“number of gaseous components</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> The total number of
gaseous components.</p></li>
<li><p><cite>“boundary conditions</cite>” <code class="docutils literal notranslate"><span class="pre">[transport-bc-spec]</span></code> Boundary conditions for
transport are dependent on the boundary conditions for flow. See
<a class="reference internal" href="#flow-specific-boundary-conditions">Flow-specific Boundary Conditions</a> and <a class="reference internal" href="#transport-specific-boundary-conditions">Transport-specific Boundary Conditions</a></p></li>
<li><p><cite>“component molar masses</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> No default. Molar mass of
each component.</p></li>
<li><p><cite>“molecular diffusion</cite>” <code class="docutils literal notranslate"><span class="pre">[molecular-diffusion-spec]</span></code> defines names of
solutes in aqueous and gaseous phases and related diffusivity values.</p></li>
<li><p>“material properties” [material-properties-spec-list] Defines material
properties see below).</p></li>
</ul>
<p>Source terms:</p>
<ul class="simple">
<li><p><cite>“source terms</cite>” [transport-source-spec-list] Provides solute source.</p></li>
</ul>
<p>Physical model and assumptions:</p>
<ul class="simple">
<li><p><cite>“physical models and assumptions</cite>” [material-properties-spec] Defines material properties.</p></li>
<li><p><cite>“effective transport porosity</cite>” [bool] If <em>true</em>, effective transport porosity
will be used by dispersive-diffusive fluxes instead of total porosity.
Default is <em>false</em>.</p></li>
</ul>
<p>Math and solver algorithm options:</p>
<ul class="simple">
<li><p><cite>“diffusion</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> Diffusion drives the distribution.
Typically we use finite volume here.  See <a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a></p></li>
<li><p><cite>“diffusion preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> Inverse of the
above.  Likely only Jacobian term options are needed here, as the others
default to the same as the <cite>“diffusion</cite>” list.  See <a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a>.</p></li>
<li><p><cite>“inverse</cite>” <code class="docutils literal notranslate"><span class="pre">[inverse-typed-spec]</span></code> <a class="reference internal" href="#inverse">Inverse</a> method for the solve.</p></li>
<li><p><cite>“cfl</cite>” [double] Time step limiter, a number less than 1. Default value is 1.</p></li>
<li><p><cite>“spatial discretization order</cite>” [int] defines accuracy of spatial discretization.
It permits values 1 or 2. Default value is 1.</p></li>
<li><p><cite>“temporal discretization order</cite>” [int] defines accuracy of temporal discretization.
It permits values 1 or 2 and values 3 or 4 when expert parameter
<cite>“generic RK implementation</cite>” is set to true. Note that RK3 is not monotone.
Default value is 1.</p></li>
<li><p><cite>“reconstruction</cite>” [list] collects reconstruction parameters. The available options are
describe in the separate section below.</p></li>
<li><p><cite>“transport subcycling</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> The code will default to
subcycling for transport within the master PK if there is one.</p></li>
</ul>
<p>Developer parameters:</p>
<ul class="simple">
<li><p><cite>“enable internal tests</cite>” [bool] turns on various internal tests during
run time. Default value is <cite>“false</cite>”.</p></li>
<li><p><cite>“generic RK implementation</cite>” [bool] leads to generic implementation of
all Runge-Kutta methods. Default value is <cite>“false</cite>”.</p></li>
<li><p><cite>“internal tests tolerance</cite>” [double] tolerance for internal tests such as the
divergence-free condition. The default value is 1e-6.</p></li>
<li><p><cite>“runtime diagnostics: solute names</cite>” [Array(string)] defines solutes that will be
tracked closely each time step if verbosity <cite>“high</cite>”. Default value is the first
solute in the global list of <cite>“aqueous names</cite>” and the first gas in the global list
of <cite>“gaseous names</cite>”.</p></li>
<li><p><cite>“runtime diagnostics: regions</cite>” [Array(string)] defines a boundary region for
tracking solutes. Default value is a seepage face boundary, see Flow PK.</p></li>
</ul>
<p>KEYS</p>
<ul>
<li><p><cite>“saturation liquid</cite>” This variable is a multiplier in in the
accumulation term. For subsurface transport, this will typically be the
saturation (<cite>“saturation_liquid</cite>”). For surface transport, this will
typically be the ponded depth (<cite>“ponded_depth</cite>”).</p></li>
<li><p><cite>“previous saturation liquid</cite>”</p></li>
<li><p><cite>“molar density liquid</cite>”  Transport is solved
for concentrations in units of mol fractions. Molar density is needed for conversion.</p></li>
<li><p><cite>“water flux</cite>”</p></li>
<li><p><cite>“water source</cite>” Defines the water injection rate [mol H2O m^-2 s^-1] in
surface and [mol H2O m^-3 s^-1] in subsurface) which applies to
concentrations specified by the <cite>“geochemical conditions</cite>”.  Note that if
this PK is coupled to a surface flow PK, the unit of the water source
there <em>must</em> be in [mol m^-2 s^-1], <em>not</em> in [m s^-1] as is an option for
that PK (e.g. <cite>“water source in meters</cite>” must be set to <cite>“false</cite>” in the
overland flow PK).</p>
<p>The injection rate of a solute [molC s^-1], when given as the product of
a concentration and a water source, is evaluated as:</p>
<dl class="simple">
<dt>Concentration [mol C L^-1] *</dt><dd><p>1000 [L m^-3] of water *
water source [mol H2O m^-3 s^-1] *
volume of injection domain [m^3] /
molar density of water [mol H2O m^-3]</p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="admonition-molecular-diffusion-spec admonition" id="molecular-diffusion-spec">
<p class="admonition-title">molecular-diffusion-spec</p>
<ul class="simple">
<li><p><cite>“aqueous names</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> List of aqueous component names to
be diffused.</p></li>
<li><p><cite>“aqueous values</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> Diffusivities of each component.</p></li>
</ul>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;molecular diffusion&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;aqueous names&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{CO2(l),Tc-99}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;aqueous values&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{1e-8,1e-9}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<div class="admonition-material-properties-spec admonition" id="material-properties-spec">
<p class="admonition-title">material-properties-spec</p>
<ul class="simple">
<li><p><cite>“region</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> Defines geometric regions for material SOIL.</p></li>
<li><p><cite>“model</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>scalar</strong> Defines dispersivity model.  One of:</p>
<ul>
<li><p><cite>“scalar</cite>” : scalar dispersivity</p></li>
<li><p><cite>“Bear</cite>” : dispersion split into along- and across- velocity</p></li>
<li><p><cite>“Burnett-Frind</cite>”</p></li>
<li><p><cite>“Lichtner-Kelkar-Robinson</cite>”</p></li>
</ul>
</li>
<li><p><cite>“parameters for MODEL</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> where <cite>“MODEL</cite>” is the model name.</p></li>
</ul>
<p>IF model == scalar</p>
<p>ONE OF</p>
<ul class="simple">
<li><p><cite>“alpha</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> defines dispersivity in all directions, [m].</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“dispersion coefficient</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> defines dispersion coefficient [m^2 s^-1].</p></li>
</ul>
<p>END</p>
<p>ELSE IF model == Bear</p>
<ul class="simple">
<li><p><cite>“alpha_l</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> defines dispersion in the direction of Darcy velocity, [m].</p></li>
<li><p><cite>“alpha_t</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> defines dispersion in the orthogonal direction, [m].</p></li>
</ul>
<p>ELSE IF model == Burnett-Frind</p>
<ul class="simple">
<li><p><cite>“alphaL</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> defines the longitudinal dispersion in the direction
of Darcy velocity, [m].</p></li>
<li><p><cite>“alpha_th</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Defines the transverse dispersion in the horizonal
direction orthogonal directions, [m].</p></li>
<li><p><cite>“alpha_tv</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Defines dispersion in the orthogonal directions,
[m].  When <cite>“alpha_th</cite>” equals to <cite>“alpha_tv</cite>”, we obtain dispersion in
the direction of the Darcy velocity.</p></li>
</ul>
<p>ELSE IF model == Lichtner-Kelker-Robinson</p>
<ul class="simple">
<li><p><cite>“alpha_lh</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> defines the longitudinal dispersion in the
horizontal direction, [m].</p></li>
<li><p><cite>“alpha_lv</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Defines the longitudinal dispersion in the vertical
direction, [m].  When <cite>“alpha_lh</cite>” equals to <cite>“alpha_lv</cite>”, we obtain
dispersion in the direction of the Darcy velocity.</p></li>
<li><p><cite>“alpha_th</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Defines the transverse dispersion in the horizontal
direction orthogonal directions, [m].</p></li>
<li><p><cite>“alpha_tv” ``[double]`</cite> Defines dispersion in the orthogonal directions.
When <cite>“alpha_th</cite>” equals to <cite>“alpha_tv</cite>”, we obtain dispersion in the
direction of the Darcy velocity.</p></li>
</ul>
<p>END</p>
<ul class="simple">
<li><p><cite>“aqueous tortuosity</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Defines tortuosity for calculating
diffusivity of liquid solutes, [-].</p></li>
<li><p><cite>“gaseous tortuosity</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Defines tortuosity for calculating
diffusivity of gas solutes, [-].</p></li>
</ul>
</div>
<div class="admonition-transport-source-spec admonition" id="transport-source-spec">
<p class="admonition-title">transport-source-spec</p>
<ul>
<li><p><cite>“component mass source</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code>  Defines solute source injection rate.</p>
<ul>
<li><p><cite>“spatial distribution method</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> One of:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>“volume</cite>”, source is considered as extensive quantity [molC s^-1] and is evenly distributed across the region.</p></li>
<li><p><cite>“none</cite>”, source is considered as intensive quantity. [molC m^-2 s^-1] in surface and [molC m^-3 s^-1] in subsurface</p></li>
</ul>
</div></blockquote>
</li>
<li><p><cite>“geochemical</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code>  Defines a source by setting solute concentration for all components (in moles/L) and an injection
rate given by the water source.  Currently, this option is only available for Alquimia provided geochemical conditions.</p>
<ul class="simple">
<li><p><cite>“geochemical conditions</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> List of geochemical constraints providing concentration for solute injection.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</section>
<section id="energy-pks">
<h4><a class="toc-backref" href="#id92" role="doc-backlink">Energy PKs</a><a class="headerlink" href="#energy-pks" title="Permalink to this heading"></a></h4>
<p>Energy PKs describe the conservation of energy as it is advected and
diffuses both above and below-ground.  Both surface and subsurface
energy equations are based on a simple advection-diffusion equation,
and include variants with and without freeze-thaw processes.</p>
<section id="energy-base-pk">
<h5><a class="toc-backref" href="#id93" role="doc-backlink">Energy Base PK</a><a class="headerlink" href="#energy-base-pk" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>An advection-diffusion equation for energy.</p>
</div></blockquote>
<p>Solves an advection-diffusion equation for energy:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial E}{\partial t} - \nabla \cdot \kappa \nabla T + \nabla \cdot \mathbf{q} e(T) = Q_w e(T) + Q_e\]</div>
<div class="admonition-energy-pk-spec admonition" id="energy-pk-spec">
<p class="admonition-title">energy-pk-spec</p>
<ul class="simple">
<li><p><cite>“domain</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“domain”</strong>  Defaults to the subsurface mesh.</p></li>
<li><p><cite>“primary variable</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The primary variable associated with
this PK, typically <cite>“DOMAIN-temperature</cite>” Note there is no default – this
must be provided by the user.</p></li>
<li><p><cite>“boundary conditions</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> Defaults to 0 diffusive flux
boundary condition.  See <a class="reference internal" href="#energy-specific-boundary-conditions">Energy-specific Boundary Conditions</a></p></li>
<li><p><cite>“thermal conductivity evaluator</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code>
The thermal conductivity.  This
needs to go away, and should get moved to State.</p></li>
<li><p><cite>“absolute error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>76.e-6</strong> A small amount of
energy, see error norm. <cite>[MJ]</cite></p></li>
<li><p><cite>“upwind conductivity method</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>arithmetic mean</strong> Method of
moving cell-based thermal conductivities onto faces.  One of:</p>
<ul>
<li><p><cite>“arithmetic mean</cite>” the default, average of neighboring cells</p></li>
<li><p><cite>“cell centered</cite>” harmonic mean</p></li>
</ul>
</li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“explicit advection</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Treat the advection term implicitly.</p></li>
</ul>
<p>ELSE</p>
<ul class="simple">
<li><p><cite>“supress advective terms in preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong>
Typically subsurface energy equations are strongly diffusion dominated,
and the advective terms may add little.  With this flag on, we ignore
theem in the preconditioner, making an easier linear solve and often not
negatively impacting the nonlinear solve.</p></li>
<li><p><cite>“advection preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> <strong>optional</strong>
Typically defaults are correct.</p></li>
</ul>
<p>END</p>
<ul class="simple">
<li><p><cite>“diffusion</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> See <a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a>, the diffusion operator.</p></li>
<li><p><cite>“diffusion preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> See
<a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a>, the inverse operator.  Typically only adds Jacobian
terms, as all the rest default to those values from <cite>“diffusion</cite>”.</p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“source term</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Is there a source term?</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“source key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-total_energy_source</strong> Typically
not set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[MJ</span> <span class="pre">s^-1]</span></code></p></li>
<li><p><cite>“source term is differentiable</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> Can the source term
be differentiated with respect to the primary variable?</p></li>
<li><p><cite>“source term finite difference</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If the source term
is not diffferentiable, we can do a finite difference approximation of
this derivative anyway.  This is useful for difficult-to-differentiate
terms like a surface energy balance, which includes many terms.</p></li>
</ul>
<p>END</p>
<p>Globalization:</p>
<ul class="simple">
<li><p><cite>“modify predictor with consistent faces</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> In a
face+cell diffusion discretization, this modifies the predictor to make
sure that faces, which are a DAE, are consistent with the predicted cells
(i.e. face fluxes from each sides match).</p></li>
<li><p><cite>“modify predictor for freezing</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> A simple limiter
that keeps temperature corrections from jumping over the phase change.</p></li>
<li><p><cite>“limit correction to temperature change [K]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1.0</strong> If &gt;
0, stops nonlinear updates from being too big through clipping.</p></li>
</ul>
<p>The following are rarely set by the user, as the defaults are typically right.</p>
<ul class="simple">
<li><p><cite>“advection</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> <strong>optional</strong> The <a class="reference internal" href="#pde-advection">PDE_Advection</a> spec.  Only one
current implementation, so defaults are typically fine.</p></li>
<li><p><cite>“accumulation preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-accumulation-spec]</span></code> <strong>optional</strong>
The inverse of the accumulation operator.  See <a class="reference internal" href="#pde-accumulation">PDE_Accumulation</a>.
Typically not provided by users, as defaults are correct.</p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“coupled to surface via flux</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, apply
surface boundary conditions from an exchange flux.  Note, if this is a
coupled problem, it is probably set by the MPC.  No need for a user to
set it.</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“surface-subsurface energy flux key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-surface_subsurface_energy_flux</strong></p></li>
</ul>
<p>END</p>
<ul class="simple">
<li><p><cite>“coupled to surface via temperature</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, apply
surface boundary conditions from the surface temperature (Dirichlet).</p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“conserved quantity</cite>” <strong>DOMAIN-energy</strong> The total energy <span class="math notranslate nohighlight">\(E\)</span> <cite>[MJ]</cite></p></li>
<li><p><cite>“energy</cite>” <strong>DOMAIN-energy</strong> The total energy <span class="math notranslate nohighlight">\(E\)</span>, also the conserved quantity. <cite>[MJ]</cite></p></li>
<li><p><cite>“water content</cite>” <strong>DOMAIN-water_content</strong> The total mass <span class="math notranslate nohighlight">\(\Theta\)</span>, used in error norm <cite>[mol]</cite></p></li>
<li><p><cite>“enthalpy</cite>” <strong>DOMAIN-enthalpy</strong> The specific enthalpy :math`e` <cite>[MJ mol^-1]</cite></p></li>
<li><p><cite>“flux</cite>” <strong>DOMAIN-water_flux</strong> The water flux <span class="math notranslate nohighlight">\(\mathbf{q}\)</span> used in advection. <cite>[mol s^-1]</cite></p></li>
<li><p><cite>“diffusive energy</cite>” <strong>DOMAIN-diffusive_energy_flux</strong> <span class="math notranslate nohighlight">\(\mathbf{q_e}\)</span> <cite>[MJ s^-1]</cite></p></li>
<li><p><cite>“advected energy</cite>” <strong>DOMAIN-advected_energy_flux</strong> <span class="math notranslate nohighlight">\(\mathbf{q_e^{adv}} = q e\)</span> <cite>[MJ s^-1]</cite></p></li>
<li><p><cite>“thermal conductivity</cite>” <strong>DOMAIN-thermal_conductivity</strong> Thermal conductivity on cells <cite>[W m^-1 K^-1]</cite></p></li>
<li><p><cite>“upwinded thermal conductivity</cite>” <strong>DOMAIN-upwinded_thermal_conductivity</strong> Thermal conductivity on faces <cite>[W m^-1 K^-1]</cite></p></li>
</ul>
<p>EVALUATORS:</p>
<ul class="simple">
<li><p><cite>“source term</cite>” <strong>optional</strong> If source key is provided.</p></li>
<li><p><cite>“enthalpy</cite>”</p></li>
<li><p><cite>“cell volume</cite>”</p></li>
<li><p><cite>“thermal conductivity</cite>”</p></li>
<li><p><cite>“conserved quantity</cite>”</p></li>
<li><p><cite>“energy</cite>”</p></li>
</ul>
</div>
</section>
<section id="two-phase-subsurface-energy-pk">
<h5><a class="toc-backref" href="#id94" role="doc-backlink">Two-Phase subsurface Energy PK</a><a class="headerlink" href="#two-phase-subsurface-energy-pk" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>An advection-diffusion equation for energy in two phases.</p>
</div></blockquote>
<p>This is simply a subsurface energy equation that places a few more requirements
on the base class.  It could probably go away if we refactor to remove
hard-coded evaluators.</p>
<div class="admonition-energy-two-phase-pk-spec admonition" id="energy-two-phase-pk-spec">
<p class="admonition-title">energy-two-phase-pk-spec</p>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[energy-pk-spec]</span></code>  See <a class="reference internal" href="#energy-base-pk">Energy Base PK</a></p></li>
</ul>
</div>
</section>
<section id="three-phase-subsurface-energy-pk">
<h5><a class="toc-backref" href="#id95" role="doc-backlink">Three-Phase subsurface Energy PK</a><a class="headerlink" href="#three-phase-subsurface-energy-pk" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>An advection-diffusion equation for energy in three phases.</p>
</div></blockquote>
<p>This is simply a subsurface energy equation that places a few more requirements
on the base class.  It could probably go away if we refactor to remove
hard-coded evaluators.</p>
<div class="admonition-energy-three-phase-pk-spec admonition" id="energy-three-phase-pk-spec">
<p class="admonition-title">energy-three-phase-pk-spec</p>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[energy-two-phase-pk-spec]</span></code> See  <a class="reference internal" href="#two-phase-subsurface-energy-pk">Two-Phase subsurface Energy PK</a></p></li>
</ul>
</div>
</section>
<section id="overland-energy-with-ice">
<h5><a class="toc-backref" href="#id96" role="doc-backlink">Overland energy with Ice</a><a class="headerlink" href="#overland-energy-with-ice" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>An advection-diffusion equation for surface energy in two phases.</p>
</div></blockquote>
<p>This is simply a surface energy equation that places a few more requirements
on the base class.  It could probably go away if we refactor to remove
hard-coded evaluators.</p>
<div class="admonition-energy-surface-ice-pk-spec admonition" id="energy-surface-ice-pk-spec">
<p class="admonition-title">energy-surface-ice-pk-spec</p>
<p>These are typically not set by the user:</p>
<ul class="simple">
<li><p><cite>“coupled to subsurface via temperature</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> A coupling
scheme, provided by MPC.</p></li>
<li><p><cite>“coupled to subsurface via flux</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> A coupling
scheme, provided by MPC.</p></li>
<li><p><cite>“subsurface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong> If one of the above
coupling schemes is turned on, we need to know the subsurface mesh.
Provided by MPC.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[energy-pk-spec]</span></code>  See <a class="reference internal" href="#energy-base-pk">Energy Base PK</a></p></li>
</ul>
</div>
</section>
</section>
<section id="surface-energy-balance-pks">
<h4><a class="toc-backref" href="#id97" role="doc-backlink">Surface Energy Balance PKs</a><a class="headerlink" href="#surface-energy-balance-pks" title="Permalink to this heading"></a></h4>
<p>Integrated hydrology is not much use without significant process
complexity in source terms coming from the ecohydrologic environment.
These include straightforward sources, like precipitation, but also
more complicated ones such as evaporation and transpiration.</p>
<p>These terms are almost always tied up in a surface energy balance –
evaporation and transpiration are driven by vapor pressure gradients
between the atmosphere and the surface (either snow, ponded water,
soil, or leaf).  Solving a surface energy balance often requires
providing a bunch of terms, including radiated energy, conducted
energy, latent and sensible heat models, etc.</p>
<p>ATS currently has several approaches to calculating these – see
<a class="reference external" href="https://github.com/amanzi/ats-demos">ats-demos</a> examples on
ecohydrology for a more in-depth discussion.</p>
<section id="balance-equation">
<h5><a class="toc-backref" href="#id98" role="doc-backlink">Balance Equation</a><a class="headerlink" href="#balance-equation" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>A simple conservation ODE.</p>
</div></blockquote>
<p>This is a very simple vector of ODEs, useful in balance equations, where the
time derivative of a conserved quantity is determined by a bunch of sources and
sinks.</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \Phi }{\partial t} = \sum_i Q_i\]</div>
<div class="admonition-balance-pk-spec admonition" id="balance-pk-spec">
<p class="admonition-title">balance-pk-spec</p>
<ul class="simple">
<li><p><cite>“primary variable key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The primary variable associated with
this PK.  Note there is no default – this must be provided by the user.</p></li>
<li><p><cite>“conserved quantity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The conserved quantity <span class="math notranslate nohighlight">\(\Phi\)</span></p></li>
<li><p><cite>“source key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-source_sink</strong> Units are in conserved
quantity per second per cell volume.</p></li>
<li><p><cite>“time discretization theta</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> <span class="math notranslate nohighlight">\(\theta\)</span> in a
Crank-Nicholson time integration scheme.  1.0 implies fully implicit, 0.0
implies explicit, 0.5 implies C-N.</p></li>
<li><p><cite>“modify predictor positivity preserving</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true,
predictors are modified to ensure that the conserved quantity is always &gt; 0.</p></li>
<li><p><cite>“absolute error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>550.0</strong> a_tol in the standard
error norm calculation.  Defaults to a small amount of water.  Units are
the same as the conserved quantity.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-physical-bdf-default-spec]</span></code></p></li>
</ul>
</div>
</section>
<section id="snow-balance-equation">
<h5><a class="toc-backref" href="#id99" role="doc-backlink">Snow Balance Equation</a><a class="headerlink" href="#snow-balance-equation" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>An implicit PK for surface balance snow SWE conservation.</p>
</div></blockquote>
<p>This is a balance PK whose conserved quantity is snow SWE.  The energy balance
comes in as it provides the energy needed to melt snow.  So source terms
include snow precipitation and snowmelt.  It also manages snow density, which
should get rethought a bit.</p>
<p>There is also some wierd hackiness here about area fractions – see ATS Issue
#8</p>
<div class="admonition-subgrid-balance-pk-spec admonition" id="subgrid-balance-pk-spec">
<p class="admonition-title">subgrid-balance-pk-spec</p>
<ul class="simple">
<li><p><cite>“absolute error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.01</strong> <code class="docutils literal notranslate"><span class="pre">[m]</span></code></p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[balance-pk-spec]</span></code> This <em>is a</em> <a class="reference internal" href="#balance-equation">Balance Equation</a></p></li>
</ul>
<p>Not typically set by user, defaults work:</p>
<ul class="simple">
<li><p><cite>“conserved quantity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-snow_water_equivalent</strong>
Sets the default conserved quantity key, so this is likely not supplied
by the user. <cite>[m]</cite></p></li>
<li><p><cite>“snow density key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-density</strong> Default snow density
key. <cite>[kg m^-3]</cite></p></li>
<li><p><cite>“snow age key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-age</strong> Default snow age key. <cite>[d]</cite></p></li>
<li><p><cite>“new snow key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-source</strong> Default new snow key. <cite>[m SWE s^-1]</cite></p></li>
<li><p><cite>“area fractions key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-fractional_areas</strong> Subgrid
model fractional areas, see note above. <cite>[-]</cite></p></li>
<li><p><cite>“snow death rate key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-death_rate</strong> Deals with last
tiny bit of snowmelt.</p></li>
</ul>
</div>
</section>
</section>
<section id="biogeochemistry">
<h4><a class="toc-backref" href="#id100" role="doc-backlink">Biogeochemistry</a><a class="headerlink" href="#biogeochemistry" title="Permalink to this heading"></a></h4>
<p>To accurately predict watershed ecohydrology, a carbon cycle model is
needed to predict transpiration.  By simulating a carbon cycle, we are
able to predict the rate of photosynthesis as a function of space and
time, and photosynthesis governs root water uptake.  Currently only
one big-leaf model is available, but ongoing work is wrapping a
generalized Common/Colorado Land Model based on that developed within
the ParFlow team, and another ongoing project is working on wrapping
kernels from E3SM’s Land Model.</p>
<section id="biogeochemistry-monolithic-version">
<h5><a class="toc-backref" href="#id101" role="doc-backlink">Biogeochemistry – Monolithic Version</a><a class="headerlink" href="#biogeochemistry-monolithic-version" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Above and below-ground carbon cycle model.</p>
</div></blockquote>
<p>This is a multi-leaf layer, big-leaf vegetation model coupled to a Century
model for belowground carbon decomposition.</p>
<p>It leverages a PFT-based structure which allows multiple height-sorted PFTs to
coexist on the same grid cells, with the shorter PFTs getting whatever light is
left in the understory.</p>
<p>The implementation is based on an old, standalone code by Chonggang Xu, and
adapted for ATS.  While this is not simple, it is called BGC simple as it is
about the least amount of complexity required to get a reasonable carbon cycle
into ATS.</p>
<p>Outputs of this include transpiration, a critical sink for hydrology, as it
solves photosynthesis based on water availability.</p>
<p>Note this is an “explicit update PK,” or effectively a forward Euler timestep
that is not written in ODE form.</p>
<p>Note this works on both the surface (vegetation) and subsurface (decomposition)
meshes.  <strong>It is required</strong> that the subsurface mesh is a “columnar” mesh, and
that build_columns in the subsurface <a class="reference internal" href="#mesh">Mesh</a> spec has been supplied.</p>
<div class="admonition-bgc-simple-spec admonition" id="bgc-simple-spec">
<p class="admonition-title">bgc-simple-spec</p>
<ul class="simple">
<li><p><cite>“initial time step</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> Initial time step size <cite>[s]</cite></p></li>
<li><p><cite>“number of carbon pools</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>7</strong> Unclear whether this can actually change?</p></li>
<li><p><cite>“soil carbon parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[soil-carbon-spec-list]</span></code> List of soil carbon parameters by soil mesh partition region name.</p></li>
<li><p><cite>“pft parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[pft-spec-list]</span></code> List of PFT parameters by PFT name.</p></li>
<li><p><cite>“latitude [degrees]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>60</strong> Latitude of the simulation in degrees.  Used in radiation balance.</p></li>
<li><p><cite>“wind speed reference height [m]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>2.0</strong> Reference height of the wind speed dataset.</p></li>
<li><p><cite>“cryoturbation mixing coefficient [cm^2/yr]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>5.0</strong> Controls diffusion of carbon into the subsurface via cryoturbation.</p></li>
<li><p><cite>“leaf biomass initial condition</cite>” <code class="docutils literal notranslate"><span class="pre">[initial-conditions-spec]</span></code> Sets the leaf biomass IC.</p></li>
<li><p><cite>“domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>domain</strong></p></li>
<li><p><cite>“surface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>surface</strong></p></li>
<li><p><cite>“transpiration key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-transpiration</strong> The distributed transpiration flux <cite>[mol s^-1]</cite></p></li>
<li><p><cite>“shaded shortwave radiation key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code>
<strong>SURFACE_DOMAIN-shaded_shortwave_radiation</strong> Shortwave radiation that gets
past the canopy and teo the bare ground for soil evaporation. <cite>[W m^-2]</cite></p></li>
<li><p><cite>“total leaf area index key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>SURFACE_DOMAIN-total_leaf_area_index</strong> Total LAI across all PFTs.</p></li>
</ul>
<p>EVALUATORS:</p>
<ul class="simple">
<li><p><cite>“temperature</cite>” The soil temperature <cite>[K]</cite></p></li>
<li><p><cite>“pressure</cite>” soil mafic potential <cite>[Pa]</cite></p></li>
<li><p><cite>“surface-cell_volume</cite>” <cite>[m^2]</cite></p></li>
<li><p><cite>“surface-incoming shortwave radiation</cite>” <cite>[W m^-2]</cite></p></li>
<li><p><cite>“surface-air_temperature</cite>” <cite>[K]</cite></p></li>
<li><p><cite>“surface-vapor_pressure_air</cite>” <cite>[Pa]</cite></p></li>
<li><p><cite>“surface-wind_speed</cite>” <cite>[m s^-1]</cite></p></li>
<li><p><cite>“surface-co2_concentration</cite>” <cite>[ppm]</cite></p></li>
</ul>
</div>
</section>
</section>
<section id="deformation">
<h4><a class="toc-backref" href="#id102" role="doc-backlink">Deformation</a><a class="headerlink" href="#deformation" title="Permalink to this heading"></a></h4>
<p>The unstructured mesh framework we use provides the opportunity to
include deformation of the mesh.  This deformation can be done in two
ways – either node coordinate changes are provided, or volumetric
changes are provided, and the code attempts to iterate toward a global
coordinate change that satisfies these volumetric changes.  The latter
can be somewhat fragile for large deformation, but it does allow
simple deformation such as small, somewhat uniform subsidence.  The
volumetric deformation PK below does this based on a volumetric change
given by loss of bulk ice.</p>
<section id="volumetric-deformation">
<h5><a class="toc-backref" href="#id103" role="doc-backlink">Volumetric Deformation</a><a class="headerlink" href="#volumetric-deformation" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Subsidence through bulk ice loss and cell volumetric change.</p>
</div></blockquote>
<p>This process kernel provides for going from a cell volumetric change to an
updated unstructured mesh, and can be coupled sequentially with flow to solve
problems of flow in a subsiding porous media.</p>
<p>Note that this PK is slaved to the flow PK.  This PK must be advanced first,
and be weakly coupled to the flow PK (or an MPC that advances the flow PK), and
the timestep of this PK must match that of the flow PK (e.g. do not try to
subcyle one or the other).  This uses a rather hacky, unconventional use of
time tags, where we use saturations and porosities at the NEXT time, but ASSUME
they are actually the values of the CURRENT time.  This saves having to stash a
copy of these variables at the CURRENT time, which would otherwise not be used.</p>
<p>Note that all deformation here is vertical, and we assume that the subsurface
mesh is <strong>perfectly columnar</strong> and that the “build columns” parameter has been
given to the subsurface mesh.  See the <a class="reference internal" href="#mesh">Mesh</a> spec for more.</p>
<p>The process here is governed through two options, the “deformation mode” and
the “deformation strategy.”</p>
<p>The deformation mode describes how the cell volume change is calculated.  There
are three options here:</p>
<ul class="simple">
<li><p>“prescribed” uses a function to precribe the volume changes as a function of (t,x,y,z).</p></li>
<li><p>“structural” decreases the cell volume if the porosity is above a prescribed
“structurally connected matrix” porosity.  Think of this as bulk ice
“propping up” the soil grains – as that bulk ice melts, it reduces porosity
toward the porosity in at which grains start to touch again and can be
structurally sound.</p></li>
<li><p>“saturation” is a heuristic that considers the liquid saturation directly,
and tries to relax the liquid saturation back toward a value that is
consistent with what the thawed soil should be.</p></li>
</ul>
<p>The deformation strategy describes how the cell volume change is turned into
node coordinate changes.  Three options are available:</p>
<ul class="simple">
<li><p>“average” simply takes the average of volume change/surface area and
horizontally averages this quantity across all neighbors.  While this has the
advantage of being simple, it has issues when thaw gradients in the
horizontal are not zero, as it may result in the loss of volume in a fully
frozen cell, blowing up the pressure and breaking the code.  This is great
when it works, but it almost never works in real problems, except in
column-based models, where it is perfect.</p></li>
<li><p>“mstk implementation” MSTK implements an iterated, local optimization method
that, one-at-a-time, moves nodes to try and match the volumes.  This has
fewer issues with overfitting, but doesn’t always do sane things, and can be
expensive if iterations don’t work well.  This is not particularly robust
either, but it seems to be the preferred method for 2D/3D problems.</p></li>
<li><p>“global optimization” attempts to directly form and solve the minimization
problem to find the nodal changes that result in the target volumetric
changes.  Note this has issues with overfitting, so penalty methods are used
to smooth the solution of the problem.  This is currently disabled.</p></li>
</ul>
<p>NOTE: all deformation options are treated EXPLICITLY, and depend only upon
values from the old time.</p>
<div class="admonition-volumetric-deformation-pk-spec admonition" id="volumetric-deformation-pk-spec">
<p class="admonition-title">volumetric-deformation-pk-spec</p>
<ul class="simple">
<li><p><cite>“max time step [s]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>inf</strong> Sets a maximum time step size.</p></li>
<li><p><cite>“deformation mode</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>prescribed</strong> See above for
descriptions.  One of: <cite>“prescribed</cite>”, <cite>“structural</cite>”, or <cite>“saturation</cite>”.</p></li>
<li><p><cite>“deformation strategy</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>global optimization</strong> See above
for descriptions.  One of <cite>“average</cite>”, <cite>“global optimization</cite>”, or <cite>“mstk
implementation</cite>”</p></li>
<li><p><cite>“domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>domain</strong>  The mesh to deform.</p></li>
<li><p><cite>“surface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>surface</strong> The surface mesh.</p></li>
<li><p><cite>“deformation function</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> <strong>optional</strong> Only used if
“deformation mode” == “prescribed”</p></li>
</ul>
<p>EVALUATORS:</p>
<ul class="simple">
<li><p><cite>“saturation_ice</cite>” <strong>DOMAIN-saturation_ice</strong></p></li>
<li><p><cite>“saturation_liquid</cite>” <strong>DOMAIN-saturation_liquid</strong></p></li>
<li><p><cite>“saturation_gas</cite>” <strong>DOMAIN-saturation_gas</strong></p></li>
<li><p><cite>“porosity</cite>” <strong>DOMAIN-porosity</strong></p></li>
<li><p><cite>“cell volume</cite>” <strong>DOMAIN-cell_volume</strong></p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-physical-default-spec]</span></code></p></li>
</ul>
</div>
</section>
</section>
</section>
<section id="mpc">
<h3><a class="toc-backref" href="#id104" role="doc-backlink">MPC</a><a class="headerlink" href="#mpc" title="Permalink to this heading"></a></h3>
<p>Multi-process-couplers or MPCs couple other PKs.  They also are PKs
themselves, in that they implement the PK interface.  So MPCs can also
couple other MPCs.  There are a few common “base” MPCs which do the
simplest form of coupling – sequential and globally implicit (with a
diagonal preconditioner).  Then there are specific couplers which know
more about their coupled sub-PKs, and can do more complicated things
(for instance, adding off-diagonal block entries to the
preconditioner).</p>
<p>MPCs are also used to couple across domains – for instance integrated
hydrology is a surface+subsurface flow coupler.  They also can do
fancier things like drape a bunch of subgrid columns off of a mesh, or
other things.  Think of these as the custom couplers.</p>
<section id="base-mpc">
<h4><a class="toc-backref" href="#id105" role="doc-backlink">Base MPC</a><a class="headerlink" href="#base-mpc" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Multi process coupler base class.</p>
</div></blockquote>
<p>A multi process coupler is a PK (process kernel) which coordinates and couples
several PKs.  Each of these coordinated PKs may be MPCs themselves, or physical
PKs.  Note this does NOT provide a full implementation of PK – it does not
supply the AdvanceStep() method.  Therefore this class cannot be instantiated, but
must be inherited by derived classes which finish supplying the functionality.
Instead, this provides the data structures and methods (which may be overridden
by derived classes) for managing multiple PKs.</p>
<p>Most of these methods simply loop through the coordinated PKs, calling their
respective methods.</p>
<div class="admonition-mpc-spec admonition" id="mpc-spec">
<p class="admonition-title">mpc-spec</p>
<ul class="simple">
<li><p><cite>“PKs order</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> Provide a specific order to the
sub-PKs; most methods loop over all sub-PKs, and will call the sub-PK
method in this order.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#pk">PK</a>.</p></li>
</ul>
</div>
</section>
<section id="weakmpc">
<h4><a class="toc-backref" href="#id106" role="doc-backlink">WeakMPC</a><a class="headerlink" href="#weakmpc" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Multi process coupler for sequential coupling.</p>
</div></blockquote>
<p>Noniterative sequential coupling simply calls each PK’s AdvanceStep() method in
order.</p>
<div class="admonition-weak-mpc-spec admonition" id="weak-mpc-spec">
<p class="admonition-title">weak-mpc-spec</p>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[mpc-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#mpc">MPC</a>.</p></li>
</ul>
</div>
</section>
<section id="strongmpc">
<h4><a class="toc-backref" href="#id107" role="doc-backlink">StrongMPC</a><a class="headerlink" href="#strongmpc" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Multi process coupler for globally implicit (strong) coupling.</p>
</div></blockquote>
<p>Globally implicit coupling solves all sub-PKs as a single system of equations.  This can be completely automated when all PKs are also <a class="reference internal" href="#pk-bdf">PK: BDF</a> PKs, using a block-diagonal preconditioner where each diagonal block is provided by its own sub-PK.</p>
<div class="admonition-strong-mpc-spec admonition" id="strong-mpc-spec">
<p class="admonition-title">strong-mpc-spec</p>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[mpc-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#mpc">MPC</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-bdf-default-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#pk-bdf">PK: BDF</a>.</p></li>
</ul>
</div>
</section>
</section>
<section id="physical-mpcs">
<h3><a class="toc-backref" href="#id108" role="doc-backlink">Physical MPCs</a><a class="headerlink" href="#physical-mpcs" title="Permalink to this heading"></a></h3>
<p>Coupling is an art, and often requires special off-diagonal work for
globally implicit coupling, and fancy games can be played with domains
to couple across domain interfaces both implicitly and sequentially.
Physical MPCs derive from default MPCs to provide special
implementations of some methods.</p>
<section id="coupled-water-mpc">
<h4><a class="toc-backref" href="#id109" role="doc-backlink">Coupled Water MPC</a><a class="headerlink" href="#coupled-water-mpc" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>A coupler which integrates surface and subsurface flow implicitly.</p>
</div></blockquote>
<p>Couples Richards equation to surface water through continuity of both pressure
and fluxes.  This leverages subsurface discretizations that include face-based
unknowns, and notes that those face unknowns that correspond to surface faces
are co-located with the surface cell pressure, and therefore are equivalent.
In this approach (described in detail in a paper that is in review), the
surface equations are directly assembled into the subsurface discrete operator.</p>
<div class="admonition-mpc-coupled-water-spec admonition" id="mpc-coupled-water-spec">
<p class="admonition-title">mpc-coupled-water-spec</p>
<ul class="simple">
<li><p><cite>“PKs order</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> The use supplies the names of the
coupled PKs.  The order must be {subsurface_flow_pk, surface_flow_pk}
(subsurface first).</p></li>
<li><p><cite>“subsurface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>domain</strong></p></li>
<li><p><cite>“surface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>surface</strong></p></li>
<li><p><cite>“water delegate</cite>” <code class="docutils literal notranslate"><span class="pre">[mpc-delegate-water-spec]</span></code> A <a class="reference internal" href="#coupled-water-globalization-delegate">Coupled Water
Globalization Delegate</a> spec.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[strong-mpc-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#strongmpc">StrongMPC</a></p></li>
</ul>
</div>
</section>
<section id="coupled-cells-mpc">
<h4><a class="toc-backref" href="#id110" role="doc-backlink">Coupled Cells MPC</a><a class="headerlink" href="#coupled-cells-mpc" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>A coupler which solves two PDEs on the same domain.</p>
</div></blockquote>
<p>This is a StrongMPC which uses a preconditioner in which the
block-diagonal cell-local matrix is dense.  If the system looks something
like:</p>
<p>A( y1, y2, x, t ) = 0
B( y1, y2, x, t ) = 0</p>
<p>where y1,y2 are spatially varying unknowns that are discretized using the MFD
method (and therefore have both cell and face unknowns), an approximation to
the Jacobian is written as</p>
<p>[  dA_c/dy1_c  dA_c/dy1_f   dA_c/dy2_c       0      ]
[  dA_f/dy1_c  dA_f/dy1_f      0              0      ]
[  dB_c/dy1_c     0          dB_c/dy2_c  dB_c/dy2_f ]
[      0           0          dB_f/dy2_c  dB_f/dy2_f ]</p>
<p>Note that the upper left block is the standard preconditioner for the A
system, and the lower right block is the standard precon for the B system,
and we have simply added cell-based couplings, dA_c/dy2_c and dB_c/dy1_c.</p>
<p>Most commonly this is used to couple flow and energy equations on the same
mesh.  In the temperature/pressure system, these extra blocks correspond to</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \Theta}{\partial T} \; , \; \frac{\partial E}{\partial p}\]</div>
<div class="admonition-mpc-coupled-cells-spec admonition" id="mpc-coupled-cells-spec">
<p class="admonition-title">mpc-coupled-cells-spec</p>
<ul class="simple">
<li><p><cite>“domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Domain of simulation</p></li>
<li><p><cite>“conserved quantity A</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Key of the first sub-PK’s conserved quantity.</p></li>
<li><p><cite>“conserved quantity B</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Key of the second sub-PK’s conserved quantity.</p></li>
<li><p><cite>“primary variable A</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Key of the first sub-PK’s primary variable.</p></li>
<li><p><cite>“primary variable B</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Key of the second sub-PK’s primary variable.</p></li>
<li><p><cite>“no dA/dy2 block</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Excludes the dA_c/dy2_c block above.</p></li>
<li><p><cite>“no dB/dy1 block</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Excludes the dB_c/dy1_c block above.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[strong-mpc-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#strongmpc">StrongMPC</a>.</p></li>
</ul>
</div>
</section>
<section id="subsurface-mpc">
<h4><a class="toc-backref" href="#id111" role="doc-backlink">Subsurface MPC</a><a class="headerlink" href="#subsurface-mpc" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>A coupler which solves flow and energy in the subsurface.</p>
</div></blockquote>
<p>This MPC provides most nearly all terms for an approximate Jacobian for
coupling three-phase Richards equation (the <a class="reference internal" href="#permafrost-flow-pk">Permafrost Flow PK</a>) to the
three-phase Energy equation (the <a class="reference internal" href="#three-phase-subsurface-energy-pk">Three-Phase subsurface Energy PK</a>).</p>
<p>Many options are provided for turning on and off various aspects of this
Jacobian, so it is useful to mathematically write out these terms.  The
equations are:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{\partial \Theta}{\partial t} - \nabla \frac{k_r n_l}{\mu} K ( \nabla p + \rho g \cdot \hat{z} ) = Q_w \\
\frac{\partial E}{\partial t} - \nabla \cdot \kappa \nabla T + \nabla \cdot \mathbf{q} e(T) = Q_w e(T) + Q_e\end{split}\]</div>
<p>Note that all of the following are dependent on <span class="math notranslate nohighlight">\(p\)</span> and/or <span class="math notranslate nohighlight">\(T\)</span>:</p>
<div class="math notranslate nohighlight">
\[\Theta(p,T), k_r(p,T), n_l(p,T), \mu(T), \rho(p,T), E(p,T), \kappa(p,T), e(T)\]</div>
<p>Also, both source terms <span class="math notranslate nohighlight">\(Q_w\)</span> and <span class="math notranslate nohighlight">\(Q_e\)</span> may or may not depend on <span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(T\)</span>.</p>
<p>Note also that the Darcy flux <span class="math notranslate nohighlight">\(\mathbf{q}\)</span> used in the advection of energy is given by the Darcy flux:</p>
<div class="math notranslate nohighlight">
\[\mathbf{q} = -\frac{k_r n_l}{\mu} K ( \nabla p + \rho g \cdot \rho g \cdot \hat{z} )\]</div>
<p>Differentiating these two equations in their two unknowns gives the following four blocks in the approximate Jacobian:</p>
<p><span class="math notranslate nohighlight">\(\frac{\partial F_1}{\partial p}\)</span>: this is the Richards equation diagonal block, and is controlled inside that PK.</p>
<p><span class="math notranslate nohighlight">\(\frac{\partial F_1}{\partial T}\)</span> includes terms for:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\frac{\partial \Theta}{\partial T}\)</span> This term is the cell-local diagonal block.</p></li>
<li><p>The partial derivative of the divergence of the Darcy flux with respect to
temperature is dominated by <span class="math notranslate nohighlight">\(\frac{\partial}{\partial T} \frac{k_r
n_l}{\mu}\)</span>.  This is because the relative permeability is strongly
dependent upon phase change (the freezing equals drying approximation).  This
term is referred to as the “d div q / dT” term.</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\frac{\partial F_2}{\partial p}\)</span> includes terms for:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\frac{\partial E}{\partial p}\)</span> This term is the cell-local diagonal block.</p></li>
<li><p>The partial derivative of the energy diffusion term with respect to pressure
is dominated by <span class="math notranslate nohighlight">\(\frac{\partial \kappa}{\partial p}\)</span> through phase
change – at a constant temperature, but changing pressure, phase change can
result in large changes to thermal conductivity.  This is referred to as the
“div K grad T / dp” term.</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\frac{\partial F_2}{\partial T}\)</span>: this is the energy equation diagonal block, and is controlled inside that PK.</p>
<p>Also, at this level, where we know more about the flux used in the energy
equation (it is the Darcy flux), we can do a better approximation of the
derivative of the advection of energy term with respect to both temperature and
pressure.  For instance, enthalpy is only weakly dependent on pressure, so we
can use the derivative of the divergence of the Darcy flux with respect to
pressure (from the Richards block) in the advection term in the
<span class="math notranslate nohighlight">\(\frac{\partial F_2}{\partial p}\)</span> block, and approximate
<span class="math notranslate nohighlight">\(\frac{\partial k_r}{\partial T}\)</span> in the advection term as well.  These
terms are referred to as “div hq / dp,T terms”.  Note the missing initial “d”
here relative to other terms.</p>
<p>The behavior of this MPC’s preconditioner can be set by an option,
<cite>“preconditioner type</cite>”.  Really users should not change this from the default,
except in expert cases or for comparison’s sake, but the options are:</p>
<ul class="simple">
<li><p><cite>“picard</cite>” is the default, this uses all available terms, and enables the
“suppress” options for finer-grained control.</p></li>
<li><p><cite>“none</cite>” No preconditioner never works.</p></li>
<li><p><cite>“block diagonal</cite>” This is what one would get from the default <a class="reference internal" href="#strongmpc">StrongMPC</a>.  This probably never works.</p></li>
<li><p><cite>“no flow coupling</cite>” This keeps the accumulation terms, but turns off all the
non-local blocks.  This is equivalent to <a class="reference internal" href="#coupled-cells-mpc">Coupled Cells MPC</a>.</p></li>
<li><p><cite>“ewc</cite>” <strong>CURRENTLY DEPRECATED/BROKEN/DISABLED</strong> In addition to the
<cite>“picard</cite>” coupling, this also <em>always</em> does a change of variables, whereby
we first invert to calculate primary variable corrections, then do a change
of variables to calculate the linearized corrections in energy and water
content space.  We then apply those corrections, and invert to find the
primary variable changes that would have made those corrections.  This is
called the “energy and water content” algorithm, and is related to similar
variable changing approaches by Krabbenhoft (for flow) and Knoll (for
energy), but in the multivariate approach.  This is somewhat bad, becuase
while it fixes some corrections, it breaks others.</p></li>
<li><p><cite>“smart ewc</cite>” <strong>CURRENTLY DEPRECATED/BROKEN/DISABLED</strong> Does the <cite>“ewc</cite>”
algorithm above, but tries to be smart about when to do it.  This algorithm
helps when we are about to fall off of the latent heat cliff.  If we can
guess when to do it, we have a better chance of not breaking things.  This
seems like it ought to be helpful, but often doesn’t do as much as one might
hope.</p></li>
</ul>
<p>Note this “ewc” algorithm is just as valid, and more useful, in the predictor
(where it is not deprecated/disabled).  There, we extrapolate a change in
pressure and temperature, but often do better to extrapolate in water content
and energy space, then invert (locally) for pressure and temperature
corrections that meet that extrapolation.  Both of these globalization
algorithms are supported by the <a class="reference internal" href="#ewc-globalization-delegate">EWC Globalization Delegate</a> object.</p>
<div class="admonition-mpc-subsurface-spec admonition" id="mpc-subsurface-spec">
<p class="admonition-title">mpc-subsurface-spec</p>
<ul class="simple">
<li><p><cite>“domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Domain of simulation</p></li>
<li><p><cite>“preconditioner type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>picard</strong> See the above for
detailed descriptions of the choices.  One of: <cite>“none</cite>”, <cite>“block
diagonal</cite>”, <cite>“no flow coupling</cite>”, <cite>“picard</cite>”, <cite>“ewc</cite>”, and <cite>“smart ewc</cite>”.</p></li>
<li><p><cite>“supress Jacobian terms: div hq / dp,T</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If using picard or ewc, do not include this block in the preconditioner.</p></li>
<li><p><cite>“supress Jacobian terms: d div q / dT</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If using picard or ewc, do not include this block in the preconditioner.</p></li>
<li><p><cite>“supress Jacobian terms: d div K grad T / dp</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If using picard or ewc, do not include this block in the preconditioner.</p></li>
<li><p><cite>“ewc delegate</cite>” <code class="docutils literal notranslate"><span class="pre">[mpc-delegate-ewc-spec]</span></code> A <a class="reference internal" href="#ewc-globalization-delegate">EWC Globalization Delegate</a> spec.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[strong-mpc-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#strongmpc">StrongMPC</a>.</p></li>
</ul>
</div>
</section>
<section id="surface-mpc">
<h4><a class="toc-backref" href="#id112" role="doc-backlink">Surface MPC</a><a class="headerlink" href="#surface-mpc" title="Permalink to this heading"></a></h4>
</section>
<section id="permafrost-mpc">
<h4><a class="toc-backref" href="#id113" role="doc-backlink">Permafrost MPC</a><a class="headerlink" href="#permafrost-mpc" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>A coupler which solves flow and energy both surface and subsurface.</p>
</div></blockquote>
<p>This MPC handles the coupling of surface energy and flow to subsurface energy
and flow for integrated hydrology with freeze/thaw processes.</p>
<div class="admonition-mpc-permafrost-spec admonition" id="mpc-permafrost-spec">
<p class="admonition-title">mpc-permafrost-spec</p>
<ul class="simple">
<li><p><cite>“PKs order</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> The user supplies the names of the
coupled PKs.  The order must be {subsurface_flow_pk, subsurface_energy_pk,
surface_flow_pk, surface_energy_pk}.</p></li>
<li><p><cite>“subsurface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>domain</strong></p></li>
<li><p><cite>“surface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>surface</strong></p></li>
<li><p><cite>“mass exchange flux key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>SURFACE_DOMAIN-surface_subsurface_flux</strong></p></li>
<li><p><cite>“energy exchange flux key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>SURFACE_DOMAIN-surface_subsurface_energy_flux</strong></p></li>
<li><p><cite>“water delegate</cite>” <code class="docutils literal notranslate"><span class="pre">[mpc-delegate-water-spec]</span></code> A <a class="reference internal" href="#coupled-water-globalization-delegate">Coupled Water
Globalization Delegate</a> spec.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[mpc-subsurface-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#subsurface-mpc">Subsurface MPC</a></p></li>
</ul>
</div>
</section>
</section>
<section id="globalization-delegates">
<h3><a class="toc-backref" href="#id114" role="doc-backlink">Globalization Delegates</a><a class="headerlink" href="#globalization-delegates" title="Permalink to this heading"></a></h3>
<p>Globalization is the art of convincing a solver to find the solution.
Remember – physics typically cares very little about <em>how</em> you get to
a solution, only that you get there.  If you can guess or otherwise
find the solution physically, without doing fancy math, go for it!
These delegates are handy utility classes which are used by MPCs to
effeciently leverage physics understanding in the mathematical solvers
to nudge the solver in the direction of a reasonable solution, or to
keep a solver from going off into a part of space which is totally
unphysical.  These can often make the difference between converging
and not converging.</p>
<p>Much of the efficiency of ATS comes from these delegates, and more of
them are always welcome contributions.</p>
<section id="coupled-water-globalization-delegate">
<h4><a class="toc-backref" href="#id115" role="doc-backlink">Coupled Water Globalization Delegate</a><a class="headerlink" href="#coupled-water-globalization-delegate" title="Permalink to this heading"></a></h4>
</section>
<section id="ewc-globalization-delegate">
<h4><a class="toc-backref" href="#id116" role="doc-backlink">EWC Globalization Delegate</a><a class="headerlink" href="#ewc-globalization-delegate" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Globalization for nonlinearity associated with phase change and latent heat.</p>
</div></blockquote>
<p>The EWC delegate works to deal with strong nonlinearities associated with
latent heat and phase change.  Provided a change in primary variables pressure
and temperature, it works by first multiplying those changes by the local
Jacobian matrix, <span class="math notranslate nohighlight">\(\frac{\partial \left\{ \Theta, E \right\} }{ \partial
\left\{ p, T \right\} }\)</span> to calculate changes in water content and energy, then
calculating the new water content and energy and inverting the functions
<span class="math notranslate nohighlight">\(\Theta(p,T), E(p,T)\)</span> to determine what pressure and temperature would
have resulted in those values.  This provides a corrected change in the primary
variables.</p>
<p>Conceptually, this is a “more robust” choice in nonlinearities associated with
phase change, where the derivatives go from small to large to small again, and
small changes in pressure and temperature result in large changes in water
content and energy.</p>
<p>This delegate manages these globalization strategies, which can be used both in
modifying the correction supplied by a nonlinear iterate, and in modifying a
predictor, the extrapolated projection (from previous timesteps) that
provides the initial guess to the nonlinear solve.</p>
<div class="admonition-mpc-delegate-ewc-spec admonition" id="mpc-delegate-ewc-spec">
<p class="admonition-title">mpc-delegate-ewc-spec</p>
<ul class="simple">
<li><p><cite>“verbose object</cite>” <code class="docutils literal notranslate"><span class="pre">[verbose-object-spec]</span></code> See <a class="reference internal" href="#verbose-object">Verbose Object</a>.</p></li>
<li><p><cite>“PK name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Name of the owning PK – simply for logging and
debugging.</p></li>
<li><p><cite>“domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“domain”</strong> The mesh.</p></li>
<li><p><cite>“preconditioner type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> When to use EWC on the nonlinear
iterate’s correction.  One of:</p>
<ul>
<li><p><cite>“none</cite>” Never do EWC</p></li>
<li><p><cite>“ewc</cite>” Always do EWC</p></li>
<li><p><cite>“smart ewc</cite>” Attempt EWC when it seems likely it will be useful and
take the EWC correction if it is smaller than the standard correction.</p></li>
</ul>
</li>
<li><p><cite>“predictor type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> When to use EWC on the predictor.  One
of:</p>
<ul>
<li><p><cite>“none</cite>” Never do EWC</p></li>
<li><p><cite>“ewc</cite>” Always do EWC</p></li>
<li><p><cite>“smart ewc</cite>” Attempt EWC when it seems likely it will be useful and
take the EWC correction if it is smaller than the standard correction.</p></li>
</ul>
</li>
<li><p><cite>“freeze-thaw cusp width [K]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Controls a width over which
to assume we are close to the latent heat cliff, and begins applying the
EWC algorithm in <cite>“ewc smarter</cite>”.</p></li>
<li><p><cite>“freeze-thaw cusp width (freezing) [K]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Controls a width
over which to assume we are close to the latent heat cliff as we get
colder, and begins applying the EWC algorithm in <cite>“ewc smarter</cite>”.</p></li>
<li><p><cite>“freeze-thaw cusp width (thawing) [K]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Controls a width
over which to assume we are close to the latent heat cliff as we get
warmer, and begins applying the EWC algorithm in <cite>“ewc smarter</cite>”.</p></li>
<li><p><cite>“pressure key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-pressure</strong></p></li>
<li><p><cite>“temperature key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-temperature</strong></p></li>
<li><p><cite>“water content key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-water_content</strong></p></li>
<li><p><cite>“energy key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-energy</strong></p></li>
<li><p><cite>“cell volume key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-cell_volume</strong></p></li>
</ul>
<p>INCLUDES</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[debugger-spec]</span></code> Uses a <a class="reference internal" href="#debugger">Debugger</a></p></li>
</ul>
</div>
</section>
</section>
</section>
<section id="state">
<h2><a class="toc-backref" href="#id50" role="doc-backlink">State</a><a class="headerlink" href="#state" title="Permalink to this heading"></a></h2>
<blockquote>
<div><p>State, a container for data.</p>
</div></blockquote>
<p>State  is a  simple data-manager,  allowing PKs  to require,  read, and  write
various fields.</p>
<ul class="simple">
<li><p>Acts as a factory for data through the various require methods.</p></li>
<li><p>Provides some data protection by providing both const and non-const
data pointers to PKs.</p></li>
<li><p>Provides some initialization capability – this is where all
independent variables can be initialized (as independent variables
are owned by state, not by any PK).</p></li>
</ul>
<div class="admonition-state-spec admonition" id="state-spec">
<p class="admonition-title">state-spec</p>
<ul class="simple">
<li><p><cite>“evaluators</cite>” <code class="docutils literal notranslate"><span class="pre">[evaluator-typedinline-spec-list]</span></code> A list of evaluators.</p></li>
<li><p><cite>“initial conditions</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> A list of constant-in-time data.  Note
that <cite>“initial conditions</cite>” is not a particularly descriptive name here –
PDE initial conditions are generally not here.  This list consists of</p></li>
</ul>
</div>
<div class="admonition-evaluator-typedinline-spec admonition" id="evaluator-typedinline-spec">
<p class="admonition-title">evaluator-typedinline-spec</p>
<ul class="simple">
<li><p><cite>“evaluator type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Type of the evaluator Included for
convenience in defining data that is not in the dependency graph,
constants are things (like gravity, or atmospheric pressure) which are
stored in state but never change.  Typically they’re limited to scalars
and dense, local vectors.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;state&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;initialization filename&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;_CHECK00123.h5&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;evaluators&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pressure&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;evaluator type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;primary variable&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;initial conditions&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;time&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;atmospheric pressure&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;101325.0&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gravity&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{0.0,0.0,-9.80665}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>State consists of two sublists, one for evaluators and the other for
atomic constants.  The latter is currently called <cite>“initial
conditions</cite>”, which is a terrible name which must be fixed.</p>
<p>example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;state&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;field evaluators&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>...
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;initial conditions&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>...
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<section id="evaluators">
<h3><a class="toc-backref" href="#id51" role="doc-backlink">Evaluators</a><a class="headerlink" href="#evaluators" title="Permalink to this heading"></a></h3>
<p>Evaluators are individual terms used to build up a PK or MPCs.  Each
term represents a variable in the equation, and can consist of primary
variables (those that are solved for by a PK solver), independent
variables (those that have no dependent variables but are provided by
the user as data), and secondary variables (those that are functions
of other variables).  Note that all three may be variable in space
and/or time.</p>
<nav class="contents local" id="list-of-evalutors">
<p class="topic-title"><strong>List of Evalutors</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#primary-variables" id="id117">Primary Variables</a></p></li>
<li><p><a class="reference internal" href="#independent-variables" id="id118">Independent Variables</a></p>
<ul>
<li><p><a class="reference internal" href="#constant" id="id119">Constant</a></p></li>
<li><p><a class="reference internal" href="#from-function" id="id120">From Function</a></p></li>
<li><p><a class="reference internal" href="#from-file" id="id121">From File</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#secondary-variables" id="id122">Secondary Variables</a></p></li>
<li><p><a class="reference internal" href="#conserved-quantities" id="id123">Conserved quantities</a></p>
<ul>
<li><p><a class="reference internal" href="#richards-equation-water-content-liquid-only" id="id124">Richards Equation water content (liquid only)</a></p></li>
<li><p><a class="reference internal" href="#liquid-gas-water-content" id="id125">Liquid+Gas water content</a></p></li>
<li><p><a class="reference internal" href="#liquid-ice-water-content" id="id126">Liquid+Ice water content</a></p></li>
<li><p><a class="reference internal" href="#liquid-ice-gas-water-content" id="id127">Liquid+Ice+Gas water content</a></p></li>
<li><p><a class="reference internal" href="#surface-water-content" id="id128">Surface water content</a></p></li>
<li><p><a class="reference internal" href="#snow-or-canopy-water-content" id="id129">Snow or canopy water content</a></p></li>
<li><p><a class="reference internal" href="#richards-energy" id="id130">Richards energy</a></p></li>
<li><p><a class="reference internal" href="#liquid-gas-energy" id="id131">Liquid+Gas energy</a></p></li>
<li><p><a class="reference internal" href="#liquid-ice-energy" id="id132">Liquid+Ice energy</a></p></li>
<li><p><a class="reference internal" href="#liquid-ice-gas-energy" id="id133">Liquid+Ice+Gas energy</a></p></li>
<li><p><a class="reference internal" href="#surface-water-ice-energy" id="id134">Surface water+ice energy</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#subsurface-flow-evaluators" id="id135">Subsurface flow evaluators</a></p>
<ul>
<li><p><a class="reference internal" href="#capillary-pressure" id="id136">Capillary pressure</a></p></li>
<li><p><a class="reference internal" href="#capillary-pressure-of-liquid-on-ice" id="id137">Capillary pressure of liquid on ice</a></p></li>
<li><p><a class="reference internal" href="#water-retention-model-and-relative-permeability" id="id138">Water Retention Model and Relative Permeability</a></p>
<ul>
<li><p><a class="reference internal" href="#van-genuchten-model" id="id139">Van Genuchten Model</a></p></li>
<li><p><a class="reference internal" href="#linear-model" id="id140">Linear  Model</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#water-retention-model-for-freeze-thaw" id="id141">Water Retention Model for Freeze-Thaw</a></p>
<ul>
<li><p><a class="reference internal" href="#original-implicit-model" id="id142">Original Implicit model</a></p></li>
<li><p><a class="reference internal" href="#freezing-point-depression-model" id="id143">Freezing point depression model</a></p></li>
<li><p><a class="reference internal" href="#freezing-point-depression-smoothed-model" id="id144">Freezing point depression, smoothed model</a></p></li>
<li><p><a class="reference internal" href="#interfrost-model" id="id145">Interfrost model</a></p></li>
<li><p><a class="reference internal" href="#sutra-ice-model" id="id146">Sutra-ICE model</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#compressible-porosity" id="id147">Compressible porosity</a></p>
<ul>
<li><p><a class="reference internal" href="#standard-model" id="id148">Standard model</a></p></li>
<li><p><a class="reference internal" href="#exponential-model" id="id149">Exponential model</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#viscosity-of-water" id="id150">Viscosity of water</a></p>
<ul>
<li><p><a class="reference internal" href="#id6" id="id151">Constant</a></p></li>
<li><p><a class="reference internal" href="#nonisothermal" id="id152">Nonisothermal</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#surface-flow-evaluators" id="id153">Surface flow evaluators</a></p>
<ul>
<li><p><a class="reference internal" href="#ponded-depth-or-water-height" id="id154">Ponded Depth or Water Height</a></p></li>
<li><p><a class="reference internal" href="#ponded-depth-frozen" id="id155">Ponded Depth, Frozen</a></p></li>
<li><p><a class="reference internal" href="#effective-or-smoothed-height" id="id156">Effective, or Smoothed Height</a></p></li>
<li><p><a class="reference internal" href="#unfrozen-fraction" id="id157">Unfrozen fraction</a></p></li>
<li><p><a class="reference internal" href="#unfrozen-flowing-depth" id="id158">Unfrozen Flowing Depth</a></p></li>
<li><p><a class="reference internal" href="#surfacepotential" id="id159">SurfacePotential</a></p></li>
<li><p><a class="reference internal" href="#overland-conductivity-sheet-flow" id="id160">Overland Conductivity, sheet flow</a></p></li>
<li><p><a class="reference internal" href="#overland-conductivity-litter-resistance" id="id161">Overland Conductivity, litter resistance</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#thermodynamic-evaluators" id="id162">Thermodynamic evaluators</a></p>
<ul>
<li><p><a class="reference internal" href="#internal-energy" id="id163">Internal energy</a></p>
<ul>
<li><p><a class="reference internal" href="#linear" id="id164">Linear</a></p></li>
<li><p><a class="reference internal" href="#quadratic" id="id165">Quadratic</a></p></li>
<li><p><a class="reference internal" href="#water-vapor" id="id166">Water Vapor</a></p></li>
<li><p><a class="reference internal" href="#enthalpy" id="id167">Enthalpy</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#thermal-conductivity-two-phases" id="id168">Thermal Conductivity, two phases</a></p>
<ul>
<li><p><a class="reference internal" href="#wet-dry-model" id="id169">Wet-Dry Model</a></p></li>
<li><p><a class="reference internal" href="#peters-lidard-model" id="id170">Peters-Lidard Model</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#thermal-conductivity-three-phases" id="id171">Thermal Conductivity, three phases</a></p>
<ul>
<li><p><a class="reference internal" href="#id8" id="id172">Wet-Dry Model</a></p></li>
<li><p><a class="reference internal" href="#id9" id="id173">Peters-Lidard Model</a></p></li>
<li><p><a class="reference internal" href="#volume-averaged-model" id="id174">Volume-averaged Model</a></p></li>
<li><p><a class="reference internal" href="#id10" id="id175">Sutra-ICE model</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#thermal-conductivity-surface" id="id176">Thermal Conductivity, Surface</a></p></li>
<li><p><a class="reference internal" href="#advected-energy-source" id="id177">Advected Energy Source</a></p></li>
<li><p><a class="reference internal" href="#active-layer-averaged-temperature" id="id178">Active Layer Averaged Temperature</a></p></li>
<li><p><a class="reference internal" href="#water-table" id="id179">Water Table</a></p></li>
<li><p><a class="reference internal" href="#thaw-depth" id="id180">Thaw Depth</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#equations-of-state" id="id181">Equations of State</a></p>
<ul>
<li><p><a class="reference internal" href="#constant-value" id="id182">Constant Value</a></p></li>
<li><p><a class="reference internal" href="#standard-equation-of-state" id="id183">Standard Equation of State</a></p></li>
<li><p><a class="reference internal" href="#models" id="id184">Models</a></p>
<ul>
<li><p><a class="reference internal" href="#constant-eos" id="id185">Constant EOS</a></p></li>
<li><p><a class="reference internal" href="#linear-eos" id="id186">Linear EOS</a></p></li>
<li><p><a class="reference internal" href="#ideal-gas" id="id187">Ideal Gas</a></p></li>
<li><p><a class="reference internal" href="#eos-of-water" id="id188">EOS of Water</a></p></li>
<li><p><a class="reference internal" href="#eos-of-ice" id="id189">EOS of Ice</a></p></li>
<li><p><a class="reference internal" href="#eos-of-vapor-in-air" id="id190">EOS of Vapor in Air</a></p></li>
<li><p><a class="reference internal" href="#eos-of-saltwater" id="id191">EOS of Saltwater</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#surface-energy-balance-evaluators" id="id192">Surface energy balance evaluators</a></p>
<ul>
<li><p><a class="reference internal" href="#area-fractions" id="id193">Area Fractions</a></p>
<ul>
<li><p><a class="reference internal" href="#two-component-model" id="id194">Two-component model</a></p></li>
<li><p><a class="reference internal" href="#three-component-model" id="id195">Three-component model</a></p></li>
<li><p><a class="reference internal" href="#three-component-model-with-microtopography" id="id196">Three-component model, with microtopography</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#potential-evapotranspiration" id="id197">Potential Evapotranspiration</a></p>
<ul>
<li><p><a class="reference internal" href="#priestley-taylor-potential-evapotranspiration" id="id198">Priestley-Taylor Potential Evapotranspiration</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#downregulation-and-limiters" id="id199">Downregulation and limiters</a></p>
<ul>
<li><p><a class="reference internal" href="#transpiration-distribution" id="id200">Transpiration Distribution</a></p></li>
<li><p><a class="reference internal" href="#rooting-depth-fraction" id="id201">Rooting Depth Fraction</a></p></li>
<li><p><a class="reference internal" href="#plant-wilting-point" id="id202">Plant Wilting Point</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#soil-resistance" id="id203">Soil Resistance</a></p></li>
<li><p><a class="reference internal" href="#radiation-balance-terms" id="id204">Radiation Balance Terms</a></p>
<ul>
<li><p><a class="reference internal" href="#radiation-balance" id="id205">Radiation Balance</a></p></li>
<li><p><a class="reference internal" href="#canopy-radiation-balance" id="id206">Canopy Radiation Balance</a></p></li>
<li><p><a class="reference internal" href="#surface-albedo" id="id207">Surface Albedo</a></p></li>
<li><p><a class="reference internal" href="#incident-shortwave-radiation" id="id208">Incident Shortwave Radiation</a></p></li>
<li><p><a class="reference internal" href="#longwave-radiation" id="id209">Longwave Radiation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#full-surface-energy-balance-models" id="id210">Full Surface Energy Balance Models</a></p>
<ul>
<li><p><a class="reference internal" href="#bare-soil-surface-energy-balance" id="id211">Bare Soil Surface Energy Balance</a></p></li>
<li><p><a class="reference internal" href="#common-land-model-parflow-clm" id="id212">Common Land Model (ParFlow-CLM)</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#snow-evaluators" id="id213">Snow evaluators</a></p>
<ul>
<li><p><a class="reference internal" href="#snowsurfacepotential" id="id214">SnowSurfacePotential</a></p></li>
<li><p><a class="reference internal" href="#snow-melt-rate" id="id215">Snow Melt Rate</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#canopy-evaluators" id="id216">Canopy evaluators</a></p>
<ul>
<li><p><a class="reference internal" href="#interception" id="id217">Interception</a></p></li>
<li><p><a class="reference internal" href="#drainage" id="id218">Drainage</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#carbon-and-biogeochemistry-models" id="id219">Carbon and Biogeochemistry Models</a></p>
<ul>
<li><p><a class="reference internal" href="#carbon-decomposition-rate" id="id220">Carbon Decomposition Rate</a></p></li>
<li><p><a class="reference internal" href="#cryo-bioturbation" id="id221">Cryo/bioturbation</a></p></li>
<li><p><a class="reference internal" href="#pool-decomposition" id="id222">Pool Decomposition</a></p></li>
<li><p><a class="reference internal" href="#pool-transfer" id="id223">Pool Transfer</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#multiscale-models" id="id224">Multiscale Models</a></p>
<ul>
<li><p><a class="reference internal" href="#subgrid-aggregation" id="id225">Subgrid Aggregation</a></p></li>
<li><p><a class="reference internal" href="#subgrid-disaggregation" id="id226">Subgrid disaggregation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#geometric-evaluators" id="id227">Geometric evaluators</a></p>
<ul>
<li><p><a class="reference internal" href="#surfaceelevation" id="id228">SurfaceElevation</a></p></li>
<li><p><a class="reference internal" href="#elevation-of-a-column" id="id229">Elevation of a Column</a></p></li>
<li><p><a class="reference internal" href="#depth-evaluator" id="id230">Depth Evaluator</a></p></li>
<li><p><a class="reference internal" href="#cell-volume-evaluator" id="id231">Cell Volume evaluator</a></p></li>
<li><p><a class="reference internal" href="#deforming-cell-volume-evaluator" id="id232">Deforming Cell Volume evaluator</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#generic-evaluators" id="id233">Generic evaluators</a></p>
<ul>
<li><p><a class="reference internal" href="#additive" id="id234">Additive</a></p></li>
<li><p><a class="reference internal" href="#multiplicative" id="id235">Multiplicative</a></p></li>
<li><p><a class="reference internal" href="#column-summation" id="id236">Column summation</a></p></li>
<li><p><a class="reference internal" href="#top-cell" id="id237">Top cell</a></p></li>
<li><p><a class="reference internal" href="#arbitrary-function" id="id238">Arbitrary function</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="primary-variables">
<h4><a class="toc-backref" href="#id117" role="doc-backlink">Primary Variables</a><a class="headerlink" href="#primary-variables" title="Permalink to this heading"></a></h4>
<p>An evaluator with no dependencies that serves as the primary variable to be
solved for by a PK.  Note that users almost never are required to write an
input spec for these – they are controlled by the PK and therefore the input
spec for this evaluator is written by that PK.</p>
<div class="admonition-evaluator-primary-spec admonition" id="evaluator-primary-spec">
<p class="admonition-title">evaluator-primary-spec</p>
<ul class="simple">
<li><p><cite>“tag</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“”</strong> Time tag at which this primary variable is used.</p></li>
</ul>
</div>
</section>
<section id="independent-variables">
<h4><a class="toc-backref" href="#id118" role="doc-backlink">Independent Variables</a><a class="headerlink" href="#independent-variables" title="Permalink to this heading"></a></h4>
<p>Independent variables are variables which do not depend upon other
dependent variables but are provided as data by the user.  Examples
include material properties, forcing datasets, etc.  These can be
provided in a few forms:</p>
<section id="constant">
<h5><a class="toc-backref" href="#id119" role="doc-backlink">Constant</a><a class="headerlink" href="#constant" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>A field evaluator with no dependencies, a constant value.</p>
</div></blockquote>
<p>This evaluator is typically used for providing data that is a simple constant
value.</p>
<p>This evaluator is used by providing the option:</p>
<p><cite>“evaluator type</cite>” = <cite>“independent variable constant</cite>”</p>
<div class="admonition-independent-variable-constant-evaluator-spec admonition" id="independent-variable-constant-evaluator-spec">
<p class="admonition-title">independent-variable-constant-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“value</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> The value.</p></li>
</ul>
</div>
</section>
<section id="from-function">
<h5><a class="toc-backref" href="#id120" role="doc-backlink">From Function</a><a class="headerlink" href="#from-function" title="Permalink to this heading"></a></h5>
<p>This evaluator is typically used for providing data that are functions of space
and time.  The evaluator consists of a list of region,function pairs, and the
functions are evaluated across that region at each timestep.  If the problem is
time-independent, the <cite>“constant in time</cite>” option results in a performance
boost (as the functions need only be evaluated once).  This leverages the
exaustive functional format capability provided in Amanzi’s <a href="#id239"><span class="problematic" id="id240">Functions_</span></a> library.</p>
<p>This evaluator is used by providing the option:</p>
<p><cite>“evaluator type</cite>” == <cite>“independent variable</cite>”</p>
<div class="admonition-independent-variable-function-evaluator-spec admonition" id="independent-variable-function-evaluator-spec">
<p class="admonition-title">independent-variable-function-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“constant in time</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, only evaluate the
functions once as they are time-independent.</p></li>
<li><p><cite>“function</cite>” <code class="docutils literal notranslate"><span class="pre">[composite-vector-function-spec-list]</span></code></p></li>
</ul>
</div>
</section>
<section id="from-file">
<h5><a class="toc-backref" href="#id121" role="doc-backlink">From File</a><a class="headerlink" href="#from-file" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>An evaluator with no dependencies specified by discrete data in a file.</p>
</div></blockquote>
<p>This evaluator is typically used for providing data that are functions of space
and time.  Data is provided, discretely (e.g. with one data point per
cell/face/node), at a series of time slices.  The time slices are interpolated
linearly in time to provide the value.</p>
<p>Within the file, data is expected to meet the following (HDF5) layout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">time</span> <span class="p">:</span> <span class="n">a</span> <span class="mi">1</span><span class="n">D</span> <span class="n">array</span> <span class="n">of</span> <span class="n">length</span> <span class="n">NTIMES</span><span class="p">,</span> <span class="n">providing</span> <span class="n">the</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">seconds</span><span class="o">.</span>
<span class="o">/</span><span class="n">variable_name</span><span class="o">.</span><span class="n">ENTITY</span><span class="o">.</span><span class="n">DOF</span>  <span class="p">(</span><span class="n">group</span><span class="p">)</span>

   <span class="o">/</span><span class="mi">0</span> <span class="p">:</span> <span class="n">a</span> <span class="mi">1</span><span class="n">D</span> <span class="n">array</span> <span class="n">of</span> <span class="n">length</span> <span class="n">NENTITIES</span><span class="p">,</span> <span class="n">providing</span> <span class="n">the</span> <span class="n">values</span> <span class="k">for</span> <span class="n">each</span> <span class="n">entity</span>
        <span class="n">at</span> <span class="n">time</span> <span class="o">/</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
   <span class="o">/</span><span class="mi">1</span> <span class="p">:</span> <span class="o">...</span>
   <span class="o">/</span><span class="n">NTIMES</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="n">D</span> <span class="n">array</span> <span class="n">at</span> <span class="n">time</span> <span class="o">/</span><span class="n">time</span><span class="p">[</span><span class="n">NTIMES</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>This evaluator is used by providing the option:</p>
<p><cite>“evaluator type</cite>” == <cite>“independent variable</cite>”</p>
<div class="admonition-independent-variable-from-file-evaluator-spec admonition" id="independent-variable-from-file-evaluator-spec">
<p class="admonition-title">independent-variable-from-file-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“filename</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Path to the file.</p></li>
<li><p><cite>“variable name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Name of the dataset to read from the file.</p></li>
<li><dl class="simple">
<dt><cite>“domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>domain</strong> Name of the domain on which the</dt><dd><p>field is defined.</p>
</dd>
</dl>
</li>
<li><p><cite>“component name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>cell</strong> Name of the component in the
field to populate.</p></li>
<li><p><cite>“mesh entity</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>cell</strong> Name of the entity on which the
component is defined.</p></li>
<li><p><cite>“number of dofs</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1</strong> Number of degrees of freedom to read.</p></li>
<li><p><cite>“time function</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> <strong>optional</strong> If provided, time is
first manipulated by this function before interpolation.  This is useful
for things like cyclic data, which can use a modulo time function to
repeat the same data.</p></li>
</ul>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;field_evaluators&quot;</span><span class="nt">&gt;</span><span class="w">  </span><span class="cm">&lt;!-- parent list --&gt;</span>
<span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;porosity&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;field evaluator type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;independent variable from file&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;filename&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;_DATA_FILE.h5&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;domain name&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;domain&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;variable name&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;porosity&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;component name&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;cell&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mesh entity&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;cell&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;number of dofs&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;time function&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;times&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{1.0, 2.0, 3.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>The field <em>porosity</em> is defined as a cell-based variable and
interpolated between three time intervals.</p>
</section>
</section>
<section id="secondary-variables">
<h4><a class="toc-backref" href="#id122" role="doc-backlink">Secondary Variables</a><a class="headerlink" href="#secondary-variables" title="Permalink to this heading"></a></h4>
<p>All other evaluators are secondary variable evaluators, and these are
grouped by physics concept or process type.</p>
<p>Secondary variables, by definition, define functions that evaluate one
or more variables as a function of one or more variables.  Therefore
all secondary evaluators provide at least one “Key,” which is the
variable(s) computed, and at least one “Dependency.”</p>
<p>If the evaluator computes one and only one key, that key is provided
by the name of the parameter list in the <cite>“evalutors</cite>” list of <a class="reference internal" href="#state">State</a>.
If more than one Key is computed, then the second must either be
guessed by the code (for instance if the provided key is
“saturation_liquid”, it is likely that the other key is
“saturation_gas”) or provided by the user.  If more than one key is
computed, all of the keys computed can be specified exactly via the
input spec.  Keys are provided in one of two parameters:</p>
<ul class="simple">
<li><p><cite>“my variable key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Specifically name the variable used as “my variable”</p></li>
<li><p><cite>“my variable key suffix</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Name a suffix, and the
variable is given by DOMAIN-SUFFIX, where the DOMAIN is given by the
prefix in the evaluator list’s name.  This is particularly useful
for collections of enumerated PKs, e.g. columnar PKs, where the
DOMAIN might be computed on the fly based on a column ID.</p></li>
</ul>
<p>Dependencies use the same approach – each dependency variable name
may include a default, and looks for a “key” and “key suffix” as
potential options.</p>
<p>As an example, a saturation evaluator may depend on pressure, and may
detail all of its names via something like:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;domain:1-saturation_liquid&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;saturation gas key&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;domain:1-saturation_gas&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pressure key suffix&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;pressure&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- OR EQUIVALENTLY --&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pressure key&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;domain:1-pressure&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="conserved-quantities">
<h4><a class="toc-backref" href="#id123" role="doc-backlink">Conserved quantities</a><a class="headerlink" href="#conserved-quantities" title="Permalink to this heading"></a></h4>
<p>Nearly all ATS process kernels are conservation equations, where there
is a formal conserved quantity, that, upon convergence, is conserved
to tolerance.  These are always an “extensive” quantity.</p>
<p>Water content in ATS is always measured on <code class="docutils literal notranslate"><span class="pre">[mol]</span></code> and therefore
includes a factor of the cell volume.  Energy in ATS is always
measured in <code class="docutils literal notranslate"><span class="pre">[MJ]</span></code>.  Unlike nearly all other variables, this is not
SI, and is done so because this makes for fairly evenly balanced
equations between a coupled flow and energy problem.</p>
<section id="richards-equation-water-content-liquid-only">
<h5><a class="toc-backref" href="#id124" role="doc-backlink">Richards Equation water content (liquid only)</a><a class="headerlink" href="#richards-equation-water-content-liquid-only" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Richards water content evaluator: the standard form as a function of liquid saturation.</p>
</div></blockquote>
<div class="math notranslate nohighlight">
\[\Theta = n s \phi V\]</div>
<p>Specified with evaluator type: <cite>“richards water content</cite>”</p>
<div class="admonition-field-evaluator-type-richards-water-content-spec admonition" id="field-evaluator-type-richards-water-content-spec">
<p class="admonition-title">field-evaluator-type-richards-water-content-spec</p>
<p>DEPENDENCIES:</p>
<ul class="simple">
<li><p><cite>“porosity</cite>”</p></li>
<li><p><cite>“molar density liquid</cite>”</p></li>
<li><p><cite>“saturation liquid</cite>”</p></li>
<li><p><cite>“cell volume</cite>”</p></li>
</ul>
</div>
</section>
<section id="liquid-gas-water-content">
<h5><a class="toc-backref" href="#id125" role="doc-backlink">Liquid+Gas water content</a><a class="headerlink" href="#liquid-gas-water-content" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Water content for liquid + water vapor.</p>
</div></blockquote>
<div class="math notranslate nohighlight">
\[\Theta = (n_l s_l + n_g s_g \omega) \phi V\]</div>
<p>Specified with evaluator type: <cite>“liquid+gas water content</cite>”</p>
<div class="admonition-field-evaluator-type-liquid-gas-water-content-spec admonition" id="field-evaluator-type-liquid-gas-water-content-spec">
<p class="admonition-title">field-evaluator-type-liquid-gas-water-content-spec</p>
<p>DEPENDENCIES:</p>
<ul class="simple">
<li><p><cite>“porosity</cite>”</p></li>
<li><p><cite>“molar density liquid</cite>”</p></li>
<li><p><cite>“molar density gas</cite>”</p></li>
<li><p><cite>“saturation liquid</cite>”</p></li>
<li><p><cite>“saturation gas</cite>”</p></li>
<li><p><cite>“mol frac gas</cite>”</p></li>
<li><p><cite>“cell volume</cite>”</p></li>
</ul>
</div>
</section>
<section id="liquid-ice-water-content">
<h5><a class="toc-backref" href="#id126" role="doc-backlink">Liquid+Ice water content</a><a class="headerlink" href="#liquid-ice-water-content" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Water content for liquid + water vapor.</p>
</div></blockquote>
<div class="math notranslate nohighlight">
\[\Theta = (n_l s_l + n_i s_i) \phi V\]</div>
<p>Specified with evaluator type: <cite>“liquid+ice water content</cite>”</p>
<div class="admonition-field-evaluator-type-liquid-ice-water-content-spec admonition" id="field-evaluator-type-liquid-ice-water-content-spec">
<p class="admonition-title">field-evaluator-type-liquid-ice-water-content-spec</p>
<p>DEPENDENCIES:</p>
<ul class="simple">
<li><p><cite>“porosity</cite>”</p></li>
<li><p><cite>“molar density liquid</cite>”</p></li>
<li><p><cite>“molar density ice</cite>”</p></li>
<li><p><cite>“saturation liquid</cite>”</p></li>
<li><p><cite>“saturation ice</cite>”</p></li>
<li><p><cite>“cell volume</cite>”</p></li>
</ul>
</div>
</section>
<section id="liquid-ice-gas-water-content">
<h5><a class="toc-backref" href="#id127" role="doc-backlink">Liquid+Ice+Gas water content</a><a class="headerlink" href="#liquid-ice-gas-water-content" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Three phase water content: vapor, liquid, and ice.</p>
</div></blockquote>
<div class="math notranslate nohighlight">
\[\Theta = (n_l s_l + n_i s_i + n_g s_g \omega_g ) \phi V\]</div>
<p>Specified with evaluator type: <cite>“three phase water content</cite>”</p>
<div class="admonition-field-evaluator-type-three-phase-water-content-spec admonition" id="field-evaluator-type-three-phase-water-content-spec">
<p class="admonition-title">field-evaluator-type-three-phase-water-content-spec</p>
<p>DEPENDENCIES:</p>
<ul class="simple">
<li><p><cite>“porosity</cite>”</p></li>
<li><p><cite>“molar density liquid</cite>”</p></li>
<li><p><cite>“saturation liquid</cite>”</p></li>
<li><p><cite>“molar density ice</cite>”</p></li>
<li><p><cite>“saturation ice</cite>”</p></li>
<li><p><cite>“molar density gas</cite>”</p></li>
<li><p><cite>“saturation gas</cite>”</p></li>
<li><p><cite>“molar fraction gas</cite>”</p></li>
<li><p><cite>“cell volume</cite>”</p></li>
</ul>
</div>
</section>
<section id="surface-water-content">
<h5><a class="toc-backref" href="#id128" role="doc-backlink">Surface water content</a><a class="headerlink" href="#surface-water-content" title="Permalink to this heading"></a></h5>
</section>
<section id="snow-or-canopy-water-content">
<h5><a class="toc-backref" href="#id129" role="doc-backlink">Snow or canopy water content</a><a class="headerlink" href="#snow-or-canopy-water-content" title="Permalink to this heading"></a></h5>
<p>Most other water contents can be formed as <a class="reference internal" href="#multiplicative">Multiplicative</a>
evaluators.  See below for a few examples:</p>
<p>Multiplicative evalutator for <cite>snow-water_content</cite>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;snow-water_content&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;field evaluator type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;multiplicative evaluator&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;evaluator dependencies&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{snow-cell_volume, snow-water_equivalent, surface-molar_density_liquid}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;units&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;mol&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Multiplicative evaluator for <cite>canopy-water_content</cite>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;canopy-water_content&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;field evaluator type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;multiplicative evaluator&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;evaluator dependencies&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{canopy-cell_volume, canopy-water_equivalent, surface-molar_density_liquid}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;units&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;mol&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="richards-energy">
<h5><a class="toc-backref" href="#id130" role="doc-backlink">Richards energy</a><a class="headerlink" href="#richards-energy" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Energy content evaluator for a standard Richards equation’s water content.</p>
</div></blockquote>
<p>Energy associated with a soil and pore-water system, in [KJ]</p>
<div class="math notranslate nohighlight">
\[E = V * ( \phi u_l s_l n_l + (1-\phi_0) u_r \rho_r )\]</div>
<p>Specified with evaluator type: <cite>“richards energy</cite>”</p>
<p>Note this equation assumes that porosity is compressible, but is based on the
uncompressed rock grain density (not bulk density).  This means that porosity
is the base, uncompressible value when used with the energy in the grain, but
the larger, compressible value when used with the energy in the water.</p>
<p>Note that this ignores energy in the gas phase.</p>
<div class="admonition-field-evaluator-type-richards-energy-spec admonition" id="field-evaluator-type-richards-energy-spec">
<p class="admonition-title">field-evaluator-type-richards-energy-spec</p>
<p>DEPENDENCIES:</p>
<ul class="simple">
<li><p><cite>“porosity</cite>” The porosity, including any compressibility. [-]</p></li>
<li><p><cite>“base porosity</cite>” The uncompressed porosity (note this may be the same as
porosity for incompressible cases) [-]</p></li>
<li><p><cite>“molar density liquid</cite>” [mol m^-3]</p></li>
<li><p><cite>“saturation liquid</cite>” [-]</p></li>
<li><p><cite>“internal energy liquid</cite>” [KJ mol^-1]</p></li>
<li><p><cite>“density rock</cite>” Units may be either [kg m^-3] or [mol m^-3]</p></li>
<li><p><cite>“internal energy rock</cite>” Units may be either [KJ kg^-1] or [KJ mol^-1],
but must be consistent with the above density.</p></li>
<li><p><cite>“cell volume</cite>” [m^3]</p></li>
</ul>
</div>
</section>
<section id="liquid-gas-energy">
<h5><a class="toc-backref" href="#id131" role="doc-backlink">Liquid+Gas energy</a><a class="headerlink" href="#liquid-gas-energy" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Energy content evaluator for a standard Richards equation, including energy in the gas phase.</p>
</div></blockquote>
<p>Calculates energy, in [KJ], via the equation:</p>
<div class="math notranslate nohighlight">
\[E = V * ( \phi (u_l s_l n_l + u_g s_g n_g)  + (1-\phi_0) u_r \rho_r )\]</div>
<p>Specified with evaluator type: <cite>“liquid+gas energy</cite>”</p>
<p>Note this equation assumes that porosity is compressible, but is based on the
uncompressed rock grain density (not bulk density).  This means that porosity
is the base, uncompressible value when used with the energy in the grain, but
the larger, compressible value when used with the energy in the water.</p>
<div class="admonition-field-evaluator-type-liquid-gas-energy-spec admonition" id="field-evaluator-type-liquid-gas-energy-spec">
<p class="admonition-title">field-evaluator-type-liquid-gas-energy-spec</p>
<p>DEPENDENCIES:</p>
<ul class="simple">
<li><p><cite>“porosity</cite>” The porosity, including any compressibility. [-]</p></li>
<li><p><cite>“base porosity</cite>” The uncompressed porosity (note this may be the same as
porosity for incompressible cases) [-]</p></li>
<li><p><cite>“molar density liquid</cite>” [mol m^-3]</p></li>
<li><p><cite>“saturation liquid</cite>” [-]</p></li>
<li><p><cite>“internal energy liquid</cite>” [KJ mol^-1]</p></li>
<li><p><cite>“molar density gas</cite>” [mol m^-3]</p></li>
<li><p><cite>“saturation gas</cite>” [-]</p></li>
<li><p><cite>“internal energy gas</cite>” [KJ mol^-1]</p></li>
<li><p><cite>“density rock</cite>” Units may be either [kg m^-3] or [mol m^-3]</p></li>
<li><p><cite>“internal energy rock</cite>” Units may be either [KJ kg^-1] or [KJ mol^-1],
but must be consistent with the above density.</p></li>
<li><p><cite>“cell volume</cite>” [m^3]</p></li>
</ul>
</div>
</section>
<section id="liquid-ice-energy">
<h5><a class="toc-backref" href="#id132" role="doc-backlink">Liquid+Ice energy</a><a class="headerlink" href="#liquid-ice-energy" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Energy content evaluator for a two-phase system, including energy in an ice phase.</p>
</div></blockquote>
<p>Calculates energy, in [KJ], via the equation:</p>
<div class="math notranslate nohighlight">
\[E = V * ( \phi (u_l s_l n_l + u_i s_i n_i)  + (1-\phi_0) u_r \rho_r )\]</div>
<p>Specified with evaluator type: <cite>“liquid+ice energy</cite>”</p>
<p>Note this equation assumes that porosity is compressible, but is based on the
uncompressed rock grain density (not bulk density).  This means that porosity
is the base, uncompressible value when used with the energy in the grain, but
the larger, compressible value when used with the energy in the water.</p>
<p>Note that this ignores energy in the gas phase.</p>
<div class="admonition-field-evaluator-type-liquid-ice-energy-spec admonition" id="field-evaluator-type-liquid-ice-energy-spec">
<p class="admonition-title">field-evaluator-type-liquid-ice-energy-spec</p>
<p>DEPENDENCIES:</p>
<ul class="simple">
<li><p><cite>“porosity</cite>” The porosity, including any compressibility. [-]</p></li>
<li><p><cite>“base porosity</cite>” The uncompressed porosity (note this may be the same as
porosity for incompressible cases) [-]</p></li>
<li><p><cite>“molar density liquid</cite>” [mol m^-3]</p></li>
<li><p><cite>“saturation liquid</cite>” [-]</p></li>
<li><p><cite>“internal energy liquid</cite>” [KJ mol^-1]</p></li>
<li><p><cite>“molar density ice</cite>” [mol m^-3]</p></li>
<li><p><cite>“saturation ice</cite>” [-]</p></li>
<li><p><cite>“internal energy ice</cite>” [KJ mol^-1]</p></li>
<li><p><cite>“density rock</cite>” Units may be either [kg m^-3] or [mol m^-3]</p></li>
<li><p><cite>“internal energy rock</cite>” Units may be either [KJ kg^-1] or [KJ mol^-1],
but must be consistent with the above density.</p></li>
<li><p><cite>“cell volume</cite>” [m^3]</p></li>
</ul>
</div>
</section>
<section id="liquid-ice-gas-energy">
<h5><a class="toc-backref" href="#id133" role="doc-backlink">Liquid+Ice+Gas energy</a><a class="headerlink" href="#liquid-ice-gas-energy" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Energy content evaluator for a three-phase, gas, liquid, ice system including the surrounding soil.</p>
</div></blockquote>
<p>Calculates energy, in [KJ], via the equation:</p>
<div class="math notranslate nohighlight">
\[E = V * ( \phi (u_l s_l n_l + u_i s_i n_i + u_g s_g n_g)  + (1-\phi_0) u_r \rho_r )\]</div>
<p>Specified with evaluator type: <cite>“three phase energy</cite>”</p>
<p>Note this equation assumes that porosity is compressible, but is based on the
uncompressed rock grain density (not bulk density).  This means that porosity
is the base, uncompressible value when used with the energy in the grain, but
the larger, compressible value when used with the energy in the water.</p>
<div class="admonition-field-evaluator-type-three-phase-energy-spec admonition" id="field-evaluator-type-three-phase-energy-spec">
<p class="admonition-title">field-evaluator-type-three-phase-energy-spec</p>
<p>DEPENDENCIES:</p>
<ul class="simple">
<li><p><cite>“porosity</cite>” The porosity, including any compressibility. [-]</p></li>
<li><p><cite>“base porosity</cite>” The uncompressed porosity (note this may be the same as
porosity for incompressible cases) [-]</p></li>
<li><p><cite>“molar density liquid</cite>” [mol m^-3]</p></li>
<li><p><cite>“saturation liquid</cite>” [-]</p></li>
<li><p><cite>“internal energy liquid</cite>” [KJ mol^-1]</p></li>
<li><p><cite>“molar density ice</cite>” [mol m^-3]</p></li>
<li><p><cite>“saturation ice</cite>” [-]</p></li>
<li><p><cite>“internal energy ice</cite>” [KJ mol^-1]</p></li>
<li><p><cite>“molar density gas</cite>” [mol m^-3]</p></li>
<li><p><cite>“saturation gas</cite>” [-]</p></li>
<li><p><cite>“internal energy gas</cite>” [KJ mol^-1]</p></li>
<li><p><cite>“density rock</cite>” Units may be either [kg m^-3] or [mol m^-3]</p></li>
<li><p><cite>“internal energy rock</cite>” Units may be either [KJ kg^-1] or [KJ mol^-1],
but must be consistent with the above density.</p></li>
<li><p><cite>“cell volume</cite>” [m^3]</p></li>
</ul>
</div>
</section>
<section id="surface-water-ice-energy">
<h5><a class="toc-backref" href="#id134" role="doc-backlink">Surface water+ice energy</a><a class="headerlink" href="#surface-water-ice-energy" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Energy content for a surface water, partially frozen system.</p>
</div></blockquote>
<p>The energy associated with ponded water, in [KJ], given by:</p>
<div class="math notranslate nohighlight">
\[E = V * ( \eta h u_l n_l + (1 - \eta) h u_i n_i )\]</div>
<p>Specified with evaluator type: <cite>“surface ice energy</cite>”</p>
<div class="admonition-field-evaluator-type-surface-ice-energy-spec admonition" id="field-evaluator-type-surface-ice-energy-spec">
<p class="admonition-title">field-evaluator-type-surface-ice-energy-spec</p>
<p>DEPENDENCIES:</p>
<ul class="simple">
<li><p><cite>“ponded depth</cite>”  Height of water above the land surface [m]</p></li>
<li><p><cite>“unfrozen fraction</cite>”  The fraction of unfrozen water ranges from 0 to 1. [-]</p></li>
<li><p><cite>“molar density liquid</cite>” [mol m^-3]</p></li>
<li><p><cite>“internal energy liquid</cite>” [KJ mol^-1]</p></li>
<li><p><cite>“molar density ice</cite>” [mol m^-3]</p></li>
<li><p><cite>“internal energy ice</cite>” [KJ mol^-1]</p></li>
<li><p><cite>“cell volume</cite>” [m^2]</p></li>
</ul>
</div>
</section>
</section>
<section id="subsurface-flow-evaluators">
<h4><a class="toc-backref" href="#id135" role="doc-backlink">Subsurface flow evaluators</a><a class="headerlink" href="#subsurface-flow-evaluators" title="Permalink to this heading"></a></h4>
<p>Assorted evaluators used for subsurface flow processes,
including water retention curves, compressible pore space, relative
permeability, and their frozen equivalents.</p>
<p>Many of these evaluators show up in nearly all ATS simulations, as
subsurface flow of water is the core process underlying all of ATS
physics.  For real examples, see <a class="reference external" href="https://github.com/amanzi/ats-demos">ats-demos</a></p>
<section id="capillary-pressure">
<h5><a class="toc-backref" href="#id136" role="doc-backlink">Capillary pressure</a><a class="headerlink" href="#capillary-pressure" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Capillary pressure for gas on a liquid.</p>
</div></blockquote>
<div class="admonition-pc-liquid-evaluator-spec admonition" id="pc-liquid-evaluator-spec">
<p class="admonition-title">pc-liquid-evaluator-spec</p>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“pressure</cite>” <strong>DOMAIN-pressure</strong></p></li>
</ul>
</div>
</section>
<section id="capillary-pressure-of-liquid-on-ice">
<h5><a class="toc-backref" href="#id137" role="doc-backlink">Capillary pressure of liquid on ice</a><a class="headerlink" href="#capillary-pressure-of-liquid-on-ice" title="Permalink to this heading"></a></h5>
</section>
<section id="water-retention-model-and-relative-permeability">
<h5><a class="toc-backref" href="#id138" role="doc-backlink">Water Retention Model and Relative Permeability</a><a class="headerlink" href="#water-retention-model-and-relative-permeability" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Evaluates saturation through water retention models.</p>
</div></blockquote>
<p>Water Retention Models (WRMs) determine the saturation as a function of
pressure and the relative permeability as a function of saturation.  Most
commonly used in practice is the van Genuchten model, but others are available default default;</p>
<p><cite>“evaluator type</cite>” = <cite>“wrm</cite>”</p>
<div class="admonition-wrm-evaluator-spec admonition" id="wrm-evaluator-spec">
<p class="admonition-title">wrm-evaluator-spec</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>“WRM parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[WRM-typedinline-spec-list]</span></code></p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“saturation</cite>” <strong>determined from evaluator name</strong> The name
of the liquid saturation – typically this is determined from
the evaluator name and need not be set.</p></li>
<li><p><cite>“other saturation</cite>”  <strong>determined from evaluator name</strong>
The name of the other saturation, usually gas – typically this is determined
from the evaluator name and need not be set.</p></li>
<li><p><cite>“capillary pressure</cite>”` <strong>DOMAIN-capillary_pressure_gas_liq</strong>
The name of the capillary pressure.</p></li>
</ul>
</div></blockquote>
<p>A collection of WRMs along with a Mesh Partition.</p>
</div>
<p>A WRM partition is a list of (region, WRM) pairs, where the regions partition
the mesh.</p>
<div class="admonition-wrm-partition-typedinline-spec admonition" id="wrm-partition-typedinline-spec">
<p class="admonition-title">wrm-partition-typedinline-spec</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>“region</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Region on which the WRM is valid.</p></li>
<li><p><cite>“WRM type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Name of the WRM type.</p></li>
<li><p><cite>“_WRM_type_ parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[_WRM_type_-spec]</span></code> See below for the required
parameter spec for each type.</p></li>
</ul>
</div></blockquote>
<p>Evaluates relative permeability using water retention models.</p>
</div>
<p>Uses a list of regions and water retention models on those regions to evaluate
relative permeability, typically as a function of liquid saturation.</p>
<p>Most of the parameters are provided to the WRM model, and not the evaluator.
Typically these share lists to ensure the same water retention curves, and this
one is updated with the parameters of the WRM evaluator.  This is handled by
flow PKs.</p>
<p>Some additional parameters are available.</p>
<p><cite>“evaluator type</cite>” = <cite>“WRM rel perm</cite>”</p>
<div class="admonition-rel-perm-evaluator-spec admonition" id="rel-perm-evaluator-spec">
<p class="admonition-title">rel-perm-evaluator-spec</p>
<ul>
<li><p><cite>“use density on viscosity in rel perm</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong></p></li>
<li><p><cite>“boundary rel perm strategy</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>boundary pressure</strong> Controls
how the rel perm is calculated on boundary faces.  Note, this may be
overwritten by upwinding later!  One of:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>“boundary pressure</cite>” Evaluates kr of pressure on the boundary face, upwinds normally.</p></li>
<li><p><cite>“interior pressure</cite>” Evaluates kr of the pressure on the interior cell (bad idea).</p></li>
<li><p><cite>“harmonic mean</cite>” Takes the harmonic mean of kr on the boundary face and kr on the interior cell.</p></li>
<li><p><cite>“arithmetic mean</cite>” Takes the arithmetic mean of kr on the boundary face and kr on the interior cell.</p></li>
<li><p><cite>“one</cite>” Sets the boundary kr to 1.</p></li>
<li><p><cite>“surface rel perm</cite>” Looks for a field on the surface mesh and uses that.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><cite>“minimum rel perm cutoff</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.</strong> Provides a lower bound on rel perm.</p></li>
<li><p><cite>“permeability rescaling</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Typically rho * kr / mu is very big
and K_sat is very small.  To avoid roundoff propagation issues, rescaling
this quantity by offsetting and equal values is encourage.  Typically 10^7 or so is good.</p></li>
<li><p><cite>“WRM parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[wrm-typedinline-spec-list]</span></code>  List (by region) of WRM specs.</p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“rel perm</cite>”</p></li>
<li><p><cite>“saturation_liquid</cite>”</p></li>
<li><p><cite>“density</cite>” (if <cite>“use density on viscosity in rel perm</cite>” == true)</p></li>
<li><p><cite>“viscosity</cite>” (if <cite>“use density on viscosity in rel perm</cite>” == true)</p></li>
<li><p><cite>“surface relative permeability</cite>” (if <cite>“boundary rel perm strategy</cite>” == <cite>“surface rel perm</cite>”)</p></li>
</ul>
</div>
<section id="van-genuchten-model">
<h6><a class="toc-backref" href="#id139" role="doc-backlink">Van Genuchten Model</a><a class="headerlink" href="#van-genuchten-model" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>WRMVanGenuchten : water retention model using van Genuchten’s parameterization</p>
</div></blockquote>
<p>van Genuchten’s water retention curve.</p>
<div class="admonition-wrm-van-genuchten-spec admonition" id="wrm-van-genuchten-spec">
<p class="admonition-title">WRM-van-Genuchten-spec</p>
<ul class="simple">
<li><p><cite>“region</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Region to which this applies</p></li>
<li><p><cite>“van Genuchten alpha [Pa^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> van Genuchten’s alpha</p></li>
</ul>
<p>ONE OF:</p>
<ul class="simple">
<li><p><cite>“van Genuchten n [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> van Genuchten’s n</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“van Genuchten m [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> van Genuchten’s m, m = 1 - 1/n</p></li>
</ul>
<p>END</p>
<ul class="simple">
<li><p><cite>“residual saturation [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.0</strong></p></li>
<li><p><cite>“smoothing interval width [saturation]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.0</strong></p></li>
<li><p><cite>“Mualem exponent l [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.5</strong></p></li>
<li><p><cite>“Krel function name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>Mualem</strong>  <cite>“Mualem</cite>” or <cite>“Burdine</cite>”</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;moss&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;moss&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;WRM type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;van Genuchten&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;van Genuchten alpha [Pa^-1]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.002&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;van Genuchten m [-]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.2&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;residual saturation [-]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;smoothing interval width [saturation]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;.05&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="linear-model">
<h6><a class="toc-backref" href="#id140" role="doc-backlink">Linear  Model</a><a class="headerlink" href="#linear-model" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>A linear sat-pc curve.</p>
<blockquote>
<div><p>A linear sat-pc curve, plus a constant rel perm, makes the system linear, so
nonlinear solver should always converge in one step.</p>
<p>No error-checking, so the user is responsible for ensuring that the pressure
is always less than atmospheric and within the acceptable range of the slope.</p>
<p>Note this is mostly for testing.</p>
</div></blockquote>
</div></blockquote>
</section>
</section>
<section id="water-retention-model-for-freeze-thaw">
<h5><a class="toc-backref" href="#id141" role="doc-backlink">Water Retention Model for Freeze-Thaw</a><a class="headerlink" href="#water-retention-model-for-freeze-thaw" title="Permalink to this heading"></a></h5>
<section id="original-implicit-model">
<h6><a class="toc-backref" href="#id142" role="doc-backlink">Original Implicit model</a><a class="headerlink" href="#original-implicit-model" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>Painter’s original, implicitly defined permafrost model.</p>
</div></blockquote>
<div class="admonition-wrm-implicit-permafrost-spec admonition" id="wrm-implicit-permafrost-spec">
<p class="admonition-title">wrm-implicit-permafrost-spec</p>
<ul class="simple">
<li><p><cite>“converged tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-12</strong> Convergence tolerance of the implicit solve.</p></li>
<li><p><cite>“max iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>100</strong> Maximum allowable iterations of the implicit solve.</p></li>
<li><p><cite>“solver algorithm [bisection/toms]</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>bisection</strong> Use bisection or the TOMS algorithm from boost.</p></li>
</ul>
</div>
</section>
<section id="freezing-point-depression-model">
<h6><a class="toc-backref" href="#id143" role="doc-backlink">Freezing point depression model</a><a class="headerlink" href="#freezing-point-depression-model" title="Permalink to this heading"></a></h6>
</section>
<section id="freezing-point-depression-smoothed-model">
<h6><a class="toc-backref" href="#id144" role="doc-backlink">Freezing point depression, smoothed model</a><a class="headerlink" href="#freezing-point-depression-smoothed-model" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>Painter’s permafrost model with freezing point depression, smoothed.</p>
</div></blockquote>
<div class="admonition-wrm-fpd-smoothed-permafrost-spec admonition" id="wrm-fpd-smoothed-permafrost-spec">
<p class="admonition-title">wrm-fpd-smoothed-permafrost-spec</p>
<ul class="simple">
<li><p><cite>“reference temperature [K]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>273.15</strong> The phase transition point</p></li>
<li><p><cite>“interfacial tension ice-water [mN m^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>33.1</strong></p></li>
<li><p><cite>“interfacial tension air-water [mN m^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>72.7</strong></p></li>
<li><p><cite>“smoothing width [K]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.</strong> Smoothing out the freeze curve allows this to be slightly easier to solve.</p></li>
<li><p><cite>“latent heat [J kg^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>3.34e5</strong> Latent heat of fusion</p></li>
<li><p><cite>“water density [kg m^-3]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>998.87</strong> Density of water.  Note this probably should use the calculated value.</p></li>
</ul>
</div>
</section>
<section id="interfrost-model">
<h6><a class="toc-backref" href="#id145" role="doc-backlink">Interfrost model</a><a class="headerlink" href="#interfrost-model" title="Permalink to this heading"></a></h6>
</section>
<section id="sutra-ice-model">
<h6><a class="toc-backref" href="#id146" role="doc-backlink">Sutra-ICE model</a><a class="headerlink" href="#sutra-ice-model" title="Permalink to this heading"></a></h6>
<p>This model is based on the emperical freezing curve used by Sutra-Ice,
documented in papers by Voss &amp; Walvoord.</p>
<div class="admonition-wrm-sutra-permafrost-model-spec admonition" id="wrm-sutra-permafrost-model-spec">
<p class="admonition-title">wrm-sutra-permafrost-model-spec</p>
<ul class="simple">
<li><p><cite>“temperature transition [K]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> thickness of the transition from frozen to thawed</p></li>
<li><p><cite>“residual saturation [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Standard residual saturation</p></li>
<li><p><cite>“freezing point [K]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>273.15</strong></p></li>
</ul>
</div>
</section>
</section>
<section id="compressible-porosity">
<h5><a class="toc-backref" href="#id147" role="doc-backlink">Compressible porosity</a><a class="headerlink" href="#compressible-porosity" title="Permalink to this heading"></a></h5>
<p>Compressible grains are both physically realistic (based on bulk modulus) and a
simple way to provide a non-elliptic, diagonal term for helping solvers to
converge.</p>
<p><cite>“evaluator type</cite>” = <cite>“compressible porosity</cite>”</p>
<div class="admonition-compressible-porosity-evaluator-spec admonition" id="compressible-porosity-evaluator-spec">
<p class="admonition-title">compressible-porosity-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“compressible porosity model parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[compressible-porosity-standard-model-spec-list]</span></code></p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“pressure</cite>” <strong>DOMAIN-pressure</strong></p></li>
<li><p><cite>“base porosity</cite>” <strong>DOMAIN-base_porosity</strong></p></li>
</ul>
</div>
<section id="standard-model">
<h6><a class="toc-backref" href="#id148" role="doc-backlink">Standard model</a><a class="headerlink" href="#standard-model" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>A simple model for allowing porosity to vary with pressure.</p>
</div></blockquote>
<p>Based on a linear increase, i.e.</p>
<div class="math notranslate nohighlight">
\[\phi = \phi_{base} + H(p - p_{atm}) * \alpha\]</div>
<p>where <span class="math notranslate nohighlight">\(H\)</span> is the heaviside function and <span class="math notranslate nohighlight">\(\alpha\)</span> is the provided
compressibility.  If the inflection point is set to zero, the above function is
exact.  However, then the porosity function is not smooth (has discontinuous
derivatives), so the inflection point smooths this with a quadratic that
matches the value and derivative at the inflection point and is 0 with 0 slope
at atmospheric pressure.</p>
<div class="admonition-compressible-porosity-standard-model-spec admonition" id="compressible-porosity-standard-model-spec">
<p class="admonition-title">compressible-porosity-standard-model-spec</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>“region</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Region on which this is applied.</p></li>
<li><p><cite>“pore compressibility [Pa^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code>  <span class="math notranslate nohighlight">\(\alpha\)</span> as described above</p></li>
<li><p><cite>“pore compressibility inflection point [Pa]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1000</strong></p></li>
</ul>
</div></blockquote>
<p>The inflection point above which the function is linear.</p>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;soil&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;region&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;soil&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pore compressibility [Pa^-1]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.e-9&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pore compressibility inflection point [Pa]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1000.&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="exponential-model">
<h6><a class="toc-backref" href="#id149" role="doc-backlink">Exponential model</a><a class="headerlink" href="#exponential-model" title="Permalink to this heading"></a></h6>
<p>The Leinjnse model is an exponential model of porosity as a function of
pressure, based on (insert citation!):</p>
<p>where <span class="math notranslate nohighlight">\(\alpha\)</span> is the provided
compressibility, and <span class="math notranslate nohighlight">\(\delta\)</span> is the cutoff (inflection point).</p>
<p>If the inflection point is set to zero, the above function is exact.  However,
then the porosity function is not smooth (has discontinuous derivatives).</p>
<div class="admonition-compressible-porosity-leijnse-model-spec admonition" id="compressible-porosity-leijnse-model-spec">
<p class="admonition-title">compressible-porosity-leijnse-model-spec</p>
<ul class="simple">
<li><p><cite>“pore compressibility [Pa^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <span class="math notranslate nohighlight">\(\alpha\)</span> as described above</p></li>
<li><p><cite>“pore compressibility inflection point [Pa]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1000</strong> The
inflection point above which the function is linear.</p></li>
</ul>
</div>
<p>NOTE: additionally the user should provide a parameter in the <a class="reference internal" href="#ewc-globalization-delegate">EWC
Globalization Delegate</a> to turn Leijnse model ON in the EWC calculations.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;porosity leijnse model&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;bool&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="viscosity-of-water">
<h5><a class="toc-backref" href="#id150" role="doc-backlink">Viscosity of water</a><a class="headerlink" href="#viscosity-of-water" title="Permalink to this heading"></a></h5>
<p>Two main viscosity models are commonly used – a constant and one
which is temperature-dependent.  The viscosity of water is strongly
temperature dependent, so it is highly recommended to use that one if
the problem is nonisothermal.</p>
<section id="id6">
<h6><a class="toc-backref" href="#id151" role="doc-backlink">Constant</a><a class="headerlink" href="#id6" title="Permalink to this heading"></a></h6>
<p>Like any quantity, a viscosity can simply be a constant value, at which
point it is not a secondary variable but an independent variable.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;viscosity_liquid&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;field evaluator type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;independent variable constant&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;8.9e-4&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;units&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Pa s&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="nonisothermal">
<h6><a class="toc-backref" href="#id152" role="doc-backlink">Nonisothermal</a><a class="headerlink" href="#nonisothermal" title="Permalink to this heading"></a></h6>
<p>A non-isothermal viscosity model intended for use within a range of
temperatures from well below freezing to ~100C.</p>
<div class="admonition-viscosity-evaluator-spec admonition" id="viscosity-evaluator-spec">
<p class="admonition-title">viscosity-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“viscosity model parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[viscosity-typedinline-spec-list]</span></code></p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“temperature</cite>”</p></li>
</ul>
</div>
<p>A constitutive relation for the viscosity of water as a function of temperature
in K, given as an empirical series expansion fit to data.</p>
<p>Used by setting</p>
<p><cite>“viscosity relation type</cite>” = <cite>“liquid water</cite>”</p>
<div class="admonition-viscosity-water-spec admonition" id="viscosity-water-spec">
<p class="admonition-title">viscosity-water-spec</p>
<p>NONE</p>
</div>
</section>
</section>
</section>
<section id="surface-flow-evaluators">
<h4><a class="toc-backref" href="#id153" role="doc-backlink">Surface flow evaluators</a><a class="headerlink" href="#surface-flow-evaluators" title="Permalink to this heading"></a></h4>
<p>Assorted evaluators used for surface flow, including potential
surfaces, Manning’s conductivity, and their frozen equivalents.</p>
<p>Like the subsurface flow evaluators, many of these evaluators show up
in nearly all ATS simulations.  For real examples, see <a class="reference external" href="https://github.com/amanzi/ats-demos">ats-demos</a></p>
<section id="ponded-depth-or-water-height">
<h5><a class="toc-backref" href="#id154" role="doc-backlink">Ponded Depth or Water Height</a><a class="headerlink" href="#ponded-depth-or-water-height" title="Permalink to this heading"></a></h5>
<p>Computes ponded depth from surface water pressure.</p>
<div class="math notranslate nohighlight">
\[h = \frac{H(p - p_{atm})}{\rho g}\]</div>
<p>where <span class="math notranslate nohighlight">\(H\)</span> is the Heaviside function.</p>
<p><cite>“evaluator type</cite>” = <cite>“ponded depth</cite>”</p>
<div class="admonition-height-evaluator-spec admonition" id="height-evaluator-spec">
<p class="admonition-title">height-evaluator-spec</p>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“mass density</cite>”</p></li>
<li><p><cite>“pressure</cite>”</p></li>
</ul>
</div>
</section>
<section id="ponded-depth-frozen">
<h5><a class="toc-backref" href="#id155" role="doc-backlink">Ponded Depth, Frozen</a><a class="headerlink" href="#ponded-depth-frozen" title="Permalink to this heading"></a></h5>
</section>
<section id="effective-or-smoothed-height">
<h5><a class="toc-backref" href="#id156" role="doc-backlink">Effective, or Smoothed Height</a><a class="headerlink" href="#effective-or-smoothed-height" title="Permalink to this heading"></a></h5>
<p>Computes ponded depth from surface water pressure using a smoothed term to make
derivative smooth near 0.  This is pretty much never used anymore.</p>
<p><cite>“evaluator type</cite>” = <cite>“effective height</cite>”</p>
<div class="admonition-effective-height-evaluator-spec admonition" id="effective-height-evaluator-spec">
<p class="admonition-title">effective-height-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“smoothing width [m]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.01</strong> the width over which smoothing
is applied.</p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“height</cite>” The unsmoothed ponded depth</p></li>
</ul>
</div>
</section>
<section id="unfrozen-fraction">
<h5><a class="toc-backref" href="#id157" role="doc-backlink">Unfrozen fraction</a><a class="headerlink" href="#unfrozen-fraction" title="Permalink to this heading"></a></h5>
<p>An empirical equation for freezing ponded water – this is simply a smooth
sinusoidal curve from 0 to 1 over a given transition in temperature.</p>
<p><cite>“evaluator type</cite>” = <cite>“unfrozen fraction</cite>”</p>
<div class="admonition-unfrozen-fraction-evaluator-spec admonition" id="unfrozen-fraction-evaluator-spec">
<p class="admonition-title">unfrozen-fraction-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“unfrozen fraction model</cite>” <code class="docutils literal notranslate"><span class="pre">[unfrozen-fraction-model-spec]</span></code></p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“temperature</cite>”</p></li>
</ul>
</div>
<div class="admonition-unfrozen-fraction-model-spec admonition" id="unfrozen-fraction-model-spec">
<p class="admonition-title">unfrozen-fraction-model-spec</p>
<ul class="simple">
<li><p><cite>“transition width [K]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.2</strong> Degrees over which to
transition from no ice to all ice.</p></li>
<li><p><cite>“freezing point [K]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>273.15</strong> Center of the transition,
at this point unfrozen fraction is 0.5.</p></li>
<li><p><cite>“minimum unfrozen fraction [-]`</cite> <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0</strong> Sets a minimum value.</p></li>
</ul>
</div>
</section>
<section id="unfrozen-flowing-depth">
<h5><a class="toc-backref" href="#id158" role="doc-backlink">Unfrozen Flowing Depth</a><a class="headerlink" href="#unfrozen-flowing-depth" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Evaluates the unfrozen mobile depth.</p>
</div></blockquote>
<p>In freezing conditions, water is only mobile if it is unfrozen.  This evaluator
determines how much water is allowed to flow given that it is partially frozen.</p>
<p>Given a ponded depth, an unfrozen fraction, and an optional power-law exponent,
which we call the ice retardation exponent.</p>
<div class="admonition-unfrozen-effective-depth-evaluator-spec admonition" id="unfrozen-effective-depth-evaluator-spec">
<p class="admonition-title">unfrozen-effective-depth-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“ice retardation exponent [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> exponent alpha
controlling how quickly ice turns off flow.</p></li>
</ul>
<p>DEPENDENCIES:
- <cite>“depth</cite>” <strong>DOMAIN-depth</strong>
- <cite>“unfrozen fraction</cite>” <strong>DOMAIN-unfrozen_fraction</strong></p>
</div>
</section>
<section id="surfacepotential">
<h5><a class="toc-backref" href="#id159" role="doc-backlink">SurfacePotential</a><a class="headerlink" href="#surfacepotential" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Evaluates the potential surface upon which overland flow acts.</p>
</div></blockquote>
<div class="math notranslate nohighlight">
\[h + z\]</div>
<p><cite>“evaluator type</cite>” =</p>
<div class="admonition-pres-elev-evaluator-spec admonition" id="pres-elev-evaluator-spec">
<p class="admonition-title">pres-elev-evaluator-spec</p>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“height</cite>” <strong>DOMAIN-ponded_depth</strong> Names the height variable. [m]</p></li>
<li><p><cite>“elevation</cite>” <strong>DOMAIN-elevation</strong> Names the elevation variable. [m]</p></li>
</ul>
</div>
<p>NOTE: This is a legacy evaluator, and is not in the factory, so need not be in
the input spec.  However, we include it here because this could easily be
abstracted for new potential surfaces, kinematic wave, etc, at which point it
would need to be added to the factory and the input spec.</p>
<p>NOTE: This could easily be replaced by a generic <a class="reference internal" href="#additive">Additive</a> Evaluator.</p>
</section>
<section id="overland-conductivity-sheet-flow">
<h5><a class="toc-backref" href="#id160" role="doc-backlink">Overland Conductivity, sheet flow</a><a class="headerlink" href="#overland-conductivity-sheet-flow" title="Permalink to this heading"></a></h5>
<p>This implements the conductivity of overland flow, which is the nonlinear
coefficient in the diffusion wave equation.  The term is given by:</p>
<p>Optionally, this may include a density factor, typically a molar density, which
converts the flow law to water flux rather than volumetric flux.</p>
<p>Also, this evaluator can be used in snow redistribution, and in that case needs
some extra factors (timestep size) to ensure the correct flow law in that case.</p>
<p><cite>“evaluator type</cite>” = <cite>“overland conductivity</cite>”</p>
<div class="admonition-overland-conductivity-evaluator-spec admonition" id="overland-conductivity-evaluator-spec">
<p class="admonition-title">overland-conductivity-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“include density</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> Include the density prefactor,
converting the flux from volumetric flux to water flux.</p></li>
<li><dl class="simple">
<dt><cite>“dt factor [s]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong> The artificial timestep size used in calculating</dt><dd><p>snow redistribution, only used in that case.</p>
</dd>
</dl>
</li>
<li><p><cite>“swe density factor [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>10</strong> Ratio of water to snow density.</p></li>
</ul>
<p>DEPENDENCIES:</p>
<ul class="simple">
<li><p><cite>“mobile depth</cite>” <strong>DOMAIN-mobile_depth</strong> Depth of the mobile water; delta
in the above equation.</p></li>
<li><p><cite>“slope</cite>” <strong>DOMAIN-slope_magnitude</strong> Magnitude of the bed surface driving
flow; | nabla z | above.</p></li>
<li><p><cite>“coefficient</cite>” <strong>DOMAIN-manning_coefficient</strong> Surface roughness/shape
coefficient; n_{mann} above.</p></li>
<li><p><cite>“molar density liquid</cite>” <strong>DOMAIN-molar_density_liquid</strong> If <cite>“include
density</cite>” is true, the density.</p></li>
</ul>
</div>
</section>
<section id="overland-conductivity-litter-resistance">
<h5><a class="toc-backref" href="#id161" role="doc-backlink">Overland Conductivity, litter resistance</a><a class="headerlink" href="#overland-conductivity-litter-resistance" title="Permalink to this heading"></a></h5>
<p>(missing documentation!)</p>
</section>
</section>
<section id="thermodynamic-evaluators">
<h4><a class="toc-backref" href="#id162" role="doc-backlink">Thermodynamic evaluators</a><a class="headerlink" href="#thermodynamic-evaluators" title="Permalink to this heading"></a></h4>
<p>Internal energy, enthalpy, thermal conductivity, etc used for both
surface and subsurface transport of energy.</p>
<section id="internal-energy">
<h5><a class="toc-backref" href="#id163" role="doc-backlink">Internal energy</a><a class="headerlink" href="#internal-energy" title="Permalink to this heading"></a></h5>
<p>Computes (specific) internal energy of as a function of temperature.</p>
<p><cite>“evaluator type</cite>” = <cite>“iem</cite>”</p>
<div class="admonition-iem-evaluator-spec admonition" id="iem-evaluator-spec">
<p class="admonition-title">iem-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“IEM parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[IEM-model-typedinline-spec-list]</span></code></p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“temperature</cite>”</p></li>
</ul>
</div>
<section id="linear">
<h6><a class="toc-backref" href="#id164" role="doc-backlink">Linear</a><a class="headerlink" href="#linear" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>Internal energy based on a linear fit.</p>
</div></blockquote>
<p>Linear internal energy model – function of Cv and temperature</p>
<div class="math notranslate nohighlight">
\[u = L_f +  C_v * (T - T_{ref})\]</div>
<p><cite>“IEM type</cite>” = <cite>“linear</cite>”</p>
<div class="admonition-iem-model-linear-spec admonition" id="iem-model-linear-spec">
<p class="admonition-title">IEM-model-linear-spec</p>
<ul class="simple">
<li><p><cite>“reference temperature [K]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>273.15</strong> The phase transition point, T_ref above</p></li>
</ul>
<p>ONE OF</p>
<ul class="simple">
<li><p><cite>“latent heat [J kg^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Latent heat of fusion, L_f above</p></li>
<li><p><cite>“heat capacity [J kg^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> C_v above</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“latent heat [J mol^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Latent heat of fusion, L_f above.</p></li>
<li><p><cite>“heat capacity [J mol^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> C_v above</p></li>
</ul>
<p>END</p>
</div>
</section>
<section id="quadratic">
<h6><a class="toc-backref" href="#id165" role="doc-backlink">Quadratic</a><a class="headerlink" href="#quadratic" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>Internal energy based on a quadratic fit to data.</p>
</div></blockquote>
<p>Quadratic internal energy model – function of Cv and temperature</p>
<div class="math notranslate nohighlight">
\[u = L_f + C_v * (T - T_{ref}) + b(T - T_{ref})^2\]</div>
<p><cite>“IEM type</cite>” = <cite>“quadratic</cite>”</p>
<div class="admonition-iem-model-quadratic-spec admonition" id="iem-model-quadratic-spec">
<p class="admonition-title">IEM-model-quadratic-spec</p>
<ul class="simple">
<li><p><cite>“reference temperature [K]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>273.15</strong> The phase transition point, T_ref above.</p></li>
</ul>
<p>ONE OF</p>
<ul class="simple">
<li><p><cite>“latent heat [J kg^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Latent heat of fusion, L_f above</p></li>
<li><p><cite>“heat capacity [J kg^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> C_v above</p></li>
<li><p><cite>“quadratic b [J kg^-1 K^-2]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> b above</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“latent heat [J mol^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Latent heat of fusion, L_f above.</p></li>
<li><p><cite>“heat capacity [J mol^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> C_v above</p></li>
<li><p><cite>“quadratic b [J mol^-1 K^-2]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> b above</p></li>
</ul>
<p>END</p>
</div>
</section>
<section id="water-vapor">
<h6><a class="toc-backref" href="#id166" role="doc-backlink">Water Vapor</a><a class="headerlink" href="#water-vapor" title="Permalink to this heading"></a></h6>
<p>Computes (specific) internal energy of as a function of temperature and molar
fraction of water vapor in the gaseous phase.</p>
<p><cite>“evaluator type</cite>” = <cite>“iem water vapor</cite>”</p>
<div class="admonition-iem-water-vapor-evaluator-spec admonition" id="iem-water-vapor-evaluator-spec">
<p class="admonition-title">iem-water-vapor-evaluator-spec</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>“IEM parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[IEM-water-vapor-model-spec]</span></code></p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“temperature</cite>”</p></li>
<li><p><cite>“vapor molar fraction</cite>”</p></li>
</ul>
</div></blockquote>
<p>Internal energy model for air and water vapor.</p>
</div>
<div class="admonition-iem-water-vapor-model-spec admonition" id="iem-water-vapor-model-spec">
<p class="admonition-title">iem-water-vapor-model-spec</p>
<ul class="simple">
<li><p><cite>“latent heat [J mol^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Latent heat of vaporization</p></li>
<li><p><cite>“heat capacity [J mol^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> C_v</p></li>
</ul>
</div>
</section>
<section id="enthalpy">
<h6><a class="toc-backref" href="#id167" role="doc-backlink">Enthalpy</a><a class="headerlink" href="#enthalpy" title="Permalink to this heading"></a></h6>
<p>Computes enthalpy [MJ / mol] of as a function of internal energy, pressure, and density.</p>
<div class="math notranslate nohighlight">
\[e = u + 10^{-6} * \frac{p}{n_l}\]</div>
<p><cite>“evaluator type</cite>” = <cite>“enthalpy</cite>”</p>
<div class="admonition-enthalpy-evaluator-spec admonition" id="enthalpy-evaluator-spec">
<p class="admonition-title">enthalpy-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“include work term</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If false, e = u, ignoring the work term.</p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“internal energy</cite>”</p></li>
<li><p><cite>“pressure</cite>”</p></li>
<li><p><cite>“mass density</cite>”</p></li>
</ul>
</div>
</section>
</section>
<section id="thermal-conductivity-two-phases">
<h5><a class="toc-backref" href="#id168" role="doc-backlink">Thermal Conductivity, two phases</a><a class="headerlink" href="#thermal-conductivity-two-phases" title="Permalink to this heading"></a></h5>
<p>Thermal conductivity based on two-phases (air,liquid) composition of the
porous media.</p>
<p><cite>“evaluator type</cite>” = <cite>“two-phase thermal conductivity</cite>”</p>
<div class="admonition-thermal-conductivity-twophase-evaluator-spec admonition" id="thermal-conductivity-twophase-evaluator-spec">
<p class="admonition-title">thermal-conductivity-twophase-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“thermal conductivity parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[thermal-conductivity-twophase-typedinline-spec-list]</span></code></p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“porosity</cite>”</p></li>
<li><p><cite>“saturation liquid</cite>”</p></li>
</ul>
</div>
<section id="wet-dry-model">
<h6><a class="toc-backref" href="#id169" role="doc-backlink">Wet-Dry Model</a><a class="headerlink" href="#wet-dry-model" title="Permalink to this heading"></a></h6>
<p>Simple model of two-phase thermal conductivity, based upon:</p>
<ul class="simple">
<li><p>Interpolation between saturated and dry conductivities via a Kersten number.</p></li>
<li><p>Power-law Kersten number.</p></li>
</ul>
<p><cite>“thermal conductivity type</cite>” = <cite>“two-phase wet/dry</cite>”</p>
<div class="admonition-thermal-conductivity-twophase-wetdry-spec admonition" id="thermal-conductivity-twophase-wetdry-spec">
<p class="admonition-title">thermal-conductivity-twophase-wetdry-spec</p>
<ul class="simple">
<li><p><cite>“region</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Region name on which to apply these parameters.</p></li>
<li><p><cite>“thermal conductivity, wet [W m^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Thermal conductivity of saturated soil</p></li>
<li><p><cite>“thermal conductivity, dry [W m^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Thermal conductivity of dry soil</p></li>
<li><p><cite>“unsaturated alpha [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Interpolating exponent</p></li>
<li><p><cite>“epsilon</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e-10</strong> Epsilon to keep saturations bounded away from 0.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;thermal conductivity model&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;thermal conductivity type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;two-phase wet/dry&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;thermal conductivity, wet [W m^-1 K^-1]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;thermal conductivity, dry [W m^-1 K^-1]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;epsilon&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.e-10&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;unsaturated alpha&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Units: [W m^-1 K^-1]</p>
</section>
<section id="peters-lidard-model">
<h6><a class="toc-backref" href="#id170" role="doc-backlink">Peters-Lidard Model</a><a class="headerlink" href="#peters-lidard-model" title="Permalink to this heading"></a></h6>
<p>A two-phase thermal conductivity, based upon:</p>
<ul class="simple">
<li><p>Interpolation between saturated and dry conductivities via a Kersten number.</p></li>
<li><p>Power-law Kersten number.</p></li>
<li><p>Emperical fit for dry conductivity from Peters-Lidard et al ‘98.</p></li>
</ul>
<p>See Atchley et al GMD 2015 Supplementary Material for equations.</p>
<p><cite>“thermal conductivity type</cite>” = <cite>“two-phase Peters-Lidard</cite>”</p>
<div class="admonition-thermal-conductivity-twophase-peterslidard-spec admonition" id="thermal-conductivity-twophase-peterslidard-spec">
<p class="admonition-title">thermal-conductivity-twophase-peterslidard-spec</p>
<ul class="simple">
<li><p><cite>“region</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Region name on which to apply these parameters.</p></li>
<li><p><cite>“thermal conductivity of soil [W m^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Thermal conductivity of soil grains (not bulk soil)</p></li>
<li><p><cite>“thermal conductivity of liquid [W m^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Thermal conductivity of liquid (water)</p></li>
<li><p><cite>“thermal conductivity of gas [W m^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Thermal conductivity of gas (air)</p></li>
<li><p><cite>“unsaturated alpha [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Interpolating exponent</p></li>
<li><p><cite>“epsilon</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e-10</strong> Epsilon to keep saturations bounded away from 0.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Thermal Conductivity Model&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;thermal conductivity type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;two-phase Peters-Lidard&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;thermal conductivity of soil [W m^-1 K^-1]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;thermal conductivity of liquid [W m^-1 K^-1]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;thermal conductivity of gas [W m^-1 K^-1]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;unsaturated alpha&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;epsilon&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.e-10&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Units: [W m^-1 K^-1]</p>
</section>
</section>
<section id="thermal-conductivity-three-phases">
<h5><a class="toc-backref" href="#id171" role="doc-backlink">Thermal Conductivity, three phases</a><a class="headerlink" href="#thermal-conductivity-three-phases" title="Permalink to this heading"></a></h5>
<p>Thermal conductivity based on a three-phase (air,liquid,ice) composition of the
porous media.</p>
<p><cite>“evaluator type</cite>” = <cite>“three-phase thermal conductivity</cite>”</p>
<div class="admonition-thermal-conductivity-threephase-evaluator-spec admonition" id="thermal-conductivity-threephase-evaluator-spec">
<p class="admonition-title">thermal-conductivity-threephase-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“thermal conductivity parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[thermal-conductivity-threephase-typedinline-spec-list]</span></code></p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“porosity</cite>”</p></li>
<li><p><cite>“saturation liquid</cite>”</p></li>
<li><p><cite>“second saturation</cite>”</p></li>
<li><p><cite>“temperature</cite>”</p></li>
</ul>
</div>
<section id="id8">
<h6><a class="toc-backref" href="#id172" role="doc-backlink">Wet-Dry Model</a><a class="headerlink" href="#id8" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>Three-phase thermal conductivity based on paper by Peters-Lidard.</p>
</div></blockquote>
<p>A three-phase thermal conductivity, based upon:</p>
<ul class="simple">
<li><p>Interpolation between saturated and dry conductivities via a Kersten number.</p></li>
<li><p>Power-law Kersten number.</p></li>
<li><p>Empirical relationship for frozen soil based on Peters-Lidard</p></li>
</ul>
<p>See Atchley et al GMD 2015 Supplementary Material for equations.</p>
<p><cite>“thermal conductivity type</cite>” = <cite>“three-phase wet/dry</cite>”</p>
<div class="admonition-thermal-conductivity-threephase-wetdry-spec admonition" id="thermal-conductivity-threephase-wetdry-spec">
<p class="admonition-title">thermal-conductivity-threephase-wetdry-spec</p>
<ul class="simple">
<li><p><cite>“region</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Region name on which to apply these parameters.</p></li>
<li><p><cite>“thermal conductivity, saturated (unfrozen) [W m^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code>
Thermal conductivity of fully saturated, unfrozen bulk soil.</p></li>
<li><p><cite>“thermal conductivity, dry [W m^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Thermal conductivity
of fully dried bulk soil.</p></li>
<li><p><cite>“unsaturated alpha unfrozen [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Interpolating exponent</p></li>
<li><p><cite>“unsaturated alpha frozen [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Interpolating exponent</p></li>
<li><p><cite>“saturated beta frozen [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> Interpolating exponent</p></li>
<li><p><cite>“epsilon</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e-10</strong> Epsilon to keep saturations bounded away from 0.</p></li>
</ul>
</div>
</section>
<section id="id9">
<h6><a class="toc-backref" href="#id173" role="doc-backlink">Peters-Lidard Model</a><a class="headerlink" href="#id9" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>Three-phase thermal conductivity based on paper by Peters-Lidard.</p>
</div></blockquote>
<p>A three-phase thermal conductivity, based upon:</p>
<ul class="simple">
<li><p>A mixture model using interpolation across various components.</p></li>
<li><p>Power-law Kersten number.</p></li>
</ul>
<p>See Atchley et al GMD 2015 Supplementary Material for equations.</p>
<p><cite>“thermal conductivity type</cite>” = <cite>“three-phase Peters-Lidard</cite>”</p>
<div class="admonition-thermal-conductivity-threephase-peterslidard-spec admonition" id="thermal-conductivity-threephase-peterslidard-spec">
<p class="admonition-title">thermal-conductivity-threephase-peterslidard-spec</p>
<ul class="simple">
<li><p><cite>“region</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Region name on which to apply these parameters.</p></li>
<li><p><cite>“thermal conductivity of soil [W m^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Thermal conductivity of soil grains (not bulk soil)</p></li>
<li><p><cite>“thermal conductivity of liquid [W m^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Thermal conductivity of liquid (water)</p></li>
<li><p><cite>“thermal conductivity of gas [W m^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Thermal conductivity of gas (air)</p></li>
<li><p><cite>“thermal conductivity of ice [W m^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Thermal conductivity of ice</p></li>
<li><p><cite>“unsaturated alpha unfrozen [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Interpolating exponent</p></li>
<li><p><cite>“unsaturated alpha frozen [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Interpolating exponent</p></li>
<li><p><cite>“epsilon</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e-10</strong> Epsilon to keep saturations bounded away from 0.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;thermal_conductivity&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;thermal conductivity type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;three-phase Peters-Lidard&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;thermal conductivity of soil [W m^-1 K^-1]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;thermal conductivity of liquid [W m^-1 K^-1]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;thermal conductivity of gas [W m^-1 K^-1]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;thermal conductivity of ice [W m^-1 K^-1]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;unsaturated alpha unfrozen [-]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;unsaturated alpha frozen [-]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;epsilon&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.e-10&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="volume-averaged-model">
<h6><a class="toc-backref" href="#id174" role="doc-backlink">Volume-averaged Model</a><a class="headerlink" href="#volume-averaged-model" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>A volume-averaged thermal conductivity based on TCs of raw components.</p>
</div></blockquote>
<p>A simple model of three-phase thermal conductivity, based upon volume-averaging
of four consitutive components.</p>
<p><cite>“thermal conductivity type</cite>” = <cite>“three-phase volume averaged</cite>”</p>
<p>See Atchley et al GMD 2015 Supplementary Material for equations.</p>
<div class="admonition-thermal-conductivity-volume-averaged-spec admonition" id="thermal-conductivity-volume-averaged-spec">
<p class="admonition-title">thermal-conductivity-volume-averaged-spec</p>
<ul class="simple">
<li><p><cite>“region</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Region name on which to apply these parameters.</p></li>
<li><p><cite>“thermal conductivity of soil [W m^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Thermal
conductivity of soil <strong>grains</strong></p></li>
<li><p><cite>“thermal conductivity of liquid [W m^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Thermal
conductivity of liquid water.</p></li>
<li><p><cite>“thermal conductivity of gas [W m^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Thermal
conductivity of air.</p></li>
<li><p><cite>“thermal conductivity of ice [W m^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Thermal
conductivity of frozen water.</p></li>
</ul>
</div>
</section>
<section id="id10">
<h6><a class="toc-backref" href="#id175" role="doc-backlink">Sutra-ICE model</a><a class="headerlink" href="#id10" title="Permalink to this heading"></a></h6>
<p>Thermal conductivity model with constant values as a function of temperature,
requires the sutra model for permafrost WRM to also be used.  This only exists
to support the INTERFROST comparison.</p>
<p>Usage:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Thermal Conductivity Model&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Thermal Conductivity Type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;sutra hacked&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;thermal conductivity of frozen&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;thermal conductivity of mushy&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;thermal conductivity of unfrozen&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;residual saturation&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Units: [W m^-1 K^-1]</p>
</section>
</section>
<section id="thermal-conductivity-surface">
<h5><a class="toc-backref" href="#id176" role="doc-backlink">Thermal Conductivity, Surface</a><a class="headerlink" href="#thermal-conductivity-surface" title="Permalink to this heading"></a></h5>
<p>Thermal conductivity of surface water that can be either frozen or liquid phase.</p>
<p><cite>“evaluator type</cite>” = <cite>“surface thermal conductivity</cite>”</p>
<div class="admonition-thermal-conductivity-surface-evaluator-spec admonition" id="thermal-conductivity-surface-evaluator-spec">
<p class="admonition-title">thermal-conductivity-surface-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“thermal conductivity parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[thermal-conductivity-surface-spec]</span></code></p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“unfrozen fraction</cite>”</p></li>
<li><p><cite>“ponded depth</cite>”</p></li>
</ul>
</div>
<div class="admonition-thermal-conductivity-surface-spec admonition" id="thermal-conductivity-surface-spec">
<p class="admonition-title">thermal-conductivity-surface-spec</p>
<ul class="simple">
<li><p><cite>“thermal conductivity of water [W m^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.58</strong></p></li>
<li><p><cite>“thermal conductivity of ice [W m^-1 K^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>2.18</strong></p></li>
<li><p><cite>“minimum thermal conductivity</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-14</strong></p></li>
</ul>
</div>
</section>
<section id="advected-energy-source">
<h5><a class="toc-backref" href="#id177" role="doc-backlink">Advected Energy Source</a><a class="headerlink" href="#advected-energy-source" title="Permalink to this heading"></a></h5>
</section>
<section id="active-layer-averaged-temperature">
<h5><a class="toc-backref" href="#id178" role="doc-backlink">Active Layer Averaged Temperature</a><a class="headerlink" href="#active-layer-averaged-temperature" title="Permalink to this heading"></a></h5>
</section>
<section id="water-table">
<h5><a class="toc-backref" href="#id179" role="doc-backlink">Water Table</a><a class="headerlink" href="#water-table" title="Permalink to this heading"></a></h5>
<p>Computes the depth to a saturated water table.</p>
<p><cite>“evaluator type</cite>” = <cite>“water table depth</cite>”</p>
<div class="admonition-water-table-depth-spec admonition" id="water-table-depth-spec">
<p class="admonition-title">water-table-depth-spec</p>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“saturation of gas</cite>” <strong>SUBSURFACE_DOMAIN-saturation-gas</strong></p></li>
<li><p><cite>“subsurface cell volume</cite>” <strong>SUBSURFACE_DOMAIN-cell_volume</strong></p></li>
<li><p><cite>“surface cell volume</cite>” <strong>DOMAIN-cell_volume</strong></p></li>
</ul>
</div>
</section>
<section id="thaw-depth">
<h5><a class="toc-backref" href="#id180" role="doc-backlink">Thaw Depth</a><a class="headerlink" href="#thaw-depth" title="Permalink to this heading"></a></h5>
<p>Computes the depth to a saturated water table.</p>
<p><cite>“evaluator type</cite>” = <cite>“thaw depth</cite>”</p>
<div class="admonition-thaw-depth-spec admonition" id="thaw-depth-spec">
<p class="admonition-title">thaw-depth-spec</p>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“temperature</cite>” <strong>SUBSURFACE_DOMAIN-temperature</strong></p></li>
<li><p><cite>“subsurface cell volume</cite>” <strong>SUBSURFACE_DOMAIN-cell_volume</strong></p></li>
<li><p><cite>“surface cell volume</cite>” <strong>DOMAIN-cell_volume</strong></p></li>
</ul>
</div>
</section>
</section>
<section id="equations-of-state">
<h4><a class="toc-backref" href="#id181" role="doc-backlink">Equations of State</a><a class="headerlink" href="#equations-of-state" title="Permalink to this heading"></a></h4>
<p>The density of water can be specified in many ways, depending upon
phase and problem of interest.  Options are available from the
simplest (constant value) to functions of just temperature,
temperature and pressure, and temperature/pressure/concentration
(e.g. salinity).</p>
<p>Note that density includes both molar and mass-based values.  Most
density evaluators can provide either, or do provide both, the
difference being simply a factor of the molecular mass of water.</p>
<p>Finally, nearly all (except the constant value) equations of state use
a common set of models which accept all of temperature, pressure, and
concentration.  Many of these models ignore one or the other, so it
should be preferred (but is not necessary) to choose the right model
for a given evaluator.  Choosing a model that uses fewer of
these than the evaluator provides is valid, but it is inefficient.
Choosing a model that uses more than the evaluator provides will
result in an error.</p>
<section id="constant-value">
<h5><a class="toc-backref" href="#id182" role="doc-backlink">Constant Value</a><a class="headerlink" href="#constant-value" title="Permalink to this heading"></a></h5>
<p>Like any quantity, a density can simply be a constant value, at which
point it is not a secondary variable but an independent variable.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;surface-molar_density_liquid&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;field evaluator type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;independent variable constant&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;55000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;units&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;mol m^-3&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="standard-equation-of-state">
<h5><a class="toc-backref" href="#id183" role="doc-backlink">Standard Equation of State</a><a class="headerlink" href="#standard-equation-of-state" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>EOSEvaluator is the interface between state/data and the model, an EOS.</p>
</div></blockquote>
</section>
<section id="models">
<h5><a class="toc-backref" href="#id184" role="doc-backlink">Models</a><a class="headerlink" href="#models" title="Permalink to this heading"></a></h5>
<section id="constant-eos">
<h6><a class="toc-backref" href="#id185" role="doc-backlink">Constant EOS</a><a class="headerlink" href="#constant-eos" title="Permalink to this heading"></a></h6>
</section>
<section id="linear-eos">
<h6><a class="toc-backref" href="#id186" role="doc-backlink">Linear EOS</a><a class="headerlink" href="#linear-eos" title="Permalink to this heading"></a></h6>
</section>
<section id="ideal-gas">
<h6><a class="toc-backref" href="#id187" role="doc-backlink">Ideal Gas</a><a class="headerlink" href="#ideal-gas" title="Permalink to this heading"></a></h6>
</section>
<section id="eos-of-water">
<h6><a class="toc-backref" href="#id188" role="doc-backlink">EOS of Water</a><a class="headerlink" href="#eos-of-water" title="Permalink to this heading"></a></h6>
</section>
<section id="eos-of-ice">
<h6><a class="toc-backref" href="#id189" role="doc-backlink">EOS of Ice</a><a class="headerlink" href="#eos-of-ice" title="Permalink to this heading"></a></h6>
</section>
<section id="eos-of-vapor-in-air">
<h6><a class="toc-backref" href="#id190" role="doc-backlink">EOS of Vapor in Air</a><a class="headerlink" href="#eos-of-vapor-in-air" title="Permalink to this heading"></a></h6>
</section>
<section id="eos-of-saltwater">
<h6><a class="toc-backref" href="#id191" role="doc-backlink">EOS of Saltwater</a><a class="headerlink" href="#eos-of-saltwater" title="Permalink to this heading"></a></h6>
</section>
</section>
</section>
<section id="surface-energy-balance-evaluators">
<h4><a class="toc-backref" href="#id192" role="doc-backlink">Surface energy balance evaluators</a><a class="headerlink" href="#surface-energy-balance-evaluators" title="Permalink to this heading"></a></h4>
<p>Evaluators used to solve the fluxes to and from the atmosphere and
between layers of the surface.  Typically in ATS these calculate
evapotranspiration.</p>
<section id="area-fractions">
<h5><a class="toc-backref" href="#id193" role="doc-backlink">Area Fractions</a><a class="headerlink" href="#area-fractions" title="Permalink to this heading"></a></h5>
<p>Frequently, the surface of a grid cell is split across at least two
“subgrid components,” for instance snow covered and bare ground.  This
“subgrid” model allows smooth transitions between fully snow-covered
and fully bare ground.</p>
<p>These area fractions often get included as area-weights in calculating
full-cell quantities.</p>
<section id="two-component-model">
<h6><a class="toc-backref" href="#id194" role="doc-backlink">Two-component model</a><a class="headerlink" href="#two-component-model" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>A subgrid model for determining the area fraction of snow vs not snow within a grid cell.</p>
</div></blockquote>
<p>Uses a simple linear transition to vary between liquid and bare ground, and
another linear transition to vary between snow-covered and not-snow-covered.</p>
<p>Ordering of the area fractions calculated are: [bare ground/water, snow].</p>
<p><cite>“evaluator type</cite>” = <cite>“area fractions, two components</cite>”</p>
<div class="admonition-area-fractions-twocomponent-evaluator-spec admonition" id="area-fractions-twocomponent-evaluator-spec">
<p class="admonition-title">area-fractions-twocomponent-evaluator-spec:</p>
<ul class="simple">
<li><dl class="simple">
<dt><cite>“minimum fractional area [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-5</strong></dt><dd><p>Mimimum area fraction allowed, less than this is rebalanced as zero.</p>
</dd>
</dl>
</li>
</ul>
<p>DEPENDENCIES:</p>
<ul class="simple">
<li><p><cite>“snow depth</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code></p></li>
</ul>
</div>
</section>
<section id="three-component-model">
<h6><a class="toc-backref" href="#id195" role="doc-backlink">Three-component model</a><a class="headerlink" href="#three-component-model" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>A subgrid model for determining the area fraction of land, water, and snow within a grid cell.</p>
</div></blockquote>
<p>Uses a simple linear transition to vary between liquid and bare ground, and
another linear transition to vary between snow-covered and not-snow-covered.</p>
<p>Ordering of the area fractions calculated are: [bare ground, water, snow].</p>
<p><cite>“evaluator type</cite>” = <cite>“area fractions, three components</cite>”</p>
<div class="admonition-area-fractions-threecomponent-evaluator-spec admonition" id="area-fractions-threecomponent-evaluator-spec">
<p class="admonition-title">area-fractions-threecomponent-evaluator-spec:</p>
<ul class="simple">
<li><dl class="simple">
<dt><cite>“minimum fractional area [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-5</strong></dt><dd><p>Mimimum area fraction allowed, less than this is rebalanced as zero.</p>
</dd>
</dl>
</li>
</ul>
<p>DEPENDENCIES:</p>
<ul class="simple">
<li><p><cite>“snow depth</cite>” <strong>DOMAIN_SNOW-depth</strong></p></li>
<li><p><cite>“ponded depth</cite>” <strong>DOMAIN-ponded_depth</strong></p></li>
</ul>
</div>
</section>
<section id="three-component-model-with-microtopography">
<h6><a class="toc-backref" href="#id196" role="doc-backlink">Three-component model, with microtopography</a><a class="headerlink" href="#three-component-model-with-microtopography" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>A subgrid model for determining the area fraction of land, open water, and snow within a grid cell.</p>
</div></blockquote>
<p>Uses the subgrid equation from Jan et al WRR 2018 for volumetric or effective
ponded depth to determine the area of water, then heuristically places snow on
top of that surface.</p>
<p><cite>“evaluator type</cite>” = <cite>“area fractions, three components with microtopography</cite>”</p>
<div class="admonition-area-fractions-threecomponent-microtopography-evaluator-spec admonition" id="area-fractions-threecomponent-microtopography-evaluator-spec">
<p class="admonition-title">area-fractions-threecomponent-microtopography-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“snow transitional height [m]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.02</strong>
Minimum thickness for specifying the snow gradient.</p></li>
<li><p><cite>“minimum fractional area [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-5</strong>
Mimimum area fraction allowed, less than this is rebalanced as zero.</p></li>
<li><p><cite>“snow domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN_SNOW</strong> A default is guessed at
by replacing <cite>“surface</cite>” with <cite>“snow</cite>” in the this’s domain.</p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“microtopographic relief</cite>” <strong>DOMAIN-microtopographic_relief</strong>
The name of del_max, the max microtopography value.</p></li>
<li><p><cite>“excluded volume</cite>” <strong>DOMAIN-excluded_volume</strong>
The name of del_excluded, the integral of the microtopography.</p></li>
<li><p><cite>“ponded depth</cite>” <strong>DOMAIN-pressure</strong>
The name of the surface water ponded depth.</p></li>
<li><p><cite>“snow depth</cite>” <strong>DOMAIN_SNOW-depth</strong>
The name of the snow depth.</p></li>
<li><p><cite>“volumetric snow depth</cite>” <strong>DOMAIN_SNOW-volumetric_depth</strong>
The name of the snow depth.</p></li>
</ul>
</div>
<p>NOTE: this evaluator simplifies the situation by assuming constant density.
This make it so that ice and water see the same geometry per unit pressure,
which isn’t quite true thanks to density differences.  However, we hypothesize
that these differences, on the surface (unlike in the subsurface) really don’t
matter much. –etc</p>
</section>
</section>
<section id="potential-evapotranspiration">
<h5><a class="toc-backref" href="#id197" role="doc-backlink">Potential Evapotranspiration</a><a class="headerlink" href="#potential-evapotranspiration" title="Permalink to this heading"></a></h5>
<p>Models of potential evapotranspiration approximate the difference in
vapor pressure between the atmosphere and the soil as a function of
available energy, allowing the calculation of the max flux of ET that
the atmosphere could accept.  This can then be limited based on water
availability, etc.</p>
<section id="priestley-taylor-potential-evapotranspiration">
<h6><a class="toc-backref" href="#id198" role="doc-backlink">Priestley-Taylor Potential Evapotranspiration</a><a class="headerlink" href="#priestley-taylor-potential-evapotranspiration" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>Evaluates potential evapotranpiration (PET) using Priestley &amp; Taylor formulation.</p>
</div></blockquote>
<p>This implementation is based on models provided in the PRMS-IV, Version 4, see
pages 90-93, Equations 1-57 to 1-60</p>
<p>Requires the following dependencies:</p>
<div class="admonition-pet-priestley-taylor-evaluator-spec admonition" id="pet-priestley-taylor-evaluator-spec">
<p class="admonition-title">pet-priestley-taylor-evaluator-spec:</p>
<ul class="simple">
<li><p><cite>“include limiter</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, multiply potential ET by
a limiter to get an actual ET.</p></li>
<li><p><cite>“limiter number of dofs</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1</strong> Area fractions are often used
as limiters, and these have multiple dofs.  This provides how many.</p></li>
<li><p><cite>“limiter dof</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Area fractions are often used
as limiters, and these have multiple dofs.  This provides which one to use.</p></li>
<li><p><cite>“include 1 - limiter</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, multiply potential
ET by 1 - a limiter (e.g. a limiter that partitions between two pools) to
get actual ET.</p></li>
<li><p><cite>“1 - limiter number of dofs</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1</strong> Area fractions are often used
as limiters, and these have multiple dofs.  This provides how many.</p></li>
<li><p><cite>“1 - limiter dof</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Area fractions are often used
as limiters, and these have multiple dofs.  This provides which one to use.</p></li>
<li><dl class="simple">
<dt><cite>“sublimate snow</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, use latent heat of</dt><dd><p>vaporization of snow, not water.</p>
</dd>
</dl>
</li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“air temperature</cite>” <strong>DOMAIN-air_temperature</strong> Air temp, in [K]</p></li>
<li><dl class="simple">
<dt><cite>“surface temperature</cite>” <strong>DOMAIN-temperature</strong> Ground or leaf temp, in [K].  Note this may be the</dt><dd><p>same as air temperature.</p>
</dd>
</dl>
</li>
<li><p><cite>“elevation</cite>” <strong>DOMAIN-elevation</strong> Elevation [m]</p></li>
<li><p><cite>“net radiation</cite>” <strong>DOMAIN-net_radiation</strong> [W m^-2] Net radiation balance, positive to the ground.</p></li>
<li><p><cite>“limiter</cite>” [-] See <cite>“include limiter</cite>” above.</p></li>
<li><p><cite>“1 - limiter</cite>” [-] See <cite>“include 1 - limiter</cite>” above.</p></li>
</ul>
</div>
</section>
</section>
<section id="downregulation-and-limiters">
<h5><a class="toc-backref" href="#id199" role="doc-backlink">Downregulation and limiters</a><a class="headerlink" href="#downregulation-and-limiters" title="Permalink to this heading"></a></h5>
<p>Given a potential, the actual ET is often limited by available water
(or nutrients or other quantities).  These evaluators are used to
limit, downregulate, distribute, or otherwise move a potential to an
actual ET.</p>
<section id="transpiration-distribution">
<h6><a class="toc-backref" href="#id200" role="doc-backlink">Transpiration Distribution</a><a class="headerlink" href="#transpiration-distribution" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>Distributes and downregulates potential transpiration to the rooting zone.</p>
</div></blockquote>
<p>The transpiration distribution evaluator looks to take a potential
evapotranspiration and distribute it across the vertical column based on water
availability and rooting depths.  It also potentially limits the transpiration
to avoid taking water where it is not available (thereby crashing the code).</p>
<p>This model is based off of versions from both CLM 4.5 and PRMS.  It requires:</p>
<ol class="arabic simple">
<li><p>A root distribution profile.</p></li>
<li><p>A plant wilting factor (e.g. how water stressed is the plant?)</p></li>
<li><p>A potential transpiration, typically calculated from data or a potential
difference based on a latent heat calculation.</p></li>
</ol>
<p>Note this also requires columnar meshes – meaning that the subsurface mesh
must have <cite>“build columns from set</cite>” provided.</p>
<p>A normalized fraction of water is calculated through multiplying the water
factor by the root distribution factor, integrating across the column, and
dividing by the integral.  This gives a factor which sums to 1 and can be used
to distribute the potential ET throughout the soil column.</p>
<p>Then, this potential ET is down-regulated and multiplied by the plant wilting
factor.  If there is no water locally, it cannot be taken.  Note that almost
always, if there is no water, this did not contribute (much) to the integral
and so is already small.  But if the entire root zone is dried out, this might
have been a bunch of small numbers which then got normalized to 1, meaning they
are all now significant.</p>
<p>Finally, transpiration may be turned off for winter – relative to time zero,
parameters <cite>“leaf on doy</cite>” and <cite>“leaf off doy</cite>” are used to control when ET
is zero.  By default these are set to 0 and 366 days, ensuring that
transpiration is never turned off and the potential ET must include this
factor.  This is the right choice for, e.g. ELM output, or eddy covariance flux
tower data (where leaf on and off are already included in the potential
calculation).  It is the wrong choice for, e.g. Priestly-Taylor or
Penmann-Montief models, which are happy to predict transpiration all winter
long.  Good choices for those models depend upon the local climate, but may be
something like Julian day 101 for leaf on and Julian day 254 for leaf off (PRMS
defaults for US temperate forests).</p>
<p>Note that <cite>“leaf on doy</cite>” and <cite>“leaf off doy</cite>” are relative to the simulation’s
zero time, not the start time.  Typically these are Julian day of the year, but
this assumes that the 0 time of the simulation (not the “start time”, but time
0!) is Jan 1.  This leaf on/off cycle is modulo the <cite>“year duration</cite>”
(typically 1 noleap).  Note if <cite>“leaf off doy</cite>” &lt; <cite>“leaf on time</cite>” is ok too –
this is the case if simulation time zero is mid-summer.  These parameters come
from the LandCover type.</p>
<div class="admonition-transpiration-distribution-evaluator-spec admonition" id="transpiration-distribution-evaluator-spec">
<p class="admonition-title">transpiration-distribution-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“year duration</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1</strong></p></li>
<li><p><cite>“year duration units</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>noleap</strong></p></li>
<li><p><cite>“water limiter function</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> <strong>optional</strong> If provided,
limit the total water sink as a function of the integral of the water
potential * rooting fraction.</p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“plant wilting factor</cite>” <strong>DOMAIN-plant_wilting_factor</strong></p></li>
<li><p><cite>“rooting depth fraction</cite>” <strong>DOMAIN-rooting_depth_fraction</strong></p></li>
<li><p><cite>“potential transpiration</cite>” <strong>DOMAIN_SURF-potential_transpiration</strong></p></li>
<li><p><cite>“cell volume</cite>” <strong>DOMAIN-cell_volume</strong></p></li>
<li><p><cite>“surface cell volume</cite>” <strong>DOMAIN_SURF-cell_volume</strong></p></li>
</ul>
</div>
</section>
<section id="rooting-depth-fraction">
<h6><a class="toc-backref" href="#id201" role="doc-backlink">Rooting Depth Fraction</a><a class="headerlink" href="#rooting-depth-fraction" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>Provides a depth-based profile of root density.</p>
</div></blockquote>
<p>Sets the root fraction as a function of depth,</p>
<p>This function is such that the integral over depth = [0,inf) is 1, but
an artificial cutoff is generated.</p>
<p>Note that all three parameters, a, b, and the cutoff, are provided in the
LandCover type.</p>
<div class="admonition-rooting-depth-fraction-evaluator-spec admonition" id="rooting-depth-fraction-evaluator-spec">
<p class="admonition-title">rooting-depth-fraction-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“surface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>SURFACE_DOMAIN</strong> Sane default provided for most domain names.</p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“depth</cite>” <strong>DOMAIN-depth</strong></p></li>
<li><p><cite>“cell volume</cite>” <strong>DOMAIN-cell_volume</strong></p></li>
<li><p><cite>“surface cell volume</cite>” <strong>SURFACE_DOMAIN-cell_volume</strong></p></li>
</ul>
</div>
</section>
<section id="plant-wilting-point">
<h6><a class="toc-backref" href="#id202" role="doc-backlink">Plant Wilting Point</a><a class="headerlink" href="#plant-wilting-point" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>Plant wilting factor provides a moisture availability-based limiter on transpiration.</p>
</div></blockquote>
<p>Also known as Beta, or the water availability factor, or the plant wilting
factor, or the transpiration reduction function.</p>
<div class="math notranslate nohighlight">
\[Beta =  (p_closed - p) / (p_closed - p_open)\]</div>
<p>where p is the capillary pressure or soil mafic potential, and closed
and open indicate the values at which stomates are fully open or fully
closed (the wilting point).</p>
<p>Note this makes use of LandCover objects for mafic potential of fully open and
fully closed stomata.</p>
<p>Note the challenges of using this model with arbitrary van Genuchten WRMs.  See
Verhoef &amp; Egea, Ag. &amp; Forest Meteorology, 2014
<a class="reference external" href="https://doi.org/10.1016/j.agrformet.2014.02.009">https://doi.org/10.1016/j.agrformet.2014.02.009</a></p>
<div class="admonition-plant-wilting-factor-evaluator-spec admonition" id="plant-wilting-factor-evaluator-spec">
<p class="admonition-title">plant-wilting-factor-evaluator-spec</p>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“capillary pressure</cite>” <strong>DOMAIN-capillary_pressure_gas_liq</strong></p></li>
</ul>
</div>
</section>
</section>
<section id="soil-resistance">
<h5><a class="toc-backref" href="#id203" role="doc-backlink">Soil Resistance</a><a class="headerlink" href="#soil-resistance" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Downregulates evaporation via vapor diffusion through a dessicated zone.</p>
</div></blockquote>
<p>Calculates evaporative resistance through a dessicated zone.</p>
<p>Sakagucki and Zeng 2009 equations 9 and 10.</p>
<p>Requires the use of LandCover types, for dessicated zone thickness and Clapp &amp;
Hornberger b.</p>
<div class="admonition-evaporation-downregulation-evaluator-spec admonition" id="evaporation-downregulation-evaluator-spec">
<p class="admonition-title">evaporation-downregulation-evaluator-spec</p>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“saturation gas</cite>” <strong>DOMAIN_SUB-saturation_gas</strong></p></li>
<li><p><cite>“saturation liquid</cite>” <strong>DOMAIN_SUB-saturation_liquid</strong></p></li>
<li><p><cite>“porosity</cite>” <strong>DOMAIN_SUB-porosity</strong></p></li>
<li><p><cite>“potential evaporation</cite>” <strong>DOMAIN_SUB-potential_evaporation</strong></p></li>
</ul>
</div>
</section>
<section id="radiation-balance-terms">
<h5><a class="toc-backref" href="#id204" role="doc-backlink">Radiation Balance Terms</a><a class="headerlink" href="#radiation-balance-terms" title="Permalink to this heading"></a></h5>
<p>Often a balance of incoming and outgoing short and longwave radiations
are required to determine the energy available to go into latent heat,
and therefore potential evapotranspiration.</p>
<p>Note that incoming shortwave radiation is typically a user-provided
meterological forcing dataset.</p>
<section id="radiation-balance">
<h6><a class="toc-backref" href="#id205" role="doc-backlink">Radiation Balance</a><a class="headerlink" href="#radiation-balance" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>Evaluates a net radiation balance for ground and canopy.</p>
</div></blockquote>
<p>Here the net radiation is positive for energy inputs to the layer.  Note that
ground is based on the two-channel (land + snow) while canopy is assumed to be
a simple, single layer.</p>
<p>Requires the use of LandCover types, for albedo and Beer’s law coefficients.</p>
<p>This is combination of CLM v4.5 Tech Note and Beer’s law for attenuation of
radiation absorption.  In particular, long-wave is exactly as Figure 4.1c in CLM
4.5 Tech Note.  The main difference comes in how absorptivity (which is equal
to emissivity, epsilon in that document) is defined.  Here we use Beer’s law
which is an exponential decay with LAI.</p>
<p>Unlike CLM 4.5, here we do not split shortwave into direct and diffuse light.</p>
<p>Computes:</p>
<ol class="arabic simple">
<li><p>“surface radiation balance” – Net radiation seen by the bare soil/ponded
water, this includes radiation transmitted to the surface through the
canopy, longwave emitted by the canopy, and less the longwave emitted by the
surface itself.  [W m^-2] of actual area – this does NOT include the
surface area fraction factor which would be required to compute a total
energy flux in W.</p></li>
<li><p>“snow radiation balance” – Net radiation seen by the snow.  See surface
above – all are the same except using snow properties. [W m^-2]</p></li>
<li><p>“canopy radiation balance” – this is a compute computation of the net
radiation experienced by the canopy.  It includes the portion of shortwave
and longwave from the atmosphere that are absorbed via Beer’s law, minus the
outgoing longwave emitted from the canopy, plus upward longwave radiation
emitted by the snow and surface.  It also does not include any secondary
bounces (e.g. reflected atmosphere-&gt;canopy-&gt;cloud-&gt;back to canopy, or
transmitted by the canopy, reflected by snow/surface.</p></li>
</ol>
<p>Requires the use of LandCover types, for canopy albedo and Beer’s law
coefficients.</p>
<p><cite>“evaluator type</cite>” = <cite>“radiation balance, surface and canopy</cite>”</p>
<div class="admonition-radiation-balance-evaluator-spec admonition" id="radiation-balance-evaluator-spec">
<p class="admonition-title">radiation-balance-evaluator-spec</p>
<p>KEYS:
- <cite>“surface albedos</cite>” <strong>SURFACE_DOMAIN-albedos</strong>
- <cite>“surface emissivities</cite>” <strong>SURFACE_DOMAIN-emissivities</strong>
- <cite>“incoming shortwave radiation</cite>” <strong>SURFACE_DOMAIN-incoming_shortwave_radiation</strong>
- <cite>“incoming longwave radiation</cite>” <strong>SURFACE_DOMAIN-incoming_longwave_radiation</strong>
- <cite>“surface temperature</cite>” <strong>SURFACE_DOMAIN-temperature</strong>
- <cite>“snow temperature</cite>” <strong>SNOW_DOMAIN-temperature</strong>
- <cite>“canopy temperature</cite>” <strong>CANOPY_DOMAIN-temperature</strong>
- <cite>“leaf area index</cite>” <strong>CANOPY_DOMAIN-leaf_area_index</strong>
- <cite>“area fractions</cite>” <strong>SURFACE_DOMAIN-area_fractions</strong></p>
</div>
<p>Note that this is a superset of the physics in the “canopy radiation
evaluator,” and is therefore mutually exclusive with that model.</p>
</section>
<section id="canopy-radiation-balance">
<h6><a class="toc-backref" href="#id206" role="doc-backlink">Canopy Radiation Balance</a><a class="headerlink" href="#canopy-radiation-balance" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>Evaluates the canopy radiation balance, providing canopy net and radiation to the snow/surface.</p>
</div></blockquote>
<p>Computes and sums the downward radiation terms, determining the total radiation
sent down to the surface from the canopy and above.</p>
<p>Requires the use of LandCover types, for albedo and emissivity of the canopy
itself, along with Beer’s law coefficients.</p>
<p>Computes:</p>
<ol class="arabic simple">
<li><p>canopy-downward_shortwave_radiation – transmitted shortwave.  Note that
incoming shortwave is attenuated by Beer’s law, and partially transmitted
without attenuation when there are gaps (e.g. LAI &lt; 1) in the canopy.</p></li>
<li><p>canopy-downward_longwave_radiation – transmitted longwave (see above,
noting that Beer’s law coefficients should be used that absorb most if not
all the longwave radiation), along with longwave emitted by the canopy
computed using a canopy leaf temperature and a Bolzmann equation.</p></li>
<li><p>canopy-downward_net_radiation – this is a partial computation of the net
radiation experienced by the canopy.  It includes the portion of shortwave
and longwave from the atmosphere that are absorbed via Beer’s law, minus the
outgoing longwave emitted from the canopy (see downward above).  It does NOT
include upward longwave radiation emitted by the snow or surface.  It also
does not include any secondary bounces (e.g. reflected
atmosphere-&gt;canopy-&gt;cloud-&gt;back to canopy, or transmitted by the canopy,
reflected by snow).</p></li>
</ol>
<p>Here the net radiation is positive for energy added to the canopy, while the
other two are positive for energy sent to the layer below.</p>
<p>In the canopy-downward_net_radiation, we cannot include the upward terms YET,
because these are a function of snow and surface temperature, which in turn
depend upon the downward radiation computed here.  So we choose to break the
loop here, by computing downard terms first, then iterating to compute snow
temperature, then compute upward terms.  The alternative would be to have a
formal snow energy PK that computed snow temperature, at which point we would
solve all of these balances to convergence simultaneously.</p>
<p><cite>“evaluator type</cite>” = <cite>“canopy radiation balance from above</cite>”</p>
<div class="admonition-canopy-radiation-evaluator-spec admonition" id="canopy-radiation-evaluator-spec">
<p class="admonition-title">canopy-radiation-evaluator-spec</p>
<p>KEYS:
- <cite>“incoming shortwave radiation</cite>” <strong>SURFACE_DOMAIN-incoming_shortwave_radiation</strong>
- <cite>“incoming longwave radiation</cite>” <strong>SURFACE_DOMAIN-incoming_longwave_radiation</strong>
- <cite>“canopy temperature</cite>” <strong>CANOPY_DOMAIN-temperature</strong>
- <cite>“leaf area index</cite>” <strong>CANOPY_DOMAIN-leaf_area_index</strong></p>
</div>
<p>Note that this is a subset of the physics in the “radiation balance evaluator,”
and is therefore mutually exclusive with that model.</p>
</section>
<section id="surface-albedo">
<h6><a class="toc-backref" href="#id207" role="doc-backlink">Surface Albedo</a><a class="headerlink" href="#surface-albedo" title="Permalink to this heading"></a></h6>
<p>Note that albedo is also a multiple subgrid component model, like
surface balance.</p>
<blockquote>
<div><p>Evaluates albedos and emissivities in a two-component subgrid model.</p>
</div></blockquote>
<p>Evaluates the albedo and emissivity as an interpolation on the surface
properties and cover.  This allows for two components – snow and not snow
(water/ice/land).  Note this internally calculates albedo of snow based upon
snow density.</p>
<p>Components are indexed by: 0 = land/ice/water, 1 = snow.</p>
<p>Requires the use of LandCover types, for ground albedo and emissivity.</p>
<div class="admonition-albedo-evaluator-spec admonition" id="albedo-evaluator-spec">
<p class="admonition-title">albedo-evaluator-spec</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>“albedo ice [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.44</strong></p></li>
<li><p><cite>“albedo water [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.1168</strong></p></li>
<li><p><cite>“emissivity ice [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.98</strong></p></li>
<li><p><cite>“emissivity water [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.995</strong></p></li>
<li><p><cite>“emissivity snow [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.98</strong></p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“subgrid albedos</cite>” <strong>DOMAIN-subgrid_albedos</strong></p></li>
<li><p><cite>“subgrid emissivities</cite>” <strong>DOMAIN-subgrid_emissivities</strong></p></li>
</ul>
<p>DEPENDENCIES:</p>
<ul class="simple">
<li><p><cite>“snow density</cite>” <strong>SNOW_DOMAIN-density</strong></p></li>
<li><p><cite>“ponded depth</cite>” <strong>DOMAIN-ponded_depth</strong></p></li>
<li><p><cite>“unfrozen fraction</cite>” <strong>DOMAIN-unfrozen_fraction</strong></p></li>
</ul>
</div></blockquote>
<p>Evaluates albedos and emissivities in a three-component subgrid model.</p>
</div>
<p>Evaluates the albedo and emissivity as an interpolation on the surface
properties and cover.  This allows for three components – water/ice, land, and
snow.  Note this internally calculates albedo of snow based upon snow density.</p>
<p>Components are: 0 = land, 1 = ice/water, 2 = snow.</p>
<p>Requires the use of LandCover types, for ground albedo and emissivity.</p>
<div class="admonition-albedo-evaluator-subgrid-spec admonition" id="albedo-evaluator-subgrid-spec">
<p class="admonition-title">albedo-evaluator-subgrid-spec</p>
<ul class="simple">
<li><p><cite>“albedo ice [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.44</strong></p></li>
<li><p><cite>“albedo water [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.1168</strong></p></li>
<li><p><cite>“emissivity ice [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.98</strong></p></li>
<li><p><cite>“emissivity water [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.995</strong></p></li>
<li><p><cite>“emissivity snow [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.98</strong></p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“subgrid albedos</cite>” <strong>DOMAIN-subgrid_albedos</strong></p></li>
<li><p><cite>“subgrid emissivities</cite>” <strong>DOMAIN-subgrid_emissivities</strong></p></li>
</ul>
<p>DEPENDENCIES:</p>
<ul class="simple">
<li><p><cite>“snow density</cite>” <strong>SNOW_DOMAIN-density</strong></p></li>
<li><p><cite>“unfrozen fraction</cite>” <strong>DOMAIN-unfrozen_fraction</strong></p></li>
</ul>
</div>
</section>
<section id="incident-shortwave-radiation">
<h6><a class="toc-backref" href="#id208" role="doc-backlink">Incident Shortwave Radiation</a><a class="headerlink" href="#incident-shortwave-radiation" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>Evaluates the radiation incident on a non-flat surface.</p>
</div></blockquote>
<p>Aspect modified shortwave radiation is determined by a factor which is
multiplied by the ‘incoming radiation incident on a flat surface’ to determine
the ‘incoming radiation incident on a sloping surface of a given aspect’ as a
function of slope and aspect, Julian day of the year, and time of day.  The
latitude and Julian day of the year are used to modify this with both time of
day and seasonal changes of the planet.</p>
<p>Note that some careful checking and experimentation has found that, in
general, the daily average incoming radiation times the 12-noon aspect
modifier correlates reasonably well with the daily average of the
product of the hourly incoming radiation and the hourly aspect
modifier.  It is notably better than the daily average radiation times
the daily average aspect modifier.</p>
<p>This implementation is derived from <a class="reference external" href="https://github.com/landlab/landlab/blob/master/landlab/components/radiation/radiation.py">LandLab code</a>,
which is released under the MIT license.</p>
<div class="admonition-incident-shortwave-radiation-evaluator-spec admonition" id="incident-shortwave-radiation-evaluator-spec">
<p class="admonition-title">incident_shortwave_radiation_evaluator-spec</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>“incident shortwave radiation parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[incident_shortwave_radiation_model-spec]</span></code></p></li>
</ul>
<p>KEYS:
- <cite>“slope</cite>” <strong>DOMAIN-slope_magnitude</strong>
- <cite>“aspect</cite>” <strong>DOMAIN-aspect</strong>
- <cite>“incoming shortwave radiation</cite>” <strong>DOMAIN-incoming_shortwave_radiation</strong></p>
</div></blockquote>
<p>Evaluates shortwave as a function of slope/aspect/etc.</p>
</div>
<div class="admonition-incident-shortwave-radiation-model-spec admonition" id="incident-shortwave-radiation-model-spec">
<p class="admonition-title">incident_shortwave_radiation_model-spec</p>
<ul class="simple">
<li><p><cite>“latitude [degrees]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Latitude of the site.  A single
typical value is fine for most domains, even relatively large ones
(e.g. HUC4).</p></li>
<li><p><cite>“daily averaged</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> Compute a daily averaged radiation, as
opposed to a time-specific, diurnal-cycle-resolving value.</p></li>
<li><p><cite>“day of year at time 0 [Julian days]</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> (Jan 1).  ATS has
no notion of absolute time, so to do things that depend upon planetary
dynamics we must know what the day of the year is.  Typically this is set
by your meteorological data – set this to be equal to the day of year of
met data’s time 0.</p></li>
</ul>
</div>
</section>
<section id="longwave-radiation">
<h6><a class="toc-backref" href="#id209" role="doc-backlink">Longwave Radiation</a><a class="headerlink" href="#longwave-radiation" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>Evaluates incoming longwave radiation from vapor pressure and air temperature.</p>
</div></blockquote>
<div class="admonition-longwave-evaluator-spec admonition" id="longwave-evaluator-spec">
<p class="admonition-title">longwave_evaluator-spec</p>
<p>DEPENDENCIES:</p>
<ul class="simple">
<li><p><cite>“air temperature key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-air_temperature</strong></p></li>
<li><p><cite>“vapor pressure air key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-vapor_pressure_air</strong></p></li>
</ul>
</div>
</section>
</section>
<section id="full-surface-energy-balance-models">
<h5><a class="toc-backref" href="#id210" role="doc-backlink">Full Surface Energy Balance Models</a><a class="headerlink" href="#full-surface-energy-balance-models" title="Permalink to this heading"></a></h5>
<p>Finally, in addition to the potential-based models above, a few
full-physics model are available.  These are often based on older,
monolithic models.</p>
<section id="bare-soil-surface-energy-balance">
<h6><a class="toc-backref" href="#id211" role="doc-backlink">Bare Soil Surface Energy Balance</a><a class="headerlink" href="#bare-soil-surface-energy-balance" title="Permalink to this heading"></a></h6>
<blockquote>
<div><p>Calculates source terms for surface fluxes to and from the atmosphere and a ground surface.</p>
</div></blockquote>
<p>The ground is assumed to consist of two potential area-fraction components –
snow and no-snow.  In the case of snow on the ground, this solves for a snow
temperature, given a skin temperature, that satisfies a energy balance
equation.  In the case of no-snow, this calculates a conductive heat flux to
the ground from the atmosphere.</p>
<p><cite>“evaluator type</cite>” = <cite>“surface energy balance, two components</cite>”</p>
<div class="admonition-seb-twocomponent-evaluator-spec admonition" id="seb-twocomponent-evaluator-spec">
<p class="admonition-title">seb-twocomponent-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“wind speed reference height [m]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>2.0</strong> Reference height at which
wind speed is measured.</p></li>
<li><p><cite>“minimum wind speed [m s^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> Sets a floor on wind speed for
potential wierd data.  Models have trouble with no wind.</p></li>
<li><p><cite>“save diagnostic data</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Saves a suite of diagnostic variables to vis.</p></li>
<li><p><cite>“surface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DEFAULT</strong> Default set by parameterlist name.</p></li>
<li><p><cite>“subsurface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DEFAULT</strong> Default set relative to surface domain name.</p></li>
<li><p><cite>“snow domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DEFAULT</strong> Default set relative to surface domain name.</p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“surface water source</cite>” <strong>DOMAIN-water_source</strong>  [m s^-1]</p></li>
<li><p><cite>“surface energy source</cite>” <strong>DOMAIN-total_energy_source</strong> [MW m^-2]</p></li>
<li><p><cite>“subsurface water source</cite>” <strong>DOMAIN-water_source</strong>  [mol s^-1]</p></li>
<li><p><cite>“subsurface energy source</cite>” <strong>DOMAIN-total_energy_source</strong> [MW m^-3]</p></li>
<li><p><cite>“snow mass source - sink</cite>” <strong>DOMAIN-source_sink</strong> [m_SWE s^-1]</p></li>
<li><p><cite>“new snow source</cite>” <strong>DOMAIN-source</strong> [m_SWE s^-1]</p></li>
<li><p><cite>“albedo</cite>” <strong>DOMAIN-albedo</strong> [-] A single variate diagnostic of the final albedo.</p></li>
<li><p><cite>“snowmelt</cite>” <strong>DOMAIN_SNOW-melt</strong> [m_SWE s^-1]</p></li>
<li><p><cite>“evaporation</cite>” <strong>DOMAIN-evaporative_flux</strong> [m s^-1]</p></li>
<li><p><cite>“snow temperature</cite>” <strong>DOMAIN_SNOW-temperature</strong> [K]</p></li>
<li><p><cite>“sensible heat flux</cite>” <strong>DOMAIN-qE_sensible_heat</strong> [W m^-2]</p></li>
<li><p><cite>“latent heat of evaporation</cite>” <strong>DOMAIN-qE_latent_heat</strong> [W m^-2]</p></li>
<li><p><cite>“latent heat of snowmelt</cite>” <strong>DOMAIN-qE_snowmelt</strong> [W m^-2]</p></li>
<li><p><cite>“outgoing longwave radiation</cite>” <strong>DOMAIN-qE_lw_out</strong> [W m^-2]</p></li>
<li><p><cite>“conducted energy flux</cite>” <strong>DOMAIN-qE_conducted</strong> [W m^-2]</p></li>
</ul>
<p>DEPENDENCIES:</p>
<ul class="simple">
<li><p><cite>“incoming shortwave radiation</cite>” <strong>DOMAIN-incoming_shortwave_radiation</strong> [W m^-2]</p></li>
<li><p><cite>“incoming longwave radiation</cite>” <strong>DOMAIN-incoming_longwave_radiation</strong> [W m^-2]</p></li>
<li><p><cite>“air temperature</cite>” <strong>DOMAIN-air_temperature</strong> [K]</p></li>
<li><p><cite>“vapor pressure air</cite>” <strong>DOMAIN-vapor_pressure_air</strong> [Pa]</p></li>
<li><p><cite>“wind speed</cite>” <strong>DOMAIN-wind_speed</strong> [m s^-1]</p></li>
<li><p><cite>“precipitation rain</cite>” <strong>DOMAIN-precipitation_rain</strong> [m s^-1]</p></li>
<li><p><cite>“precipitation snow</cite>” <strong>DOMAIN_SNOW-precipitation</strong> [m_SWE s^-1]</p></li>
<li><p><cite>“snow depth</cite>” <strong>DOMAIN_SNOW-depth</strong> [m]</p></li>
<li><p><cite>“snow density</cite>” <strong>DOMAIN_SNOW-density</strong> [kg m^-3]</p></li>
<li><p><cite>“snow death rate</cite>” <strong>DOMAIN_SNOW-death_rate</strong> [m s^-1]  Snow “death” refers to the last bit of snowmelt that we want to remove discretely.</p></li>
<li><p><cite>“ponded depth</cite>” <strong>DOMAIN-ponded_depth</strong> [m]</p></li>
<li><p><cite>“unfrozen fraction</cite>” <strong>DOMAIN-unfrozen_fraction</strong> [-]  1 –&gt; all surface water, 0 –&gt; all surface ice</p></li>
<li><p><cite>“subgrid albedos</cite>” <strong>DOMAIN-albedos</strong> [-] Dimension 2 field of (no-snow, snow) albedos.</p></li>
<li><p><cite>“subgrid emissivity</cite>” <strong>DOMAIN-emissivities</strong> [-] Dimension 2 field of (no-snow, snow) emissivities.</p></li>
<li><p><cite>“area fractions</cite>” <strong>DOMAIN-fractional_areas</strong> Dimension 2 field of (no-snow, snow) area fractions (sum to 1).</p></li>
<li><p><cite>“temperature</cite>” <strong>DOMAIN-temperature</strong>  [K] surface skin temperature.</p></li>
<li><p><cite>“pressure</cite>” <strong>DOMAIN-pressure</strong> [Pa] surface skin pressure.</p></li>
<li><p><cite>“gas saturation</cite>” <strong>DOMAIN_SS-saturation_gas</strong> [-] subsurface gas saturation</p></li>
<li><p><cite>“liquid saturation</cite>” <strong>DOMAIN_SS-saturation_liquid</strong> [-] subsurface liquid saturation</p></li>
<li><p><cite>“porosity</cite>” [-] subsurface porosity</p></li>
<li><p><cite>“subsurface pressure</cite>” <strong>DOMAIN_SS-pressure</strong> [Pa]</p></li>
<li><p><cite>“molar density liquid</cite>” <strong>DOMAIN-molar_density_liquid</strong> [mol m^-3]</p></li>
<li><p><cite>“mass density liquid</cite>” <strong>DOMAIN-mass_density_liquid</strong> [kg m^-3]</p></li>
</ul>
</div>
<p>Calculates source terms for surface fluxes to and from the atmosphere and a
ground surface characterized by three components – snow, water-covered ground,
and vegetated/bare soil.</p>
<p>The surface energy balance on these area weighted patches are individually
calculated then averaged to form the total quantities.  All down- and
up-scaling of relevant quantities are done through the area weighting, which is
calculated by a minimum threshold in snow and a depression depth/geometry-based
approach for water.  All snow is assumed to first cover water (likely ice),
then cover land, as both water and snow prefer low-lying depressions due to
gravity- and wind-driven redistributions, respectively.</p>
<p><cite>“evaluator type</cite>” = <cite>“surface energy balance, two components</cite>”</p>
<div class="admonition-seb-threecomponent-evaluator-spec admonition" id="seb-threecomponent-evaluator-spec">
<p class="admonition-title">seb-threecomponent-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“wind speed reference height [m]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>2.0</strong> Reference height at which
wind speed is measured.</p></li>
<li><p><cite>“minimum wind speed [m s^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> Sets a floor on wind speed for
potential wierd data.  Models have trouble with no wind.</p></li>
<li><p><cite>“save diagnostic data</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Saves a suite of diagnostic variables to vis.</p></li>
<li><p><cite>“surface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DEFAULT</strong> Default set by parameterlist name.</p></li>
<li><p><cite>“subsurface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DEFAULT</strong> Default set relative to surface domain name.</p></li>
<li><p><cite>“snow domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DEFAULT</strong> Default set relative to surface domain name.</p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“surface water source</cite>” <strong>DOMAIN-water_source</strong>  [m s^-1]</p></li>
<li><p><cite>“surface energy source</cite>” <strong>DOMAIN-total_energy_source</strong> [MW m^-2]</p></li>
<li><p><cite>“subsurface water source</cite>” <strong>DOMAIN-water_source</strong>  [mol s^-1]</p></li>
<li><p><cite>“subsurface energy source</cite>” <strong>DOMAIN-total_energy_source</strong> [MW m^-3]</p></li>
<li><p><cite>“snow mass source - sink</cite>” <strong>DOMAIN-source_sink</strong> [m_SWE s^-1]</p></li>
<li><p><cite>“new snow source</cite>” <strong>DOMAIN-source</strong> [m_SWE s^-1]</p></li>
<li><p><cite>“albedo</cite>” <strong>DOMAIN-albedo</strong> [-] A single variate diagnostic of the final albedo.</p></li>
<li><p><cite>“snowmelt</cite>” <strong>DOMAIN_SNOW-melt</strong> [m_SWE s^-1]</p></li>
<li><p><cite>“evaporation</cite>” <strong>DOMAIN-evaporative_flux</strong> [m s^-1]</p></li>
<li><p><cite>“snow temperature</cite>” <strong>DOMAIN_SNOW-temperature</strong> [K]</p></li>
<li><p><cite>“sensible heat flux</cite>” <strong>DOMAIN-qE_sensible_heat</strong> [W m^-2]</p></li>
<li><p><cite>“latent heat of evaporation</cite>” <strong>DOMAIN-qE_latent_heat</strong> [W m^-2]</p></li>
<li><p><cite>“latent heat of snowmelt</cite>” <strong>DOMAIN-qE_snowmelt</strong> [W m^-2]</p></li>
<li><p><cite>“outgoing longwave radiation</cite>” <strong>DOMAIN-qE_lw_out</strong> [W m^-2]</p></li>
<li><p><cite>“conducted energy flux</cite>” <strong>DOMAIN-qE_conducted</strong> [W m^-2]</p></li>
</ul>
<p>DEPENDENCIES:</p>
<ul class="simple">
<li><p><cite>“incoming shortwave radiation</cite>” <strong>DOMAIN-incoming_shortwave_radiation</strong> [W m^-2]</p></li>
<li><p><cite>“incoming longwave radiation</cite>” <strong>DOMAIN-incoming_longwave_radiation</strong> [W m^-2]</p></li>
<li><p><cite>“air temperature</cite>” <strong>DOMAIN-air_temperature</strong> [K]</p></li>
<li><p><cite>“vapor pressure air</cite>” <strong>DOMAIN-vapor_pressure_air</strong> [Pa]</p></li>
<li><p><cite>“wind speed</cite>” <strong>DOMAIN-wind_speed</strong> [m s^-1]</p></li>
<li><p><cite>“precipitation rain</cite>” <strong>DOMAIN-precipitation_rain</strong> [m s^-1]</p></li>
<li><p><cite>“precipitation snow</cite>” <strong>DOMAIN_SNOW-precipitation</strong> [m_SWE s^-1]</p></li>
<li><p><cite>“snow depth</cite>” <strong>DOMAIN_SNOW-depth</strong> [m]</p></li>
<li><p><cite>“snow density</cite>” <strong>DOMAIN_SNOW-density</strong> [kg m^-3]</p></li>
<li><p><cite>“snow death rate</cite>” <strong>DOMAIN_SNOW-death_rate</strong> [m s^-1]  Snow “death” refers to the last bit of snowmelt that we want to remove discretely.</p></li>
<li><p><cite>“ponded depth</cite>” <strong>DOMAIN-ponded_depth</strong> [m]</p></li>
<li><p><cite>“unfrozen fraction</cite>” <strong>DOMAIN-unfrozen_fraction</strong> [-]  1 –&gt; all surface water, 0 –&gt; all surface ice</p></li>
<li><p><cite>“subgrid albedos</cite>” <strong>DOMAIN-albedos</strong> [-] Dimension 2 field of (no-snow, snow) albedos.</p></li>
<li><p><cite>“subgrid emissivity</cite>” <strong>DOMAIN-emissivities</strong> [-] Dimension 2 field of (no-snow, snow) emissivities.</p></li>
<li><p><cite>“area fractions</cite>” <strong>DOMAIN-fractional_areas</strong> Dimension 2 field of (no-snow, snow) area fractions (sum to 1).</p></li>
<li><p><cite>“temperature</cite>” <strong>DOMAIN-temperature</strong>  [K] surface skin temperature.</p></li>
<li><p><cite>“pressure</cite>” <strong>DOMAIN-pressure</strong> [Pa] surface skin pressure.</p></li>
<li><p><cite>“gas saturation</cite>” <strong>DOMAIN_SS-saturation_gas</strong> [-] subsurface gas saturation</p></li>
<li><p><cite>“liquid saturation</cite>” <strong>DOMAIN_SS-saturation_liquid</strong> [-] subsurface liquid saturation</p></li>
<li><p><cite>“porosity</cite>” [-] subsurface porosity</p></li>
<li><p><cite>“subsurface pressure</cite>” <strong>DOMAIN_SS-pressure</strong> [Pa]</p></li>
<li><p><cite>“molar density liquid</cite>” <strong>DOMAIN-molar_density_liquid</strong> [mol m^-3]</p></li>
<li><p><cite>“mass density liquid</cite>” <strong>DOMAIN-mass_density_liquid</strong> [kg m^-3]</p></li>
</ul>
</div>
</section>
<section id="common-land-model-parflow-clm">
<h6><a class="toc-backref" href="#id212" role="doc-backlink">Common Land Model (ParFlow-CLM)</a><a class="headerlink" href="#common-land-model-parflow-clm" title="Permalink to this heading"></a></h6>
<p>This is included here because it should eventually get split into
evaluators.  Currently, the CLM SEB model is a PK only, see <a href="#id241"><span class="problematic" id="id242">`Common
Land Model PK`_</span></a>.</p>
</section>
</section>
</section>
<section id="snow-evaluators">
<h4><a class="toc-backref" href="#id213" role="doc-backlink">Snow evaluators</a><a class="headerlink" href="#snow-evaluators" title="Permalink to this heading"></a></h4>
<p>Evaluators used for solving snowpack and/or snow redistribution laterally.</p>
<section id="snowsurfacepotential">
<h5><a class="toc-backref" href="#id214" role="doc-backlink">SnowSurfacePotential</a><a class="headerlink" href="#snowsurfacepotential" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Computes the potential surface upon which snow redistribution acts.</p>
</div></blockquote>
<p>Snow distribution moves snow precipitation around to ensure that low-lying
areas fill up first.  This represents a potential field driving movement of
snow precip, so defines what we mean by low-lying.</p>
<div class="math notranslate nohighlight">
\[h + z + h_{{snow}} + dt * P_{{snow}}\]</div>
<p><cite>“evaluator type</cite>” = <cite>“snow skin potential</cite>”</p>
<div class="admonition-snow-skin-potential-evaluator-spec admonition" id="snow-skin-potential-evaluator-spec">
<p class="admonition-title">snow-skin-potential-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“dt factor [s]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> A free-parameter factor for providing a
time scale for diffusion of snow precipitation into low-lying areas.
Typically on the order of 1e4-1e7. This timestep times the wave speed of
snow provides an approximate length of how far snow precip can travel.
Extremely tunable! [s]</p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“ponded depth</cite>” <strong>SURFACE_DOMAIN-ponded_depth</strong> [m]</p></li>
<li><p><cite>“snow depth</cite>” <strong>DOMAIN-depth</strong> [m]</p></li>
<li><p><cite>“precipitation snow</cite>” <strong>DOMAIN-precipitation</strong> [m s^-1]</p></li>
<li><p><cite>“elevation</cite>” <strong>SURFACE_DOMAIN-elevation</strong> [m]</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;snow_skin_potential&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;evaluator type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;snow skin potential&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dt factor [s]&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;864000.0&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="snow-melt-rate">
<h5><a class="toc-backref" href="#id215" role="doc-backlink">Snow Melt Rate</a><a class="headerlink" href="#snow-melt-rate" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Evaluates snow melt via USDA - Natural Resources Conservation Service model</p>
</div></blockquote>
<p>From:  National Engineering Handbook (NEH) part 630, Chapter 11</p>
<p>Snow melt rate is given by:</p>
<div class="math notranslate nohighlight">
\[SM = H(T_{snow}^{expected} - 273.15) R\]</div>
<p>where <span class="math notranslate nohighlight">\(R\)</span> is the snow melt rate per degree-day and
<span class="math notranslate nohighlight">\(T_{snow}^{expected}\)</span> is the expected snow temperature, which is
typically given by <span class="math notranslate nohighlight">\(T_{snow}^{expected} = T_{air} - \Delta\)</span>, where
<span class="math notranslate nohighlight">\(\Delta\)</span> is the expected air-snow temperature difference [C] (note this
is NOT prescribed here – the user must supply the expected snow temperature
via an evalutor).</p>
<p>Note that the Heaviside function is used to ensure this is only active when the
expected snow temperature is above 0 C.</p>
<p>Then, a linear transition factor is applied to ensure that this goes to zero as
the snow SWE goes to zero.  That factor is 1 at the snow transition depth, and
0 when snow SWE is 0.  This uses LandCover for the snow_ground_transition
parameter.</p>
<div class="admonition-snow-meltrate-evaluator-spec admonition" id="snow-meltrate-evaluator-spec">
<p class="admonition-title">snow-meltrate-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“snow melt rate [mm day^-1 C^-1]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>2.74</strong>
the melt rate per degree-day, above 0 C, e.g. <span class="math notranslate nohighlight">\(R\)</span> above.</p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“snow water equivalent</cite>” <strong>DOMAIN-water_equivalent</strong></p></li>
<li><p><cite>“expected snow temperature</cite>”  <strong>DOMAIN-expected_temperature</strong></p></li>
</ul>
</div>
</section>
</section>
<section id="canopy-evaluators">
<h4><a class="toc-backref" href="#id216" role="doc-backlink">Canopy evaluators</a><a class="headerlink" href="#canopy-evaluators" title="Permalink to this heading"></a></h4>
<section id="interception">
<h5><a class="toc-backref" href="#id217" role="doc-backlink">Interception</a><a class="headerlink" href="#interception" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Partitions water between interception and throughfall, combining throughfall with drainage.</p>
</div></blockquote>
<p>Based on CLM 4.5 and Lawrence et al 2007, interception is given by:</p>
<div class="math notranslate nohighlight">
\[I = (P_{rain} + P_{snow}) * \alpha * (1 - exp(-.5(LAI)))\]</div>
<p>Throughfall is given by:</p>
<div class="math notranslate nohighlight">
\[T = (P_{rain} + P_{snow}) - I\]</div>
<p>Drainage is provided as input here, as a total drainage from the canopy.  The
phase of this drainage is assumed to match the phase of the precipitation.  So
if it is raining, drainage is rain, while if it is 50/50 rain and snow,
drainage is also 50/50 rain and snow.  If total precipitation is 0, then
drainage is partitioned by air temperature (above 0C –&gt; all rain, otherwise
all snow).  This evaluator partitions the drainage and sums it with throughfall
to compute the total source, in each phase, to the layer below the canopy (snow
and/or ground surface).</p>
<div class="admonition-interception-fraction-evaluator-spec admonition" id="interception-fraction-evaluator-spec">
<p class="admonition-title">interception-fraction-evaluator-spec</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>“interception fraction parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[interception-fraction-model-spec]</span></code></p></li>
</ul>
<p>MY KEYS:
- <cite>“interception</cite>” <strong>DOMAIN-interception</strong>
- <cite>“throughfall and drainage rain</cite>” <strong>DOMAIN-throughfall_drainage_rain</strong>
- <cite>“throughfall and drainage snow</cite>” <strong>DOMAIN-throughfall_drainage_snow</strong></p>
<p>KEYS:
- <cite>“area index</cite>” <strong>DOMAIN-area_index</strong>
- <cite>“precipitation rain</cite>” <strong>DOMAIN_SURFACE-precipitation_rain</strong>
- <cite>“precipitation snow</cite>” <strong>DOMAIN_SNOW-precipitation</strong>
- <cite>“drainage</cite>” <strong>DOMAIN-drainage</strong>
- <cite>“air temperature</cite>” <strong>DOMAIN_SURFACE-air_temperature</strong></p>
</div></blockquote>
<p>Fraction of incoming water that is intercepted.</p>
</div>
<p>Based on CLM 4.5 and Lawrence et al 2007:</p>
<div class="math notranslate nohighlight">
\[f_I = \alpha * (1 - exp(-.5 LAI)))\]</div>
<p>The interception fraction is everything here after the precip.</p>
<div class="admonition-interception-fraction-model-spec admonition" id="interception-fraction-model-spec">
<p class="admonition-title">interception-fraction-model-spec</p>
<ul class="simple">
<li><dl class="simple">
<dt><cite>“leaf area interception fraction [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.25</strong> The alpha</dt><dd><p>term, this describes the fraction of leaf area that intercepts water.</p>
</dd>
</dl>
</li>
</ul>
</div>
</section>
<section id="drainage">
<h5><a class="toc-backref" href="#id218" role="doc-backlink">Drainage</a><a class="headerlink" href="#drainage" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Drainage rate from the canopy to the lower layers.</p>
</div></blockquote>
<p>A simple model based on relaxation from current water content to a saturated water content.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>       <span class="o">|</span>
       <span class="o">|</span> <span class="n">source</span>
       <span class="n">V</span>
      <span class="o">/</span>   \
   <span class="n">I</span> <span class="o">/</span>     \
    <span class="n">V</span>       <span class="o">|</span>
<span class="o">--</span><span class="n">Theta</span><span class="o">--</span>    <span class="o">|</span> <span class="n">T</span>
    <span class="o">^</span>       <span class="o">|</span>
    <span class="o">|</span> <span class="n">D</span>     <span class="o">|</span>
    <span class="n">V</span>       <span class="n">V</span>
<span class="o">--</span> <span class="o">--</span> <span class="o">--</span> <span class="o">--</span> <span class="o">--</span> <span class="o">--</span> <span class="o">--</span>
</pre></div>
</div>
<p>This is the model for drainage D.</p>
<p>Drainage is given by:</p>
<div class="math notranslate nohighlight">
\[D = max(0, \frac{(\Theta - \Theta_sat)}{\tau})\]</div>
<div class="admonition-drainage-evaluator-spec admonition" id="drainage-evaluator-spec">
<p class="admonition-title">drainage-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“drainage timescale [s]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>864</strong> Timescale over which drainage occurs.</p></li>
<li><dl class="simple">
<dt><cite>“saturated specific water content [m^3 H2O / m^2 leaf area]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e-4</strong></dt><dd><p>The thickness of the wetting surface – determines maximum canopy water storage.</p>
</dd>
</dl>
</li>
</ul>
<p>KEYS:
- “area index”
- “water equivalent”</p>
</div>
</section>
</section>
<section id="carbon-and-biogeochemistry-models">
<h4><a class="toc-backref" href="#id219" role="doc-backlink">Carbon and Biogeochemistry Models</a><a class="headerlink" href="#carbon-and-biogeochemistry-models" title="Permalink to this heading"></a></h4>
<section id="carbon-decomposition-rate">
<h5><a class="toc-backref" href="#id220" role="doc-backlink">Carbon Decomposition Rate</a><a class="headerlink" href="#carbon-decomposition-rate" title="Permalink to this heading"></a></h5>
</section>
<section id="cryo-bioturbation">
<h5><a class="toc-backref" href="#id221" role="doc-backlink">Cryo/bioturbation</a><a class="headerlink" href="#cryo-bioturbation" title="Permalink to this heading"></a></h5>
</section>
<section id="pool-decomposition">
<h5><a class="toc-backref" href="#id222" role="doc-backlink">Pool Decomposition</a><a class="headerlink" href="#pool-decomposition" title="Permalink to this heading"></a></h5>
</section>
<section id="pool-transfer">
<h5><a class="toc-backref" href="#id223" role="doc-backlink">Pool Transfer</a><a class="headerlink" href="#pool-transfer" title="Permalink to this heading"></a></h5>
</section>
</section>
<section id="multiscale-models">
<h4><a class="toc-backref" href="#id224" role="doc-backlink">Multiscale Models</a><a class="headerlink" href="#multiscale-models" title="Permalink to this heading"></a></h4>
<section id="subgrid-aggregation">
<h5><a class="toc-backref" href="#id225" role="doc-backlink">Subgrid Aggregation</a><a class="headerlink" href="#subgrid-aggregation" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>SubgridAggregateEvaluator restricts a field to the subgrid version of the same field.</p>
</div></blockquote>
<div class="admonition-subgrid-aggregate-evaluator-spec admonition" id="subgrid-aggregate-evaluator-spec">
<p class="admonition-title">subgrid-aggregate-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“source domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Domain name of the source mesh.</p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“field</cite>” <strong>SOURCE_DOMAIN-KEY</strong>  Default set from this evaluator’s name.</p></li>
</ul>
</div>
</section>
<section id="subgrid-disaggregation">
<h5><a class="toc-backref" href="#id226" role="doc-backlink">Subgrid disaggregation</a><a class="headerlink" href="#subgrid-disaggregation" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>SubgridDisaggregateEvaluator restricts a field to the subgrid version of the same field.</p>
</div></blockquote>
<p>Note that this evaluator fills exactly one subdomain in a domain set – there
will be N evaluators each filling one subdomain.</p>
<div class="admonition-subgrid-disaggregate-evaluator-spec admonition" id="subgrid-disaggregate-evaluator-spec">
<p class="admonition-title">subgrid-disaggregate-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“source domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Domain name of the source mesh.</p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“field</cite>” <strong>SOURCE_DOMAIN-KEY</strong>  Default set from this evaluator’s name.</p></li>
</ul>
</div>
</section>
</section>
<section id="geometric-evaluators">
<h4><a class="toc-backref" href="#id227" role="doc-backlink">Geometric evaluators</a><a class="headerlink" href="#geometric-evaluators" title="Permalink to this heading"></a></h4>
<p>Evaluators that capture various aspects of the mesh geometry.</p>
<section id="surfaceelevation">
<h5><a class="toc-backref" href="#id228" role="doc-backlink">SurfaceElevation</a><a class="headerlink" href="#surfaceelevation" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Evaluates the elevation (z-coordinate) and slope magnitude of a mesh.</p>
</div></blockquote>
<p><cite>“evaluator type</cite>” = <cite>“meshed elevation</cite>”</p>
<p>Evaluates the z-coordinate and the magnitude of the slope :math:<code class="docutils literal notranslate"><span class="pre">|\nambla_h</span> <span class="pre">z|</span></code></p>
<div class="admonition-meshed-elevation-evaluator-spec admonition" id="meshed-elevation-evaluator-spec">
<p class="admonition-title">meshed-elevation-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“parent domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>SUBSURFACE_DOMAIN</strong> Domain name of the parent
mesh, which is the 3D version of this domain.  Attempts to generate an
intelligent default by stripping “surface” from this domain.</p></li>
<li><p><cite>“dynamic mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Lets the evaluator know that the
elevation changes in time, and adds the <cite>“deformation</cite>” dependency.</p></li>
</ul>
<p>MY KEYS:</p>
<ul class="simple">
<li><p><cite>“elevation</cite>” <strong>DOMAIN-elevation</strong> Name the elevation variable. [m]</p></li>
<li><p><cite>“slope magnitude</cite>” <strong>DOMAIN-slope_magnitude</strong> Name the elevation variable. [-]</p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“deformation</cite>” <strong>optional</strong> If <cite>“dynamic mesh</cite>” == True, this is required
to tell when the mesh has been deformed.</p></li>
</ul>
</div>
</section>
<section id="elevation-of-a-column">
<h5><a class="toc-backref" href="#id229" role="doc-backlink">Elevation of a Column</a><a class="headerlink" href="#elevation-of-a-column" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>ElevationEvaluatorColumn: evaluates the elevation (z-coordinate) and slope magnitude of a mesh.</p>
</div></blockquote>
<p>Evaluates elevation, slope, and aspect of the “surface_star” mesh of the Arctic
Intermediate Scale Model (ISM).</p>
<p>Evaluates the z-coordinate and the magnitude of the slope :math:<code class="docutils literal notranslate"><span class="pre">|\nambla_h</span>
<span class="pre">z|</span></code> Note that this is evaluator is different from both the standard elevation
evaluator, which would take elevation/slope/aspect from the parent 3D mesh, and
from the standard “single cell” column mesh elevation, which can do the same.
Instead, it is a mix of:</p>
<ul class="simple">
<li><p>elevation is aggregated from the column meshes’ top faces</p></li>
<li><p>slope is calculated using a cell-neighbor differencing scheme.  Unlike 3D
meshes, in the ISM, we deform columns of cells and so do not have faces.
Therefore, we use all neighboring cells to compute an average normal for the
cell, and use that to compute slope and aspect.</p></li>
<li><p>aspect is set to 0.  It could easily be calculated using the same normal as
the slope algorithm, but is not done currently.</p></li>
</ul>
<p><cite>“evaluator type</cite>” = <cite>“elevation column</cite>”</p>
<div class="admonition-column-elevation-evaluator-spec admonition" id="column-elevation-evaluator-spec">
<p class="admonition-title">column-elevation-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“elevation key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>elevation</strong> Name the elevation variable. [m]</p></li>
<li><p><cite>“slope magnitude key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>slope_magnitude</strong> Name the elevation
variable. [-]</p></li>
<li><p><cite>“dynamic mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Lets the evaluator know that the
elevation changes in time, and adds the <cite>“deformation</cite>” and
<cite>“base_porosity</cite>” dependencies.</p></li>
<li><p><cite>“parent domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN</strong> Domain name of the parent
mesh, which is the 3D version of this domain.  In the columnar meshes the
surface elevation and slope are assigned based on the columns and not the
base 3D domain.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;surface_star-elevation&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;evaluator type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;column elevation&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="depth-evaluator">
<h5><a class="toc-backref" href="#id230" role="doc-backlink">Depth Evaluator</a><a class="headerlink" href="#depth-evaluator" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Computes depth, positive downward relative to the surface, of mesh cells.</p>
</div></blockquote>
<p>Computes cell depths only.</p>
<p>Note that two algorithms for computing the depth are available:</p>
<p><cite>“cell centroid</cite>” uses the cell centroid, as computed by the Mesh, directly.</p>
<p><cite>“mean face centroid</cite>” is the default, as the cell centroid can have problems
in the case of non-planar faces.  Instead, it uses the mean of the above and
below face centroids in place of the face centroid, with the implicit
assumption that dz is uniform (e.g. this is an extruded mesh).</p>
<p><cite>“evaluator type</cite>” = <cite>“depth</cite>”</p>
<div class="admonition-depth-evaluator-spec admonition" id="depth-evaluator-spec">
<p class="admonition-title">depth-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“algorithm</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>mean face centroid</strong> Valid is <cite>“mean face centroid</cite>”
and <cite>“cell centroid</cite>”, see above.</p></li>
</ul>
</div>
</section>
<section id="cell-volume-evaluator">
<h5><a class="toc-backref" href="#id231" role="doc-backlink">Cell Volume evaluator</a><a class="headerlink" href="#cell-volume-evaluator" title="Permalink to this heading"></a></h5>
</section>
<section id="deforming-cell-volume-evaluator">
<h5><a class="toc-backref" href="#id232" role="doc-backlink">Deforming Cell Volume evaluator</a><a class="headerlink" href="#deforming-cell-volume-evaluator" title="Permalink to this heading"></a></h5>
</section>
</section>
<section id="generic-evaluators">
<h4><a class="toc-backref" href="#id233" role="doc-backlink">Generic evaluators</a><a class="headerlink" href="#generic-evaluators" title="Permalink to this heading"></a></h4>
<p>These evaluators take arguments to allow the user to provide custom
functions via the input spec.</p>
<section id="additive">
<h5><a class="toc-backref" href="#id234" role="doc-backlink">Additive</a><a class="headerlink" href="#additive" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>A generic evaluator for summing a collection of fields.</p>
</div></blockquote>
<div class="admonition-additive-evaluator-spec-constant-shift-double-0-a-constant-value-to-add-to-the-sum admonition" id="additive-evaluator-spec">
<p class="admonition-title">additive-evaluator-spec
* <cite>“constant shift</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0</strong> A constant value to add to the sum.</p>
<ul class="simple">
<li><p><cite>“enforce positivity</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, max the result with 0.</p></li>
<li><p><cite>“DEPENDENCY coefficient</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> A multiple for each dependency in
the list below.</p></li>
</ul>
<p>ONE OF</p>
<ul class="simple">
<li><p><cite>“dependencies</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> The things to sum.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“evaluator dependency suffixes</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code></p></li>
</ul>
<p>END</p>
</div>
</section>
<section id="multiplicative">
<h5><a class="toc-backref" href="#id235" role="doc-backlink">Multiplicative</a><a class="headerlink" href="#multiplicative" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>A generic evaluator for multiplying a collection of fields.</p>
</div></blockquote>
<div class="admonition-multiplicative-evaluator-spec-coefficient-double-1-a-constant-prefix-to-the-product admonition" id="multiplicative-evaluator-spec">
<p class="admonition-title">multiplicative-evaluator-spec
* <cite>“coefficient</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1</strong> A constant prefix to the product.</p>
<ul class="simple">
<li><p><cite>“enforce positivity</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, max the result with 0.</p></li>
<li><p><cite>“DEPENDENCY dof</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0</strong> Degree of Freedom for each given
dependency to use in the multiplication.  NOTE, this should only be
provided if the dependency has more than 1 DoF – if it just has one
leaving this blank results in better error checking than providing the
value 0 manually.</p></li>
</ul>
<p>ONE OF</p>
<ul class="simple">
<li><p><cite>“dependencies</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> The fields to multiply.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“evaluator dependency suffixes</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code></p></li>
</ul>
<p>END</p>
</div>
</section>
<section id="column-summation">
<h5><a class="toc-backref" href="#id236" role="doc-backlink">Column summation</a><a class="headerlink" href="#column-summation" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Sums a subsurface field vertically only a surface field.</p>
</div></blockquote>
<p>Simple vertical sum of all cells below each surface cell.  Note that their are
options for including volume factors (multiply by subsurface cell volume, sum,
divide by surface cell area) and density (useful for the most common use case
of summing fluxes onto the surface and converting to m/s instead of mol/m^2/s).</p>
<div class="admonition-column-sum-evaluator-spec admonition" id="column-sum-evaluator-spec">
<p class="admonition-title">column-sum-evaluator-spec</p>
<ul class="simple">
<li><p><cite>“include volume factor</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> In summing, multiply the
summand subsurface cell volume, then divide the sum by the surface cell
area.  Useful for converting volumetric fluxes to total fluxes.</p></li>
<li><p><cite>“divide by density</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> Divide the summand by density.
Useful for converting molar fluxes to volumetric fluxes
(e.g. transpiration).</p></li>
<li><p><cite>“column domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>domain</strong> The domain of the
subsurface mesh.  Note this defaults to a sane thing based on the
variable’s domain (typically “surface” or “surface_column:*”) and is
rarely set by the user.</p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“summed</cite>” The summand, defaults to the root suffix of the calculated variable.</p></li>
<li><p><cite>“cell volume</cite>” Defaults to domain’s cell volume.</p></li>
<li><p><cite>“surface cell volume</cite>” Defaults to surface domain’s cell volume.</p></li>
<li><p><cite>“molar density</cite>” Defaults to domain’s molar_density_liquid.</p></li>
</ul>
</div>
</section>
<section id="top-cell">
<h5><a class="toc-backref" href="#id237" role="doc-backlink">Top cell</a><a class="headerlink" href="#top-cell" title="Permalink to this heading"></a></h5>
</section>
<section id="arbitrary-function">
<h5><a class="toc-backref" href="#id238" role="doc-backlink">Arbitrary function</a><a class="headerlink" href="#arbitrary-function" title="Permalink to this heading"></a></h5>
<p>Uses functions to evaluate arbitrary algebraic functions of its dependencies.</p>
<p>For example, one might write a dependency:</p>
<blockquote>
<div><p>VARNAME = 0.2 * DEP1 - DEP2 + 3</p>
</div></blockquote>
<p><cite>“evaluator type</cite>” = <cite>“secondary variable from function</cite>”</p>
<div class="admonition-secondary-variable-from-function-evaluator-spec admonition" id="secondary-variable-from-function-evaluator-spec">
<p class="admonition-title">secondary-variable-from-function-evaluator-spec</p>
<p>ONE OF:</p>
<ul class="simple">
<li><p><cite>“functions</cite>” <code class="docutils literal notranslate"><span class="pre">[composite-vector-function-spec-list]</span></code> Note this is used
for multiple Degress of Freedom.</p></li>
</ul>
<p>OR:</p>
<ul class="simple">
<li><p><cite>“function</cite>” <code class="docutils literal notranslate"><span class="pre">[composite-vector-function-spec]</span></code> Used for a single degree
of freedom.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;VARNAME&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;field evaluator type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;algebraic variable from function&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;evaluator dependencies&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array{string}&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{DEP1, DEP2}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-linear&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;x0&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{0.0,0.0}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;y0&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;3.&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gradient&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{0.2, -1}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="initialconditions">
<h3><a class="toc-backref" href="#id52" role="doc-backlink">InitialConditions</a><a class="headerlink" href="#initialconditions" title="Permalink to this heading"></a></h3>
<p>Initial condition specs are used in three places:</p>
<ul class="simple">
<li><p>In the <cite>“initial conditions</cite>” sublist of state, in which the value
of atomic constants are provided (not really initial conditions and
should be renamed).  These atomic values are not controlled by
evaluators, and are not included in the DaG.</p></li>
<li><p>Within the <a class="reference internal" href="#pk">PK</a> spec which describes the initial condition of primary variables (true
initial conditions).</p></li>
<li><p>In <a href="#id243"><span class="problematic" id="id244">`IndependentVariableEvaluator Constant &lt;Constant_&gt;`_</span></a></p></li>
</ul>
<p>The first may be of multiple types of data, while the latter two are
nearly always fields on a mesh (e.g. CompositeVectors).  The specific
available options for initializing various data in state differ by
data type.</p>
<div class="admonition-constants-scalar-spec admonition" id="constants-scalar-spec">
<p class="admonition-title">constants-scalar-spec</p>
<ul class="simple">
<li><p><cite>“value</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Value of a scalar constant</p></li>
</ul>
</div>
<div class="admonition-constants-dense-vector-spec admonition" id="constants-dense-vector-spec">
<p class="admonition-title">constants-dense-vector-spec</p>
<ul class="simple">
<li><p><cite>“value</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Value of a dense, local vector.</p></li>
</ul>
</div>
<div class="admonition-constants-point-spec admonition" id="constants-point-spec">
<p class="admonition-title">constants-point-spec</p>
<ul class="simple">
<li><p><cite>“value</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Array containing the values of the point.</p></li>
</ul>
</div>
<div class="admonition-constants-composite-vector-spec admonition" id="constants-composite-vector-spec">
<p class="admonition-title">constants-composite-vector-spec</p>
<ul class="simple">
<li><p><cite>“constant</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>optional</strong> Constant value.</p></li>
<li><p><cite>“value</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>optional</strong> Constant value, same as <cite>“constant</cite>” above.</p></li>
<li><p><cite>“function</cite>” <code class="docutils literal notranslate"><span class="pre">[composite-vector-function-spec-list]</span></code> <strong>optional</strong>
Initialize from a function, see <a class="reference internal" href="#compositevectorfunction">CompositeVectorFunction</a></p></li>
<li><p><cite>“restart file</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong> Path to a checkpoint file from
which to read the values.</p></li>
<li><p><cite>“cells from file</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong> Same as <cite>“restart file</cite>”,
but only reads the cell component.</p></li>
<li><p><cite>“exodus file initialization</cite>” <code class="docutils literal notranslate"><span class="pre">[exodus-file-initialization-spec]</span></code>
<strong>optional</strong> See <a class="reference internal" href="#exodus-file-initialization">Exodus File Initialization</a>.</p></li>
<li><p><cite>“initialize from 1D column</cite>” <code class="docutils literal notranslate"><span class="pre">[column-file-initialization-spec]</span></code>
<strong>optional</strong> See <a class="reference internal" href="#column-file-initialization">Column File Initialization</a>.</p></li>
</ul>
</div>
</section>
<section id="boundaryconditions">
<h3><a class="toc-backref" href="#id53" role="doc-backlink">BoundaryConditions</a><a class="headerlink" href="#boundaryconditions" title="Permalink to this heading"></a></h3>
<p>In general, boundary conditions are provided in a hierarchical list by
boundary condition type, then functional form.  Boundary condition specs are
split between two types – those which require a user-provided function
(i.e. Dirichlet data, etc) and those which do not (i.e. zero gradient
conditions).</p>
<p>A list of conditions might pull in both Dirichlet and Neumann data on
different regions, or use different functions on different regions.  The
following example illustrates how boundary conditions are prescribed across
the domain for a typical PK:</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;DIRICHLET_TYPE&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;DIRICHLET_FUNCTION_NAME&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;101325.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC east&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{east}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;DIRICHLET_FUNCTION_NAME&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;102325.&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;water flux&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC north&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{north}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;outward water flux&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;zero gradient&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC south&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{south}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Different PKs populate this general format with different names, replacing
DIRICHLET_TYPE and DIRICHLET_FUNCTION_NAME.</p>
<section id="flow-specific-boundary-conditions">
<h4>Flow-specific Boundary Conditions<a class="headerlink" href="#flow-specific-boundary-conditions" title="Permalink to this heading"></a></h4>
<p>Flow boundary conditions must follow the general format shown in
<a class="reference internal" href="#boundaryconditions">BoundaryConditions</a>.  Specific conditions implemented include:</p>
<section id="dirichlet-pressure-boundary-conditions">
<h5>Dirichlet (pressure) boundary conditions<a class="headerlink" href="#dirichlet-pressure-boundary-conditions" title="Permalink to this heading"></a></h5>
<p>Used for both surface and subsurface flows, this provides pressure data on
boundaries (in [Pa]).</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pressure&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary pressure&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;101325.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="dirichlet-head-boundary-conditions">
<h5>Dirichlet (head) boundary conditions<a class="headerlink" href="#dirichlet-head-boundary-conditions" title="Permalink to this heading"></a></h5>
<p>Used for both surface and subsurface flows, this provides head data (in [m]
above the land surface), typically as a function of x &amp; y.  In the subsurface
case, the z-value is given by hydrostatic relative to that head.</p>
<div class="math notranslate nohighlight">
\[p = p_{atm} + rho * g * (h(x,y) + z_{surf} - z)\]</div>
<p>where h is the head function provided.</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;head&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary head&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.01&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="dirichlet-fixed-level-boundary-conditions">
<h5>Dirichlet (fixed level) boundary conditions<a class="headerlink" href="#dirichlet-fixed-level-boundary-conditions" title="Permalink to this heading"></a></h5>
<p>This fixes the water table at a constant elevation.  It is a head condition
that adapts to the surface elevation, adjusting the head to a datum that is a
fixed absolute z coordinate.</p>
<div class="math notranslate nohighlight">
\[p = p_{atm} + rho * g * (h(x,y) - z)\]</div>
<p>where h is the head function provided.</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;fixed level&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;fixed level&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="neumann-water-flux-boundary-conditions">
<h5>Neumann (water flux) boundary conditions<a class="headerlink" href="#neumann-water-flux-boundary-conditions" title="Permalink to this heading"></a></h5>
<p>Used for both surface and subsurface flows, this provides water flux data (in [mol m^-2 s^-1], for the subsurface, or [mol m^-1 s^-1] for the surface, in the outward normal direction) on boundaries.</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;water flux&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;outward water flux&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;-1.e-3&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="neumann-fix-level-flux-boundary-conditions">
<h5>Neumann (fix level flux) boundary conditions<a class="headerlink" href="#neumann-fix-level-flux-boundary-conditions" title="Permalink to this heading"></a></h5>
<p>Used for surface only,  this provides fixed level ([m])  velocity data (in [m s^-1], in the outward normal direction on boundaries.</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;fixed level flux&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;river level south&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{river south}&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;fixed level&quot;</span><span class="nt">&gt;</span>
<span class="w">           </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
<span class="w">             </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.5&quot;</span><span class="nt">/&gt;</span>
<span class="w">           </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">        </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;velocity&quot;</span><span class="nt">&gt;</span>
<span class="w">           </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
<span class="w">             </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;2.5&quot;</span><span class="nt">/&gt;</span>
<span class="w">           </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">   </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="seepage-face-boundary-conditions">
<h5>Seepage face boundary conditions<a class="headerlink" href="#seepage-face-boundary-conditions" title="Permalink to this heading"></a></h5>
<p>A variety of seepage face boundary conditions are permitted for both surface
and subsurface flow PKs.  Typically seepage conditions are of the form:</p>
<blockquote>
<div><ul class="simple">
<li><p>if <span class="math notranslate nohighlight">\(q \cdot \hat{n} &lt; 0\)</span>, then <span class="math notranslate nohighlight">\(q = 0\)</span></p></li>
<li><p>if <span class="math notranslate nohighlight">\(p &gt; p0\)</span>, then <span class="math notranslate nohighlight">\(p = p0\)</span></p></li>
</ul>
</div></blockquote>
<p>This ensures that flow is only out of the domain, but that the max pressure on
the boundary is specified by <span class="math notranslate nohighlight">\(p0\)</span>.</p>
<p>Example: pressure (for surface or subsurface)</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;seepage face pressure&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary pressure&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;101325.&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Example: head (for surface)</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;seepage face head&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary head&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Additionally, an infiltration flux may be prescribed, which describes the max
flux.  This is for surface faces on which a typical precipitation rate might
be prescribed, to be enforced until the water table rises to the surface, at
which point the precip is turned off and water seeps into runoff.  This
capability is experimental and has not been well tested.</p>
<blockquote>
<div><ul class="simple">
<li><p>if <span class="math notranslate nohighlight">\(q \cdot \hat{n} &lt; q_0\)</span>, then <span class="math notranslate nohighlight">\(q = q_0\)</span></p></li>
<li><p>if <span class="math notranslate nohighlight">\(p &gt; p_{atm}\)</span>, then <span class="math notranslate nohighlight">\(p = p_{atm}\)</span></p></li>
</ul>
</div></blockquote>
<p>Note the condition also accepts a parameter:</p>
<ul class="simple">
<li><p><cite>“explicit time index</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, the _type_ of the BC is
evaluated at the old time, keeping it fixed while the nonlinear solve
iterates.</p></li>
</ul>
<p>Example: seepage with infiltration</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;seepage face with infiltration&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;explicit time index&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;bool&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;outward water flux&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;-1.e-5&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Note it would be straightforward to add both p0 and q0 in the same condition;
this has simply not had a use case yet.</p>
</section>
<section id="zero-head-gradient-boundary-conditions">
<h5>Zero head gradient boundary conditions<a class="headerlink" href="#zero-head-gradient-boundary-conditions" title="Permalink to this heading"></a></h5>
<p>Used for surface flows, this is an “outlet” boundary condition which looks to
enforce the condition that</p>
<div class="math notranslate nohighlight">
\[\div h \cdot \hat{n} = 0\]</div>
<p>for head <span class="math notranslate nohighlight">\(h\)</span> and outward normal <span class="math notranslate nohighlight">\(\hat{n}\)</span>.  Note that this is an
“outlet” boundary, in the sense that it should really not be used on a
boundary in which</p>
<div class="math notranslate nohighlight">
\[\div z \cdot \hat{n} &gt; 0.\]</div>
<p>This makes it a useful boundary condition for benchmark and 2D problems, where
the elevation gradient is clear, but not so useful for DEM-based meshes.</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;zero gradient&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="critical-depth-boundary-conditions">
<h5>Critical depth boundary conditions<a class="headerlink" href="#critical-depth-boundary-conditions" title="Permalink to this heading"></a></h5>
<p>Also for surface flows, this is an “outlet” boundary condition which looks to
set an outward flux to take away runoff.  This condition is given by:</p>
<div class="math notranslate nohighlight">
\[q = \sqrt{g \hat{z}} n_{liq} h^1.5\]</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;critical depth&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="dynamic-boundary-condutions">
<h5>Dynamic boundary condutions<a class="headerlink" href="#dynamic-boundary-condutions" title="Permalink to this heading"></a></h5>
<p>The type of boundary conditions maybe changed in time depending on the switch function of TIME.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dynamic&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{surface west}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;switch function&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-tabular&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;file&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;../data/floodplain2.h5&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;x header&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Time&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;y header&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Switch&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;form&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{constant}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;bcs&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;bc types&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{head, water flux}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;bc functions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{boundary head, outward water flux}&quot;</span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;water flux&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{surface west}&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;outward water flux&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-tabular&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;file&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;../data/floodplain2.h5&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;x header&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Time&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;y header&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Flux&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;form&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{linear}&quot;</span><span class="nt">/&gt;</span>
<span class="w">          </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">         </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">       </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>

<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;head&quot;</span><span class="nt">&gt;</span>
<span class="w">       </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
<span class="w">         </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{surface west}&quot;</span><span class="nt">/&gt;</span>
<span class="w">         </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary head&quot;</span><span class="nt">&gt;</span>
<span class="w">           </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-tabular&quot;</span><span class="nt">&gt;</span>
<span class="w">              </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;file&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;../data/floodplain2.h5&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">              </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;x header&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Time&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">              </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;y header&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Head&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">              </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;form&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{linear}&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">         </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">       </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">     </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>

<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="transport-specific-boundary-conditions">
<h4>Transport-specific Boundary Conditions<a class="headerlink" href="#transport-specific-boundary-conditions" title="Permalink to this heading"></a></h4>
</section>
<section id="energy-specific-boundary-conditions">
<h4>Energy-specific Boundary Conditions<a class="headerlink" href="#energy-specific-boundary-conditions" title="Permalink to this heading"></a></h4>
<p>Energy boundary conditions must follow the general format shown in
<a class="reference internal" href="#boundaryconditions">BoundaryConditions</a>.  Energy-specific conditions implemented include:</p>
<section id="dirichlet-temperature-boundary-conditions">
<h5>Dirichlet (temperature) boundary conditions<a class="headerlink" href="#dirichlet-temperature-boundary-conditions" title="Permalink to this heading"></a></h5>
<p>Provide temperature data in units of [K].</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;temperature&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary temperature&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;276.15.&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="neumann-diffusive-energy-flux-boundary-conditions">
<h5>Neumann (diffusive energy flux) boundary conditions<a class="headerlink" href="#neumann-diffusive-energy-flux-boundary-conditions" title="Permalink to this heading"></a></h5>
<p>Note that for an energy equation, there are two mechanisms by which energy can
be fluxed into the domain: through diffusion and through advection.  This
boundary condition sets the diffusive flux of energy, and allows the advective
flux to be whatever it may be.  Frequently this is used in combination with
boundaries where water is expected to be advected out of the domain, and we
wish to allow the energy of that water to be advected away with it, but wish to
independently specify diffusive fluxes.  This can also be used in cases where
the mass flux is prescribed to be zero (e.g. bottom boundaries, where this
might be the geothermal gradient).</p>
<p>Units are in <strong>[MW m^-2]</strong>, noting the deviation from SI units!</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;diffusive flux&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;outward diffusive flux&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Note that another commonly implemented boundary condition is one where the
diffusive flux is prescribed, and also the temperature of incoming water is
prescribed.  This is not currently implemented, but would be straightforward to
do so if requested.</p>
</section>
<section id="neumann-total-energy-flux-boundary-conditions">
<h5>Neumann (total energy flux) boundary conditions<a class="headerlink" href="#neumann-total-energy-flux-boundary-conditions" title="Permalink to this heading"></a></h5>
<p>This boundary condition sets the total flux of energy, from both advection and
diffusion.  This is not used all that often in real applications, but is common
for benchmarks or other testing.</p>
<p>Units are in <strong>[MW m^-2]</strong>, noting the deviation from SI units!</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;enthalpy flux&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;outward enthalpy flux&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>
<section id="time-integrators-solvers-and-other-mathematical-specs">
<h2><a class="toc-backref" href="#id54" role="doc-backlink">Time integrators, solvers, and other mathematical specs</a><a class="headerlink" href="#time-integrators-solvers-and-other-mathematical-specs" title="Permalink to this heading"></a></h2>
<blockquote>
<div><p>Common specs for all solvers and time integrators, used in PKs.</p>
</div></blockquote>
<p>There are three commonly used broad classes of time integration
strategies.</p>
<p>“Update” methods are the simplest – they use no formal
mathematical definition of a differential equation, but instead
implicitly use a process by which variables at the new time are
directly calculated.  Typically there <em>is</em> an implied ODE or PDE here,
but it is not stated as such and time integration routines are not
used.  Examples of these are common in biogeochemistry and vegetation
models.</p>
<p>“Explicit” time methods are the next simplest.  These include a
variety of options from forward Euler to higher order Runge-Kutta
schemes.  These only require evaluating forward models where we have
existing of the dependencies.  If they work, these are great thanks to
their deterministic nature and lack of expensive, memory-bandwith
limited solvers.  But they only work on some types of problems.
Examples of of these include transport, where we use high order time
integration schemes to preserve fronts.</p>
<p>“Implicit” and semi-implicit methods instead require the evaluation of
a residual equation – the solution is guessed at, and the residual is
calculated, which measures how far the equation is from being
satisfied.  This measure is then inverted, finding a correction to the
guess which hopefully reduces the residual.  As the residual goes to
zero, the error, a measure of the difference between the guess and the
true solution, also goes to zero.  To do this inversion, we lean on
Newton and Newton-like methods, which attempt to somehow linearize, or
approximately linearize, the residual function near the guess in order
to calculate an update.  In this case, the time integration scheme
requires both a nonlinear solver (to drive the residual to zero) and a
linear solver or approximate solver (to calculate the correction).</p>
<section id="timeintegrator">
<h3><a class="toc-backref" href="#id55" role="doc-backlink">TimeIntegrator</a><a class="headerlink" href="#timeintegrator" title="Permalink to this heading"></a></h3>
<p>Currently there are two classes of time integration schemes used in
ATS: explicit (including a range of single and multi-stage) methods
and BDF1, or Backward Euler.</p>
<section id="explicit-time-integration">
<h4>Explicit Time Integration<a class="headerlink" href="#explicit-time-integration" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Explicit time integration methods in a generalized form.</p>
</div></blockquote>
<p>This class implements several explicit Runge Kutta methods:</p>
<ul class="simple">
<li><p>forward Euler     (1st order)  –&gt; “forward_euler”</p></li>
<li><p>Heun-Euler method (2nd order)  –&gt; “heun_euler”</p></li>
<li><p>Midpoint method   (2nd order)  –&gt; “midpoint”</p></li>
<li><p>Ralston method    (2nd order)  –&gt; “ralston”</p></li>
<li><p>TVD RK method     (3rd order)  –&gt; “tvd_3rd_order”</p></li>
<li><p>Kutta method      (3rd order)  –&gt; “kutta_3rd_order”</p></li>
<li><p>Runge Kutta       (4th order)  –&gt; “runge_kutta_4th_order”</p></li>
<li><p>User defined      (whatever)   –&gt; user_defined, use special constructor to create</p></li>
</ul>
<p>Note that user-defined is only for developers currently, and cannot be created from an input file.</p>
<p>The RK tableau is made up of the three private objects a, b, and c below.  they
are arranged as follows:</p>
<p>Note that c[0] should always equal zero, and that the entries in the matrix a
that are not listed in this tableau are not used</p>
<p>The implemented general Runge Kutta scheme of order s based on this tableau arrangement is</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}y_{n+1} = y_n + \sum{i=0}^{s-1} b[i]*k_i\\with\\\begin{split}  k_0 = h * f(t_n, y_n) \\
  k_1 = h * f(t_n + c[1]*h, y_n + a(1,0)*k_0) \\
  k_2 = h * f(t_n + c[2]*h, y_n + a(2,0)*k_0 + a(2,1)*k_1) \\
   . \\
   . \\
   . \\
  k_{s-1} = h * f(t_n + c[s-1]*h, y_n + a(s-1,0)*k_0 + ... + a(s-1,s-2)*k_{s-2})\end{split}\end{aligned}\end{align} \]</div>
<div class="admonition-explicit-ti-rk-spec admonition" id="explicit-ti-rk-spec">
<p class="admonition-title">explicit-ti-rk-spec</p>
<ul class="simple">
<li><p><cite>“verbose object</cite>” <code class="docutils literal notranslate"><span class="pre">[verbose-object-spec]</span></code> A <a class="reference internal" href="#verbose-object">Verbose Object</a></p></li>
<li><p><cite>“RK method</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>forward euler</strong>  One of: <cite>“forward Euler</cite>”, <cite>“heun euler</cite>”, <cite>“midpoint</cite>”, <cite>“ralston</cite>”, <cite>“tvd 3rd order</cite>”, <cite>“kutta 3rd order</cite>”, <cite>“runge kutta 4th order</cite>”</p></li>
</ul>
</div>
</section>
<section id="backward-euler">
<h4>Backward Euler<a class="headerlink" href="#backward-euler" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Solves globally implicit systems using backward Euler</p>
</div></blockquote>
<p>Backward Euler is the simplest of the implicit methods.  It solves time
integration schemes by evaluating all time derivatives at the new time.  This
makes it unconditionally stable, though potentially not very accurate.  This
unconditional stability tends to make it the workhorse of the types of stiff,
nonlinear parabolic equations such as Richards equation and the diffusion wave
approximation.</p>
<p>In this method, we look to solve:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \mathbf{u}}{\partial t} = f(\mathbf{u},\mathbf{x},t)\]</div>
<p>via the time discretization scheme:</p>
<div class="math notranslate nohighlight">
\[\frac{\mathbf{u}^{t + \Delta t} - \mathbf{u}^{t}}{\Delta t} = f(\mathbf{u}^{t + \Delta t}, \mathbf{x}, t + \Delta t)\]</div>
<div class="admonition-bdf1-ti-spec admonition" id="bdf1-ti-spec">
<p class="admonition-title">bdf1-ti-spec</p>
<ul class="simple">
<li><p><cite>“verbose object</cite>” <code class="docutils literal notranslate"><span class="pre">[verbose-object-spec]</span></code> A <a class="reference internal" href="#verbose-object">Verbose Object</a></p></li>
<li><p><cite>“residual debugger</cite>” <code class="docutils literal notranslate"><span class="pre">[residual-debugger-spec]</span></code> A <a class="reference internal" href="#residual-debugger">Residual Debugger</a> object.</p></li>
<li><p><cite>“max preconditioner lag iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> specifies frequency
of preconditioner recalculation.</p></li>
<li><p><cite>“freeze preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> enforces preconditioner to
be updated only once per non-linear solver. When set to true, the above
parameter is ignored.</p></li>
<li><p><cite>“extrapolate initial guess</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> identifies forward time
extrapolation of the initial guess.</p></li>
<li><p><cite>“nonlinear iteration initial guess extrapolation order</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1</strong>
defines extrapolation algorithm. Zero value implies no extrapolation.</p></li>
<li><p><cite>“restart tolerance relaxation factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1</strong> Changes the
nonlinear tolerance on restart. The time integrator is usually restarted
when a boundary condition changes drastically. It may be beneficial to
loosen the nonlinear tolerance on the first several time steps after the
time integrator restart. The default value is 1, while a reasonable value
may be as large as 1000.</p></li>
<li><p><cite>“restart tolerance relaxation factor damping</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1</strong>
Controls how fast the loosened nonlinear tolerance will revert back to
the one specified in <cite>“nonlinear tolerance</cite>”. If the nonlinear tolerance
is “tol”, the relaxation factor is “factor”, and the damping is “d”, and
the time step count is “n” then the actual nonlinear tolerance is “tol *
max(1.0, factor * d ** n)”. Reasonable values are between 0 and 1.</p></li>
</ul>
<p>INCLUDES
- <code class="docutils literal notranslate"><span class="pre">[solver-typed-spec]</span></code> <em>Uses a</em> <a class="reference internal" href="#solver">Solver</a>.
- <code class="docutils literal notranslate"><span class="pre">[timestep-controller-typed-spec]</span></code> <em>Uses a</em> <a class="reference internal" href="#timestep-controller">Timestep Controller</a></p>
</div>
<p>Note this also accepts an object that provides the <a class="reference internal" href="#bdf1-solver-interface">BDF1 Solver Interface</a>.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;time integrator&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;time integration method&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;BDF1&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BDF1&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;max preconditioner lag iterations&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;5&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;freeze preconditioner&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;bool&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;extrapolate initial guess&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;bool&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nonlinear iteration initial guess extrapolation order&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;restart tolerance relaxation factor&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;restart tolerance relaxation factor damping&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;timestep controller type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;standard&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;timestep controller standard parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span>...
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>

<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;solver type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;nka&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nka parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span>...
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<section id="bdf1-solver-interface">
<h5>BDF1 Solver Interface<a class="headerlink" href="#bdf1-solver-interface" title="Permalink to this heading"></a></h5>
</section>
</section>
<section id="timestep-controller">
<h4>Timestep Controller<a class="headerlink" href="#timestep-controller" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Factory for creating TimestepController objects</p>
</div></blockquote>
<p>A TimestepController object sets what size timestep to take.  This can be a
variety of things, from fixed timestep size, to adaptive based upon error
control, to adapter based upon simple nonlinear iteration counts.</p>
<p>Available types include:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#timestep-controller-fixed">Timestep Controller Fixed</a>  (type <cite>“fixed</cite>”), a constant timestep</p></li>
<li><p><a class="reference internal" href="#timestep-controller-standard">Timestep Controller Standard</a> (type <cite>‘standard</cite>”), an adaptive timestep based upon nonlinear iterations</p></li>
<li><p><a class="reference internal" href="#timestep-controller-smarter">Timestep Controller Smarter</a> (type <cite>‘smarter</cite>”), an adaptive timestep based upon nonlinear iterations with more control</p></li>
<li><p><a class="reference internal" href="#timestep-controller-adaptive">Timestep Controller Adaptive</a> (type <cite>“adaptive</cite>”), an adaptive timestep based upon error control.</p></li>
<li><p><a class="reference internal" href="#timestep-controller-from-file">Timestep Controller From File</a> (type <cite>“from file</cite>”), uses a timestep history loaded from an HDF5 file.  (Usually only used for regression testing.)</p></li>
</ul>
<div class="admonition-timestep-controller-typed-spec admonition" id="timestep-controller-typed-spec">
<p class="admonition-title">timestep-controller-typed-spec</p>
<ul class="simple">
<li><p><cite>“timestep controller type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Set the type.  One of: <cite>“fixed</cite>”, <cite>“standard</cite>”, <cite>“smarter</cite>”, <cite>“adaptive</cite>”, or <cite>“from file</cite>”</p></li>
<li><p><cite>“timestep controller X parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> List of parameters for a timestep controller of type X.</p></li>
</ul>
</div>
<section id="timestep-controller-fixed">
<h5>Timestep Controller Fixed<a class="headerlink" href="#timestep-controller-fixed" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Timestep controller providing constant timestep size.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">TimestepControllerFixed</span></code> is a simple timestep control mechanism which sets
a constant timestep size.  Note that the actual timestep size is given by the
minimum of PK’s initial timestep sizes.</p>
<p>No parameters are required.</p>
</section>
<section id="timestep-controller-standard">
<h5>Timestep Controller Standard<a class="headerlink" href="#timestep-controller-standard" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Simple timestep control based upon previous iteration count.</p>
</div></blockquote>
<p>This is a simple timestep control mechanism
which sets the next timestep based upon the previous timestep and how many
nonlinear iterations the previous timestep took to converge.</p>
<p>The timestep for step <span class="math notranslate nohighlight">\(k+1\)</span>, <span class="math notranslate nohighlight">\(\Delta t_{k+1}\)</span>, is given by:</p>
<ul class="simple">
<li><p>if <span class="math notranslate nohighlight">\(N_k &gt; N^{max}\)</span> then <span class="math notranslate nohighlight">\(\Delta t_{k+1} = f_{reduction} * \Delta t_{k}\)</span></p></li>
<li><p>if <span class="math notranslate nohighlight">\(N_k &lt; N^{min}\)</span> then <span class="math notranslate nohighlight">\(\Delta t_{k+1} = f_{increase} * \Delta t_{k}\)</span></p></li>
<li><p>otherwise <span class="math notranslate nohighlight">\(\Delta t_{k+1} = \Delta t_{k}\)</span></p></li>
</ul>
<p>where <span class="math notranslate nohighlight">\(\Delta t_{k}\)</span> is the previous timestep and <span class="math notranslate nohighlight">\(N_k\)</span> is the number of
nonlinear iterations required to solve step <span class="math notranslate nohighlight">\(k\)</span>:.</p>
<div class="admonition-timestep-controller-standard-spec admonition" id="timestep-controller-standard-spec">
<p class="admonition-title">timestep-controller-standard-spec</p>
<ul class="simple">
<li><p><cite>“max iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <span class="math notranslate nohighlight">\(N^{max}\)</span>, decrease the timestep if the previous step took more than this.</p></li>
<li><p><cite>“min iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <span class="math notranslate nohighlight">\(N^{min}\)</span>, increase the timestep if the previous step took less than this.</p></li>
<li><p><cite>“time step reduction factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <span class="math notranslate nohighlight">\(f_{reduction}\)</span>, reduce the previous timestep by this multiple.</p></li>
<li><p><cite>“time step increase factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <span class="math notranslate nohighlight">\(f_{increase}\)</span>, increase the previous timestep by this multiple.</p></li>
<li><p><cite>“max time step</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> The max timestep size allowed.</p></li>
<li><p><cite>“min time step</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> The min timestep size allowed.  If the step has failed and the new step is below this cutoff, the simulation fails.</p></li>
</ul>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BDF1&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- parent list --&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;timestep controller type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;standard&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;timestep controller standard parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;min iterations&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;10&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;max iterations&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;15&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;time step increase factor&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.2&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;time step reduction factor&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.5&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;max time step&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1e+9&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;min time step&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>In this example, the time step is increased by factor 1.2 when the nonlinear
solver converges in 10 or less iterations.
The time step is not changed when the number of nonlinear iterations is
between 11 and 15.
The time step will be cut twice if the number of nonlinear iterations exceeds 15.</p>
</section>
<section id="timestep-controller-smarter">
<h5>Timestep Controller Smarter<a class="headerlink" href="#timestep-controller-smarter" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Slightly smarter timestep controller based upon a history of previous timesteps.</p>
</div></blockquote>
<p>This is based on <a class="reference internal" href="#timestep-controller-standard">Timestep Controller Standard</a>, but also tries to be a bit
smarter to avoid repeated increase/decrease loops where the step size
decreases, converges in few iterations, increases, but then fails again.  It
also tries to grow the step geometrically to more quickly recover from tricky
nonlinearities.</p>
<div class="admonition-timestep-controller-smarter-spec admonition" id="timestep-controller-smarter-spec">
<p class="admonition-title">timestep-controller-smarter-spec</p>
<ul class="simple">
<li><p><cite>“max iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <span class="math notranslate nohighlight">\(N^{max}\)</span>, decrease the timestep if the previous step took more than this.</p></li>
<li><p><cite>“min iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <span class="math notranslate nohighlight">\(N^{min}\)</span>, increase the timestep if the previous step took less than this.</p></li>
<li><p><cite>“time step reduction factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <span class="math notranslate nohighlight">\(f_{reduction}\)</span>, reduce the previous timestep by this multiple.</p></li>
<li><p><cite>“time step increase factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <span class="math notranslate nohighlight">\(f_{increase}\)</span>, increase the previous timestep by this multiple.  Note that this can be modified geometrically in the case of repeated successful steps.</p></li>
<li><p><cite>“max time step increase factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>10.</strong> The max <span class="math notranslate nohighlight">\(f_{increase}\)</span> will ever get.</p></li>
<li><p><cite>“growth wait after fail</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> Wait at least this many timesteps before attempting to grow the timestep after a failed timestep.</p></li>
<li><p><cite>“count before increasing increase factor</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> Require this many successive increasions before multiplying <span class="math notranslate nohighlight">\(f_{increase}\)</span> by itself.</p></li>
</ul>
</div>
</section>
<section id="timestep-controller-adaptive">
<h5>Timestep Controller Adaptive<a class="headerlink" href="#timestep-controller-adaptive" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Adaptive timestep control based upon previous iteration count.</p>
</div></blockquote>
<p>This is under development and is based on a posteriori error estimates.</p>
</section>
<section id="timestep-controller-from-file">
<h5>Timestep Controller From File<a class="headerlink" href="#timestep-controller-from-file" title="Permalink to this heading"></a></h5>
<blockquote>
<div><p>Timestep controller which loads a timestep history from file.</p>
</div></blockquote>
<p>This loads a timestep history from a file, then advances the step size with
those values.  This is mostly used for testing purposes, where we need to force
the same timestep history as previous runs to do regression testing.  Otherwise
even machine roundoff can eventually alter number of iterations enough to alter
the timestep history, resulting in solutions which are enough different to
cause doubt over their correctness.</p>
<div class="admonition-timestep-controller-from-file-spec admonition" id="timestep-controller-from-file-spec">
<p class="admonition-title">timestep-controller-from-file-spec</p>
<ul class="simple">
<li><p><cite>“file name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Path to hdf5 file containing timestep information.</p></li>
<li><p><cite>“timestep header</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Name of the dataset containing the history of timestep sizes.</p></li>
</ul>
</div>
</section>
</section>
</section>
<section id="nonlinear-solver">
<h3><a class="toc-backref" href="#id56" role="doc-backlink">Nonlinear Solver</a><a class="headerlink" href="#nonlinear-solver" title="Permalink to this heading"></a></h3>
<blockquote id="solver">
<div><p>A factory for creating nonlinear solvers.</p>
</div></blockquote>
<p>Nonlinear solvers are used within implicit time integration schemes to drive
the residual to zero and thereby solve for the primary variable at the new
time.</p>
<div class="admonition-solver-typed-spec admonition" id="solver-typed-spec">
<p class="admonition-title">solver-typed-spec</p>
<ul class="simple">
<li><p><cite>“solver type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Type of the solver.  One of:</p>
<ul>
<li><p><cite>“Newton</cite>” See <a class="reference internal" href="#solver-newton-and-inexact-newton">Solver: Newton and Inexact Newton</a></p></li>
<li><p><cite>“JFNK</cite>” See <a class="reference internal" href="#solver-jacobian-free-newton-krylov">Solver: Jacobian-Free Newton Krylov</a></p></li>
<li><p><cite>“line search</cite>” See <a class="reference internal" href="#solver-newton-with-line-search">Solver: Newton with Line Search</a></p></li>
<li><p><cite>“continuation</cite>” See <a class="reference internal" href="#solver-nonlinear-continuation">Solver: Nonlinear Continuation</a></p></li>
<li><p><cite>“nka</cite>” See <a class="reference internal" href="#solver-nonlinear-krylov-acceleration">Solver: Nonlinear Krylov Acceleration</a></p></li>
<li><p><cite>“aa</cite>” See <a class="reference internal" href="#solver-anderson-acceleration">Solver: Anderson Acceleration</a></p></li>
<li><p><cite>“nka line search</cite>” See <cite>Solver: NKA with Line Search</cite>”</p></li>
<li><p><cite>“nka_ls_ats</cite>” See <a class="reference internal" href="#solver-nka-with-line-search-ats">Solver: NKA with Line Search, ATS</a></p></li>
<li><p><cite>“nka_bt_ats</cite>” See <a class="reference internal" href="#solver-nka-with-backtracking-ats">Solver: NKA with backtracking, ATS</a></p></li>
<li><p><cite>“nox</cite>” See <a class="reference internal" href="#solver-nox">Solver: NOX</a></p></li>
</ul>
</li>
<li><p><cite>“_solver_type_ parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[_solver_type_-spec]</span></code> A sublist containing
parameters specific to the type.</p></li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><cite>“JFNK</cite>”, <cite>“line search</cite>”, and <cite>“continuation</cite>” methods have not been
beaten on as much as other methods.  <cite>“nka_ls_ats</cite>” is somewhat deprecated
and probably shouldn’t be used.  Prefer <cite>“nka</cite>” for simple problems,
<cite>“nka_bt_ats</cite>” for freeze-thaw problems or other problems with strong
nonlinearities, and <cite>“Newton</cite>” when you have a good Jacobian.  While
<cite>“nox</cite>” hasn’t been used extensively, it may be quite useful.</p>
</div>
<section id="solver-newton-and-inexact-newton">
<h4>Solver: Newton and Inexact Newton<a class="headerlink" href="#solver-newton-and-inexact-newton" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Straightforward Newton/Inexact Newton solver.</p>
</div></blockquote>
<p>The classical Newton method works well for cases where Jacobian is available
and corresponds to a stable (e.g. upwind) discretization.  The inexact Newton
methods work for cases where the discrete Jacobian is either not available, or
not stable, or computationally expensive. The discrete Jacobian is replaced by
a stable approximation of the continuum Jacobian. The choice between exact and
inexact is not made by the Solver, but instead by the PK.  Both use the
ApplyPreconditioner() method – if this applies the true Jacobian, then the
method is Newton.  If it applies an appoximation, it is inexact Newton.</p>
<div class="admonition-solver-newton-spec admonition" id="solver-newton-spec">
<p class="admonition-title">solver-newton-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“monitor</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>monitor update</strong> specifies control of the
nonlinear residual. The available options are <cite>“monitor update</cite>” and
<cite>“monitor residual</cite>”.</p></li>
<li><p><cite>“limit iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>50</strong> defines the maximum allowed number
of iterations.</p></li>
<li><p><cite>“diverged tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> defines the error level
indicating divergence of the solver. The error is calculated by a PK.</p></li>
<li><p><cite>“max du growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e5</strong> allows the solver to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment changes drastically on two consecutive iterations,
the solver is terminated.</p></li>
<li><p><cite>“max error growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e5</strong> defines another way to
identify divergence pattern on earlier iterations. If the PK-specific
error changes drastically on two consecutive iterations, the solver is
terminated.</p></li>
<li><p><cite>“max divergent iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>3</strong> defines another way to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment grows on too many consecutive iterations, the
solver is terminated.</p></li>
<li><p><cite>“modify correction</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> allows a PK to modify the
solution increment. One example is a physics-based clipping of extreme
solution values.</p></li>
<li><p><cite>“stagnation iteration check</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>8</strong> determines the number of
iterations before the stagnation check is turned on. The stagnation
happens when the current l2-error exceeds the initial l2-error.</p></li>
</ul>
</div>
</section>
<section id="solver-jacobian-free-newton-krylov">
<h4>Solver: Jacobian-Free Newton Krylov<a class="headerlink" href="#solver-jacobian-free-newton-krylov" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Decorator for using a Solver with JFNK as the preconditioner.</p>
</div></blockquote>
<p>Jacobian-Free Newton Krylov uses a finite difference scheme to approximate the
action of the Jacobian matrix, then uses a Krylov method (which only needs the
action of the Jacobian and not the Jacobian itself) to calculate the action of
the inverse of the Jacobian, thereby providing a Newton-like update.  As the
linear Krylov scheme converges to the inverse action, the nonlinear solution
converges to the same solution as a true Newton method.</p>
<p>This implementation simply replaces a SolverFnBase’s ApplyPreconditioner() with
a new ApplyPreconditioner() which uses the Krylov method with the action of the
forward operator to (hopefully) improve, relative to the supplied approximate
inverse, the estimate of the inverse.</p>
<div class="admonition-solver-jfnk-spec admonition" id="solver-jfnk-spec">
<p class="admonition-title">solver-jfnk-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear solver</cite>” <code class="docutils literal notranslate"><span class="pre">[solver-typed-spec]</span></code> The outer nonlinear solver to use.</p></li>
<li><p><cite>“inverse</cite>” <code class="docutils literal notranslate"><span class="pre">[inverse-typed-spec]</span></code> The Krylov method to use.</p></li>
<li><p><cite>“JF matrix parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[jf-matrix-spec]</span></code> See <a class="reference internal" href="#jf-matrix-spec">jf-matrix-spec</a></p></li>
</ul>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;solver type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;JFNK&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;JFNK parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;typical solution value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;JF matrix parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;finite difference epsilon&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0e-8&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;method for epsilon&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Knoll-Keyes L2&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nonlinear solver&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nonlinear tolerance&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0e-05&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;diverged tolerance&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0e+10&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;limit iterations&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;20&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;max divergent iterations&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;linear operator&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;iterative method&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;gmres&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gmres parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span>...
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>The Jacobian-Free Matrix operator, which is used to estimate the action of the
Jacobian.</p>
<p>A variety of methods are available for choosing the epsilon used to approximate
the action of the Jacobian.  They are documented in Knoll &amp; Keyes 2004 paper.</p>
<p>..todo:: Document these</p>
<div class="admonition-jf-matrix-spec admonition" id="jf-matrix-spec">
<p class="admonition-title">jf-matrix-spec</p>
<ul class="simple">
<li><p><cite>“typical solution value</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>100</strong> Used in relative action
approximations. OPTION NOT IMPLEMENTED</p></li>
<li><p><cite>“finite difference epsilon</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-8</strong> defines the base finite
difference epsilon.</p></li>
<li><p><cite>“method for epsilon</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> defines a method for calculating finite
difference epsilon. Available option is “Knoll-Keyes”, “Knoll-Keyes L2”,
“Brown-Saad”.  See Knoll</p></li>
</ul>
</div>
</section>
<section id="solver-newton-with-line-search">
<h4>Solver: Newton with Line Search<a class="headerlink" href="#solver-newton-with-line-search" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Backtracking line search on the provided correction as a solver.</p>
</div></blockquote>
<p>Line Search accepts a correction from the Jacobian, then uses a
process to attempt to minimize or at least ensure a reduction in the residual
while searching <em>in that direction</em>, but not necessarily with the same
magnitude, as the provided correction.  The scalar multiple of the search
direction is given by <span class="math notranslate nohighlight">\(\alpha\)</span>.</p>
<p>This globalization recognizes that a true inverse Jacobian is a local
measurement of the steepest descent direction, and so while the direction is
guaranteed to be the direction which best reduces the residual, it may not
provide the correct magnitude.</p>
<p>Note, this always monitors the residual.</p>
<div class="admonition-solver-backtracking-spec admonition" id="solver-backtracking-spec">
<p class="admonition-title">solver-backtracking-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“limit iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>50</strong> defines the maximum allowed number
of iterations.</p></li>
<li><p><cite>“diverged tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> defines the error level
indicating divergence of the solver. The error is calculated by a PK.
Set to a negative value to ignore this check.</p></li>
<li><p><cite>“max error growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e5</strong> defines another way to
identify divergence pattern on earlier iterations. If the PK-specific
error changes drastically on two consecutive iterations, the solver is
terminated.</p></li>
<li><p><cite>“modify correction</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> allows a PK to modify the
solution increment. One example is a physics-based clipping of extreme
solution values.</p></li>
<li><p><cite>“accuracy of line search minimum [bits]</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong></p></li>
<li><p><cite>“min valid alpha</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0</strong></p></li>
<li><p><cite>“max valid alpha</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>10.</strong></p></li>
<li><p><cite>“max line search iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong></p></li>
</ul>
</div>
</section>
<section id="solver-nonlinear-continuation">
<h4>Solver: Nonlinear Continuation<a class="headerlink" href="#solver-nonlinear-continuation" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>A very simple nonlinear continuation method.</p>
</div></blockquote>
<p>Continuation methods are useful when the nonlinearity can be controlled by a
single simple parameter.  In this method, the nonlinear problem is solved with
a less-nonlinear value of the parameter, and the solution of that is used as
the initial guess to solve a harder problem.  As each successive problem is
solved, the continuation parameter is changed closer and closer to the true
value.</p>
<p>Few if any PKs support this method currently – it requires the PK to provide more
interface about how to update the continuation parameter.</p>
<div class="admonition-solver-continuation-spec admonition" id="solver-continuation-spec">
<p class="admonition-title">solver-continuation-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“number of continuation steps</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>5</strong> How many steps to take
from initial parameter to final parameter.</p></li>
<li><p><cite>“inner solver</cite>” <code class="docutils literal notranslate"><span class="pre">[solver-typed-spec]</span></code> A <a class="reference internal" href="#solver">Solver</a>, used at each step.</p></li>
</ul>
</div>
</section>
<section id="solver-nonlinear-krylov-acceleration">
<h4>Solver: Nonlinear Krylov Acceleration<a class="headerlink" href="#solver-nonlinear-krylov-acceleration" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Nonlinear Krylov Acceleration as a nonlinear solver.</p>
</div></blockquote>
<p>Uses the Nonlinear Krylov acceleration method of Carlson and Miller to do
effectively a multivariant secant method, accelerating the solution of a
nonlinear solve.  This method can be significantly faster than Newton,
especially with an approximate Jacobian.</p>
<blockquote>
<div><p>Calef et al. “Nonlinear Krylov acceleration applied to a discrete ordinates
formulation of the k-eigenvalue problem.” JCP 238 (2013): 188-209.</p>
<p>N. N. Carlson, K. Miller, Design and application of a gradient-weighted
moving finite element code II: In two dimensions, SIAM J. Sci.  Comput. 19
(3) (1998) 766–798.</p>
</div></blockquote>
<div class="admonition-solver-nka-spec admonition" id="solver-nka-spec">
<p class="admonition-title">solver-nka-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> Defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“monitor</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>monitor update</strong> Specifies control of the
nonlinear residual. The available options are <cite>“monitor update</cite>”,
<cite>“monitor residual</cite>”, <cite>“monitor preconditioned residual</cite>”, <cite>“monitor l2
residual</cite>”, and <cite>“monitor preconditioned l2 residual</cite>”.</p></li>
<li><p><cite>“limit iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>20</strong> Defines the maximum allowed number
of iterations.</p></li>
<li><p><cite>“diverged tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> Defines the error level
indicating divergence of the solver. The error is calculated by a PK.
Set to a negative value to ignore this check.</p></li>
<li><p><cite>“diverged l2 tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> Defines another way to
identify divergence of the solver. If the relative l2 (little l) norm of
the solution increment is above this value, the solver is terminated.
Set to a negative value to ignore this check.</p></li>
<li><p><cite>“diverged pc tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e10</strong> Defines another way to
identify divergence of the solver. If the relative maximum norm of the
solution increment (with respect to the initial increment) is above this
value, the solver is terminated.
Set to a negative value to ignore this check.</p></li>
<li><p><cite>“diverged residual tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e10</strong> Defines another way
to identify divergence of the solver. If the relative l2 norm of the
residual (with respect to the initial residual) is above this value, the
solver is terminated.  Set to a negative value to ignore this check.</p></li>
<li><p><cite>“max du growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e5</strong> Allows the solver to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment changes drastically on two consecutive iterations,
the solver is terminated.</p></li>
<li><p><cite>“max error growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e5</strong> Defines another way to
identify divergence pattern on earlier iterations. If the PK-specific
error changes drastically on two consecutive iterations, the solver is
terminated.</p></li>
<li><p><cite>“max divergent iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>3</strong> Defines another way to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment grows on too many consecutive iterations, the
solver is terminated.</p></li>
<li><p><cite>“modify correction</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Allows a PK to modify the
solution increment. One example is a physics-based clipping of extreme
solution values.</p></li>
<li><p><cite>“lag iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Delays the NKA acceleration, but
updates the Krylov space.</p></li>
<li><p><cite>“max nka vectors</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong> Defines the maximum number of
consecutive vectors used for a local space.</p></li>
<li><p><cite>“nka vector tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.05</strong> Defines the minimum
allowed orthogonality between vectors in the local space. If a new vector
does not satisfy this requirement, the space is modified.</p></li>
</ul>
</div>
</section>
<section id="solver-anderson-acceleration">
<h4>Solver: Anderson Acceleration<a class="headerlink" href="#solver-anderson-acceleration" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Anderson acceleration as a nonlinear solver.</p>
</div></blockquote>
<p>This is a variation of the GMRES solver for nonlinear problems.</p>
<div class="admonition-solver-aa-spec admonition" id="solver-aa-spec">
<p class="admonition-title">solver-aa-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> Defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“limit iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>20</strong> Defines the maximum allowed number
of iterations.</p></li>
<li><p><cite>“diverged tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> Defines the error level
indicating divergence of the solver. The error is calculated by a PK.
Set to a negative value to ignore this check.</p></li>
<li><p><cite>“diverged l2 tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> Defines another way to
identify divergence of the solver. If the relative L2 norm of the
solution increment is above this value, the solver is terminated.
Set to a negative value to ignore this check.</p></li>
<li><p><cite>“max du growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e5</strong> Allows the solver to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment changes drastically on two consecutive iterations,
the solver is terminated.</p></li>
<li><p><cite>“max divergent iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>3</strong> Defines another way to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment grows on too many consecutive iterations, the
solver is terminated.</p></li>
<li><p><cite>“max aa vectors</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong> Defines the maximum number of
consecutive vectors used for a local space.</p></li>
<li><p><cite>“modify correction</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Allows a PK to modify the
solution increment. One example is a physics-based clipping of extreme
solution values.</p></li>
<li><p><cite>“relaxation parameter</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1</strong> Damping factor for increment.</p></li>
</ul>
</div>
</section>
<section id="solver-nka-with-line-search">
<h4>Solver: NKA with Line Search<a class="headerlink" href="#solver-nka-with-line-search" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>NKA nonlinear solver with a line-search based on a Brendt minimization algorithm.</p>
</div></blockquote>
<p>Does NKA, then checks if that correction has reduced the residual by at least a
tolerance.  If not, this uses a Brendt minimization algorithm to try and find
an <span class="math notranslate nohighlight">\(\alpha\)</span> that minimizes the reduction in the residual.</p>
<p>Note, this always monitors the residual.</p>
<span class="target" id="solver-nka-ls-spec"></span></section>
<section id="solver-nka-with-line-search-ats">
<h4>Solver: NKA with Line Search, ATS<a class="headerlink" href="#solver-nka-with-line-search-ats" title="Permalink to this heading"></a></h4>
</section>
<section id="solver-nka-with-backtracking-ats">
<h4>Solver: NKA with backtracking, ATS<a class="headerlink" href="#solver-nka-with-backtracking-ats" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Nonlinear solve using NKA with a heuristic based backtracking.</p>
</div></blockquote>
<p>Whereas line search uses a formal minimization method, backtracking simply uses
a heuristic multiplier on <span class="math notranslate nohighlight">\(\alpha\)</span> to find a correction that sufficiently
reduces the residual.  This can be significantly faster than the full
minimization problem, and finding the true minimum may not be as important as
simply doing better and going on to the next nonlinear iteration.</p>
<p>This is the workhorse for hard ATS problems, as it is usually rather efficient,
even in problems where the linear solve results in a correction that is way too
large (e.g. for steep nonlinearities such as phase change).</p>
<p>Note this always monitors the residual, and the correction is always modified.</p>
<div class="admonition-solver-nka-bt-ats-spec admonition" id="solver-nka-bt-ats-spec">
<p class="admonition-title">solver-nka-bt-ats-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> Defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“limit iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>20</strong> Defines the maximum allowed number
of iterations.</p></li>
<li><p><cite>“diverged tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> Defines the error level
indicating divergence of the solver. The error is calculated by a PK.
Set to a negative value to ignore this check.</p></li>
<li><p><cite>“nka lag iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Delays the NKA acceleration, but
updates the Krylov space.</p></li>
<li><p><cite>“max nka vectors</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong> Defines the maximum number of
consecutive vectors used for a local space.</p></li>
<li><p><cite>“nka vector tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.05</strong> Defines the minimum
allowed orthogonality between vectors in the local space. If a new vector
does not satisfy this requirement, the space is modified.</p></li>
<li><p><cite>“backtrack tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.</strong> Require a reduction of at
least this much in the residual norm before accepting a correction.</p></li>
<li><p><cite>“backtrack factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.5</strong> Multiply the correction by this
factor each backtracking step.  Note, should be in (0, 1)</p></li>
<li><p><cite>“backtrack monitor</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>monitor either</strong> What norm is
checked to determine whether backtracking has improved the residual or
not?  One of <cite>“monitor enorm</cite>”, <cite>“monitor L2 residual</cite>”, or <cite>‘monitor
either</cite>”</p></li>
<li><p><cite>“backtrack max steps</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong> Controls how many multiples of
the backtrack factor are applied before declaring failure.</p></li>
<li><p><cite>“backtrack max total steps</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1e6</strong> Controls how many total
backtrack steps may be taken before declaring failure.</p></li>
<li><p><cite>“backtrack lag iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Delay requiring a reduction
in residual for this many nonlinear iterations.</p></li>
<li><p><cite>“backtrack last iteration</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1e6</strong> Stop requiring a
reductiontion in residual after this many nonlinear iterations.</p></li>
<li><p><cite>“backtrack fail on bad search direction</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If
backtracking for the full number of “backtrack max steps” is taken, and
the residual norm has still not be reduced suffiently, this determines
the behavior.  If true, the solver declares failure.  If false, it takes
the bad step anyway and hopes to recover in later iterates.</p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“Anderson mixing</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, use Anderson mixing instead of NKA.</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“relaxation parameter</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.7</strong> The relaxation parameter
for Anderson mixing.</p></li>
</ul>
<p>END</p>
</div>
</section>
<section id="solver-nox">
<h4>Solver: NOX<a class="headerlink" href="#solver-nox" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Calls Nox nonlinear solvers/JFNK.</p>
</div></blockquote>
<p>The interface to Trilinos NOX solver is as follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;solver type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;nox&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nox parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;typical solution value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;JF matrix parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;finite difference epsilon&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0e-8&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;method for epsilon&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Knoll-Keyes L2&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>

<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nonlinear solver&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;solver type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Newton&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Newton parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>...
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>

<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;linear operator&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;iterative method&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;gmres&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gmres parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>...
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="linear-solvers">
<h3><a class="toc-backref" href="#id57" role="doc-backlink">Linear Solvers</a><a class="headerlink" href="#linear-solvers" title="Permalink to this heading"></a></h3>
<blockquote id="inverse">
<span id="linear-solver"></span><span id="linearsolvers"></span><span id="linearoperator"></span><div><p>Base class for providing ApplyInverse() methods on operators.</p>
</div></blockquote>
<p>Matrix provides existing Operators with an inverse.  Note this may be
iterative or non-iterative, assembled or non-assembled, approximate or exact to
machine precision.</p>
<div class="admonition-inverse-typed-spec admonition" id="inverse-typed-spec">
<p class="admonition-title">inverse-typed-spec</p>
<ul class="simple">
<li><p><cite>“iterative method</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong></p></li>
<li><p><cite>“direct method</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong></p></li>
<li><p><cite>“preconditioning method</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong></p></li>
</ul>
</div>
<p>DOCUMENT ME!</p>
<section id="linear-solver-pcg">
<h4>Linear Solver: PCG<a class="headerlink" href="#linear-solver-pcg" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Preconditioned conjugate gradient method for a linear solver.</p>
</div></blockquote>
<div class="admonition-iterative-method-pcg-spec admonition" id="iterative-method-pcg-spec">
<p class="admonition-title">iterative-method-pcg-spec</p>
<ul class="simple">
<li><p><cite>“error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> Tolerance on which to declare success.</p></li>
<li><p><cite>“maximum number of iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>100</strong> Maximum iterations before declaring failure.</p></li>
<li><p><cite>“overflow tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>3.e50</strong> Error above this value results in failure.</p></li>
<li><p><cite>“convergence criterial</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> <strong>{relative rhs}</strong> A list of
criteria, any of which can be applied.  Valid include:</p>
<ul>
<li><p><cite>“relative rhs</cite>” : measure error relative to the norm of the RHS vector</p></li>
<li><p><cite>“relative residual</cite>” : measure error relative to the norm of the residual</p></li>
<li><p><cite>“absolute residual</cite>” : measure error directly, norm of error</p></li>
<li><p><cite>“make one iteration</cite>” : require at least one iteration to be performed before declaring success</p></li>
</ul>
</li>
</ul>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;_PCG with HYPRE AMG&quot;</span><span class="nt">&gt;</span><span class="w">  </span><span class="cm">&lt;!-- parent list --&gt;</span>
<span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pcg parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;error tolerance&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1e-12&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;maximum number of iterations&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;400&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;convergence criteria&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{relative residual,make one iteration}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;overflow tolerance&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;3.0e+50&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;verbose object&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;verbosity level&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;high&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="linear-solver-gmres">
<h4>Linear Solver: GMRES<a class="headerlink" href="#linear-solver-gmres" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Generalized minimum residual method for a linear solver.</p>
</div></blockquote>
<p>Based on the methods of Yu. Kuznetsov, 1968; Y.Saad, 1986.  Deflated version of
GMRES is due to R.Morgan, GMRES with deflated restarting, 2002 SISC; S.Rollin,
W.Fichtner, Improving accuracy of GMRES with deflated restarting, 2007 SISC.</p>
<div class="admonition-iterative-method-gmres-spec admonition" id="iterative-method-gmres-spec">
<p class="admonition-title">iterative-method-gmres-spec</p>
<ul class="simple">
<li><p><cite>“error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> Tolerance on which to declare success.</p></li>
<li><p><cite>“maximum number of iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>100</strong> Maximum iterations before declaring failure.</p></li>
<li><p><cite>“overflow tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>3.e50</strong> Error above this value results in failure.</p></li>
<li><p><cite>“convergence criterial</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> <strong>{relative rhs}</strong> A list of
criteria, any of which can be applied.  Valid include:</p>
<ul>
<li><p><cite>“relative rhs</cite>” : measure error relative to the norm of the RHS vector</p></li>
<li><p><cite>“relative residual</cite>” : measure error relative to the norm of the residual</p></li>
<li><p><cite>“absolute residual</cite>” : measure error directly, norm of error</p></li>
<li><p><cite>“make one iteration</cite>” : require at least one iteration to be performed before declaring success</p></li>
</ul>
</li>
<li><p><cite>“size of Krylov space</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong> Size of the Krylov space used to span the residual.</p></li>
<li><p><cite>“controller training start</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Start iteration for determining
convergence rates. (Add more please!)</p></li>
<li><p><cite>“controller training end</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>3</strong> Start iteration for determining
convergence rates. (Add more please!)</p></li>
<li><p><cite>“preconditioning strategy</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>left</strong> Valid are “left” and
“right”-type preconditioning (see Saad 1986)</p></li>
<li><p><cite>“maximum size of deflation space</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Size of the deflation space, see Rollin et al.</p></li>
</ul>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;_GMRES with HYPRE AMG&quot;</span><span class="nt">&gt;</span><span class="w">  </span><span class="cm">&lt;!-- parent list --&gt;</span>
<span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gmres parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;error tolerance&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1e-12&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;maximum number of iterations&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;400&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;convergence criteria&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{relative residual}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;size of Krylov space&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;10&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;overflow tolerance&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;3.0e+50&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;maximum size of deflation space&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;preconditioning strategy`&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;left&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;release Krylov vectors&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;bool&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;verbose object&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;verbosity level&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;high&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>

<span class="cm">&lt;!-- Alternative implementation</span>
<span class="cm">&lt;ParameterList name=&quot;belos gmres parameters&quot;&gt;</span>
<span class="cm">  &lt;Parameter name=&quot;error tolerance&quot; type=&quot;double&quot; value=&quot;1e-12&quot;/&gt;</span>
<span class="cm">  &lt;Parameter name=&quot;maximum number of iterations&quot; type=&quot;int&quot; value=&quot;400&quot;/&gt;</span>
<span class="cm">  &lt;Parameter name=&quot;convergence criteria&quot; type=&quot;Array(string)&quot; value=&quot;{relative residual}&quot;/&gt;</span>
<span class="cm">  &lt;Parameter name=&quot;size of Krylov space&quot; type=&quot;int&quot; value=&quot;10&quot;/&gt;</span>
<span class="cm">  &lt;Parameter name=&quot;overflow tolerance&quot; type=&quot;double&quot; value=&quot;3.0e+50&quot;/&gt;</span>
<span class="cm">&lt;/ParameterList--&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="linear-solver-nka">
<h4>Linear Solver: NKA<a class="headerlink" href="#linear-solver-nka" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Uses NKA method as a linear solver.</p>
</div></blockquote>
<p>This is effectively equivalent to GMRES with a rolling restart, where vectors
fall off the end of the space.</p>
<div class="admonition-iterative-method-nka-spec admonition" id="iterative-method-nka-spec">
<p class="admonition-title">iterative-method-nka-spec</p>
<ul class="simple">
<li><p><cite>“error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> Tolerance on which to declare success.</p></li>
<li><p><cite>“maximum number of iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>100</strong> Maximum iterations before declaring failure.</p></li>
<li><p><cite>“overflow tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>3.e50</strong> Error above this value results in failure.</p></li>
<li><p><cite>“convergence criterial</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> <strong>{relative rhs}</strong> A list of
criteria, any of which can be applied.  Valid include:</p>
<ul>
<li><p><cite>“relative rhs</cite>” : measure error relative to the norm of the RHS vector</p></li>
<li><p><cite>“relative residual</cite>” : measure error relative to the norm of the residual</p></li>
<li><p><cite>“absolute residual</cite>” : measure error directly, norm of error</p></li>
<li><p><cite>“make one iteration</cite>” : require at least one iteration to be performed before declaring success</p></li>
</ul>
</li>
<li><p><cite>“max nka vectors</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong> Size of the NKA space used to span the residual, conceptually equivalent to the size of the Krylov space.</p></li>
<li><p><cite>“nka vector tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.05</strong> Vectors whose dot product are within this tolerance are considered parallel, and therefore the old vector is thrown out.</p></li>
</ul>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;_NKA&quot;</span><span class="nt">&gt;</span><span class="w">  </span><span class="cm">&lt;!-- parent list --&gt;</span>
<span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nka parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;error tolerance&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1e-12&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;maximum number of iterations&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;400&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;convergence criteria&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{relative residual}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;overflow tolerance&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;3.0e+50&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;max nka vectors&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;10&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nka vector tolerance&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.05&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;verbose object&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;verbosity level&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;high&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="linear-solver-amesos">
<h4>Linear Solver: Amesos<a class="headerlink" href="#linear-solver-amesos" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Direct solvers via Trilinos.</p>
</div></blockquote>
<p>Amesos library of Trilinos package provides interfaces to a few direct solvers.
List <cite>“amesos parameters</cite>” contains parameters that understood by this library.
These parameters may violate the camel-case convention employed by this spec.
Additional parameters are:</p>
<ul class="simple">
<li><p><cite>“solver name</cite>” [string] declares name of one of the supported direct solvers.
Available options are <cite>“klu</cite>”, <cite>“superludist</cite>”, <cite>“basker</cite>”, etc, see Amesos and
Amesos2 manuals for details. The default value is serial solver <cite>“klu</cite>”.</p></li>
<li><p><cite>“amesos version</cite>” [int] specifies version of Amesos. Available options are 1 and 2.
The default value is 1.</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;_AMESOS KLU&quot;</span><span class="nt">&gt;</span><span class="w">  </span><span class="cm">&lt;!-- parent list --&gt;</span>
<span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;direct method&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;amesos&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;amesos parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;solver name&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;klu&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;amesos version&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="id11">
<h4>Linear Solver: Amesos<a class="headerlink" href="#id11" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Direct solvers via Trilinos.</p>
</div></blockquote>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>undocumented</p>
</div>
</section>
<section id="linear-solver-belos-gmres">
<h4>Linear Solver: Belos (GMRES)<a class="headerlink" href="#linear-solver-belos-gmres" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Trilinos/Belos implementations of iterative methods.</p>
</div></blockquote>
<p>Includes GMRES and other Belos methods.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>undocumented</p>
</div>
</section>
</section>
<section id="preconditioners">
<h3><a class="toc-backref" href="#id58" role="doc-backlink">Preconditioners</a><a class="headerlink" href="#preconditioners" title="Permalink to this heading"></a></h3>
<blockquote id="preconditioner">
<div><p>A base class for assembled preconditioners.</p>
</div></blockquote>
<p>This sublist contains entries for various
preconditioners required by a simulation. At the moment, we support Trilinos multilevel
preconditioner, Hypre BoomerAMG preconditioner, ILU preconditioner, Hypre’s Euclid ILU
preconditioner, and identity preconditioner.</p>
<ul class="simple">
<li><p><cite>“preconditioning method</cite>” [string] defines preconditioner algorithm.</p></li>
<li><p><cite>“xxx parameters</cite>” [list] provides parameters for the preconditioner specified
by parameter <cite>“preconditioning method</cite>”.</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList&gt;</span><span class="w">  </span><span class="cm">&lt;!-- parent list --&gt;</span>
<span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;preconditioners&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;_TRILINOS ML&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;preconditioning method&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;ml&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ml parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span>...
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;_HYPRE AMG&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;preconditioning method&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;boomer amg&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boomer amg parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span>...
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;_BLOCK ILU&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;preconditioning method&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;block ilu&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;block ilu parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span>...
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;_DIAGONAL&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;preconditioning method&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;diagonal&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<section id="identity">
<h4>Identity<a class="headerlink" href="#identity" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Identity as a preconditioner.</p>
</div></blockquote>
<p>Simply copies the input vector to the output – uses the Identity matrix as a
preconditioner.</p>
<p>This is provided when using the <cite>“preconditioning method</cite>”=`”identity`” in the
<a class="reference internal" href="#preconditioner">Preconditioner</a> spec.</p>
<p>No parameters are required.</p>
</section>
<section id="diagonal">
<h4>Diagonal<a class="headerlink" href="#diagonal" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Diagonal preconditioner.</p>
</div></blockquote>
<p>Simply applys the pointwise inverse of the diagonal of the matrix as an
extremely cheap matrix.</p>
<p>This is provided when using the <cite>“preconditioning method</cite>”=`”diagonal`” in the
<a class="reference internal" href="#preconditioner">Preconditioner</a> spec.</p>
<p>No parameters are required.</p>
</section>
<section id="block-ilu">
<h4>Block ILU<a class="headerlink" href="#block-ilu" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Ifpack suite of preconditioners, including block ILU.</p>
</div></blockquote>
<p>The Ifpack (Incomplete Factorization Package) from Trilinos provides
additive-Schwarz-based incomplete factorization methods, including ILU and many
others.</p>
<p>The method is provided in the parent list, e.g. <cite>“preconditioning method</cite>” =
<cite>“ifpack: METHOD</cite>” when calling the Preconditioner factory.</p>
<p>Valid methods include:</p>
<ul class="simple">
<li><p><cite>“point relaxation</cite>” : Additive Schwarz + relaxation</p></li>
<li><p><cite>“block relaxation</cite>” : Additive Schwarz + block relaxation</p></li>
<li><p><cite>“Amesos</cite>” : Additive Schwarz with Amesos on block</p></li>
<li><p><cite>“IC</cite>” : Additive Schwarz + Incomplete Cholesky (symmetry required)</p></li>
<li><p><cite>“ICT</cite>” : Additive Schwarz + tolerance based Incomplete Cholesky (symmetry required)</p></li>
<li><p><cite>“ILU</cite>” : Additive Schwarz + Incomplete LU</p></li>
<li><p><cite>“ILUT</cite>” : Additive Schwarz + tolerance based Incomplete LU</p></li>
<li><p><cite>“block ilu</cite>” : is the same as <cite>“ILU</cite>”, as this is the legacy Amanzi name.</p></li>
</ul>
<p>Note that all of these can be used without Additive Schwarz by appending
“stand-alone”.</p>
<p>The full list of relevant parameters is somewhat method-dependent, and is
documented extensively in the <a class="reference external" href="https://docs.trilinos.org/dev/packages/ifpack/doc/html/index.html">Trilinos Documentation</a>.</p>
<p>Here we document a subset of the most frequently used parameters – advanced
users should read the Ifpack User Guide above to see all options.</p>
<div class="admonition-preconditioner-ifpack-ilu-spec admonition" id="preconditioner-ifpack-ilu-spec">
<p class="admonition-title">preconditioner-ifpack-ilu-spec:</p>
<ul class="simple">
<li><p><cite>“schwarz: combine mode</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>Add</strong> Note that <cite>“Zero</cite>” may
perform better for nonsymmetric cases.</p></li>
<li><p><cite>“overlap</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> overlap of the Additive Schwarz</p></li>
<li><p><cite>“fact: relax value</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.0</strong> If nonzero, dropped values are added to the diagonal (times this factor).</p></li>
<li><p><cite>“fact: absolute threshold</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.0</strong> Defines the value to
add to each diagonal element (times the sign of the actual diagonal
element).</p></li>
<li><p><cite>“fact: relative threshold</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> Multiplies the
diagonal by this value before checking the threshold.</p></li>
<li><p><cite>“fact: level-of-fill</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong></p></li>
</ul>
</div>
<div class="admonition-preconditioner-ifpack-relaxation-spec admonition" id="preconditioner-ifpack-relaxation-spec">
<p class="admonition-title">preconditioner-ifpack-relaxation-spec:</p>
<ul class="simple">
<li><p><cite>“schwarz: combine mode</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>Add</strong> Note that <cite>“Zero</cite>” may
perform better for nonsymmetric cases.</p></li>
<li><p><cite>“overlap</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> overlap of the Additive Schwarz</p></li>
<li><p><cite>“relaxation: type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>Jacobi</strong></p></li>
<li><p><cite>“relaxation: sweeps</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1</strong></p></li>
<li><p><cite>“relaxation: damping factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong></p></li>
</ul>
</div>
<div class="admonition-preconditioner-amesos-relaxation-spec admonition" id="preconditioner-ifpack-amesos-spec">
<p class="admonition-title">preconditioner-amesos-relaxation-spec:</p>
<ul class="simple">
<li><p><cite>“schwarz: combine mode</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>Add</strong> Note that <cite>“Zero</cite>” may
perform better for nonsymmetric cases.</p></li>
<li><p><cite>“overlap</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> overlap of the Additive Schwarz</p></li>
<li><p><cite>“amesos: solver type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>Amesos_Klu</strong></p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;block ilu parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;fact: relax value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;fact: absolute threshold&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;fact: relative threshold&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;fact: level-of-fill&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;overlap&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schwarz: combine mode&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Add&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="boomer-amg-and-euclid">
<h4>Boomer AMG and Euclid<a class="headerlink" href="#boomer-amg-and-euclid" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Hypre based preconditioners include Algebraic MultiGrid and global ILU</p>
</div></blockquote>
<p>Boomer AMG is a HYPRE product consisting of a variety of Algebraic Multigrid
methods.  It is accessed through Ifpack.</p>
<p>This is provided when using the <cite>“preconditioning method</cite>”=`”boomer amg`” or
<cite>“preconditioning method</cite>” = <cite>“hypre: boomer amg</cite>” in the <a class="reference internal" href="#preconditioner">Preconditioner</a>
spec.</p>
<div class="admonition-preconditioner-boomer-amg-spec admonition" id="preconditioner-boomer-amg-spec">
<p class="admonition-title">preconditioner-boomer-amg-spec:</p>
<ul class="simple">
<li><p><cite>“tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.</strong> If is not zero, the preconditioner is dynamic
and approximate the inverse matrix with the prescribed tolerance (in
the energy norm ???).</p></li>
<li><p><cite>“smoother sweeps</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>3</strong> defines the number of smoothing loops. Default is 3.</p></li>
<li><p><cite>“cycle applications</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>5</strong> defines the number of V-cycles.</p></li>
<li><p><cite>“strong threshold</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.5</strong> defines the number of V-cycles. Default is 5.</p></li>
<li><p><cite>“relaxation type</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>6</strong> defines the smoother to be used. Default is 6
which specifies a symmetric hybrid Gauss-Seidel / Jacobi hybrid method. TODO: add others!</p></li>
<li><p><cite>“coarsen type</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> defines the coarsening strategy to be used. Default is 0
which specifies a Falgout method. TODO: add others!</p></li>
<li><p><cite>“max multigrid levels</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> optionally defined the maximum number of multigrid levels.</p></li>
<li><p><cite>“use block indices</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, uses the <cite>“systems of
PDEs</cite>” code with blocks given by the SuperMap, or one per DoF per entity
type.</p></li>
<li><p><cite>“number of functions</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1</strong> Any value &gt; 1 tells Boomer AMG to
use the <cite>“systems of PDEs</cite>” code with strided block type.  Note that, to use
this approach, unknowns must be ordered with DoF fastest varying (i.e. not
the native Epetra_MultiVector order).  By default, it uses the <cite>“unknown</cite>”
approach in which each equation is coarsened and interpolated independently.</p></li>
<li><p><cite>“nodal strength of connection norm</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> tells AMG to coarsen such
that each variable has the same coarse grid - sometimes this is more
“physical” for a particular problem. The value chosen here for nodal
determines how strength of connection is determined between the coupled
system.  I suggest setting nodal = 1, which uses a Frobenius norm.  This
does NOT tell AMG to use nodal relaxation.  Default is 0.</p></li>
<li><p><cite>“verbosity</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> prints a summary of run time settings and
timing information to stdout.  <cite>“1</cite>” prints coarsening info, <cite>“2</cite>” prints
smoothing info, and <cite>“3</cite>’” prints both.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;boomer amg parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tolerance&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;smoother sweeps&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;cycle applications&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;5&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;strong threshold&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.5&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;coarsen type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;relaxation type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;verbosity&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;number of functions&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Euclid is a Parallel Incomplete LU, provided as part of the HYPRE project
through the Ifpack interface.
The algorithm was presented at SC99 and published in expanded
form in the SIAM Journal on Scientific Computing.
Scalability means that the factorization (setup) and application (triangular solve) timings remain
nearly constant when the global problem size is scaled in proportion to the number of processors.
As with all ILU preconditioning methods, the number of iterations is expected to increase with
global problem size.</p>
<p>This is provided when using the <cite>“preconditioning method</cite>”=`”euclid`” or
=`”hypre: euclid`” in the <a class="reference internal" href="#preconditioner">Preconditioner</a> spec.</p>
<div class="admonition-preconditioner-euclid-spec admonition" id="preconditioner-euclid-spec">
<p class="admonition-title">preconditioner-euclid-spec:</p>
<ul class="simple">
<li><p><cite>“ilu(k) fill level</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1</strong> The factorization level.</p></li>
<li><p><cite>“ilut drop tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0</strong> Defines a drop tolerance relative to the largest absolute value of any entry in the row being factored.</p></li>
<li><p><cite>“rescale row</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, values are scaled prior to factorization so that largest value in any row is +1 or -1. Note that this can destroy matrix symmetry.</p></li>
<li><p><cite>“verbosity</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Prints a summary of runtime settings and timing information to stdout.</p></li>
</ul>
</div>
</section>
<section id="ml-trilinos-amg">
<h4>ML (Trilinos AMG)<a class="headerlink" href="#ml-trilinos-amg" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Trilinos ML smoothed aggregation multigrid.</p>
</div></blockquote>
<p>This is provided when using the <cite>“preconditioning method</cite>”=`”ml`” in the
<a class="reference internal" href="#preconditioner">Preconditioner</a> spec.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>no input spec defined</p>
</div>
<p>See also: <a class="reference external" href="https://trilinos.github.io/pdfs/mlguide5.pdf">https://trilinos.github.io/pdfs/mlguide5.pdf</a></p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ml parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ML output&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;aggregation: damping factor&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.33&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;aggregation: nodes per aggregate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;aggregation: threshold&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;aggregation: type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Uncoupled&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;coarse: type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Amesos-KLU&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;coarse: max size&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;128&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;coarse: damping factor&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;cycle applications&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;eigen-analysis: iterations&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;10&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;eigen-analysis: type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;cg&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;max levels&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;40&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;prec type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;MGW&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;smoother: damping factor&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;smoother: pre or post&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;both&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;smoother: sweeps&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;smoother: type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Gauss-Seidel&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="other-common-specs">
<h2><a class="toc-backref" href="#id59" role="doc-backlink">Other Common Specs</a><a class="headerlink" href="#other-common-specs" title="Permalink to this heading"></a></h2>
<section id="ioevent">
<h3><a class="toc-backref" href="#id60" role="doc-backlink">IOEvent</a><a class="headerlink" href="#ioevent" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>IOEvent: base time/timestep control determing when in time to do something.</p>
</div></blockquote>
<p>The IOEvent is used for multiple objects that need to indicate simulation times or cycles on which to do something.</p>
<div class="admonition-io-event-spec admonition" id="io-event-spec">
<p class="admonition-title">io-event-spec</p>
<ul class="simple">
<li><p><cite>“cycles start period stop</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code> <strong>optional</strong> The first entry
is the start cycle, the second is the cycle period, and the third is the
stop cycle or -1, in which case there is no stop cycle. A visualization
dump is written at such cycles that satisfy cycle = start + n*period, for
n=0,1,2,… and cycle &lt; stop if stop != -1.0.</p></li>
<li><p><cite>“cycles start period stop 0</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code> <strong>optional</strong> If multiple
cycles start period stop parameters are needed, then use these parameters.
If one with 0 is found, then one with 1 is looked for, etc, until the Nth
one is not found.</p></li>
<li><p><cite>“cycles</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code> <strong>optional</strong> An array of discrete cycles that
at which a visualization dump is written.</p></li>
<li><p><cite>“times start period stop</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> <strong>optional</strong> The first
entry is the start time, the second is the time period, and the third is
the stop time or -1, in which case there is no stop time. A visualization
dump is written at such times that satisfy time = start + n*period, for
n=0,1,2,… and time &lt; stop if stop != -1.0.</p></li>
<li><p><cite>“times start period stop units</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>s</strong> Units corresponding
to this spec.  One of <cite>“s</cite>”, <cite>“min</cite>”, <cite>“h</cite>”, <cite>“d</cite>”, <cite>“yr</cite>”, or <cite>“noleap</cite>”</p></li>
<li><p><cite>“times start period stop 0</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> <strong>optional</strong> If multiple
start period stop parameters are needed, then use this these parameters
with N=0,1,2.  If one with 0 is found, then one with 1 is looked for, etc,
until the Nth one is not found.</p></li>
<li><p><cite>“times start period stop 0 units</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>s</strong> Units corresponding
to this spec.  One of <cite>“s</cite>”, <cite>“min</cite>”, <cite>“h</cite>”, <cite>“d</cite>”, <cite>“yr</cite>”, or <cite>“noleap</cite>”
See above for continued integer listings.</p></li>
<li><p><cite>“times</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> <strong>optional</strong> An array of discrete times that
at which a visualization dump shall be written.</p></li>
<li><p><cite>“times units</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>s</strong> Units corresponding to this spec.  One
of <cite>“s</cite>”, <cite>“d</cite>”, <cite>“yr</cite>”, or <cite>“yr 365</cite>”</p></li>
</ul>
</div>
</section>
<section id="verbose-object">
<h3><a class="toc-backref" href="#id61" role="doc-backlink">Verbose Object</a><a class="headerlink" href="#verbose-object" title="Permalink to this heading"></a></h3>
<p>This allows control of log-file verbosity for a wide variety of objects
and physics.</p>
<div class="admonition-verbose-object-spec admonition" id="verbose-object-spec">
<p class="admonition-title">verbose-object-spec</p>
<ul class="simple">
<li><p><cite>“verbosity level</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>GLOBAL_VERBOSITY</strong>, <cite>“low</cite>”,
<cite>“medium</cite>”, <cite>“high</cite>”, <cite>“extreme</cite>” The default is set by the global
verbosity spec, (fix me!)  Typically, <cite>“low</cite>” prints out minimal
information, <cite>“medium</cite>” prints out errors and overall high level
information, <cite>“high</cite>” prints out basic debugging, and <cite>“extreme</cite>” prints
out local debugging information.</p></li>
<li><p><cite>“write on rank</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> VerboseObjects only write on a single
rank – by deafult the 0th rank.  However, sometimes it is useful for
debugging to write from another rank due to a need for cleaner output or
writing a specific cell/entity information.</p></li>
<li><p><cite>“output filename</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong> Redirect this output to a
specific file rather than writing to screen.  Note this will be done
by-the-instance, so this may not catch as much as one might think.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;verbose object&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;verbosity level&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;medium&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;my header&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;hide line prefix&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;bool&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;write on rank&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="debugger">
<h3><a class="toc-backref" href="#id62" role="doc-backlink">Debugger</a><a class="headerlink" href="#debugger" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>A mesh and vector structure aware utility for printing info.</p>
</div></blockquote>
<p>This is a utility that makes it easier for the user to control output written
to the screen.  It allows the user to provide element IDs, and then provides
functionality for a PK to write mesh geometry information and vector values of
those elements to screen based upon verbosity levels.</p>
<p>Note, most information is only written if the owning object’s verbosity level
from the <cite>“Verbose Object</cite>” spec is set to <cite>“high</cite>” or higher.</p>
<div class="admonition-debugger-spec admonition">
<p class="admonition-title">debugger-spec</p>
<ul class="simple">
<li><p><cite>“debug cells</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code> For each global ID of a cell provided
here, controls writing of vectors inside of the using PK.</p></li>
<li><p><cite>“debug faces</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code> For each global ID of a face provided
here, writes all adjoining cell information as if each cell was included
in <cite>“debug cells</cite>”.</p></li>
</ul>
</div>
</section>
<section id="residual-debugger">
<h3><a class="toc-backref" href="#id63" role="doc-backlink">Residual Debugger</a><a class="headerlink" href="#residual-debugger" title="Permalink to this heading"></a></h3>
<p>Debugging object for writing vectors to file within an iterative
process for use with vis tools.</p>
<div class="admonition-residual-debugger-spec admonition" id="residual-debugger-spec">
<p class="admonition-title">residual-debugger-spec</p>
<ul class="simple">
<li><p><cite>“file name base</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>amanzi_dbg</strong> Prefix for output filenames.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[io-event-spec]</span></code> An <a class="reference internal" href="#ioevent">IOEvent</a> spec</p></li>
</ul>
</div>
</section>
<section id="function">
<h3><a class="toc-backref" href="#id64" role="doc-backlink">Function</a><a class="headerlink" href="#function" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>A base class for all functions of space and time.</p>
</div></blockquote>
<p>Analytic, algabraic functions of space and time are used for a variety of
purposes, including boundary conditions, initial conditions, and independent
variables.</p>
<p>For initial conditions, functions are prescribed of space only, i.e.</p>
<div class="math notranslate nohighlight">
\[u = f(x,y,z)\]</div>
<p>For boundary conditions and independent variables, functions are also a
function of time:</p>
<div class="math notranslate nohighlight">
\[u = f(t,x,y,z)\]</div>
<p>It is straightforward to add new functions as needed.</p>
<section id="constant-function">
<h4>Constant Function<a class="headerlink" href="#constant-function" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>FunctionConstant: Implements the Function interface using a constant value.</p>
</div></blockquote>
<p>Constant function is defined as <span class="math notranslate nohighlight">\(f(x) = a\)</span>, for all <span class="math notranslate nohighlight">\(x\)</span>.</p>
<ul class="simple">
<li><p><cite>“value</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> The constant to be applied.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="tabular-function">
<h4>Tabular Function<a class="headerlink" href="#tabular-function" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>FunctionTabular: Piecewise-defined function.</p>
</div></blockquote>
<p>A piecewise function of one variable.</p>
<p>A tabular function is tabulated on a series of intervals; given values
<span class="math notranslate nohighlight">\({{x_i}}, {{y_i}},, i=0, ... n-1\)</span> and functional forms <span class="math notranslate nohighlight">\({{f_j}},,
j=0, ... n-2\)</span> a tabular function <span class="math notranslate nohighlight">\(f(x)\)</span> is defined as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{matrix}
f(x) &amp;=&amp; y_0, &amp; x \le x_0,\\
f(x) &amp;=&amp; f_{{i-1}}(x)  &amp; x \in (x_{{i-1}}, x_i],\\
f(x) &amp;=&amp; y_{{n-1}}, &amp; x &gt; x_{{n-1}}.
\end{matrix}\end{split}\]</div>
<p>The functional forms <span class="math notranslate nohighlight">\({f_j}\)</span> may be constant, which uses the left endpoint, i.e.</p>
<p><span class="math notranslate nohighlight">\(f_i(x) = y_i\)</span>,</p>
<p>linear, i.e.</p>
<p><span class="math notranslate nohighlight">\(f_i(x) = ( y_i * (x - x_i) + y_{{i+1}} * (x_{{i+1}} - x) ) / (x_{{i+1}} - x_i)\)</span></p>
<p>or arbitrary, in which the <span class="math notranslate nohighlight">\(f_j\)</span> must be provided.</p>
<p>The <span class="math notranslate nohighlight">\(x_i\)</span> and <span class="math notranslate nohighlight">\(y_i\)</span> may be provided in one of two ways – explicitly in the input spec or from an HDF5 file.  The length of these must be equal, and the <span class="math notranslate nohighlight">\(x_i\)</span> must be monotonically increasing.  Forms, as defined on intervals, must be of length equal to the length of the <span class="math notranslate nohighlight">\(x_i\)</span> less one.</p>
<p>Explicitly specifying the data:</p>
<div class="admonition-function-tabular-spec admonition" id="function-tabular-spec">
<p class="admonition-title">function-tabular-spec</p>
<ul class="simple">
<li><p><cite>“x values</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> the <span class="math notranslate nohighlight">\(x_i\)</span></p></li>
<li><p><cite>“y values</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> the <span class="math notranslate nohighlight">\(y_i\)</span></p></li>
<li><p><cite>“forms</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> <strong>optional</strong> Form of the interpolant, either
<cite>“constant</cite>”, <cite>“linear</cite>”, or <cite>“USER_DEFINED</cite>” Default is linear for each *
interval.  Note the length of this array should be one per interval, or
one less than len of x and y values.</p></li>
<li><p><cite>“USER_DEFINED</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> <strong>optional</strong> user-provided functional
forms on the interval</p></li>
<li><p><cite>“x coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>t</strong>, <cite>“x</cite>”, <cite>“y</cite>”, <cite>“z</cite>” defines which
coordinate direction the <span class="math notranslate nohighlight">\(x_i\)</span> are formed, defaulting to time.</p></li>
</ul>
</div>
<p>The below example defines a function that is zero on interval <span class="math notranslate nohighlight">\((-\infty,\,0]\)</span>,
linear on interval <span class="math notranslate nohighlight">\((0,\,1]\)</span>, constant (<cite>f(x)=1</cite>) on interval <span class="math notranslate nohighlight">\((1,\,2]\)</span>,
square root of <cite>t</cite> on interval <span class="math notranslate nohighlight">\((2,\,3]\)</span>,
and constant (<cite>f(x)=2</cite>) on interval <span class="math notranslate nohighlight">\((3,\,\infty]\)</span>.</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-tabular&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;x values&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{0.0, 1.0, 2.0, 3.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;x coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;t&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;y values&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{0.0, 1.0, 2.0, 2.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;forms&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{linear, constant, USER_FUNC}&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;USER_FUNC&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-standard-math&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;operator&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;sqrt&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Loading table from file.  (Note that <cite>“USER_DEFINED</cite>” is not an option here,
but could be made so if requested).</p>
<div class="admonition-function-tabular-fromfile-spec admonition" id="function-tabular-fromfile-spec">
<p class="admonition-title">function-tabular-fromfile-spec</p>
<ul class="simple">
<li><p><cite>“file</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> filename of the HDF5 data</p></li>
<li><p><cite>“x header</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> name of the dataset for the <span class="math notranslate nohighlight">\(x_i\)</span> in the file</p></li>
<li><p><cite>“y header</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> name of the dataset for the <span class="math notranslate nohighlight">\(y_i\)</span> in the file</p></li>
<li><p><cite>“forms</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong>, Form of the interpolant, either
<cite>“constant</cite>” or <cite>“linear</cite>”</p></li>
</ul>
</div>
<p>The example below would perform linear-interpolation on the intervals provided by data within the hdf5 file <cite>“my_data.h5</cite>”.</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-tabular&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;file&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;my_data.h5&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;x coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;t&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;x header&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;/time&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;y header&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;/data&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="smooth-step-function">
<h4>Smooth step Function<a class="headerlink" href="#smooth-step-function" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>FunctionSmoothStep: a smoothed discontinuity.</p>
</div></blockquote>
<p>A smooth <span class="math notranslate nohighlight">\(C^2\)</span> function <cite>f(x)</cite> on interval <span class="math notranslate nohighlight">\([x_0,\,x_1]\)</span> is
defined such that <cite>f(x) = y_0</cite> for <cite>x &lt; x0</cite>, <cite>f(x) = y_1</cite> for <cite>x &gt; x_1</cite>, and
monotonically increasing for <span class="math notranslate nohighlight">\(x \in [x_0, x_1]\)</span> through cubic
interpolation.</p>
<div class="admonition-function-smooth-step-spec admonition" id="function-smooth-step-spec">
<p class="admonition-title">function-smooth-step-spec</p>
<ul class="simple">
<li><p><cite>“x0</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> First fitting point</p></li>
<li><p><cite>“y0</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> First fitting value</p></li>
<li><p><cite>“x1</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Second fitting point</p></li>
<li><p><cite>“y1</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Second fitting value</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-smooth-step&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;x0&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;y0&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;x1&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;y1&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;2.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="polynomial-function">
<h4>Polynomial Function<a class="headerlink" href="#polynomial-function" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>FunctionPolynomial: a polynomial</p>
</div></blockquote>
<p>A generic polynomial function is given by the following expression:</p>
<div class="math notranslate nohighlight">
\[f(x) = \sum_{{j=0}}^n c_j (x - x_0)^{{p_j}}\]</div>
<p>where <span class="math notranslate nohighlight">\(c_j\)</span> are coefficients of monomials,
<span class="math notranslate nohighlight">\(p_j\)</span> are integer exponents, and <span class="math notranslate nohighlight">\(x_0\)</span> is the reference point.</p>
<div class="admonition-function-polynomial-spec admonition" id="function-polynomial-spec">
<p class="admonition-title">function-polynomial-spec</p>
<ul class="simple">
<li><p><cite>“coefficients</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> c_j polynomial coefficients</p></li>
<li><p><cite>“exponents</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code> p_j polynomail exponents</p></li>
<li><p><cite>“reference point</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> x0 to which polynomial argument is normalized.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-polynomial&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;coefficients&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{1.0, 1.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;exponents&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{2, 4}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;reference point&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="multi-variable-linear-function">
<h4>Multi-variable linear Function<a class="headerlink" href="#multi-variable-linear-function" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>FunctionLinear: a multivariate linear function.</p>
</div></blockquote>
<p>A multi-variable linear function is formally defined by</p>
<div class="math notranslate nohighlight">
\[f(x) = y_0 + \sum_{{j=0}}^{{n-1}} g_j (x_j - x_{{0,j}})\]</div>
<p>with the constant term “math:<cite>y_0</cite> and gradient <span class="math notranslate nohighlight">\(g_0,\, g_1\,..., g_{{n-1}}\)</span>.
If the reference point <span class="math notranslate nohighlight">\(x_0\)</span> is specified, it must have the same
number of values as the gradient.  Otherwise, it defaults to zero.
Note that one of the parameters in a multi-valued linear function can be time.</p>
<div class="admonition-function-linear-spec admonition" id="function-linear-spec">
<p class="admonition-title">function-linear-spec</p>
<ul class="simple">
<li><p><cite>“y0</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> y_0 in f = y0 + g * (x - x0)</p></li>
<li><p><cite>“gradient</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> g in f = y0 + g * (x - x0)</p></li>
<li><p><cite>“x0</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> x0 in f = y0 + g * (x - x0)</p></li>
</ul>
</div>
<p>Conditions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-linear&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;y0&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gradient&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{1.0, 2.0, 3.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;x0&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{2.0, 3.0, 1.0}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="separable-function">
<h4>Separable Function<a class="headerlink" href="#separable-function" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>FunctionSeparable: f(x,y) = f1(x)*f2(y)</p>
</div></blockquote>
<p>A separable function is defined as the product of other functions such as</p>
<div class="math notranslate nohighlight">
\[f(x_0, x_1,...,x_{{n-1}}) = f_1(x_0)\, f_2(x_1,...,x_{{n-1}})\]</div>
<p>where <span class="math notranslate nohighlight">\(f_1\)</span> is defined by the <cite>“function1</cite>” sublist, and
<span class="math notranslate nohighlight">\(f_2\)</span> by the <cite>“function2</cite>” sublist.</p>
<div class="admonition-function-separable-spec admonition" id="function-separable-spec">
<p class="admonition-title">function-separable-spec</p>
<ul class="simple">
<li><p><cite>“function1</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> <span class="math notranslate nohighlight">\(f_1\)</span> in <span class="math notranslate nohighlight">\(f(x) = f_1(x0) * f_2(x1...)\)</span></p></li>
<li><p><cite>“function2</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> <span class="math notranslate nohighlight">\(f_2\)</span> in <span class="math notranslate nohighlight">\(f(x) = f_1(x0) * f_2(x1...)\)</span></p></li>
</ul>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-separable&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function1&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>function-specification
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function2&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>function-specification
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="additive-function">
<h4>Additive Function<a class="headerlink" href="#additive-function" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>FunctionAdditive: f(x,y) = f1(x,y) + f2(x,y)</p>
</div></blockquote>
<p>An additive function simply adds two other function results together.</p>
<div class="math notranslate nohighlight">
\[f(x) = f_1(x) + f_2(x)\]</div>
<p>where <span class="math notranslate nohighlight">\(f_1\)</span> is defined by the <cite>“function1</cite>” sublist, and
<span class="math notranslate nohighlight">\(f_2\)</span> by the <cite>“function2</cite>” sublist.</p>
<div class="admonition-function-additive-spec admonition" id="function-additive-spec">
<p class="admonition-title">function-additive-spec</p>
<ul class="simple">
<li><p><cite>“function1</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> <span class="math notranslate nohighlight">\(f_1\)</span> in <span class="math notranslate nohighlight">\(f(x) = f_1(x) + f_2(x)\)</span></p></li>
<li><p><cite>“function2</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> <span class="math notranslate nohighlight">\(f_2\)</span> in <span class="math notranslate nohighlight">\(f(x) = f_1(x) + f_2(x)\)</span></p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-additive&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function1&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>function-specification
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function2&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>function-specification
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="multiplicative-function">
<h4>Multiplicative Function<a class="headerlink" href="#multiplicative-function" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>FunctionMultiplicative: f(x,y) = f1(x,y) * f2(x,y)</p>
</div></blockquote>
<p>A multiplicative function simply multiplies two other function results together.</p>
<div class="math notranslate nohighlight">
\[f(x) = f_1(x) * f_2(x)\]</div>
<p>where <span class="math notranslate nohighlight">\(f_1\)</span> is defined by the <cite>“function1</cite>” sublist, and
<span class="math notranslate nohighlight">\(f_2\)</span> by the <cite>“function2</cite>” sublist.</p>
<div class="admonition-function-multiplicative-spec admonition" id="function-multiplicative-spec">
<p class="admonition-title">function-multiplicative-spec</p>
<ul class="simple">
<li><p><cite>“function1</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> <span class="math notranslate nohighlight">\(f_1\)</span> in <span class="math notranslate nohighlight">\(f(x) = f_1(x) * f_2(x)\)</span></p></li>
<li><p><cite>“function2</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> <span class="math notranslate nohighlight">\(f_2\)</span> in <span class="math notranslate nohighlight">\(f(x) = f_1(x) * f_2(x)\)</span></p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-multiplicative&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function1&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>function-specification
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function2&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>function-specification
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="composition-function">
<h4>Composition Function<a class="headerlink" href="#composition-function" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>FunctionComposition: f(x,y) = f1(x,y) * f2(x,y)</p>
</div></blockquote>
<p>Function composition simply applies one function to the result of another.</p>
<div class="math notranslate nohighlight">
\[f(x) = f_1( f_2(x) )\]</div>
<p>where <span class="math notranslate nohighlight">\(f_1\)</span> is defined by the <cite>“function1</cite>” sublist, and
<span class="math notranslate nohighlight">\(f_2\)</span> by the <cite>“function2</cite>” sublist.</p>
<div class="admonition-function-composition-spec admonition" id="function-composition-spec">
<p class="admonition-title">function-composition-spec</p>
<ul class="simple">
<li><p><cite>“function1</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> <span class="math notranslate nohighlight">\(f_1\)</span> in <span class="math notranslate nohighlight">\(f(x) = f_1(f_2(x))\)</span></p></li>
<li><p><cite>“function2</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> <span class="math notranslate nohighlight">\(f_2\)</span> in <span class="math notranslate nohighlight">\(f(x) = f_1(f_2(x))\)</span></p></li>
</ul>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-composition&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function1&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>function-specification
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function2&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span>function-specification
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="piecewise-bilinear-function">
<h4>Piecewise Bilinear Function<a class="headerlink" href="#piecewise-bilinear-function" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>FunctionBilinear: a piecewise bilinear function.</p>
</div></blockquote>
<p>A piecewise bilinear function extends the linear form of the tabular function to two variables.</p>
<p>Define <span class="math notranslate nohighlight">\(i(x) = i : x_i &lt; x &lt;= x_{{i+1}}\)</span> and similarly <span class="math notranslate nohighlight">\(j(y) = j : y_j &lt; y &lt;= y_{{j+1}}\)</span> for monotonically increasing <span class="math notranslate nohighlight">\(x_i\)</span> and <span class="math notranslate nohighlight">\(y_j\)</span>.</p>
<p>Given a two-dimensional array <span class="math notranslate nohighlight">\(u_{i,j}\)</span>, <span class="math notranslate nohighlight">\(f\)</span> is then defined by
bilinear interpolation on <span class="math notranslate nohighlight">\(u_{i(x),j(y)}, u_{i(x)+1,j(y)}, u_{i(x),j(y)+1}, u_{i(x)+1,j(y)+1}\)</span>,
if <span class="math notranslate nohighlight">\((x,y)\)</span> is in <span class="math notranslate nohighlight">\([x_0,x_n] \times [y_0,y_m]\)</span>, linear interpolation if one of <span class="math notranslate nohighlight">\(x,y\)</span>
are out of those bounds, and constant at the corner value if both are out of
bounds.</p>
<div class="admonition-function-bilinear-spec admonition" id="function-bilinear-spec">
<p class="admonition-title">function-bilinear-spec</p>
<ul class="simple">
<li><p><cite>“file</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> HDF5 filename of the data</p></li>
<li><p><cite>“row header</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> name of the row dataset, the <span class="math notranslate nohighlight">\(x_i\)</span></p></li>
<li><p><cite>“row coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> one of <cite>“t</cite>”,`”x`”,`”y`”,`”z`”</p></li>
<li><p><cite>“column header</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> name of the column dataset, the <span class="math notranslate nohighlight">\(y_i\)</span></p></li>
<li><p><cite>“column coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> one of <cite>“t</cite>”,`”x`”,`”y`”,`”z`”</p></li>
<li><p><cite>“value header</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> name of the values dataset, the <span class="math notranslate nohighlight">\(u_{{i,j}}\)</span></p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-bilinear&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;file&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;pressure.h5&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;row header&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;/time&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;row coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;t&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;column header&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;/x&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;column coordinate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;x&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value header&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;/pressure&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="distance-function">
<h4>Distance Function<a class="headerlink" href="#distance-function" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>FunctionDistance: distance from a reference point.</p>
</div></blockquote>
<p>A distance function calculates distance from reference point <span class="math notranslate nohighlight">\(x_0\)</span>
using by the following expression:</p>
<div class="math notranslate nohighlight">
\[f(x) = \sqrt( \sum_{j=0}^{n} m_j (x_j - x_{0,j})^2 )\]</div>
<p>Note that the first parameter in <span class="math notranslate nohighlight">\(x\)</span> can be time.</p>
<div class="admonition-function-distance-spec admonition" id="function-distance-spec">
<p class="admonition-title">function-distance-spec</p>
<ul class="simple">
<li><p><cite>“x0</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Point from which distance is measured.</p></li>
<li><p><cite>“metric</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Linear scaling metric, typically all 1s.</p></li>
</ul>
</div>
<p>Here is an example of a distance function using isotropic metric:</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-distance&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;x0&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{1.0, 3.0, 0.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;metric&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{1.0, 1.0, 1.0}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="monomial-function">
<h4>Monomial Function<a class="headerlink" href="#monomial-function" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>FunctionMonomial: a multivariate monomial function.</p>
</div></blockquote>
<p>A multi-variable monomial function is given by the following expression:</p>
<div class="math notranslate nohighlight">
\[f(x) = c \prod_{j=0}^{n} (x_j - x_{0,j})^{p_j}\]</div>
<p>with the constant factor <span class="math notranslate nohighlight">\(c\)</span>, the reference point <span class="math notranslate nohighlight">\(x_0\)</span>, and
integer exponents <span class="math notranslate nohighlight">\(p_j\)</span>.
Note that the first parameter in <span class="math notranslate nohighlight">\(x\)</span> can be time.</p>
<div class="admonition-function-monomial-spec admonition" id="function-monomial-spec">
<p class="admonition-title">function-monomial-spec</p>
<ul class="simple">
<li><p><cite>“c</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> c in <span class="math notranslate nohighlight">\(f = c \prod_{j=0}^{n} (x_j - x_{0,j})^{p_j}\)</span></p></li>
<li><p><cite>“x0</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> x0 in <span class="math notranslate nohighlight">\(f = c \prod_{j=0}^{n} (x_j - x_{0,j})^{p_j}\)</span></p></li>
<li><p><cite>“exponents</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code> p in <span class="math notranslate nohighlight">\(f = c \prod_{j=0}^{n} (x_j - x_{0,j})^{p_j}\)</span></p></li>
</ul>
</div>
<p>Conditions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">exponents</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is an example of monomial of degree 6 in three variables:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-monomial&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;c&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;x0&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{1.0, 3.0, 0.0}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;exponents&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{2, 3, 1}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
<section id="standard-math-function">
<h4>Standard Math Function<a class="headerlink" href="#standard-math-function" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Provides access to many common mathematical functions.</p>
</div></blockquote>
<p>These functions allow to set up non-trivial time-dependent boundary conditions
which increases a set of analytic solutions that can be used in convergence
analysis tests.</p>
<div class="math notranslate nohighlight">
\[f(x) = A * operator( p * (x - s) )\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[f(x) = A * operator(x-s, p)\]</div>
<p>Note that these operate only on the first coordinate, which is often time.
Function composition can be used to apply these to other coordinates (or
better yet a dimension could/should be added upon request).</p>
<div class="admonition-function-standard-math-spec admonition" id="function-standard-math-spec">
<p class="admonition-title">function-standard-math-spec</p>
<ul class="simple">
<li><p><cite>“operator</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> specifies the name of a standard mathematical
function.  Available options are:</p>
<ul>
<li><p>trigonometric operators: <cite>“cos</cite>”, <cite>“sin</cite>”, <cite>“tan</cite>”, <cite>“acos</cite>”, <cite>“asin</cite>”,
<cite>“atan</cite>”</p></li>
<li><p>hyperbolic trig operators: <cite>“cosh</cite>”, <cite>“sinh</cite>”, <cite>“tanh</cite>”</p></li>
<li><p>power/log operators: <cite>“pow</cite>”, <cite>“exp</cite>”, <cite>“log</cite>”, <cite>“log10</cite>”, <cite>“sqrt</cite>”,</p></li>
<li><p>integral operators: <cite>“ceil</cite>”, <cite>“floor</cite>”, <cite>“mod</cite>”,</p></li>
<li><p><cite>“abs</cite>”, <cite>“fabs</cite>”, <cite>“positive</cite>” (0 for negative values), <cite>“negative</cite>” (0
for positive values), <cite>“heaviside</cite>”, <cite>“sign</cite>”</p></li>
</ul>
</li>
<li><p><cite>“amplitude</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> specifies a multiplication factor <cite>a</cite> in
formula <cite>a f(x)</cite>.  The multiplication factor is ignored by function
<cite>mod</cite>. Default value is 1.</p></li>
<li><p><cite>“parameter</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> specifies additional parameter <cite>p</cite> for
math functions with two arguments. These functions are <cite>“a pow(x[0], p)</cite>”
and <cite>“a mod(x[0], p)</cite>”.  Alternative, scales the argument before
application, for use in changing the period of trig functions.</p></li>
<li><p><cite>“shift</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> specifies a shift of the function argument. Default
is 0.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function-standard-math&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;operator&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;sqrt&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;amplitude&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1e-7&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;shift&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0.1&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>This example defines function <cite>1e-7 sqrt(t-0.1)</cite>.</p>
</section>
</section>
<section id="operator">
<h3><a class="toc-backref" href="#id65" role="doc-backlink">Operator</a><a class="headerlink" href="#operator" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>Operator represents a linear map, and typically encapsulates a discretization.</p>
</div></blockquote>
<p>Operators are discrete forms of linearized PDEs operators.
They form a layer between physical process kernels and solvers
and include accumulation, diffusion, advection, elasticity, reaction,
and source operators.
The residual associated with an operator <span class="math notranslate nohighlight">\(L_h\)</span> helps to
understand the employed sign convention:</p>
<div class="math notranslate nohighlight">
\[r = f - L_h u.\]</div>
<p>Operator represents a map from linear space X to linear space Y.  Typically,
this map is a linear map, and encapsulates much of the discretization involved
in moving from continuous to discrete equations. The spaces X and Y are described
by CompositeVectors (CV). A few maps X-&gt;Y are supported.</p>
<p>An operator provides an interface for applying both the forward and inverse
linear map (assuming the map is invertible).</p>
<p>Typically the Operator is never seen by the user; instead the user provides
input information for helper classes based on the continuous mathematical
operator and the desired discretization.  These helpers build the needed
<code class="docutils literal notranslate"><span class="pre">Operator</span></code>, which may include information from multiple helpers (i.e. in the
case of Jacobian Operators for a PDE).</p>
<p>However, one option may be provided by the user, which is related to dealing
with nearly singular operators:</p>
<ul class="simple">
<li><p><cite>“diagonal shift</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.0</strong> Adds a scalar shift to the diagonal
of the <code class="docutils literal notranslate"><span class="pre">Operator</span></code>, which can be useful if the <code class="docutils literal notranslate"><span class="pre">Operator</span></code> is singular or
near-singular.</p></li>
</ul>
<p>A PK decides how to bundle operators in a collection of operators.
For example, an advection-diffusion problem may benefit from using
a single operator that combines two operators representing diffusion and advection process.
Collection of operators must be used for implicit solvers and for building preconditioners.
In such a case, the collections acts as a single operator.</p>
<p>Operators use a few tools that are generic in nature and can be used independently by PKs.
The list includes reconstruction and limiting algorithms.</p>
<section id="schema">
<h4>Schema<a class="headerlink" href="#schema" title="Permalink to this heading"></a></h4>
<p>The operators use notion of schema to describe operator’s abstract structure.
Old operators use a simple schema which is simply the list of geometric objects where
scalar degrees of freedom are defined.
New operators use a list to define location, type, and number of degrees of freedom.
In addition, the base of local stencil is either <em>face</em> or <em>cell</em>.
A rectangular operator needs two schemas do describe its domain (called <cite>“schema domain</cite>”)
and its range (called <cite>“schema range</cite>”).
A square operator may use either two identical schema lists or a single list called <cite>“schema</cite>”.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pks operator name&quot;</span><span class="nt">&gt;</span><span class="w">  </span><span class="cm">&lt;!-- parent list--&gt;</span>
<span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema domain&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;cell&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;location&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{node, face}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{scalar, normal component}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;number&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{2, 1}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema domain&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;cell&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;location&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{node, face}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{scalar, normal component}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;number&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{2, 1}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>This example describes a square operator with two degrees of freedom per mesh node and one
degree of freedom per mesh face.
The face-based degree of freedom is the normal component of a vector field.
Such set of degrees of freedom is used in the Bernardi-Raugel element for discretizing
Stokes equations.
Parameter <cite>“base</cite>” indicates that local matrices are associated with mesh cells.</p>
</section>
<section id="pde-accumulation">
<h4>PDE_Accumulation<a class="headerlink" href="#pde-accumulation" title="Permalink to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">PDE_Accumulation</span></code> assembles the discrete form of <span class="math notranslate nohighlight">\(\frac{\partial A}{\partial t}\)</span>.</p>
<p>This class is usually used as part of a preconditioner, providing the linearization:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial}{\partial A} \left[ \frac{\partial A}{\partial t} \right]_{A_0} i
= \frac{|\Omega_E|}{\Delta t}\]</div>
<p>for a grid element <span class="math notranslate nohighlight">\(\Omega_E\)</span>.</p>
<div class="admonition-pde-accumulation-spec admonition" id="pde-accumulation-spec">
<p class="admonition-title">pde-accumulation-spec</p>
<ul class="simple">
<li><p><cite>“entity kind</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong> Typically set by the PK</p></li>
<li><p><cite>“number of vectors</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>optional</strong> Typically set by the PK</p></li>
</ul>
</div>
</section>
<section id="pde-diffusion">
<h4>PDE_Diffusion<a class="headerlink" href="#pde-diffusion" title="Permalink to this heading"></a></h4>
<p><code class="docutils literal notranslate"><span class="pre">PDE_Diffusion</span></code> forms local <code class="docutils literal notranslate"><span class="pre">Op</span></code> s and global <code class="docutils literal notranslate"><span class="pre">Operator</span></code> s for elliptic equations:</p>
<div class="math notranslate nohighlight">
\[\nabla \cdot k \nabla u\]</div>
<p>with a variety of discretizations. Note also, for reasons that are one part historical
and potentially not that valid, this also supports and implementation with an advective
source, i.e.:</p>
<div class="math notranslate nohighlight">
\[\nabla \cdot K k (\nabla (u + b g z))\]</div>
<p>for gravitational terms in Richards equations.</p>
<p>The input spec for a diffusion operator consists of:</p>
<ul class="simple">
<li><p><cite>“discretization primary</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> See below for supported options.</p>
<ul>
<li><p><cite>“fv: default</cite>” the standard two-point flux finite volume discretization</p></li>
<li><p><cite>“nlfv: default</cite>” the nonlinear finite volume method of ???</p></li>
<li><p>MFD methods, including:</p>
<ul>
<li><p><cite>“mfd: default</cite>”</p></li>
<li><p><cite>“mfd: monotone for hex</cite>”</p></li>
<li><p><cite>“mfd: optimized for monotonicity</cite>”</p></li>
<li><p><cite>“mfd: two-point flux approximation</cite>”</p></li>
<li><p><cite>“mfd: optimized for sparsity</cite>”</p></li>
<li><p><cite>“mfd: support operator</cite>”</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<div><p>Note that the most commonly used are <cite>“fv: default</cite>” for simple test
problems (this method is not particularly accurate for distorted
meshes), <cite>“mfd: optimized for sparsity</cite>” for most real problems on
unstructured meshes, and <cite>“mfd: optimized for monotonicity</cite>” for
orthogonal meshes with diagonal tensor/scalar coefficients.</p>
</div></blockquote>
<ul class="simple">
<li><p><cite>“gravity</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> specifies if the gravitational flow term is included</p></li>
<li><p><cite>“Newton correction</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> specifies a model for non-physical terms
that must be added to the matrix. These terms represent Jacobian and are needed
for the preconditioner. Available options are <cite>“true Jacobian</cite>” and <cite>“approximate Jacobian</cite>”.
The FV scheme accepts only the first options. The other schemes accept only the second option.</p></li>
<li><p><cite>“scaled constraint equation</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> rescales flux continuity equations
on mesh faces.  These equations are formed without the nonlinear
coefficient. This option allows us to treat the case of zero nonlinear
coefficient, which otherwise generates zero rows in the operator, which is
then singular.  At moment this feature does not work with non-zero gravity
term.</p></li>
<li><p><cite>“constraint equation scaling cutoff</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> specifies the cutoff value for
applying rescaling strategy described above.</p></li>
</ul>
<blockquote>
<div><p>Diffusion generates local Ops and global Operators for an elliptic operator.</p>
</div></blockquote>
<p>Diffusion is the most frequently used operator. It employs the old schema.</p>
<ul class="simple">
<li><p><cite>“pks operator name</cite>” [list] a PK specific name for the diffusion operator.</p>
<ul>
<li><p><cite>“discretization primary</cite>” [string] specifies an advanced discretization method that
has useful properties under some a priori conditions on the mesh and/or permeability tensor.
The available options are <cite>“mfd: optimized for sparsity</cite>”, <cite>“mfd: optimized for monotonicity</cite>”,
<cite>“mfd: default</cite>”, <cite>“mfd: support operator</cite>”, <cite>“mfd: two-point flux approximation</cite>”,
<cite>“fv: default</cite>”, and <cite>“nlfv: default</cite>”.
The first option is recommended for general meshes.
The second option is recommended for orthogonal meshes and diagonal absolute
permeability tensor.</p></li>
<li><p><cite>“discretization secondary</cite>” [string] specifies the most robust discretization method
that is used when the primary selection fails to satisfy all a priori conditions.
Default value is equal to that for the primary discretization.</p></li>
<li><p><cite>“diffusion tensor</cite>” [string] specifies additional properties of the diffusion tensor.
It allows us to solve problems with non-symmetric but positive definite tensors.
Available options are <em>symmetric</em> (default) and <em>nonsymmetric</em>.</p></li>
<li><p><cite>“nonlinear coefficient</cite>” [string] specifies a method for treating nonlinear diffusion
coefficient, if any. Available options are <cite>“none</cite>”, <cite>“upwind: face</cite>”, <cite>“divk: cell-face</cite>” (default),
<cite>“divk: face</cite>”, <cite>“standard: cell</cite>”, and <cite>“divk: cell-face-twin</cite>”.
Symmetry preserving methods are the divk-family of methods and the classical cell-centered
method (<cite>“standard: cell</cite>”). The first part of the name indicates the base scheme.
The second part (after the semi-column) indicates required components of the composite vector
that must be provided by a physical PK.
Default is <cite>“none</cite>”.</p></li>
<li><p><cite>“schema</cite>” [Array(string)] defines the operator stencil. It is a collection of
geometric objects. It equals to <cite>“{cell}</cite>” for finite volume schemes.
It is typically <cite>“{face, cell}</cite>” for mimetic discretizations.</p></li>
<li><p><cite>“preconditioner schema</cite>” [Array(string)] defines the preconditioner stencil.
It is needed only when the default assembling procedure is not desirable.
If skipped, the <cite>“schema</cite>” is used instead.</p></li>
<li><p><cite>“gravity</cite>” [bool] specifies if flow is driven also by the gravity.</p></li>
<li><p><cite>“gravity term discretization</cite>” [string] selects a model for discretizing the
gravity term. Available options are <cite>“hydraulic head</cite>” [default] and <cite>“finite volume</cite>”.
The first option starts with equation for the shifted solution, i.e. the hydraulic head,
and derives gravity discretization by the reserve shifting.
The second option is based on the divergence formula.</p></li>
<li><p><cite>“gravity magnitude</cite>” [double] defined magnitude of the gravity vector.</p></li>
<li><p><cite>“Newton correction</cite>” [string] specifies a model for correction (non-physical) terms
that must be added to the preconditioner. These terms approximate some Jacobian terms.
Available options are <cite>“true Jacobian</cite>” and <cite>“approximate Jacobian</cite>”.
The FV scheme accepts only the first options. The othre schemes accept only the second option.</p></li>
<li><p><cite>“scaled constraint equation</cite>” [bool] rescales flux continuity equations on mesh faces.
These equations are divided by the nonlinear coefficient. This option allows us to
treat the case of zero nonlinear coefficient. At moment this feature does not work
with non-zero gravity term. Default is <em>false</em>.</p></li>
<li><p><cite>“constraint equation scaling cutoff”</cite>” [double] specifies the cutoff value for
applying rescaling strategy described above.</p></li>
<li><p><cite>“consistent faces</cite>” [list] may contain a <cite>“preconditioner</cite>” and
<cite>“linear operator</cite>” list (see sections <a class="reference internal" href="#preconditioners">Preconditioners</a> and <a class="reference internal" href="#linearsolvers">LinearSolvers</a>
respectively).  If these lists are provided, and the <cite>“discretization
primary</cite>” is of type <cite>“mfd: *</cite>”, then the diffusion method
UpdateConsistentFaces() can be used.  This method, given a set of cell
values, determines the faces constraints that satisfy the constraint
equation in MFD by assembling and inverting the face-only system.  This is
not currently used by any Amanzi PKs.</p></li>
<li><p><cite>“fracture</cite>” [Array(string)] provides list of regions that defines a fracture network.
This parameter is used only by the coupled flow PK.</p></li>
</ul>
</li>
</ul>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pks operator name&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;discretization primary&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;mfd: optimized for monotonicity&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;discretization secondary&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;mfd: two-point flux approximation&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{face, cell}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;preconditioner schema&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{face}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gravity&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;bool&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gravity term discretization&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;hydraulic head&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gravity magnitude&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;9.81&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nonlinear coefficient&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;upwind: face&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Newton correction&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true Jacobian&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;consistent faces&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;linear solver&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span>...
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;preconditioner&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span>...
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>This example creates a p-lambda system, i.e. the pressure is
discretized in mesh cells and on mesh faces.
The preconditioner is defined on faces only, i.e. cell-based unknowns
are eliminated explicitly and the preconditioner is applied to the
Schur complement.</p>
<p>Additional options available only for the MFD family of discretizations include:</p>
<ul class="simple">
<li><p><cite>“nonlinear coefficient</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> specifies a method for treating nonlinear
diffusion coefficient, if any. Available options are <cite>“none</cite>”, <cite>“upwind:
face</cite>”, <cite>“divk: cell-face</cite>” (default), <cite>“divk: face</cite>”, <cite>“standard: cell</cite>”,
<cite>“divk: cell-face-twin</cite>” and <cite>“divk: cell-grad-face-twin</cite>”.  Symmetry
preserving methods are the divk-family of methods and the classical
cell-centered method (<cite>“standard: cell</cite>”). The first part of the name
indicates the base scheme.  The second part (after the semi-column)
indicates required components of the composite vector that must be provided
by a physical PK.</p></li>
<li><p><cite>“discretization secondary</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> specifies the most robust
discretization method that is used when the primary selection fails to
satisfy all a priori conditions.  This is typically <cite>“mfd: default</cite>”, and is
used only when an MFD <cite>“discretization primary</cite>” is used.</p></li>
<li><p><cite>“schema</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> defines the operator stencil. It is a collection of
geometric objects.  Typically this is set by the implementation and is not provided.</p></li>
<li><p><cite>“preconditioner schema</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> <strong>{face,cell}</strong> Defines the
preconditioner stencil.  It is needed only when the default assembling
procedure is not desirable. If skipped, the <cite>“schema</cite>” is used instead.
In addition to the default, <strong>{face}</strong> may be used, which forms the Schur
complement.</p></li>
<li><p><cite>“consistent faces</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> may contain a <cite>“preconditioner</cite>” and
<cite>“linear operator</cite>” list (see sections <a class="reference internal" href="#preconditioners">Preconditioners</a> and <a class="reference internal" href="#linearsolvers">LinearSolvers</a>
respectively).  If these lists are provided, and the <cite>“discretization
primary</cite>” is of type <cite>“mfd: *</cite>”, then the diffusion method
UpdateConsistentFaces() can be used.  This method, given a set of cell
values, determines the faces constraints that satisfy the constraint
equation in MFD by assembling and inverting the face-only system.  This is
not currently used by any Amanzi PKs.</p></li>
<li><p><cite>“diffusion tensor</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> allows us to solve problems with symmetric and
non-symmetric (but positive definite) tensors. Available options are <em>symmetric</em>
(default) and <em>nonsymmetric</em>.</p></li>
<li><p><cite>“use manifold flux</cite>”  <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Computes the flux using algorithms
and data structures for manifolds or fracture networks.</p></li>
</ul>
<p>Additional options for MFD with the gravity term include:</p>
<ul class="simple">
<li><p><cite>“gravity term discretization</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> selects a model for discretizing the
gravity term. Available options are <cite>“hydraulic head</cite>” (default) and <cite>“finite volume</cite>”.
The first option starts with equation for the shifted solution, i.e. the hydraulic
head, and derives gravity discretization by the reserve shifting.
The second option is based on the divergence formula.</p></li>
</ul>
</section>
<section id="pde-advection">
<h4>PDE_Advection<a class="headerlink" href="#pde-advection" title="Permalink to this heading"></a></h4>
<p>A high-order advection operator may have different domain and range and therefore requires two schemas.
The structure of the new schema is described in the previous section.
A high-order advection operator has two terms in a weak formulation, corresponding to
volume and surface integrals. These two terms are discretixed using two operators with
matrix of types <em>advection</em> and <em>flux</em>, respectively.</p>
<ul class="simple">
<li><p><cite>“pks operator name</cite>” [list] a PK specific name for the advection operator.</p>
<ul>
<li><p><cite>“method</cite>” [string] defines a discretization method. The available option is <cite>“dg modal</cite>”.</p></li>
<li><p><cite>“method order</cite>” [int] defines method order. For example, the classical low-order finite
volume scheme is equivalent to DG of order 0.</p></li>
<li><p><cite>“matrix type</cite>” [string] defines matrix type. The supported options are <cite>“advection</cite>”
and <cite>“flux</cite>”.</p></li>
<li><p><cite>“dg basis</cite>” [string] defines bases for DG schemes. The available options are
<cite>“regularized</cite>” (recommended), <cite>“normalized</cite>”, <cite>“orthonormalized</cite>”, and <cite>“natural</cite>”
(not recommended).</p></li>
<li><p><cite>“gradient operator on test function</cite>” [bool] defines place of the gradient operator.
For integration by parts schemes, the gradient is transfered to a test function.
This option is needed for discretizing volumetric integrals.</p></li>
<li><p><cite>“jump operator on test function</cite>” [bool] defines place of the jump operator.
For integration by parts schemes, the jump operator is applied to a test function.
This option is needed for discretizing surface fluxes.</p></li>
<li><p><cite>“flux formula</cite>” [string] defines type of the flux. The available options
are <cite>“Rusanov</cite>” (default), <cite>“upwind</cite>”, <cite>“downwind</cite>”, and <cite>“NavierStokes</cite>”.</p></li>
<li><p><cite>“schema domain</cite>” [list] defines a discretization schema for the operator domain.</p></li>
<li><p><cite>“schema range</cite>” [list] defines a discretization schema for the operator range.</p></li>
</ul>
</li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pks operator name&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;method&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;dg modal&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;method order&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;flux formula&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Rusanov&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;matrix type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;flux&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;jump operator on test function&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;bool&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema domain&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;cell&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;location&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{node, face}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{scalar, normal component}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;number&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{2, 1}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema range&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;cell&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;location&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{cell}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{scalar}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;number&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{1}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>In this example, we construct an operator for volumetric integrals in a weak formulation
of advection problem.</p>
<p>The only low-order advection operator in Amanzi is the upwind operator.
It employes the old schema.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pks operator name&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;face&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{cell}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;method order&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;matrix type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;advection&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">PDE_AdvectionUpwind</span></code> assembles the discrete form of:</p>
<div class="math notranslate nohighlight">
\[\nabla \cdot (q C)\]</div>
<p>which advects quantity <span class="math notranslate nohighlight">\(C\)</span> with fluxes <span class="math notranslate nohighlight">\(q\)</span>.</p>
<p>This is a simple, first-order donor-upwind scheme, and is recommended
for use in diffusion-dominated advection-diffusion equations.</p>
</section>
</section>
<section id="field-initializers">
<h3><a class="toc-backref" href="#id66" role="doc-backlink">Field Initializers</a><a class="headerlink" href="#field-initializers" title="Permalink to this heading"></a></h3>
<p>Fields, also known by their underlying datatype, the CompositeVector,
can be initialized in a variety of ways.  These are used in a variety
of places as generic capability.</p>
<section id="function-initialization">
<h4>Function Initialization<a class="headerlink" href="#function-initialization" title="Permalink to this heading"></a></h4>
<blockquote id="compositevectorfunction">
<div><p>Mesh Functions, evaluate a function on a mesh and stick the result in a vector.</p>
</div></blockquote>
<p>CompositeVectorFunctions are ways of evaluating a piecewise function on a
mesh and sticking the result into a CompositeVector.</p>
<p>This is used in a variety of ways – Initial Conditions, Boundary
Conditions, and Independent Variable Evaluators.</p>
<p>Typically any containing object of this spec is a list of these specs.  The
list is indexed by Region, and the regions (logically) should partition the
domain (or boundary of the domain in the case of BCs).</p>
<p>Each entry in that list is a:</p>
<div class="admonition-composite-vector-function-spec admonition" id="composite-vector-function-spec">
<p class="admonition-title">composite-vector-function-spec</p>
<p>ONE OF</p>
<ul class="simple">
<li><p><cite>“region</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Region on which this function is evaluated.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“regions</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> List of regions on which this function is evaluated.</p></li>
</ul>
<p>END</p>
<p>ONE OF</p>
<ul class="simple">
<li><p><cite>“component</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Mesh component to evaluate this on.  This is
one of “cell”, “face”, “node”, “edge”, or “boundary_face”. The last two
may require additional conditions, such as a proper mesh initialization.
The mask “*” could be used in place of the component name.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“components</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> Mesh components to evaluate this on.
This is some collection of “cell”, “face”, “node”, “edge”, and/or
“boundary_face”. The last two may require additional conditions, such as a
proper mesh initialization.  The array with the single entry “*” could be
used to initialize all existing components.</p></li>
</ul>
<p>END</p>
<ul class="simple">
<li><p><cite>“function</cite>” <code class="docutils literal notranslate"><span class="pre">[function-typedinline-spec]</span></code> The spec to provide the actual algebraic function.</p></li>
</ul>
</div>
</section>
<section id="column-file-initialization">
<h4>Column File Initialization<a class="headerlink" href="#column-file-initialization" title="Permalink to this heading"></a></h4>
<p>Interpolate a depth-based, 1D column of data onto a mesh.  Values are
prescribed only to cells.  Expected is an HDF5 file in the format:</p>
<p>Depth coordinates z:</p>
<blockquote>
<div><dl class="simple">
<dt>/z[:] = (z_0, z_1, … , z_n)</dt><dd><p>z_0 = 0.0
z_n &gt;= max depth of mesh
z_i &gt; z_(i-1)</p>
</dd>
</dl>
</div></blockquote>
<p>Function values u:</p>
<blockquote>
<div><p>/f[:] = (f_0(z_0), f_1(z_1), …, f_n(z_n))</p>
</div></blockquote>
<div class="admonition-column-initialization-spec admonition">
<p class="admonition-title">column-initialization-spec</p>
<ul class="simple">
<li><p><cite>“file</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> HDF5 filename</p></li>
<li><p><cite>“z header</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> name of the z-coordinate data: <cite>z</cite> above.  Depth
coordinates (positive downward from the surface), [m]</p></li>
<li><p><cite>“f header</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> name of the function data: <cite>f</cite> above.</p></li>
</ul>
<p>ONE OF</p>
<ul class="simple">
<li><p><cite>“surface sideset</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Region on the surface domain from which
to start to determine columns.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“surface sidesets</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> Regions on the surface domain
from which to start to determine columns.</p></li>
</ul>
<p>END</p>
</div>
</section>
<section id="exodus-file-initialization">
<h4>Exodus File Initialization<a class="headerlink" href="#exodus-file-initialization" title="Permalink to this heading"></a></h4>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../input_spec.html" class="btn btn-neutral float-left" title="Input Specification" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ATSNativeSpec_1_4.html" class="btn btn-neutral float-right" title="ATS Native XML Input Specification V-1.4" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 202X, jointly shared by contributor institutions.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>