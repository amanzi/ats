

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ATS Native XML Input Specification V1 &mdash; ATS 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> ATS
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../demos.html">ATS Demo Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input_spec.html">Input Specification</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ATS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>ATS Native XML Input Specification V1</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/input_spec/ATSNativeSpec_1_0.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="ats-native-xml-input-specification-v1">
<h1><a class="toc-backref" href="#id8">ATS Native XML Input Specification V1</a><a class="headerlink" href="#ats-native-xml-input-specification-v1" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title"><strong>Table of Contents</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#ats-native-xml-input-specification-v1" id="id8">ATS Native XML Input Specification V1</a></p></li>
<li><p><a class="reference internal" href="#syntax-of-the-specification" id="id9">Syntax of the Specification</a></p></li>
<li><p><a class="reference internal" href="#symbol-index" id="id10">Symbol Index</a></p></li>
<li><p><a class="reference internal" href="#main" id="id11">Main</a></p></li>
<li><p><a class="reference internal" href="#mesh" id="id12">Mesh</a></p>
<ul>
<li><p><a class="reference internal" href="#generated-mesh" id="id13">Generated Mesh</a></p></li>
<li><p><a class="reference internal" href="#read-mesh-file" id="id14">Read Mesh File</a></p></li>
<li><p><a class="reference internal" href="#logical-mesh" id="id15">Logical Mesh</a></p></li>
<li><p><a class="reference internal" href="#surface-mesh" id="id16">Surface Mesh</a></p></li>
<li><p><a class="reference internal" href="#subgrid-meshes" id="id17">Subgrid Meshes</a></p></li>
<li><p><a class="reference internal" href="#column-meshes" id="id18">Column Meshes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#region" id="id19">Region</a></p>
<ul>
<li><p><a class="reference internal" href="#all" id="id20">All</a></p></li>
<li><p><a class="reference internal" href="#box" id="id21">Box</a></p></li>
<li><p><a class="reference internal" href="#plane" id="id22">Plane</a></p></li>
<li><p><a class="reference internal" href="#labeled-set" id="id23">Labeled Set</a></p></li>
<li><p><a class="reference internal" href="#function-color" id="id24">Function Color</a></p></li>
<li><p><a class="reference internal" href="#point" id="id25">Point</a></p></li>
<li><p><a class="reference internal" href="#logical" id="id26">Logical</a></p></li>
<li><p><a class="reference internal" href="#polygon" id="id27">Polygon</a></p></li>
<li><p><a class="reference internal" href="#enumerated" id="id28">Enumerated</a></p></li>
<li><p><a class="reference internal" href="#boundary" id="id29">Boundary</a></p></li>
<li><p><a class="reference internal" href="#box-volume-fractions" id="id30">Box Volume Fractions</a></p></li>
<li><p><a class="reference internal" href="#line-segment" id="id31">Line Segment</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#coordinator" id="id32">Coordinator</a></p></li>
<li><p><a class="reference internal" href="#visualization" id="id33">Visualization</a></p></li>
<li><p><a class="reference internal" href="#checkpoint" id="id34">Checkpoint</a></p></li>
<li><p><a class="reference internal" href="#observation" id="id35">Observation</a></p></li>
<li><p><a class="reference internal" href="#pk" id="id36">PK</a></p>
<ul>
<li><p><a class="reference internal" href="#base-pks" id="id37">Base PKs</a></p>
<ul>
<li><p><a class="reference internal" href="#pk-physical" id="id38">PK: Physical</a></p></li>
<li><p><a class="reference internal" href="#pk-bdf" id="id39">PK: BDF</a></p></li>
<li><p><a class="reference internal" href="#pk-physical-and-bdf" id="id40">PK: Physical and BDF</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#physical-pks" id="id41">Physical PKs</a></p>
<ul>
<li><p><a class="reference internal" href="#flow-pks" id="id42">Flow PKs</a></p>
<ul>
<li><p><a class="reference internal" href="#richards-pk" id="id43">Richards PK</a></p></li>
<li><p><a class="reference internal" href="#permafrost-flow-pk" id="id44">Permafrost Flow PK</a></p></li>
<li><p><a class="reference internal" href="#overland-flow-pk" id="id45">Overland Flow PK</a></p></li>
<li><p><a class="reference internal" href="#overland-flow-with-ice" id="id46">Overland Flow with Ice</a></p></li>
<li><p><a class="reference internal" href="#snow-distribution-pk" id="id47">Snow Distribution PK</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#energy-pks" id="id48">Energy PKs</a></p>
<ul>
<li><p><a class="reference internal" href="#energy-base-pk" id="id49">Energy Base PK</a></p></li>
<li><p><a class="reference internal" href="#two-phase-subsurface-energy-pk" id="id50">Two-Phase subsurface Energy PK</a></p></li>
<li><p><a class="reference internal" href="#three-phase-subsurface-energy-pk" id="id51">Three-Phase subsurface Energy PK</a></p></li>
<li><p><a class="reference internal" href="#overland-energy-with-ice" id="id52">Overland energy with Ice</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#surface-energy-balance-pks" id="id53">Surface Energy Balance PKs</a></p>
<ul>
<li><p><a class="reference internal" href="#balance-equation" id="id54">Balance Equation</a></p></li>
<li><p><a class="reference internal" href="#snow-balance-equation" id="id55">Snow Balance Equation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#biogeochemistry" id="id56">Biogeochemistry</a></p>
<ul>
<li><p><a class="reference internal" href="#biogeochemistry-monolithic-version" id="id57">Biogeochemistry – Monolithic Version</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#deformation" id="id58">Deformation</a></p>
<ul>
<li><p><a class="reference internal" href="#volumetric-deformation" id="id59">Volumetric Deformation</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#mpc" id="id60">MPC</a></p>
<ul>
<li><p><a class="reference internal" href="#base-mpc" id="id61">Base MPC</a></p></li>
<li><p><a class="reference internal" href="#weakmpc" id="id62">WeakMPC</a></p></li>
<li><p><a class="reference internal" href="#strongmpc" id="id63">StrongMPC</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#physical-mpcs" id="id64">Physical MPCs</a></p>
<ul>
<li><p><a class="reference internal" href="#coupled-water-mpc" id="id65">Coupled Water MPC</a></p></li>
<li><p><a class="reference internal" href="#coupled-cells-mpc" id="id66">Coupled Cells MPC</a></p></li>
<li><p><a class="reference internal" href="#subsurface-mpc" id="id67">Subsurface MPC</a></p></li>
<li><p><a class="reference internal" href="#permafrost-mpc" id="id68">Permafrost MPC</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#globalization-delegates" id="id69">Globalization Delegates</a></p>
<ul>
<li><p><a class="reference internal" href="#coupled-water-globalization-delegate" id="id70">Coupled Water Globalization Delegate</a></p></li>
<li><p><a class="reference internal" href="#ewc-globalization-delegate" id="id71">EWC Globalization Delegate</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#state" id="id72">State</a></p>
<ul>
<li><p><a class="reference internal" href="#field-evaluators" id="id73">Field Evaluators</a></p>
<ul>
<li><p><a class="reference internal" href="#primaryvariableevaluator" id="id74">PrimaryVariableEvaluator</a></p></li>
<li><p><a class="reference internal" href="#independentvariableevaluator" id="id75">IndependentVariableEvaluator</a></p>
<ul>
<li><p><a class="reference internal" href="#from-function" id="id76">From Function</a></p></li>
<li><p><a class="reference internal" href="#from-file" id="id77">From File</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#water-content" id="id78">Water Content</a></p>
<ul>
<li><p><a class="reference internal" href="#richards-equation-water-content" id="id79">Richards Equation water content</a></p></li>
<li><p><a class="reference internal" href="#liquid-gas-water-content" id="id80">Liquid+Gas water content</a></p></li>
<li><p><a class="reference internal" href="#liquid-ice-water-content" id="id81">Liquid+Ice water content</a></p></li>
<li><p><a class="reference internal" href="#liquid-ice-gas-water-content" id="id82">Liquid+Ice+Gas water content</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#surface-water-potential-surfaces" id="id83">Surface Water potential surfaces</a></p>
<ul>
<li><p><a class="reference internal" href="#surfaceelevation" id="id84">SurfaceElevation</a></p></li>
<li><p><a class="reference internal" href="#surfacepotential" id="id85">SurfacePotential</a></p></li>
<li><p><a class="reference internal" href="#snowsurfacepotential" id="id86">SnowSurfacePotential</a></p></li>
<li><p><a class="reference internal" href="#surface-water-content" id="id87">Surface water content</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#generic-evaluators" id="id88">Generic Evaluators</a></p>
<ul>
<li><p><a class="reference internal" href="#additive" id="id89">Additive</a></p></li>
<li><p><a class="reference internal" href="#multiplicative" id="id90">Multiplicative</a></p></li>
<li><p><a class="reference internal" href="#column-summation" id="id91">Column summation</a></p></li>
<li><p><a class="reference internal" href="#subgrid-disaggregation" id="id92">Subgrid disaggregation</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#initialconditions" id="id93">InitialConditions</a></p>
<ul>
<li><p><a class="reference internal" href="#initialization-of-constant-scalars" id="id94">Initialization of constant scalars</a></p></li>
<li><p><a class="reference internal" href="#initialization-of-constant-vectors" id="id95">Initialization of constant vectors</a></p></li>
<li><p><a class="reference internal" href="#initialization-of-scalar-fields" id="id96">Initialization of scalar fields</a></p></li>
<li><p><a class="reference internal" href="#initialization-of-tensor-fields" id="id97">Initialization of tensor fields</a></p></li>
<li><p><a class="reference internal" href="#initialization-from-a-file" id="id98">Initialization from a file</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#boundaryconditions" id="id99">BoundaryConditions</a></p>
<ul>
<li><p><a class="reference internal" href="#flow-specific-boundary-conditions" id="id100">Flow-specific Boundary Conditions</a></p>
<ul>
<li><p><a class="reference internal" href="#dirichlet-pressure-boundary-conditions" id="id101">Dirichlet (pressure) boundary conditions</a></p></li>
<li><p><a class="reference internal" href="#neumann-mass-flux-boundary-conditions" id="id102">Neumann (mass flux) boundary conditions</a></p></li>
<li><p><a class="reference internal" href="#seepage-face-boundary-conditions" id="id103">Seepage face boundary conditions</a></p></li>
<li><p><a class="reference internal" href="#dirichlet-head-boundary-conditions" id="id104">Dirichlet (head) boundary conditions</a></p></li>
<li><p><a class="reference internal" href="#fixed-level-boundary-conditions" id="id105">Fixed level boundary conditions</a></p></li>
<li><p><a class="reference internal" href="#zero-head-gradient-boundary-conditions" id="id106">Zero head gradient boundary conditions</a></p></li>
<li><p><a class="reference internal" href="#critical-depth-boundary-conditions" id="id107">Critical depth boundary conditions</a></p></li>
<li><p><a class="reference internal" href="#dynamic-boundary-condutions" id="id108">Dynamic boundary condutions</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#time-integrators-solvers-and-other-mathematical-specs" id="id109">Time integrators, solvers, and other mathematical specs</a></p>
<ul>
<li><p><a class="reference internal" href="#timeintegrator" id="id110">TimeIntegrator</a></p>
<ul>
<li><p><a class="reference internal" href="#explicit-time-integration" id="id111">Explicit Time Integration</a></p></li>
<li><p><a class="reference internal" href="#backward-euler" id="id112">Backward Euler</a></p>
<ul>
<li><p><a class="reference internal" href="#bdf1-solver-interface" id="id113">BDF1 Solver Interface</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#timestep-controller" id="id114">Timestep Controller</a></p>
<ul>
<li><p><a class="reference internal" href="#timestep-controller-fixed" id="id115">Timestep Controller Fixed</a></p></li>
<li><p><a class="reference internal" href="#timestep-controller-standard" id="id116">Timestep Controller Standard</a></p></li>
<li><p><a class="reference internal" href="#timestep-controller-smarter" id="id117">Timestep Controller Smarter</a></p></li>
<li><p><a class="reference internal" href="#timestep-controller-adaptive" id="id118">Timestep Controller Adaptive</a></p></li>
<li><p><a class="reference internal" href="#timestep-controller-from-file" id="id119">Timestep Controller From File</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#nonlinear-solver" id="id120">Nonlinear Solver</a></p>
<ul>
<li><p><a class="reference internal" href="#solver-newton-and-inexact-newton" id="id121">Solver: Newton and Inexact Newton</a></p></li>
<li><p><a class="reference internal" href="#solver-jacobian-free-newton-krylov" id="id122">Solver: Jacobian-Free Newton Krylov</a></p></li>
<li><p><a class="reference internal" href="#solver-newton-with-line-search" id="id123">Solver: Newton with Line Search</a></p></li>
<li><p><a class="reference internal" href="#solver-nonlinear-continuation" id="id124">Solver: Nonlinear Continuation</a></p></li>
<li><p><a class="reference internal" href="#solver-nonlinear-krylov-acceleration" id="id125">Solver: Nonlinear Krylov Acceleration</a></p></li>
<li><p><a class="reference internal" href="#solver-anderson-acceleration" id="id126">Solver: Anderson Acceleration</a></p></li>
<li><p><a class="reference internal" href="#solver-nka-with-line-search" id="id127">Solver: NKA with Line Search</a></p></li>
<li><p><a class="reference internal" href="#solver-nka-with-line-search-ats" id="id128">Solver: NKA with Line Search, ATS</a></p></li>
<li><p><a class="reference internal" href="#solver-nka-with-backtracking-ats" id="id129">Solver: NKA with backtracking, ATS</a></p></li>
<li><p><a class="reference internal" href="#solver-nox" id="id130">Solver: NOX</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#linear-solvers" id="id131">Linear Solvers</a></p>
<ul>
<li><p><a class="reference internal" href="#linear-solver-pcg" id="id132">Linear Solver: PCG</a></p></li>
<li><p><a class="reference internal" href="#linear-solver-gmres" id="id133">Linear Solver: GMRES</a></p></li>
<li><p><a class="reference internal" href="#linear-solver-nka" id="id134">Linear Solver: NKA</a></p></li>
<li><p><a class="reference internal" href="#linear-solver-amesos" id="id135">Linear Solver: Amesos</a></p></li>
<li><p><a class="reference internal" href="#linear-solver-belos-gmres" id="id136">Linear Solver: Belos GMRES</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#preconditioners" id="id137">Preconditioners</a></p>
<ul>
<li><p><a class="reference internal" href="#identity" id="id138">Identity</a></p></li>
<li><p><a class="reference internal" href="#diagonal" id="id139">Diagonal</a></p></li>
<li><p><a class="reference internal" href="#block-ilu" id="id140">Block ILU</a></p></li>
<li><p><a class="reference internal" href="#boomer-amg" id="id141">Boomer AMG</a></p></li>
<li><p><a class="reference internal" href="#euclid" id="id142">Euclid</a></p></li>
<li><p><a class="reference internal" href="#ml-trilinos-amg" id="id143">ML (Trilinos AMG)</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#other-common-specs" id="id144">Other Common Specs</a></p>
<ul>
<li><p><a class="reference internal" href="#ioevent" id="id145">IOEvent</a></p></li>
<li><p><a class="reference internal" href="#verbose-object" id="id146">Verbose Object</a></p></li>
<li><p><a class="reference internal" href="#debugger" id="id147">Debugger</a></p></li>
<li><p><a class="reference internal" href="#function" id="id148">Function</a></p>
<ul>
<li><p><a class="reference internal" href="#constant-function" id="id149">Constant Function</a></p></li>
<li><p><a class="reference internal" href="#tabular-function" id="id150">Tabular Function</a></p></li>
<li><p><a class="reference internal" href="#smooth-step-function" id="id151">Smooth step Function</a></p></li>
<li><p><a class="reference internal" href="#polynomial-function" id="id152">Polynomial Function</a></p></li>
<li><p><a class="reference internal" href="#multi-variable-linear-function" id="id153">Multi-variable linear Function</a></p></li>
<li><p><a class="reference internal" href="#separable-function" id="id154">Separable Function</a></p></li>
<li><p><a class="reference internal" href="#additive-function" id="id155">Additive Function</a></p></li>
<li><p><a class="reference internal" href="#multiplicative-function" id="id156">Multiplicative Function</a></p></li>
<li><p><a class="reference internal" href="#composition-function" id="id157">Composition Function</a></p></li>
<li><p><a class="reference internal" href="#piecewise-bilinear-function" id="id158">Piecewise Bilinear Function</a></p></li>
<li><p><a class="reference internal" href="#distance-function" id="id159">Distance Function</a></p></li>
<li><p><a class="reference internal" href="#monomial-function" id="id160">Monomial Function</a></p></li>
<li><p><a class="reference internal" href="#standard-math-function" id="id161">Standard Math Function</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#operator" id="id162">Operator</a></p>
<ul>
<li><p><a class="reference internal" href="#pde-accumulation" id="id163">PDE_Accumulation</a></p></li>
<li><p><a class="reference internal" href="#pde-diffusion" id="id164">PDE_Diffusion</a></p></li>
<li><p><a class="reference internal" href="#pde-advection" id="id165">PDE_Advection</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="syntax-of-the-specification">
<h1><a class="toc-backref" href="#id9">Syntax of the Specification</a><a class="headerlink" href="#syntax-of-the-specification" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Input specification for each ParameterList entry consists of two parts.
First, a bulleted list defines the usage syntax and available options.
This is followed by example snipets of XML code to demonstrate usage.</p></li>
<li><p>In many cases, the input specifies data for a particular parameterized model, and ATS
supports a number of parameterizations.
For example, initial data might be uniform (the value is required), or linear in y (the value
and its gradient are required).
Where ATS supports a number of parameterized models for quantity Z, the available
models will be listed by name, and then will be described in the subsequent section.
For example, the specification for an <cite>“X</cite>” list might begin with the following:</p>
<ul>
<li><p><cite>“Y</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“default_value”</strong>, <cite>“other</cite>”, <cite>“valid</cite>”, <cite>“options</cite>”</p></li>
<li><p>Z <code class="docutils literal notranslate"><span class="pre">[Z-spec]</span></code> Model for Z, choose exactly one of the following: (1) <cite>“z1</cite>”, or (2) <cite>“z2</cite>” (see below)</p></li>
</ul>
</li>
</ul>
<p>Here, an <cite>“X</cite>” is defined by a <cite>“Y</cite>” and a <cite>“Z</cite>”.
The <cite>“Y</cite>” is a string parameter but the <cite>“Z</cite>” is given by a model (which will require its own set of parameters).
The options for <cite>“Z</cite>” will then be described as a spec:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>“z1</cite>” applies model z1.  Requires <cite>“z1a</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code></p></li>
<li><p><cite>“z2</cite>” applies model z2.  Requires <cite>“z2a</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> and <cite>“z2b</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code></p></li>
</ul>
</div></blockquote>
<p>An example of using such a specification:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;X&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;Y&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;hello&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;z2&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;z2a&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;0.7&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;z2b&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Here, the user is defining X with Y=”hello”, and Z will be a z2 constructed with z2a=0.7 and z2b=3.</p>
<p>Conventions:</p>
<ul class="simple">
<li><p>Reserved keywords and labels are <cite>“quoted and italicized</cite>” – these
labels or values of parameters in user-generated input files must
match (using XML matching rules) the specified or allowable values.</p></li>
<li><p>User-defined labels are indicated with ALL-CAPS, and are meant to
represent a typical name given by a user - these can be names or
numbers or whatever serves best the organization of the user input
data.</p></li>
<li><p>Bold values are default values, and are used if the Parameter
is not provided.</p></li>
</ul>
</div>
<div class="section" id="symbol-index">
<h1><a class="toc-backref" href="#id10">Symbol Index</a><a class="headerlink" href="#symbol-index" title="Permalink to this headline">¶</a></h1>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(E\)</span></p></td>
<td><p>extensive energy of a cell <span class="math notranslate nohighlight">\([MJ]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(e\)</span></p></td>
<td><p>specific enthalpy <span class="math notranslate nohighlight">\([MJ mol^-1]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(g\)</span></p></td>
<td><p>gravitational acceleration vector <span class="math notranslate nohighlight">\([m s^-2]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(h\)</span></p></td>
<td><p>ponded depth, or the water head over the surface <span class="math notranslate nohighlight">\([m]\)</span></p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>alternative, in context of the subsurface, water head <span class="math notranslate nohighlight">\([m]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(h_{snow}\)</span></p></td>
<td><p>snow depth <span class="math notranslate nohighlight">\([m]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(K\)</span></p></td>
<td><p>absolute permeability <span class="math notranslate nohighlight">\([m^2]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\kappa\)</span></p></td>
<td><p>thermal conductivity <span class="math notranslate nohighlight">\([MW m^-1 K^-1]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(k_r\)</span></p></td>
<td><p>relative permeability <span class="math notranslate nohighlight">\([-]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(n_X\)</span></p></td>
<td><p>molar density of phase X <span class="math notranslate nohighlight">\([mol m^-3]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\vert \partial \Omega \vert\)</span></p></td>
<td><p>volume of a discrete element <span class="math notranslate nohighlight">\(\partial \Omega\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(p\)</span></p></td>
<td><p>pressure of the liquid phase <span class="math notranslate nohighlight">\([Pa]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(P_{r}\)</span></p></td>
<td><p>precipitation of rain <span class="math notranslate nohighlight">\([m s^-1]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(P_{s}\)</span></p></td>
<td><p>precipitation of snow, in snow-water-equivalent (SWE)  <span class="math notranslate nohighlight">\([m SWE s^-1]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(Q_e\)</span></p></td>
<td><p>source of energy <span class="math notranslate nohighlight">\([MJ s^-1]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(Q_w\)</span></p></td>
<td><p>mass source of water <span class="math notranslate nohighlight">\([mol s^-1]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(s_X\)</span></p></td>
<td><p>saturation of phase X <span class="math notranslate nohighlight">\([-]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(t\)</span></p></td>
<td><p>time variable <span class="math notranslate nohighlight">\([s]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(z\)</span></p></td>
<td><p>elevation <span class="math notranslate nohighlight">\([m]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\nu\)</span></p></td>
<td><p>dynamic viscosity of water <span class="math notranslate nohighlight">\([Pa s]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\phi\)</span></p></td>
<td><p>porosity of the soil <span class="math notranslate nohighlight">\([-]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\mathbf{q}\)</span></p></td>
<td><p>Darcy flux vector <span class="math notranslate nohighlight">\([mol  m^-2 s^-1]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\mathbf{q_s}\)</span></p></td>
<td><p>surface flux vector <span class="math notranslate nohighlight">\([mol  m s^-1]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\rho\)</span></p></td>
<td><p>mass density of a phase <span class="math notranslate nohighlight">\([kg m^-3]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(t\)</span></p></td>
<td><p>time variable <span class="math notranslate nohighlight">\([s]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(T\)</span></p></td>
<td><p>temperature <span class="math notranslate nohighlight">\([K]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\Theta\)</span></p></td>
<td><p>extensive water content of a cell <span class="math notranslate nohighlight">\([mol]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(u_X\)</span></p></td>
<td><p>specific internal energy of phase X <span class="math notranslate nohighlight">\([MJ mol^-1]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\mathbf{V}\)</span></p></td>
<td><p>Darcy velocity vector <span class="math notranslate nohighlight">\([m s^-1]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\mathbf{V_s}\)</span></p></td>
<td><p>surface velocity vector <span class="math notranslate nohighlight">\([m s^-1]\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(x\)</span>,:math:<cite>y</cite>,:math:<cite>z</cite></p></td>
<td><p>spatial coordinates <span class="math notranslate nohighlight">\([m]\)</span></p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="main">
<h1><a class="toc-backref" href="#id11">Main</a><a class="headerlink" href="#main" title="Permalink to this headline">¶</a></h1>
<p>ATS’s top-level main accepts an XML list including a few required elements.</p>
<div class="admonition-main-spec admonition" id="main-spec">
<p class="admonition-title">main-spec</p>
<ul class="simple">
<li><p><cite>“mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[mesh-typed-spec-list]</span></code> A list of <a class="reference internal" href="#mesh">Mesh</a> objects.</p></li>
<li><p><cite>“regions</cite>” <code class="docutils literal notranslate"><span class="pre">[region-spec-list]</span></code> A list of <a class="reference internal" href="#region">Region</a> objects.</p></li>
<li><p><cite>“cycle driver</cite>” <code class="docutils literal notranslate"><span class="pre">[coordinator-spec]</span></code>  See <a class="reference internal" href="#coordinator">Coordinator</a>.</p></li>
<li><p><cite>“visualization</cite>” <code class="docutils literal notranslate"><span class="pre">[visualization-spec-list]</span></code> A list of <a class="reference internal" href="#visualization">Visualization</a> objects.</p></li>
<li><p><cite>“observations</cite>” <code class="docutils literal notranslate"><span class="pre">[observation-spec-list]</span></code> An list of <a class="reference internal" href="#observation">Observation</a> objects.</p></li>
<li><p><cite>“checkpoint</cite>” <code class="docutils literal notranslate"><span class="pre">[checkpoint-spec]</span></code> See <a class="reference internal" href="#checkpoint">Checkpoint</a>.</p></li>
<li><p><cite>“PKs</cite>” <code class="docutils literal notranslate"><span class="pre">[pk-typed-spec-list]</span></code> A list of <a class="reference internal" href="#pk">PK</a> objects.</p></li>
<li><p><cite>“state</cite>” <code class="docutils literal notranslate"><span class="pre">[state-spec]</span></code> See <a class="reference internal" href="#state">State</a>.</p></li>
</ul>
</div>
</div>
<div class="section" id="mesh">
<h1><a class="toc-backref" href="#id12">Mesh</a><a class="headerlink" href="#mesh" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>A list of mesh objects and their domain names.</p>
</div></blockquote>
<p>All processes are simulated on a domain, which is discretized through a mesh.</p>
<p>Multiple domains and therefore meshes can be used in a single simulation, and
multiple meshes can be constructed on the fly.  The top level <cite>“mesh</cite>” is a
list of <code class="docutils literal notranslate"><span class="pre">[mesh-typed-spec]</span></code> sublists whose name indicate the mesh or domain
name.</p>
<p>Included in that list is at least one mesh: the <cite>“domain</cite>” mesh.  The
<cite>“domain</cite>” mesh represents the primary domain of simulation – usually the
subsurface.  Simple, structured meshes may be generated on the fly, or complex
unstructured meshes are provided as Exodus II files.  The <cite>“domain</cite>” mesh list
includes either a <a class="reference internal" href="#generated-mesh">Generated Mesh</a>, <a class="reference internal" href="#read-mesh-file">Read Mesh File</a>, or <a class="reference internal" href="#logical-mesh">Logical Mesh</a> spec, as
described below.</p>
<p>Additionally, a <a class="reference internal" href="#surface-mesh">Surface Mesh</a> may be formed by lifting the surface of a
provided mesh and then flattening that mesh to a 2D surface.  <a class="reference internal" href="#column-meshes">Column Meshes</a>
which split a base mesh into vertical columns of cells for use in 1D models
may also be generated automatically.</p>
<p>Finally, mesh generation is hard and error-prone.  A mesh audit is provided,
which checks for many common geometric and topologic errors in mesh
generation.  This is reasonably fast, even for big meshes, and can be done
through providing a “verify mesh” option.</p>
<div class="admonition-mesh-typed-spec admonition" id="mesh-typed-spec">
<p class="admonition-title">mesh-typed-spec</p>
<ul class="simple">
<li><p><cite>“mesh type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> One of:</p>
<ul>
<li><p><cite>“generate mesh</cite>” See <a class="reference internal" href="#generated-mesh">Generated Mesh</a>.</p></li>
<li><p><cite>“read mesh file</cite>” See <a class="reference internal" href="#read-mesh-file">Read Mesh File</a>.</p></li>
<li><p><cite>“logical</cite>” See <a class="reference internal" href="#logical-mesh">Logical Mesh</a>.</p></li>
<li><p><cite>“surface</cite>” See <a class="reference internal" href="#surface-mesh">Surface Mesh</a>.</p></li>
<li><p><cite>“subgrid</cite>” See <a class="reference internal" href="#subgrid-meshes">Subgrid Meshes</a>.</p></li>
<li><p><cite>“column</cite>” See <a class="reference internal" href="#column-meshes">Column Meshes</a>.</p></li>
</ul>
</li>
<li><p><cite>“_mesh_type_ parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[_mesh_type_-spec]</span></code> List of parameters
associated with the type.</p></li>
<li><p><cite>“verify mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Perform a mesh audit.</p></li>
<li><p><cite>“deformable mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Will this mesh be deformed?</p></li>
<li><p><cite>“partitioner</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>zoltan_rcb</strong> Method to partition the
mesh.  Note this only makes sense on the domain mesh.  One of:</p>
<ul>
<li><p><cite>“zoltan_rcb</cite>” a “map view” partitioning that keeps columns of cells together</p></li>
<li><p><cite>“metis</cite>” uses the METIS graph partitioner</p></li>
<li><p><cite>“zoltan</cite>” uses the default Zoltan graph-based partitioner.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="generated-mesh">
<h2><a class="toc-backref" href="#id13">Generated Mesh</a><a class="headerlink" href="#generated-mesh" title="Permalink to this headline">¶</a></h2>
<p>Generated mesh are by definition structured, with uniform dx, dy, and dz.
Such a mesh is specified by a bounding box high and low coordinate, and a list
of number of cells in each direction.</p>
<p>Specified by <cite>“mesh type</cite>” of <cite>“generate mesh</cite>”.</p>
<div class="admonition-mesh-type-generate-mesh-spec admonition" id="mesh-type-generate-mesh-spec">
<p class="admonition-title">mesh-type-generate-mesh-spec</p>
<ul class="simple">
<li><p><cite>“domain low coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of low corner of domain</p></li>
<li><p><cite>“domain high coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of high corner of domain</p></li>
<li><p><cite>“number of cells</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code> the number of uniform cells in each coordinate direction</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;mesh&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;domain&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;mesh type&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;generate mesh&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;generate mesh parameters&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;number of cells&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span> <span class="na">value=</span><span class="s">&quot;{{100, 1, 100}}&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;domain low coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{{0.0, 0.0, 0.0}}&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;domain high coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{{100.0, 1.0, 10.0}}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="read-mesh-file">
<h2><a class="toc-backref" href="#id14">Read Mesh File</a><a class="headerlink" href="#read-mesh-file" title="Permalink to this headline">¶</a></h2>
<p>Meshes can be pre-generated in a multitude of ways, then written to file, and
loaded in ATS. Note that in the case of an Exodus II mesh file, the suffix of
the serial mesh file must be .exo and the suffix of the parallel mesh file must
be .par.  When running in serial the code will read this the indicated file
directly.  When running in parallel with a prepartitioned mesh, the suffix is
.par and the code will instead read the partitioned files that have been
generated with a Nemesis tool and named as filename.par.N.r where N is the
number of processors and r is the rank.  When running in parallel and the
suffix is .exo, the code will partition automatically the serial file.</p>
<p>Specified by <cite>“mesh type</cite>” of <cite>“read mesh file</cite>”.</p>
<div class="admonition-mesh-type-read-mesh-file-spec admonition" id="mesh-type-read-mesh-file-spec">
<p class="admonition-title">mesh-type-read-mesh-file-spec</p>
<ul class="simple">
<li><p><cite>“file</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> filename of a pre-generated mesh file</p></li>
<li><p><cite>“format</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> format of pre-generated mesh file. One of:</p>
<ul>
<li><p><cite>“MSTK</cite>”</p></li>
<li><p><cite>“Exodus II</cite>”</p></li>
</ul>
</li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;mesh&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;domain&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;mesh type&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;read mesh file&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;read mesh file parameters&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;file&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;mesh_filename.exo&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;format&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;Exodus II&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;verify mesh&quot;</span> <span class="na">type=</span><span class="s">&quot;bool&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="logical-mesh">
<h2><a class="toc-backref" href="#id15">Logical Mesh</a><a class="headerlink" href="#logical-mesh" title="Permalink to this headline">¶</a></h2>
<p>Logical meshes are meshes for whom nodal coordinates may not be
specified, but sufficient information about the geometry of the
conceptual domain can be specified to allow solving problems.  This
allows for the conceptual generation of domains that “act” like a mesh
and can be used like a mesh, but don’t fit MSTK’s view of an
unstructured mesh.</p>
<p>This is an active research and development area, and is used most
frequently for river networks, root networks, and crack networks.</p>
<p>Specified by <cite>“mesh type</cite>” of <cite>“logical</cite>”.</p>
<div class="admonition-mesh-type-logical-spec admonition" id="mesh-type-logical-spec">
<p class="admonition-title">mesh-type-logical-spec</p>
<p>Not yet completed…</p>
</div>
</div>
<div class="section" id="surface-mesh">
<h2><a class="toc-backref" href="#id16">Surface Mesh</a><a class="headerlink" href="#surface-mesh" title="Permalink to this headline">¶</a></h2>
<p>To lift a surface off of the mesh, a side-set specifying all surface faces
must be given.  These faces are lifted locally, so the partitioning of the
surface cells will be identical to the partitioning of the subsurface faces
that correspond to these cells.  All communication and ghost cells are set up.
The mesh is flattened, so all surface faces must have non-zero area when
projected in the z-direction.  No checks for holes are performed.  Surface
meshes may similarly be audited to make sure they are reasonable for
computation.</p>
<p>Specified by <cite>“mesh type</cite>” of <cite>“surface</cite>”.</p>
<div class="admonition-mesh-type-surface-spec admonition" id="mesh-type-surface-spec">
<p class="admonition-title">mesh-type-surface-spec</p>
<p>ONE OF</p>
<ul class="simple">
<li><p><cite>“surface sideset name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The <a class="reference internal" href="#region">Region</a> name containing all surface faces.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“surface sideset names</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> A list of <a class="reference internal" href="#region">Region</a> names containing the surface faces.</p></li>
</ul>
<p>END</p>
<ul class="simple">
<li><p><cite>“verify mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Verify validity of surface mesh.</p></li>
<li><p><cite>“export mesh to file</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong> Export the lifted
surface mesh to this filename.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;mesh&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;surface&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;mesh type&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;surface&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;surface parameters&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;surface sideset name&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;{surface_region}&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;verify mesh&quot;</span> <span class="na">type=</span><span class="s">&quot;bool&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;export mesh to file&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;surface_mesh.exo&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;domain&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;mesh type&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;read mesh file&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;read mesh file parameters&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;file&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;../data/open-book-2D.exo&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;format&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;Exodus II&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="subgrid-meshes">
<h2><a class="toc-backref" href="#id17">Subgrid Meshes</a><a class="headerlink" href="#subgrid-meshes" title="Permalink to this headline">¶</a></h2>
<p>A collection of meshes formed by associating a new mesh with each entity of a
region.  Used for a few cases, including generating a 1D column for each
surface face of a semi-structured subsurface mesh, or for hanging logical
meshes off of each surface cell as a subgrid model, etc.</p>
<p>The subgrid meshes are then named <cite>“MESH_NAME_X”</cite> for each X, which is an
entity local ID, in a provided region of the provided entity type.</p>
<p>Specified by <cite>“mesh type</cite>” of <cite>“subgrid</cite>”.</p>
<div class="admonition-mesh-type-subgrid-spec admonition" id="mesh-type-subgrid-spec">
<p class="admonition-title">mesh-type-subgrid-spec</p>
<ul class="simple">
<li><p><cite>“subgrid region name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Region on which each subgrid mesh will be associated.</p></li>
<li><p><cite>“entity kind</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> One of <cite>“cell</cite>”, <cite>“face</cite>”, etc.  Entity of the
region (usually <cite>“cell</cite>”) on which each subgrid mesh will be associated.</p></li>
<li><p><cite>“parent domain</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>domain</strong> Mesh which includes the above region.</p></li>
<li><p><cite>“flyweight mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>False</strong> NOT YET SUPPORTED.  Allows a single
mesh instead of one per entity.</p></li>
</ul>
</div>
</div>
<div class="section" id="column-meshes">
<h2><a class="toc-backref" href="#id18">Column Meshes</a><a class="headerlink" href="#column-meshes" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Note these are rarely if ever created manually by a user.  Instead use
<a class="reference internal" href="#subgrid-meshes">Subgrid Meshes</a>, which generate a column mesh spec for every face
of a set.</p>
</div>
<p>Specified by <cite>“mesh type</cite>” of <cite>“column</cite>”.</p>
<div class="admonition-mesh-type-column-spec admonition" id="mesh-type-column-spec">
<p class="admonition-title">mesh-type-column-spec</p>
<ul class="simple">
<li><p><cite>“parent domain</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The name of the 3D mesh from which columns are generated.
Note that the <cite>“build columns from set</cite>” parameter must be set in that mesh.</p></li>
<li><p><cite>“verify mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Verify validity of surface mesh.</p></li>
<li><p><cite>“deformable mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong>  Used for deformation PKs to allow non-const access.</p></li>
<li><p><cite>“entity LID</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> Local ID of the surface cell that is the top of the column.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;mesh&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;column&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;column parameters&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;parent domain&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;domain&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;entity LID&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;domain&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;mesh type&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;read mesh file&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;read mesh file parameters&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;file&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;../data/open-book-2D.exo&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;format&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;Exodus II&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="region">
<h1><a class="toc-backref" href="#id19">Region</a><a class="headerlink" href="#region" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>A geometric or discrete subdomain of the full domain.</p>
</div></blockquote>
<p>Regions are geometrical constructs used to define subsets of
the computational domain in order to specify the problem to be solved, and the
output desired. Regions may represents zero-, one-, two- or three-dimensional
subsets of physical space.  For a three-dimensional problem, the simulation
domain will be a three-dimensional region bounded by a set of two-dimensional
regions.  If the simulation domain is N-dimensional, the boundary conditions
must be specified over a set of regions are (N-1)-dimensional.</p>
<p>Region specs are <strong>not</strong> denoted by a “type” parameter for legacy reasons.
Instead, they take a single sublist whose name defines the type.</p>
<div class="admonition-region-spec admonition" id="region-spec">
<p class="admonition-title">region-spec</p>
<p>ONE OF</p>
<ul class="simple">
<li><p><cite>“region: all</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> See <a class="reference internal" href="#all">All</a>.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“region: box</cite>” <code class="docutils literal notranslate"><span class="pre">[region-box-spec]</span></code> See <a class="reference internal" href="#box">Box</a>.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“region: plane</cite>” <code class="docutils literal notranslate"><span class="pre">[region-plane-spec]</span></code> See <a class="reference internal" href="#plane">Plane</a>.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“region: labeled set</cite>” <code class="docutils literal notranslate"><span class="pre">[region-labeled-set-spec]</span></code> See <a class="reference internal" href="#labeled-set">Labeled Set</a>.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“region: color function</cite>” <code class="docutils literal notranslate"><span class="pre">[region-color-function-spec]</span></code> See <a class="reference internal" href="#function-color">Function Color</a>.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“region: point</cite>” <code class="docutils literal notranslate"><span class="pre">[region-point-spec]</span></code> See <a class="reference internal" href="#point">Point</a>.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“region: logical</cite>” <code class="docutils literal notranslate"><span class="pre">[region-logical-spec]</span></code> See <a class="reference internal" href="#logical">Logical</a>.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“region: polygon</cite>” <code class="docutils literal notranslate"><span class="pre">[region-polygon-spec]</span></code> See <a class="reference internal" href="#polygon">Polygon</a>.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“region: enumerated</cite>” <code class="docutils literal notranslate"><span class="pre">[region-enumerated-spec]</span></code> See <a class="reference internal" href="#enumerated">Enumerated</a>.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“region: boundary</cite>” <code class="docutils literal notranslate"><span class="pre">[region-boundary-spec]</span></code> See <a class="reference internal" href="#boundary">Boundary</a>.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“region: box volume fractions</cite>” <code class="docutils literal notranslate"><span class="pre">[region-box-volume-fractions-spec]</span></code> See <a class="reference internal" href="#box-volume-fractions">Box Volume Fractions</a>.</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“region: line segment</cite>” <code class="docutils literal notranslate"><span class="pre">[region-line-segment-spec]</span></code> See <a class="reference internal" href="#line-segment">Line Segment</a>.</p></li>
</ul>
<p>END</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Surface files contain labeled triangulated face sets.  The user is
responsible for ensuring that the intersections with other surfaces in the
problem, including the boundaries, are <em>exact</em> (<em>i.e.</em> that surface
intersections are <em>watertight</em> where applicable), and that the surfaces are
contained within the computational domain.  If nodes in the surface fall
outside the domain, the elements they define are ignored.</p>
<p>Examples of surface files are given in the <em>Exodus II</em> file format here.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Region names must NOT be repeated.</p>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList&gt;</span>  <span class="c">&lt;!-- parent list --&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;TOP SECTION&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: box&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;low coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{2, 3, 5}&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;high coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{4, 5, 8}&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;MIDDLE SECTION&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: box&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;low coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{2, 3, 3}&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;high coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{4, 5, 5}&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BOTTOM SECTION&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: box&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;low coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{2, 3, 0}&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;high coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{4, 5, 3}&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;INFLOW SURFACE&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: labeled set&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;label&quot;</span>  <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;sideset_2&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;file&quot;</span>   <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;F_area_mesh.exo&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;format&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;Exodus II&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;entity&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;face&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;OUTFLOW PLANE&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: plane&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;point&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{0.5, 0.5, 0.5}&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;normal&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{0, 0, 1}&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BLOODY SAND&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: color function&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;file&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;F_area_col.txt&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;25&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;FLUX PLANE&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: polygon&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;number of points&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;5&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;points&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{-0.5, -0.5, -0.5,</span>
<span class="s">                                                               0.5, -0.5, -0.5,</span>
<span class="s">                                                               0.8, 0.0, 0.0,</span>
<span class="s">                                                               0.5,  0.5, 0.5,</span>
<span class="s">                                                              -0.5, 0.5, 0.5}&quot;</span><span class="nt">/&gt;</span>
       <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>In this example, <em>TOP SECTION</em>, <em>MIDDLE SECTION</em> and <em>BOTTOM SECTION</em>
are three box-shaped volumetric regions. <em>INFLOW SURFACE</em> is a
surface region defined in an Exodus II-formatted labeled set
file and <em>OUTFLOW PLANE</em> is a planar region. <em>BLOODY SAND</em> is a volumetric
region defined by the value 25 in color function file.</p>
<div class="section" id="all">
<h2><a class="toc-backref" href="#id20">All</a><a class="headerlink" href="#all" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>A region consisting of all entities on a mesh.</p>
</div></blockquote>
<p>No parameters required.</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;domain&quot;</span><span class="nt">&gt;</span>  <span class="c">&lt;!-- parent list --&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: all&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="box">
<h2><a class="toc-backref" href="#id21">Box</a><a class="headerlink" href="#box" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>RegionBox: a rectangular region in space, defined by two corners</p>
</div></blockquote>
<p>List <em>region: box</em> defines a region bounded by coordinate-aligned
planes. Boxes are allowed to be of zero thickness in only one
direction in which case they are equivalent to planes.</p>
<div class="admonition-region-box-spec admonition" id="region-box-spec">
<p class="admonition-title">region-box-spec</p>
<ul class="simple">
<li><p><cite>“low coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of the boundary point with the lowest coordinates.</p></li>
<li><p><cite>“high coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of the boundary points with the highest coordinates.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;WELL&quot;</span><span class="nt">&gt;</span>  <span class="c">&lt;!-- parent list --&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: box&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;low coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{-5.0,-5.0, -5.0}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;high coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{5.0, 5.0,  5.0}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="plane">
<h2><a class="toc-backref" href="#id22">Plane</a><a class="headerlink" href="#plane" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>RegionPlane: A planar (infinite) region in space, defined by a point and a normal.</p>
</div></blockquote>
<p>List <em>region: plane</em> defines a plane using a point lying on the plane and normal to the plane.</p>
<div class="admonition-region-plane-spec admonition" id="region-plane-spec">
<p class="admonition-title">region-plane-spec</p>
<ul class="simple">
<li><p><cite>“normal</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Normal to the plane.</p></li>
<li><p><cite>“point</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Point in space.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;TOP_SECTION&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- parent list --&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: plane&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;point&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{2, 3, 5}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;normal&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{1, 1, 0}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;expert parameters&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;tolerance&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;1.0e-05&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="labeled-set">
<h2><a class="toc-backref" href="#id23">Labeled Set</a><a class="headerlink" href="#labeled-set" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>RegionLabeledSet: A region defined by a set of mesh entities in a mesh file</p>
</div></blockquote>
<p>The list <em>region: labeled set</em> defines a named set of mesh entities
existing in an input mesh file. This is the same file that contains
the computational mesh. The name of the entity set is given
by <em>label</em>.  For example, a mesh file in the Exodus II
format can be processed to tag cells, faces and/or nodes with
specific labels, using a variety of external tools. Regions based
on such sets are assigned a user-defined label for Amanzi, which may
or may not correspond to the original label in the exodus file.
Note that the file used to express this labeled set may be in any
Amanzi-supported mesh format (the mesh format is specified in the
parameters for this option).  The <em>entity</em> parameter may be
necessary to specify a unique set.  For example, an Exodus file
requires <em>cell</em>, <em>face</em> or <em>node</em> as well as a label (which is
an integer).  The resulting region will have the dimensionality
associated with the entities in the indicated set.</p>
<div class="admonition-region-labeled-set-spec admonition" id="region-labeled-set-spec">
<p class="admonition-title">region-labeled-set-spec</p>
<ul class="simple">
<li><p><cite>“label</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Set per label defined in the mesh file.</p></li>
<li><p><cite>“file</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> File name.</p></li>
<li><p><cite>“format</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Currently, we only support mesh files in the “Exodus II” format.</p></li>
<li><p><cite>“entity</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Type of the mesh object (cell, face, etc).</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;AQUIFER&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: labeled set&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;entity&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;cell&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;file&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;porflow4_4.exo&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;format&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;Exodus II&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;label&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="function-color">
<h2><a class="toc-backref" href="#id24">Function Color</a><a class="headerlink" href="#function-color" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>RegionFunctionColor: A region defined by the value of an indicator function in a file.</p>
</div></blockquote>
<p>The list <em>region: color function</em> defines a region based a specified integer
color, <em>value</em>, in a structured color function file, <em>file</em>.  The format of
the color function file is given below in the “Tabulated function file format”
section. As shown in the file, the color values may be specified at the nodes
or cells of the color function grid. A computational cell is assigned the
‘color’ of the data grid cell containing its cell centroid (cell-based colors)
or the data grid nearest its cell-centroid (node-based colors). Computational
cells sets are then built from all cells with the specified color <em>Value</em>.</p>
<p>In order to avoid, gaps and overlaps in specifying materials, it is strongly
recommended that regions be defined using a single color function file.</p>
<div class="admonition-region-color-function-spec admonition" id="region-color-function-spec">
<p class="admonition-title">region-color-function-spec</p>
<ul class="simple">
<li><p><cite>“file</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> File name containing color function.</p></li>
<li><p><cite>“value</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> Color that defines the set in the tabulated function file.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;SOIL_TOP&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: color function&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;file&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;geology_resamp_2D.tf3&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="point">
<h2><a class="toc-backref" href="#id25">Point</a><a class="headerlink" href="#point" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>RegionPoint: a point in space.</p>
</div></blockquote>
<p>List <em>region: point</em> defines a point in space.
This region consists of cells containing this point.</p>
<div class="admonition-region-point-spec admonition" id="region-point-spec">
<p class="admonition-title">region-point-spec</p>
<ul class="simple">
<li><p><cite>“coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of point in space.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;DOWN_WIND150&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- parent list defining the name --&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: point&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{-150.0, 0.0, 0.0}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="logical">
<h2><a class="toc-backref" href="#id26">Logical</a><a class="headerlink" href="#logical" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>RegionLogical: A region defined by a logical operation on one or two other regions</p>
</div></blockquote>
<p>The list <em>region: logical</em> defines logical operations on regions allow for
more advanced region definitions. At this time the logical region allows for
logical operations on a list of regions.  <em>union</em> and <em>intersection</em> are
self-evident. In the case of <em>subtraction</em>, subtraction is performed from the
first region in the list.  The <em>complement</em> is a special case in that it is
the only case that operates on single region, and returns the complement to it
within the domain ENTIRE_DOMAIN.  Currently, multi-region booleans are not
supported in the same expression.</p>
<div class="admonition-region-logical-spec admonition" id="region-logical-spec">
<p class="admonition-title">region-logical-spec</p>
<ul class="simple">
<li><p><cite>“operation</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> defines operation on the list of regions.
One of: <cite>“union</cite>”, <cite>“intersect</cite>”, <cite>“subtract</cite>”, <cite>“complement</cite>”</p></li>
<li><p><cite>“regions</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> specifies the list of involved regions.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;LOWER_LAYERs&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: logical&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;operation&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;union&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{Middle1, Middle2, Bottom}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="polygon">
<h2><a class="toc-backref" href="#id27">Polygon</a><a class="headerlink" href="#polygon" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>RegionPolygon: A closed polygonal segment of a plane.</p>
</div></blockquote>
<p>The list <em>region: polygon</em> defines a polygonal region on which mesh faces and
nodes can be queried. NOTE that one cannot ask for cells in a polygonal surface
region. In 2D, the polygonal region is a line and is specified by 2 points.
In 3D, the polygonal region is specified by an arbitrary number of points.
In both cases the point coordinates are given as a linear array. The polygon
can be non-convex.</p>
<p>This provides a set of faces with a normal for computing flux.</p>
<p>The polygonal surface region can be queried for a normal. In 2D, the normal is
defined as [Vy,-Vx] where [Vx,Vy] is the vector from point 1 to point 2.
In 3D, the normal of the polygon is defined by the order in which points
are specified.</p>
<p><code class="docutils literal notranslate"><span class="pre">[region-polygon-spec]</span></code></p>
<ul class="simple">
<li><p><cite>“number of points</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> Number of polygon points.</p></li>
<li><p><cite>“points</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Point coordinates in a linear array.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;XY_PENTAGON&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: polygon&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;number of points&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;5&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;points&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{-0.5, -0.5, -0.5,</span>
<span class="s">                                                           0.5, -0.5, -0.5,</span>
<span class="s">                                                           0.8, 0.0, 0.0,</span>
<span class="s">                                                           0.5,  0.5, 0.5,</span>
<span class="s">                                                          -0.5, 0.5, 0.5}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;expert parameters&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;tolerance&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;1.0e-3&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="enumerated">
<h2><a class="toc-backref" href="#id28">Enumerated</a><a class="headerlink" href="#enumerated" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>RegionEnumerated: A region enumerated as a list of IDs.</p>
</div></blockquote>
<p>List <em>region: enumerated set</em> defines a set of mesh entities via the list
of input global ids. Note that global ids are not defined correctly when
parallel mesh is created on a fly.</p>
<div class="admonition-region-enumerated-spec admonition" id="region-enumerated-spec">
<p class="admonition-title">region-enumerated-spec</p>
<ul class="simple">
<li><p><cite>“entity</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Type of the mesh object.  One of: <cite>“cell</cite>”, <cite>“face</cite>”, <cite>“edge</cite>”, <cite>“node</cite>”</p></li>
<li><p><cite>“entity gids</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code> List of the global IDs of the entities.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;WELL&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- parent list --&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: enumerated set&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;entity&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;face&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;entity gids&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span> <span class="na">value=</span><span class="s">&quot;{1, 12, 23, 34}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="boundary">
<h2><a class="toc-backref" href="#id29">Boundary</a><a class="headerlink" href="#boundary" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>RegionBoundary:  A region consisting of all entities on the domain boundary</p>
</div></blockquote>
<p>List <em>region: boundary</em> defines a set of all boundary faces.
Using this definition, faces located on the domain boundary are extracted.</p>
<div class="admonition-region-boundary-spec admonition" id="region-boundary-spec">
<p class="admonition-title">region-boundary-spec</p>
<ul class="simple">
<li><p><cite>“entity</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Type of the mesh object.  Unclear whether this is
used or can be other things than <cite>“face</cite>”?</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;DOMAIN_BOUNDARY&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- parent list names the region --&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: boundary&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;entity&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;face&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="box-volume-fractions">
<h2><a class="toc-backref" href="#id30">Box Volume Fractions</a><a class="headerlink" href="#box-volume-fractions" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>RegionBoxVolumeFractions: A rectangular region in space, defined by two corner points and normals to sides.</p>
</div></blockquote>
<p>List <em>region: box volume fraction</em> defines a region bounded by a box <em>not</em>
aligned with coordinate axes.
Boxes are allowed to be of zero thickness in only one direction in which case
they are equivalent to rectangles on a plane or segments on a line.</p>
<div class="admonition-region-box-volume-fraction-spec admonition" id="region-box-volume-fraction-spec">
<p class="admonition-title">region-box-volume-fraction-spec</p>
<ul class="simple">
<li><p><cite>“corner coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of one box corner.</p></li>
<li><p><cite>“opposite corner coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of the opposite box corner.</p></li>
<li><p><cite>“normals</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Normals to sides in a linear array. Default is columns of
the identity matrix. The normals may be scaled arbitrarily but must be orthogonal to
one another and form the right coordinate frame.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BASIN&quot;</span><span class="nt">&gt;</span>  <span class="c">&lt;!-- parent list --&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: box volume fractions&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;corner coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{-1.0,-1.0, 1.0}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;opposite corner coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{1.0, 1.0, 1.0}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;normals&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{1.0, 0.0, 0.0</span>
<span class="s">                                                           0.0, 2.0, 0.0,</span>
<span class="s">                                                           0.0, 0.0, 3.0}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>This example defines a degenerate box, a square on a surface <em>z=1</em>.</p>
</div>
<div class="section" id="line-segment">
<h2><a class="toc-backref" href="#id31">Line Segment</a><a class="headerlink" href="#line-segment" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>RegionLineSegment: A line segment, defined by two points in space.</p>
</div></blockquote>
<p>List <em>region: line segment</em> desribes a region defined by a line
segment. This region is a set of cells which intersect with a line
segment.  The line segment is allowed to intersect with one or more cells. Zero length
line segments are allowed. The line segment is defined by its ends
points.</p>
<div class="admonition-region-line-segment-spec admonition" id="region-line-segment-spec">
<p class="admonition-title">region-line-segment-spec</p>
<ul class="simple">
<li><p><cite>“end coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of one end of a line
segment.</p></li>
<li><p><cite>“opposite end coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Location of the opposite
end of a line segment.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;WELL&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!-- parent list --&gt;</span>
   <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;region: line segment&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;end coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{497542.44, 5393755.77, 0.0}&quot;</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;opposite end coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{497542.44, 5393755.77, 100.0}&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;/ParameterList&gt;</span>
 <span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="coordinator">
<h1><a class="toc-backref" href="#id32">Coordinator</a><a class="headerlink" href="#coordinator" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>Simulation controller and top-level driver</p>
</div></blockquote>
<p>In the <cite>“cycle driver</cite>” sublist, the user specifies global control of the
simulation, including starting and ending times and restart options.</p>
<div class="admonition-coordinator-spec admonition" id="coordinator-spec">
<p class="admonition-title">coordinator-spec</p>
<ul class="simple">
<li><p><cite>“start time</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.</strong> Specifies the start of time in model time.</p></li>
<li><p><cite>“start time units</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“s”</strong> One of “s”, “d”, or “yr”</p></li>
</ul>
<p>ONE OF</p>
<ul class="simple">
<li><p><cite>“end time</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Specifies the end of the simulation in model time.</p></li>
<li><p><cite>“end time units</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“s”</strong> One of <cite>“s</cite>”, <cite>“d</cite>”, or <cite>“yr</cite>”</p></li>
</ul>
<p>OR</p>
<ul>
<li><p><cite>“end cycle</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>optional</strong> If provided, specifies the end of the
simulation in timestep cycles.</p>
<p>END</p>
</li>
<li><p><cite>“restart from checkpoint file</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong> If provided,
specifies a path to the checkpoint file to continue a stopped simulation.</p></li>
<li><p><cite>“wallclock duration [hrs]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>optional</strong> After this time, the
simulation will checkpoint and end.</p></li>
<li><p><cite>“required times</cite>” <code class="docutils literal notranslate"><span class="pre">[io-event-spec]</span></code> <strong>optional</strong> An <a class="reference internal" href="#ioevent">IOEvent</a> spec that
sets a collection of times/cycles at which the simulation is guaranteed to
hit exactly.  This is useful for situations such as where data is provided at
a regular interval, and interpolation error related to that data is to be
minimized.</p></li>
<li><p><cite>“PK tree</cite>” <code class="docutils literal notranslate"><span class="pre">[pk-typed-spec-list]</span></code> List of length one, the top level
<a class="reference internal" href="#pk">PK</a> spec.</p></li>
</ul>
</div>
<p>Note: Either <cite>“end cycle</cite>” or <cite>“end time</cite>” are required, and if
both are present, the simulation will stop with whichever arrives
first.  An <cite>“end cycle</cite>” is commonly used to ensure that, in the case
of a time step crash, we do not continue on forever spewing output.</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;cycle driver&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span>  <span class="na">name=</span><span class="s">&quot;end cycle&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;6000&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span>  <span class="na">name=</span><span class="s">&quot;start time&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;0.&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span>  <span class="na">name=</span><span class="s">&quot;start time units&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;s&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span>  <span class="na">name=</span><span class="s">&quot;end time&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span>  <span class="na">name=</span><span class="s">&quot;end time units&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;yr&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;required times&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;start period stop&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{0,-1,86400}&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;PK tree&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;my richards pk&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;PK type&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;richards&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="visualization">
<h1><a class="toc-backref" href="#id33">Visualization</a><a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>Manages simulation output to disk.</p>
</div></blockquote>
<p>A user may request periodic writes of field data for the purposes of
visualization in the <cite>“visualization</cite>” sublists.</p>
<p>ATS accepts a visualization list for each domain/mesh, including surface and
column meshes.  These are in separate ParameterLists, entitled
<cite>“visualization</cite>” for the main mesh, and <cite>“visualization surface</cite>” on the
surface mesh.  It is expected that, for any addition meshes, each will have a
domain name and therefore admit a spec of the form: <cite>“visualization
DOMAIN-NAME</cite>”.</p>
<div class="admonition-visualization-spec admonition" id="visualization-spec">
<p class="admonition-title">visualization-spec</p>
<ul class="simple">
<li><p><cite>“file name base</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>visdump_DOMAIN_data</strong></p></li>
<li><p><cite>“dynamic mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Write mesh data for every
visualization dump; this facilitates visualizing deforming meshes.</p></li>
<li><p><cite>“time units</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>s</strong> A valid time unit to convert time
into for output files.  One of <cite>“s</cite>”, <cite>“d</cite>”, <cite>“y</cite>”, or <cite>“yr 365</cite>”</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[io-event-spec]</span></code> An <a class="reference internal" href="#ioevent">IOEvent</a> spec</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;visualization&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;file name base&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;visdump_data&quot;</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;cycles start period stop&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span> <span class="na">value=</span><span class="s">&quot;{{0, 100, -1}}&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;cycles&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span> <span class="na">value=</span><span class="s">&quot;{{999, 1001}}&quot;</span> <span class="nt">/&gt;</span>

  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;times start period stop 0&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{{0.0, 10.0, 100.0}}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;times start period stop 1&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{{100.0, 25.0, -1.0}}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;times&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{{101.0, 303.0, 422.0}}&quot;</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;dynamic mesh&quot;</span> <span class="na">type=</span><span class="s">&quot;bool&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="checkpoint">
<h1><a class="toc-backref" href="#id34">Checkpoint</a><a class="headerlink" href="#checkpoint" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>Manages checkpoint/restart capability.</p>
</div></blockquote>
<p>A user may request periodic dumps of ATS Checkpoint Data in the
<cite>“checkpoint</cite>” sublist.  The user has no explicit control over the
content of these files, but has the guarantee that the ATS run will be
reproducible (with accuracies determined by machine round errors and
randomness due to execution in a parallel computing environment).
Therefore, output controls for Checkpoint Data are limited to file
name generation and writing frequency, by numerical cycle number.
Unlike <cite>“visualization</cite>”, there is only one <cite>“checkpoint</cite>” list for
all domains/meshes.</p>
<div class="admonition-checkpoint-spec admonition" id="checkpoint-spec">
<p class="admonition-title">checkpoint-spec</p>
<ul class="simple">
<li><p><cite>“file name base</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“checkpoint”</strong></p></li>
<li><p><cite>“file name digits</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>5</strong></p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[io-event-spec]</span></code> An <a class="reference internal" href="#ioevent">IOEvent</a> spec</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;checkpoint&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;cycles start period stop&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span> <span class="na">value=</span><span class="s">&quot;{{0, 100, -1}}&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;cycles&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span> <span class="na">value=</span><span class="s">&quot;{{999, 1001}}&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;times start period stop 0&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{{0.0, 10.0, 100.0}}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;times start period stop 1&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{{100.0, 25.0, -1.0}}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;times&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{{101.0, 303.0, 422.0}}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>In this example, checkpoint files are written when the cycle number is
a multiple of 100, every 10 seconds for the first 100 seconds, and
every 25 seconds thereafter, along with times 101, 303, and 422.  Files will be written in the form: <cite>“checkpoint00000.h5</cite>”.</p>
</div>
<div class="section" id="observation">
<h1><a class="toc-backref" href="#id35">Observation</a><a class="headerlink" href="#observation" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>Collects, reduces, and writes observations during a simulation.</p>
</div></blockquote>
<p>Observations are a localized-in-space but frequent-in-time view of simulation
output, designed to get at useful diagnostic quantities such as hydrographs,
total water content, quantities at a point, etc.  These allow frequent
collection in time without saving huge numbers of visualization files to do
postprocessing.  In fact, these should be though of as orthogonal data queries
to visualization – vis is pointwise in time but complete in space, while
observations are pointwise/finite in space but complete in time.</p>
<p>A user may request any number of specific observations.  Each observation spec
involves a field quantity, a functional reduction operator, a region from which
it will extract its source data, and a list of discrete times for its
evaluation.  The observations are evaluated during the simulation and written
to disk.</p>
<div class="admonition-observation-spec admonition" id="observation-spec">
<p class="admonition-title">observation-spec</p>
<ul class="simple">
<li><p><cite>“observation output filename</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> user-defined name for the file
that the observations are written to.</p></li>
<li><p><cite>“variable</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> any ATS variable used by any PK, e.g. <cite>“pressure</cite>”
or <cite>“surface-water_content</cite>”</p></li>
<li><p><cite>“region</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> the label of a user-defined region</p></li>
<li><p><cite>“location name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> the mesh location of the thing to be measured,
i.e. <cite>“cell</cite>”, <cite>“face</cite>”, or <cite>“node</cite>”</p></li>
<li><p><cite>“functional</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> the label of a function to apply to the variable
across the region.  One of:</p>
<ul>
<li><p><cite>“observation data: point</cite>” returns the value of the field quantity at a
point.  The region and location name must result in a single entity being
selected.</p></li>
<li><p><cite>“observation data: extensive integral</cite>” returns the sum of an (extensive)
variable over the region.  This should be used for extensive quantities
such as <cite>“water_content</cite>” or <cite>“energy</cite>”.</p></li>
<li><p><cite>“observation data: intensive integral</cite>” returns the volume-weighted
average of an (intensive) variable over the region.  This should be used
for intensive quantities such as <cite>“temperature</cite>” or <cite>“saturation_liquid</cite>”.</p></li>
</ul>
</li>
<li><p><cite>“direction normalized flux</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>optional</strong> For flux observations,
dots the face-normal flux with a vector to ensure fluxes are integrated
pointing the same direction.</p></li>
<li><p><cite>“direction normalized flux direction</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> <strong>optional</strong> For
flux observations, provides the vector to dot the face normal with.  If this
is not provided, then it is assumed that the faces integrated over are all
boundary faces and that the default vector is the outward normal direction
for each face.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[io-event-spec]</span></code> An <a class="reference internal" href="#ioevent">IOEvent</a> spec</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;observations&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- This measures the hydrograph out the &quot;east&quot; face of the surface domain --&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;surface outlet flux&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;variable&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;surface-mass_flux&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;direction normalized flux&quot;</span> <span class="na">type=</span><span class="s">&quot;bool&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;region&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;east&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;functional&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;observation data: extensive integral&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;delimiter&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot; &quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;location name&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;face&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;observation output filename&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;surface_outlet_flux.dat&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;times start period stop&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{0.0,86400.0,-1.0}&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="c">&lt;!-- This measures the total water, in mols, in the entire subsurface domain --&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;subsurface water content&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;variable&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;water_content&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;region&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;computational domain&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;functional&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;observation data: extensive integral&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;delimiter&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot; &quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;location name&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;cell&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;observation output filename&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;water_content.dat&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;times start period stop&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{0.0,86400.0,-1.0}&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="c">&lt;!-- This tracks the temperature at a point --&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;temperature_probeA&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;variable&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;temperature&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;region&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;probeA&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;functional&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;observation data: point&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;delimiter&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot; &quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;location name&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;cell&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;observation output filename&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;temperature_probeA.dat&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;times start period stop&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{0.0,86400.0,-1.0}&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="pk">
<h1><a class="toc-backref" href="#id36">PK</a><a class="headerlink" href="#pk" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>The interface for a Process Kernel, an equation or system of equations.</p>
</div></blockquote>
<p>A process kernel represents a single or system of partial/ordinary
differential equation(s) or conservation law(s), and is used as the
fundamental unit for coupling strategies.</p>
<p>Implementations of this interface typically are either an MPC
(multi-process coupler) whose job is to heirarchically couple several
other PKs and represent the system of equations, or a Physical PK,
which represents a single equation.</p>
<p>Note there are two PK specs – the first is the “typed” spec, which appears in
the “cycle driver” list in the PK tree.  The second is the spec for the base
class PK, which is inherited and included by each actual PK, and lives in the
“PKs” sublist of “main”.</p>
<div class="admonition-pk-typed-spec admonition" id="pk-typed-spec">
<p class="admonition-title">pk-typed-spec</p>
<ul class="simple">
<li><p><cite>“PK type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> One of the registered PK types</p></li>
<li><p><cite>“sub PKs</cite>” <code class="docutils literal notranslate"><span class="pre">[pk-typed-spec-list]</span></code> <strong>optional</strong> If there are sub pks, list them.</p></li>
<li><p><cite>“verbose object</cite>” <code class="docutils literal notranslate"><span class="pre">[verbose-object-spec]</span></code> <strong>optional</strong> See <a class="reference internal" href="#verbose-object">Verbose Object</a></p></li>
</ul>
</div>
<div class="admonition-pk-spec admonition" id="pk-spec">
<p class="admonition-title">pk-spec</p>
<ul class="simple">
<li><p><cite>“PK type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> One of the registered PK types.  Note this must
match the corresponding entry in the <code class="docutils literal notranslate"><span class="pre">[pk-typed-spec]</span></code></p></li>
<li><p><cite>“verbose object</cite>” <code class="docutils literal notranslate"><span class="pre">[verbose-object-spec]</span></code> <strong>optional</strong> See <a class="reference internal" href="#verbose-object">Verbose Object</a></p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;PKs&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;my cool PK&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;PK type&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;my cool PK&quot;</span><span class="nt">/&gt;</span>
     ...
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;PKs&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;Top level MPC&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;PK type&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;strong MPC&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;sub PKs&quot;</span><span class="nt">&gt;</span>
      ...
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<div class="section" id="base-pks">
<h2><a class="toc-backref" href="#id37">Base PKs</a><a class="headerlink" href="#base-pks" title="Permalink to this headline">¶</a></h2>
<p>There are several types of PKs, and each PK has its own valid input
spec.  However, there are three main types of PKs, from which nearly
all PKs derive.  Note that none of these are true PKs and cannot stand
alone.</p>
<div class="section" id="pk-physical">
<h3><a class="toc-backref" href="#id38">PK: Physical</a><a class="headerlink" href="#pk-physical" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A base class with default implementations of methods for a leaf of the PK tree (a conservation equation, or similar).</p>
</div></blockquote>
<p><cite>PKPhysicalBase</cite> is a base class providing some functionality for PKs which
are defined on a single mesh, and represent a single process model.  Typically
all leaves of the PK tree will inherit from <cite>PKPhysicalBase</cite>.</p>
<div class="admonition-pk-physical-default-spec admonition" id="pk-physical-default-spec">
<p class="admonition-title">pk-physical-default-spec</p>
<ul class="simple">
<li><p><cite>“domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Name from the <a class="reference internal" href="#mesh">Mesh</a> list on which this PK is defined.</p></li>
<li><p><cite>“primary variable key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The primary variable
e.g. <cite>“pressure</cite>”, or <cite>“temperature</cite>”.  Most PKs supply sane defaults.</p></li>
<li><p><cite>“initial condition</cite>” <code class="docutils literal notranslate"><span class="pre">[initial-conditions-spec]</span></code>  See <a class="reference internal" href="#initialconditions">InitialConditions</a>.</p></li>
<li><p><cite>“max valid change</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong> Sets a limiter on what is a
valid change in a single timestep.  Changes larger than this are declared
invalid and the timestep shrinks.  By default, any change is valid.
Units are the same as the primary variable.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-spec]</span></code> This <em>is a</em> <a class="reference internal" href="#pk">PK</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[debugger-spec]</span></code> Uses a <a class="reference internal" href="#debugger">Debugger</a></p></li>
</ul>
</div>
</div>
<div class="section" id="pk-bdf">
<h3><a class="toc-backref" href="#id39">PK: BDF</a><a class="headerlink" href="#pk-bdf" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A base class with default implementations of methods for a PK that can be implicitly integrated in time.</p>
</div></blockquote>
<p><cite>PKBDFBase</cite> is a base class from which PKs that want to use the <cite>BDF</cite>
series of implicit time integrators must derive.  It specifies both the
<cite>BDFFnBase</cite> interface and implements some basic functionality for <cite>BDF</cite>
PKs.</p>
<div class="admonition-pk-bdf-default-spec admonition" id="pk-bdf-default-spec">
<p class="admonition-title">pk-bdf-default-spec</p>
<ul class="simple">
<li><p><cite>“initial time step</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.</strong> Initial time step size [s]</p></li>
<li><p><cite>“assemble preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> A flag, typically not set
by user but by an MPC.</p></li>
<li><p><cite>“time integrator</cite>” <code class="docutils literal notranslate"><span class="pre">[implicit-time-integrator-typed-spec]</span></code> <strong>optional</strong>
A <a class="reference internal" href="#timeintegrator">TimeIntegrator</a>.  Note that this is only provided if this PK is not
strongly coupled to other PKs.</p></li>
<li><p><cite>“preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[preconditioner-typed-spec]</span></code> <strong>optional</strong> A <a class="reference internal" href="#preconditioner">Preconditioner</a>.
Note that this is only used if this PK is not strongly coupled to other PKs.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-spec]</span></code> This <em>is a</em> <a class="reference internal" href="#pk">PK</a>.</p></li>
</ul>
</div>
</div>
<div class="section" id="pk-physical-and-bdf">
<h3><a class="toc-backref" href="#id40">PK: Physical and BDF</a><a class="headerlink" href="#pk-physical-and-bdf" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Default implementation of both BDF and Physical PKs.</p>
</div></blockquote>
<p>A base class for all PKs that are both physical, in the sense that they
implement an equation and are not couplers, and BDF, in the sense that they
support the implicit integration interface.  This largely just supplies a
default error norm based on error in conservation relative to the extent of the
conserved quantity.</p>
<p>By default, the error norm used by solvers is given by:</p>
<p><span class="math notranslate nohighlight">\(ENORM(u, du) = |du| / ( a_tol + r_tol * |u| )\)</span></p>
<p>The defaults here are typically good, or else good defaults are set in the
code, so usually are not supplied by the user.</p>
<div class="admonition-pk-physical-bdf-default-spec admonition" id="pk-physical-bdf-default-spec">
<p class="admonition-title">pk-physical-bdf-default-spec</p>
<ul class="simple">
<li><p><cite>“conserved quantity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Name of the conserved quantity.
Usually a sane default is set by the PK.</p></li>
<li><p><cite>“absolute error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> Absolute tolerance,
<span class="math notranslate nohighlight">\(a_tol\)</span> in the equation above.  Unit are the same as the conserved
quantity.  Note that this default is often overridden by PKs with more
physical values, and very rarely are these set by the user.</p></li>
<li><p><cite>“relative error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> Relative tolerance,
<span class="math notranslate nohighlight">\(r_tol\)</span> in the equation above.  <code class="docutils literal notranslate"><span class="pre">[-]</span></code> Note that this default can
be overridden by PKs with more physical values, and very rarely are these
set by the user.</p></li>
<li><p><cite>“flux error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> Relative tolerance on the
flux.  Note that this default is often overridden by PKs with more physical
values, and very rarely are these set by the user.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-bdf-default-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#pk-bdf">PK: BDF</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-physical-default-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#pk-physical">PK: Physical</a></p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="physical-pks">
<h2><a class="toc-backref" href="#id41">Physical PKs</a><a class="headerlink" href="#physical-pks" title="Permalink to this headline">¶</a></h2>
<p>Physical PKs are the physical capability implemented within ATS.</p>
<div class="section" id="flow-pks">
<h3><a class="toc-backref" href="#id42">Flow PKs</a><a class="headerlink" href="#flow-pks" title="Permalink to this headline">¶</a></h3>
<p>Flow PKs describe the conservation of mass of water as it flows both
above and below-ground.  Subsurface flow PKs are based on 3D Richards
equation, which describes variably saturated flow in porous media.
Minor variations to this include the incorporation of freeze-thaw
processes.  Surface flow PKs are based on a diffusion wave equation
and Manning’s model for sheet flow.  Variations to this also include
the incorporation of freeze-thaw processes.  Finally we include in
flow a “snow distribution” algorithm which takes as input
precipitation and applies it based on the existing surface level
(elevation + water + snowpack), thereby “filling in” low-lying areas
preferentially.  This makes for more accurate snowpacks at fine
scales.</p>
<div class="section" id="richards-pk">
<h4><a class="toc-backref" href="#id43">Richards PK</a><a class="headerlink" href="#richards-pk" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Two-phase, variable density Richards equation.</p>
</div></blockquote>
<p>Solves Richards equation:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \Theta}{\partial t} - \nabla \cdot \frac{k_r n_l}{\mu} K ( \nabla p + \rho g \hat{z} ) = Q_w\]</div>
<div class="admonition-richards-spec admonition" id="richards-spec">
<p class="admonition-title">richards-spec</p>
<ul class="simple">
<li><p><cite>“domain</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“domain”</strong>  Defaults to the subsurface mesh.</p></li>
<li><p><cite>“primary variable key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The primary variable associated with
this PK, typically <cite>“DOMAIN-pressure</cite>” Note there is no default – this
must be provided by the user.</p></li>
<li><p><cite>“boundary conditions</cite>” <code class="docutils literal notranslate"><span class="pre">[subsurface-flow-bc-spec]</span></code> Defaults to Neuman,
0 normal flux.  See <a class="reference internal" href="#flow-specific-boundary-conditions">Flow-specific Boundary Conditions</a></p></li>
<li><p><cite>“permeability type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>scalar</strong> This controls the number of
values needed to specify the absolute permeability.  One of:</p>
<ul>
<li><p><cite>“scalar</cite>” Requires one scalar value.</p></li>
<li><p><cite>“horizontal and vertical</cite>” Requires two values, horizontal then vertical.</p></li>
<li><p><cite>“diagonal tensor</cite>” Requires dim values: {xx, yy} or {xx, yy, zz}</p></li>
<li><p><cite>“full tensor</cite>”. (Note symmetry is required.)  Either {xx, yy, xy} or {xx,yy,zz,xy,xz,yz}.</p></li>
</ul>
</li>
<li><p><cite>“water retention evaluator</cite>” <code class="docutils literal notranslate"><span class="pre">[wrm-evaluator-spec]</span></code> The water retention
curve.  This needs to go away, and should get moved to State.</p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“source term</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Is there a source term?</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“source key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-mass_source</strong> Typically
not set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[mol</span> <span class="pre">s^-1]</span></code></p></li>
<li><p><cite>“source term is differentiable</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> Can the source term
be differentiated with respect to the primary variable?</p></li>
<li><p><cite>“explicit source term</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Apply the source term from
the previous time step.</p></li>
</ul>
<p>END</p>
<p>Math and solver algorithm options:</p>
<ul class="simple">
<li><p><cite>“diffusion</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> The (forward) diffusion operator,
see <a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a>.</p></li>
<li><p><cite>“diffusion preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> <strong>optional</strong> The
inverse of the diffusion operator.  See <a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a>.  Typically this
is only needed to set Jacobian options, as all others probably should
match those in <cite>“diffusion</cite>”, and default to those values.</p></li>
<li><p><cite>“preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[preconditioner-typed-spec]</span></code> Preconditioner for the solve.</p></li>
<li><p><cite>“linear solver</cite>” <code class="docutils literal notranslate"><span class="pre">[linear-solver-typed-spec]</span></code> <strong>optional</strong> May be used
to improve the inverse of the diffusion preconditioner.  Only used if this
PK is not implicitly coupled.  See <a class="reference internal" href="#linearoperator">LinearOperator</a>.</p></li>
<li><p><cite>“surface rel perm strategy</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>none</strong> Approach for
specifying the relative permeabiilty on the surface face.  <cite>“clobber</cite>” is
frequently used for cases where a surface rel perm will be provided.  One
of:</p>
<ul>
<li><p><cite>“none</cite>” : use the upwind direction to determine whether to use the
boundary face or internal cell</p></li>
<li><p><cite>“clobber</cite>” : always use the boundary face rel perm</p></li>
<li><p><cite>“max</cite>” : use the max of the boundary face and internal cell values</p></li>
<li><p><cite>“unsaturated</cite>” : Uses the boundary face when the internal cell is not
saturated.</p></li>
</ul>
</li>
<li><p><cite>“relative permeability method</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>upwind with Darcy flux</strong>
Relative permeability is defined on cells, but must be calculated on
faces to multiply a flux.  There are several methods commonly used.  Note
these can significantly change answers – you don’t want to change these
unless you know what they mena.  One of:</p>
<ul>
<li><p><cite>“upwind with Darcy flux</cite>” First-order upwind method that is most common</p></li>
<li><p><cite>“upwind with gravity</cite>” Upwinds according to the gravitational flux direction</p></li>
<li><p><cite>“cell centered</cite>” This corresponds to the harmonic mean, and is most
accurate if the problem is always wet, but has issues when it is dry.</p></li>
<li><p><cite>“arithmetic mean</cite>” Face value is the mean of the neighboring cells.
Not a good method.</p></li>
</ul>
</li>
</ul>
<p>Globalization and other process-based hacks:</p>
<ul class="simple">
<li><p><cite>“modify predictor with consistent faces</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> In a
face+cell diffusion discretization, this modifies the predictor to make
sure that faces, which are a DAE, are consistent with the predicted cells
(i.e. face fluxes from each sides match).</p></li>
<li><p><cite>“modify predictor for flux BCs</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Infiltration into
dry ground can be hard on solvers – this tries to do the local nonlinear
problem to ensure that face pressures are consistent with the
prescribed flux in a predictor.</p></li>
<li><p><cite>“modify predictor via water content</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Modifies the
predictor using the method of Krabbenhoft [??] paper.  Effectively does a
change of variables, extrapolating not in pressure but in water content,
then takes the smaller of the two extrapolants.</p></li>
<li><p><cite>“max valid change in saturation in a time step [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong>
Rejects timesteps whose max saturation change is greater than this value.
This can be useful to ensure temporally resolved solutions.  Usually a
good value is 0.1 or 0.2.</p></li>
<li><p><cite>“max valid change in ice saturation in a time step [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code>
<strong>-1</strong> Rejects timesteps whose max ice saturation change is greater than
this value.  This can be useful to ensure temporally resolved solutions.
Usually a good value is 0.1 or 0.2.</p></li>
<li><p><cite>“limit correction to pressure change [Pa]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong> If &gt; 0,
this limits an iterate’s max pressure change to this value.  Not usually
helpful.</p></li>
<li><p><cite>“limit correction to pressure change when crossing atmospheric [Pa]</cite>”
<code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong> If &gt; 0, this limits an iterate’s max pressure change
to this value when they cross atmospheric pressure.  Not usually helpful.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-physical-bdf-default-spec]</span></code> A <a class="reference internal" href="#pk-physical-and-bdf">PK: Physical and BDF</a> spec.</p></li>
</ul>
<p>Everything below this point is usually not provided by the user, but are
documented here for completeness.</p>
<p>Keys name variables:</p>
<ul class="simple">
<li><p><cite>“conserved quantity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-water_content</strong> Typically
not set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[mol]</span></code></p></li>
<li><p><cite>“mass density key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-mass_density_liquid</strong> liquid water
density <code class="docutils literal notranslate"><span class="pre">[kg</span> <span class="pre">m^-3]</span></code></p></li>
<li><p><cite>“molar density key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-molar_density_liquid</strong> liquid
water density <code class="docutils literal notranslate"><span class="pre">[mol</span> <span class="pre">m^-3]</span></code></p></li>
<li><p><cite>“permeability key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-permeability</strong> permeability of the
soil medium <code class="docutils literal notranslate"><span class="pre">[m^2]</span></code></p></li>
<li><p><cite>“conductivity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-relative_permeability</strong> scalar
coefficient of the permeability <code class="docutils literal notranslate"><span class="pre">[-]</span></code></p></li>
<li><p><cite>“upwind conductivity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code>
<strong>DOMAIN-upwind_relative_permeability</strong> upwinded (face-based) scalar
coefficient of the permeability.  Note the units of this are strange, but
this represents <span class="math notranslate nohighlight">\(\frac{n_l k_r}{\mu}\)</span> <code class="docutils literal notranslate"><span class="pre">[mol</span> <span class="pre">kg^-1</span> <span class="pre">s^1</span> <span class="pre">m^-2]</span></code></p></li>
<li><p><cite>“darcy flux key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-mass_flux</strong> mass flux across a face <code class="docutils literal notranslate"><span class="pre">[mol</span> <span class="pre">s^-1]</span></code></p></li>
<li><p><cite>“darcy flux direction key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-mass_flux_direction</strong>
direction of the darcy flux (used in upwinding <span class="math notranslate nohighlight">\(k_r\)</span>) <code class="docutils literal notranslate"><span class="pre">[??]</span></code></p></li>
<li><p><cite>“darcy velocity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-darcy_velocity</strong> darcy velocity
vector, interpolated from faces to cells <code class="docutils literal notranslate"><span class="pre">[m</span> <span class="pre">s^-1]</span></code></p></li>
<li><p><cite>“saturation key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-saturation_liquid</strong> volume
fraction of the liquid phase <code class="docutils literal notranslate"><span class="pre">[-]</span></code></p></li>
<li><p><cite>“saturation gas key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-saturation_gas</strong> volume
fraction of the gas phase <code class="docutils literal notranslate"><span class="pre">[-]</span></code></p></li>
</ul>
<p>Discretization / operators / solver controls:</p>
<ul class="simple">
<li><p><cite>“accumulation preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-accumulation-spec]</span></code> <strong>optional</strong>
The inverse of the accumulation operator.  See <a class="reference internal" href="#pde-accumulation">PDE_Accumulation</a>.
Typically not provided by users, as defaults are correct.</p></li>
<li><p><cite>“absolute error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>2750.0</strong> <code class="docutils literal notranslate"><span class="pre">[mol]</span></code></p></li>
<li><p><cite>“compute boundary values</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Used to include boundary
face unknowns on discretizations that are cell-only (e.g. FV).  This can
be useful for surface flow or other wierd boundary conditions.  Usually
provided by MPCs that need them.</p></li>
</ul>
<p>Physics control:</p>
<ul class="simple">
<li><p><cite>“permeability rescaling</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e7</strong> Typically 1e7 or order
<span class="math notranslate nohighlight">\(sqrt(K)\)</span> is about right.  This rescales things to stop from
multiplying by small numbers (permeability) and then by large number
(<span class="math notranslate nohighlight">\(\rho / \mu\)</span>).</p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“coupled to surface via flux</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, apply
surface boundary conditions from an exchange flux.  Note, if this is a
coupled problem, it is probably set by the MPC.  No need for a user to
set it.</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“surface-subsurface flux key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-surface_subsurface_flux</strong></p></li>
</ul>
<p>END</p>
<ul class="simple">
<li><p><cite>“coupled to surface via head</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, apply
surface boundary conditions from the surface pressure (Dirichlet).</p></li>
</ul>
<p>EVALUATORS:</p>
<ul class="simple">
<li><p><cite>“conserved quantity</cite>”</p></li>
<li><p><cite>“mass density</cite>”</p></li>
<li><p><cite>“molar density</cite>”</p></li>
<li><p><cite>“permeability</cite>”</p></li>
<li><p><cite>“conductivity</cite>”</p></li>
<li><p><cite>“saturation</cite>”</p></li>
<li><p><cite>“primary variable</cite>” = <cite>“independent</cite>”</p></li>
</ul>
</div>
</div>
<div class="section" id="permafrost-flow-pk">
<h4><a class="toc-backref" href="#id44">Permafrost Flow PK</a><a class="headerlink" href="#permafrost-flow-pk" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>A three-phase, thermal Richard’s equation with water, water vapor, and ice for permafrost applications.</p>
</div></blockquote>
<p>Note that the only difference between permafrost and richards is in
constitutive relations – the WRM changes to provide three saturations,
while the water content changes to account for water in ice phase.  As these
are now drop-in field evaluators, there is very little to change in the PK.</p>
<p>In the future, this should not even need a different PK.</p>
<div class="admonition-permafrost-spec admonition" id="permafrost-spec">
<p class="admonition-title">permafrost-spec</p>
<ul class="simple">
<li><p><cite>“saturation ice key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“DOMAIN-saturation_ice”</strong> volume fraction of the ice phase (only when relevant) <code class="docutils literal notranslate"><span class="pre">[-]</span></code> Typically the default is correct.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[richards-spec]</span></code> See <a class="reference internal" href="#richards-pk">Richards PK</a></p></li>
</ul>
</div>
</div>
<div class="section" id="overland-flow-pk">
<h4><a class="toc-backref" href="#id45">Overland Flow PK</a><a class="headerlink" href="#overland-flow-pk" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Overland flow using the diffusion wave equation.</p>
</div></blockquote>
<p>Solves the diffusion wave equation for overland flow with pressure as a primary variable:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \Theta}{\partial t} - \nabla n_l k \nabla h(p) = Q_w\]</div>
<div class="admonition-overland-pressure-spec admonition" id="overland-pressure-spec">
<p class="admonition-title">overland-pressure-spec</p>
<p>Keys name variables:</p>
<ul class="simple">
<li><p><cite>“domain</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“surface”</strong>  Defaults to the extracted surface mesh.</p></li>
<li><p><cite>“primary variable</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The primary variable associated with
this PK, typically <cite>“DOMAIN-pressure</cite>” Note there is no default – this
must be provided by the user.</p></li>
<li><p><cite>“boundary conditions</cite>” <code class="docutils literal notranslate"><span class="pre">[surface-flow-bc-spec]</span></code> Defaults to Neuman, 0 normal flux.</p></li>
<li><p><cite>“overland conductivity evaluator</cite>” <code class="docutils literal notranslate"><span class="pre">[overland-conductivity-eval-spec]</span></code>
See <a href="#id166"><span class="problematic" id="id167">`Overland Conductivity Evaluator`_</span></a>.</p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“source term</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Is there a source term?</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“source key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-mass_source</strong> Typically
not set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[m</span> <span class="pre">s^-1]</span></code> or <code class="docutils literal notranslate"><span class="pre">[mol</span> <span class="pre">s^-1]</span></code></p></li>
<li><p><cite>“mass source in meters</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> Is the source term in <code class="docutils literal notranslate"><span class="pre">[m</span> <span class="pre">s^-1]</span></code>?</p></li>
<li><p><cite>“source term is differentiable</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> Can the source term
be differentiated with respect to the primary variable?</p></li>
<li><p><cite>“explicit source term</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Apply the source term from
the previous time step.</p></li>
</ul>
<p>END</p>
<p>Math and solver algorithm options:</p>
<ul class="simple">
<li><p><cite>“diffusion</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> The (forward) diffusion operator,
see <a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a>.</p></li>
<li><p><cite>“diffusion preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> <strong>optional</strong> The
inverse of the diffusion operator.  See <a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a>.  Typically this
is only needed to set Jacobian options, as all others probably should
match those in <cite>“diffusion</cite>”, and default to those values.</p></li>
<li><p><cite>“linear solver</cite>” <code class="docutils literal notranslate"><span class="pre">[linear-solver-typed-spec]</span></code> <strong>optional</strong> May be used
to improve the inverse of the diffusion preconditioner.  Only used if this
PK is not implicitly coupled.  See <a class="reference internal" href="#linearoperator">LinearOperator</a>.</p></li>
<li><p><cite>“absolute error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>550.</strong> Defaults to 1 cm of
water.  A small, but significant, amount of water.</p></li>
<li><p><cite>“limit correction to pressure change [Pa]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong> If &gt; 0,
this limits an iterate’s max pressure change to this value.  Not usually
helpful.</p></li>
<li><p><cite>“limit correction to pressure change when crossing atmospheric [Pa]</cite>”
<code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong> If &gt; 0, this limits an iterate’s max pressure change
to this value when they cross atmospheric pressure.  Not usually helpful.</p></li>
<li><p><cite>“allow no negative ponded depths</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Modifies all
correction updates to ensure only positive ponded depth is allowed.</p></li>
<li><p><cite>“min ponded depth for velocity calculation</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-2</strong> For
ponded depth below this height, declare the velocity 0.</p></li>
<li><p><cite>“min ponded depth for tidal bc</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.02</strong> Control on the
tidal boundary condition.  TODO: This should live in the BC spec?</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-physical-bdf-default-spec]</span></code> A <a class="reference internal" href="#pk-physical-and-bdf">PK: Physical and BDF</a> spec.</p></li>
</ul>
<p>Everything below this point is usually not provided by the user, but are
documented here for completeness.</p>
<p>Keys name variables:</p>
<ul class="simple">
<li><p><cite>“conserved quantity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-water_content</strong> Typically
not set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[mol]</span></code></p></li>
<li><p><cite>“elevation key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-elevation</strong> Typically
not set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[mol]</span></code></p></li>
<li><p><cite>“slope magnitude key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-slope_magnitude</strong> Typically
not set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[mol]</span></code></p></li>
</ul>
<p>Algorithmic parameters:</p>
<ul class="simple">
<li><p><cite>“coupled to subsurface via flux</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Set by MPC.</p></li>
<li><p><cite>“coupled to subsurface via head</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Set by MPC.</p></li>
<li><p><cite>“accumulation preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-accumulation-spec]</span></code> <strong>optional</strong>
The inverse of the accumulation operator.  See <a class="reference internal" href="#pde-accumulation">PDE_Accumulation</a>.
Typically not provided by users, as defaults are correct.</p></li>
</ul>
<p>EVALUATORS:</p>
<ul class="simple">
<li><p><cite>“conserved quantity</cite>”</p></li>
<li><p><cite>“water content</cite>”</p></li>
<li><p><cite>“cell volume</cite>”</p></li>
<li><p><cite>“surface_subsurface_flux</cite>”</p></li>
<li><p><cite>“elevation</cite>”</p></li>
<li><p><cite>“slope magnitude</cite>”</p></li>
<li><p><cite>“overland_conductivity</cite>”</p></li>
<li><p><cite>“ponded_depth</cite>”</p></li>
<li><p><cite>“pres_elev</cite>”</p></li>
<li><p><cite>“source</cite>”</p></li>
</ul>
</div>
</div>
<div class="section" id="overland-flow-with-ice">
<h4><a class="toc-backref" href="#id46">Overland Flow with Ice</a><a class="headerlink" href="#overland-flow-with-ice" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Two-phase overland flow equation.</p>
</div></blockquote>
<p>This modifies the diffusion wave equation for overland flow that includes
freeze-thaw processes.  This class could completely go away, but it does some
error checking on the input file to make sure freeze-thaw processes are done
correctly.  In the future this service should be done by a preprocessor
generating the input file, and this class would go away.</p>
<div class="admonition-icy-overland-spec admonition" id="icy-overland-spec">
<p class="admonition-title">icy-overland-spec</p>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[overland-pressure-spec]</span></code> See <a class="reference internal" href="#overland-flow-pk">Overland Flow PK</a>.</p></li>
</ul>
</div>
</div>
<div class="section" id="snow-distribution-pk">
<h4><a class="toc-backref" href="#id47">Snow Distribution PK</a><a class="headerlink" href="#snow-distribution-pk" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Preferential distribution of snow precip in low-lying areas.</p>
</div></blockquote>
<p>This PK is a heuristic PK that distributes incoming snow precipitation using a
diffusion wave equation.  Think of it as an analogue to overland flow – it
effectively ensures that new snow “flows downhill,” due to a uniformly random
direction and strength wind, and lands on the lowest lying areas.</p>
<p>Tweaking the snow-manning_coefficient lets you play with how uniform the snow
layer ends up.  Most of the parameters are set by your snow precipitation input
data interval.  The details of this are a bit tricky mathematically, and it may
take some fiddling with parameters to do this correctly if your data is not
daily (which all defaults are set for).</p>
<div class="admonition-snow-distribution-spec admonition" id="snow-distribution-spec">
<p class="admonition-title">snow-distribution-spec</p>
<ul class="simple">
<li><p><cite>“distribution time</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>86400.</strong> Interval of snow precip input dataset. <cite>[s]</cite></p></li>
<li><p><cite>“precipitation function</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> Snow precipitation <a class="reference internal" href="#function">Function</a> spec.</p></li>
<li><p><cite>“diffusion</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> Diffusion drives the distribution.
Typically we use finite volume here.  See <a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a></p></li>
<li><p><cite>“diffusion preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> Inverse of the
above.  Likely only Jacobian term options are needed here, as the others
default to the same as the <cite>“diffusion</cite>” list.  See <a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a>.</p></li>
<li><p><cite>“preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[preconditioner-typed-spec]</span></code> Preconditioner for the solve.</p></li>
<li><p><cite>“linear solver</cite>” <code class="docutils literal notranslate"><span class="pre">[linear-solver-typed-spec]</span></code> <strong>optional</strong> May be used
to improve the inverse of the diffusion preconditioner.  Only used if this
PK is not implicitly coupled.  See <a class="reference internal" href="#linearoperator">LinearOperator</a>.</p></li>
</ul>
<p>Not typically provided by the user, defaults are good:</p>
<ul class="simple">
<li><p><cite>“accumulation preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-accumulation-spec]</span></code> See <a class="reference internal" href="#pde-accumulation">PDE_Accumulation</a>.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="energy-pks">
<h3><a class="toc-backref" href="#id48">Energy PKs</a><a class="headerlink" href="#energy-pks" title="Permalink to this headline">¶</a></h3>
<p>Energy PKs describe the conservation of energy as it is advected and
diffuses both above and below-ground.  Both surface and subsurface
energy equations are based on a simple advection-diffusion equation,
and include variants with and without freeze-thaw processes.</p>
<div class="section" id="energy-base-pk">
<h4><a class="toc-backref" href="#id49">Energy Base PK</a><a class="headerlink" href="#energy-base-pk" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>An advection-diffusion equation for energy.</p>
</div></blockquote>
<p>Solves an advection-diffusion equation for energy:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial E}{\partial t} - \nabla \cdot \kappa \nabla T + \nabla \cdot \mathbf{q} e(T) = Q_w e(T) + Q_e\]</div>
<div class="admonition-energy-pk-spec admonition" id="energy-pk-spec">
<p class="admonition-title">energy-pk-spec</p>
<ul class="simple">
<li><p><cite>“domain</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“domain”</strong>  Defaults to the subsurface mesh.</p></li>
<li><p><cite>“primary variable</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The primary variable associated with
this PK, typically <cite>“DOMAIN-temperature</cite>” Note there is no default – this
must be provided by the user.</p></li>
<li><p><cite>“boundary conditions</cite>” <code class="docutils literal notranslate"><span class="pre">[energy-bc-spec]</span></code> Defaults to 0 diffusive flux
boundary condition.  See <a href="#id168"><span class="problematic" id="id169">`Energy-specific Boundary Conditions`_</span></a></p></li>
<li><p><cite>“thermal conductivity evaluator</cite>”
<code class="docutils literal notranslate"><span class="pre">[thermal-conductivity-evaluator-spec]</span></code> The thermal conductivity.  This
needs to go away, and should get moved to State.</p></li>
<li><p><cite>“absolute error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>76.e-6</strong> A small amount of
energy, see error norm. <cite>[MJ]</cite></p></li>
<li><p><cite>“upwind conductivity method</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>arithmetic mean</strong> Method of
moving cell-based thermal conductivities onto faces.  One of:</p>
<ul>
<li><p><cite>“arithmetic mean</cite>” the default, average of neighboring cells</p></li>
<li><p><cite>“cell centered</cite>” harmonic mean</p></li>
</ul>
</li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“explicit advection</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Treat the advection term implicitly.</p></li>
</ul>
<p>ELSE</p>
<ul class="simple">
<li><p><cite>“supress advective terms in preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong>
Typically subsurface energy equations are strongly diffusion dominated,
and the advective terms may add little.  With this flag on, we ignore
theem in the preconditioner, making an easier linear solve and often not
negatively impacting the nonlinear solve.</p></li>
<li><p><cite>“advection preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-advection-spec]</span></code> <strong>optional</strong>
Typically defaults are correct.</p></li>
</ul>
<p>END</p>
<ul class="simple">
<li><p><cite>“diffusion</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> See <a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a>, the diffusion operator.</p></li>
<li><p><cite>“diffusion preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> See
<a class="reference internal" href="#pde-diffusion">PDE_Diffusion</a>, the inverse operator.  Typically only adds Jacobian
terms, as all the rest default to those values from <cite>“diffusion</cite>”.</p></li>
<li><p><cite>“preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[preconditioner-typed-spec]</span></code> The <a class="reference internal" href="#preconditioner">Preconditioner</a></p></li>
<li><p><cite>“linear solver</cite>” <code class="docutils literal notranslate"><span class="pre">[linear-solver-typed-spec]</span></code> A <a class="reference internal" href="#linearoperator">LinearOperator</a></p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“source term</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Is there a source term?</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“source key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-total_energy_source</strong> Typically
not set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[MJ</span> <span class="pre">s^-1]</span></code></p></li>
<li><p><cite>“source term is differentiable</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> Can the source term
be differentiated with respect to the primary variable?</p></li>
<li><p><cite>“source term finite difference</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If the source term
is not diffferentiable, we can do a finite difference approximation of
this derivative anyway.  This is useful for difficult-to-differentiate
terms like a surface energy balance, which includes many terms.</p></li>
</ul>
<p>EVALUATORS:</p>
<ul class="simple">
<li><p><cite>“source term</cite>”</p></li>
</ul>
<p>END</p>
<p>Globalization:</p>
<ul class="simple">
<li><p><cite>“modify predictor with consistent faces</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> In a
face+cell diffusion discretization, this modifies the predictor to make
sure that faces, which are a DAE, are consistent with the predicted cells
(i.e. face fluxes from each sides match).</p></li>
<li><p><cite>“modify predictor for freezing</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> A simple limiter
that keeps temperature corrections from jumping over the phase change.</p></li>
<li><p><cite>“limit correction to temperature change [K]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1.0</strong> If &gt;
0, stops nonlinear updates from being too big through clipping.</p></li>
</ul>
<p>The following are rarely set by the user, as the defaults are typically right.</p>
<p>Variable names:</p>
<ul class="simple">
<li><p><cite>“conserved quantity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-energy</strong> The total energy <span class="math notranslate nohighlight">\(E\)</span> <cite>[MJ]</cite></p></li>
<li><p><cite>“energy key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-energy</strong> The total energy <span class="math notranslate nohighlight">\(E\)</span>, also the conserved quantity. <cite>[MJ]</cite></p></li>
<li><p><cite>“water content key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-water_content</strong> The total mass <span class="math notranslate nohighlight">\(\Theta\)</span>, used in error norm <cite>[mol]</cite></p></li>
<li><p><cite>“enthalpy key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-enthalpy</strong> The specific enthalpy :math`e` <cite>[MJ mol^-1]</cite></p></li>
<li><p><cite>“flux key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-mass_flux</strong> The mass flux <span class="math notranslate nohighlight">\(\mathbf{q}\)</span> used in advection. <cite>[mol s^-1]</cite></p></li>
<li><p><cite>“diffusive energy flux</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-diffusive_energy_flux</strong> <span class="math notranslate nohighlight">\(\mathbf{q_e}\)</span> <cite>[MJ s^-1]</cite></p></li>
<li><p><cite>“advected energy flux</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-advected_energy_flux</strong> <span class="math notranslate nohighlight">\(\mathbf{q_e^{adv}} = q e\)</span> <cite>[MJ s^-1]</cite></p></li>
<li><p><cite>“thermal conductivity</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-thermal_conductivity</strong> Thermal conductivity on cells <cite>[W m^-1 K^-1]</cite></p></li>
<li><p><cite>“upwinded thermal conductivity</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-upwinded_thermal_conductivity</strong> Thermal conductivity on faces <cite>[W m^-1 K^-1]</cite></p></li>
<li><p><cite>“advection</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-advection-spec]</span></code> <strong>optional</strong> The <a class="reference internal" href="#pde-advection">PDE_Advection</a> spec.  Only one current implementation, so defaults are typically fine.</p></li>
<li><p><cite>“accumulation preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-accumulation-spec]</span></code> <strong>optional</strong>
The inverse of the accumulation operator.  See <a class="reference internal" href="#pde-accumulation">PDE_Accumulation</a>.
Typically not provided by users, as defaults are correct.</p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“coupled to surface via flux</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, apply
surface boundary conditions from an exchange flux.  Note, if this is a
coupled problem, it is probably set by the MPC.  No need for a user to
set it.</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“surface-subsurface energy flux key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-surface_subsurface_energy_flux</strong></p></li>
</ul>
<p>END</p>
<ul class="simple">
<li><p><cite>“coupled to surface via temperature</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, apply
surface boundary conditions from the surface temperature (Dirichlet).</p></li>
</ul>
<p>EVALUATORS:</p>
<ul class="simple">
<li><p><cite>“enthalpy</cite>”</p></li>
<li><p><cite>“cell volume</cite>”</p></li>
<li><p><cite>“thermal conductivity</cite>”</p></li>
<li><p><cite>“conserved quantity</cite>”</p></li>
<li><p><cite>“energy</cite>”</p></li>
</ul>
</div>
</div>
<div class="section" id="two-phase-subsurface-energy-pk">
<h4><a class="toc-backref" href="#id50">Two-Phase subsurface Energy PK</a><a class="headerlink" href="#two-phase-subsurface-energy-pk" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>An advection-diffusion equation for energy in two phases.</p>
</div></blockquote>
<p>This is simply a subsurface energy equation that places a few more requirements
on the base class.  It could probably go away if we refactor to remove
hard-coded evaluators.</p>
<div class="admonition-energy-two-phase-pk-spec admonition" id="energy-two-phase-pk-spec">
<p class="admonition-title">energy-two-phase-pk-spec</p>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[energy-pk-spec]</span></code>  See <a class="reference internal" href="#energy-base-pk">Energy Base PK</a></p></li>
</ul>
</div>
</div>
<div class="section" id="three-phase-subsurface-energy-pk">
<h4><a class="toc-backref" href="#id51">Three-Phase subsurface Energy PK</a><a class="headerlink" href="#three-phase-subsurface-energy-pk" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>An advection-diffusion equation for energy in three phases.</p>
</div></blockquote>
<p>This is simply a subsurface energy equation that places a few more requirements
on the base class.  It could probably go away if we refactor to remove
hard-coded evaluators.</p>
<div class="admonition-energy-three-phase-pk-spec admonition" id="energy-three-phase-pk-spec">
<p class="admonition-title">energy-three-phase-pk-spec</p>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[energy-two-phase-pk-spec]</span></code> See  <a class="reference internal" href="#two-phase-subsurface-energy-pk">Two-Phase subsurface Energy PK</a></p></li>
</ul>
</div>
</div>
<div class="section" id="overland-energy-with-ice">
<h4><a class="toc-backref" href="#id52">Overland energy with Ice</a><a class="headerlink" href="#overland-energy-with-ice" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>An advection-diffusion equation for surface energy in two phases.</p>
</div></blockquote>
<p>This is simply a surface energy equation that places a few more requirements
on the base class.  It could probably go away if we refactor to remove
hard-coded evaluators.</p>
<div class="admonition-energy-surface-ice-pk-spec admonition" id="energy-surface-ice-pk-spec">
<p class="admonition-title">energy-surface-ice-pk-spec</p>
<p>These are typically not set by the user:</p>
<ul class="simple">
<li><p><cite>“coupled to subsurface via temperature</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> A coupling
scheme, provided by MPC.</p></li>
<li><p><cite>“coupled to subsurface via flux</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> A coupling
scheme, provided by MPC.</p></li>
<li><p><cite>“subsurface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong> If one of the above
coupling schemes is turned on, we need to know the subsurface mesh.
Provided by MPC.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[energy-pk-spec]</span></code>  See <a class="reference internal" href="#energy-base-pk">Energy Base PK</a></p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="surface-energy-balance-pks">
<h3><a class="toc-backref" href="#id53">Surface Energy Balance PKs</a><a class="headerlink" href="#surface-energy-balance-pks" title="Permalink to this headline">¶</a></h3>
<p>Integrated hydrology is not much use without significant process
complexity in source terms coming from the ecohydrologic environment.
These include straightforward sources, like precipitation, but also
more complicated ones such as evaporation and transpiration.</p>
<p>These terms are almost always tied up in a surface energy balance –
evaporation and transpiration are driven by vapor pressure gradients
between the atmosphere and the surface (either snow, ponded water,
soil, or leaf).  Solving a surface energy balance often requires
providing a bunch of terms, including radiated energy, conducted
energy, latent and sensible heat models, etc.</p>
<p>ATS currently has several approaches to calculating these – see
<a class="reference external" href="https://github.com/amanzi/ats-demos">ats-demos</a> examples on
ecohydrology for a more in-depth discussion.</p>
<div class="section" id="balance-equation">
<h4><a class="toc-backref" href="#id54">Balance Equation</a><a class="headerlink" href="#balance-equation" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>A simple conservation ODE.</p>
</div></blockquote>
<p>This is a very simple vector of ODEs, useful in balance equations, where the
time derivative of a conserved quantity is determined by a bunch of sources and
sinks.</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \Phi }{\partial t} = \sum_i Q_i\]</div>
<div class="admonition-balance-pk-spec admonition" id="balance-pk-spec">
<p class="admonition-title">balance-pk-spec</p>
<ul class="simple">
<li><p><cite>“domain</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Mesh on which the balance is to be done.</p></li>
<li><p><cite>“primary variable key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The primary variable associated with
this PK.  Note there is no default – this must be provided by the user.</p></li>
<li><p><cite>“conserved quantity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The conserved quantity <span class="math notranslate nohighlight">\(\Phi\)</span></p></li>
<li><p><cite>“source key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-source_sink</strong> Units are in conserved
quantity per second per cell volume.</p></li>
<li><p><cite>“time discretization theta</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> <span class="math notranslate nohighlight">\(\theta\)</span> in a
Crank-Nicholson time integration scheme.  1.0 implies fully implicit, 0.0
implies explicit, 0.5 implies C-N.</p></li>
<li><p><cite>“modify predictor positivity preserving</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true,
predictors are modified to ensure that the conserved quantity is always &gt; 0.</p></li>
<li><p><cite>“absolute error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>550.0</strong> a_tol in the standard
error norm calculation.  Defaults to a small amount of water.  Units are
the same as the conserved quantity.</p></li>
<li><p><cite>“preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[preconditioner-typed-spec]</span></code> Preconditioner for the
solve.</p></li>
<li><p><cite>“linear solver</cite>” <code class="docutils literal notranslate"><span class="pre">[linear-solver-typed-spec]</span></code> <strong>optional</strong> May be used
to improve the inverse of the diffusion preconditioner.  Only used if this
PK is not implicitly coupled.  See <a class="reference internal" href="#linearoperator">LinearOperator</a>.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-physical-bdf-default-spec]</span></code></p></li>
</ul>
</div>
</div>
<div class="section" id="snow-balance-equation">
<h4><a class="toc-backref" href="#id55">Snow Balance Equation</a><a class="headerlink" href="#snow-balance-equation" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>An implicit PK for surface balance snow SWE conservation.</p>
</div></blockquote>
<p>This is a balance PK whose conserved quantity is snow SWE.  The energy balance
comes in as it provides the energy needed to melt snow.  So source terms
include snow precipitation and snowmelt.  It also manages snow density, which
should get rethought a bit.</p>
<p>There is also some wierd hackiness here about area fractions – see ATS Issue
#8</p>
<div class="admonition-subgrid-balance-pk-spec admonition" id="subgrid-balance-pk-spec">
<p class="admonition-title">subgrid-balance-pk-spec</p>
<ul class="simple">
<li><p><cite>“absolute error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.01</strong> <code class="docutils literal notranslate"><span class="pre">[m]</span></code></p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[balance-pk-spec]</span></code> This <em>is a</em> <a class="reference internal" href="#balance-equation">Balance Equation</a></p></li>
</ul>
<p>Not typically set by user, defaults work:</p>
<ul class="simple">
<li><p><cite>“conserved quantity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>LAYER-snow_water_equivalent</strong>
Sets the default conserved quantity key, so this is likely not supplied
by the user. <cite>[m]</cite></p></li>
<li><p><cite>“snow density key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>LAYER-density</strong> Default snow density
key. <cite>[kg m^-3]</cite></p></li>
<li><p><cite>“snow age key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>LAYER-age</strong> Default snow age key. <cite>[d]</cite></p></li>
<li><p><cite>“new snow key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>LAYER-source</strong> Default new snow key. <cite>[m SWE s^-1]</cite></p></li>
<li><p><cite>“area fractions key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>LAYER-fractional_areas</strong> Subgrid
model fractional areas, see note above. <cite>[-]</cite></p></li>
<li><p><cite>“snow death rate key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>LAYER-death_rate</strong> Deals with last
tiny bit of snowmelt.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="biogeochemistry">
<h3><a class="toc-backref" href="#id56">Biogeochemistry</a><a class="headerlink" href="#biogeochemistry" title="Permalink to this headline">¶</a></h3>
<p>To accurately predict watershed ecohydrology, a carbon cycle model is
needed to predict transpiration.  By simulating a carbon cycle, we are
able to predict the rate of photosynthesis as a function of space and
time, and photosynthesis governs root water uptake.  Currently only
one big-leaf model is available, but ongoing work is wrapping a
generalized Common/Colorado Land Model based on that developed within
the ParFlow team, and another ongoing project is working on wrapping
kernels from E3SM’s Land Model.</p>
<div class="section" id="biogeochemistry-monolithic-version">
<h4><a class="toc-backref" href="#id57">Biogeochemistry – Monolithic Version</a><a class="headerlink" href="#biogeochemistry-monolithic-version" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Above and below-ground carbon cycle model.</p>
</div></blockquote>
<p>This is a multi-leaf layer, big-leaf vegetation model coupled to a Century
model for belowground carbon decomposition.</p>
<p>It leverages a PFT-based structure which allows multiple height-sorted PFTs to
coexist on the same grid cells, with the shorter PFTs getting whatever light is
left in the understory.</p>
<p>The implementation is based on an old, standalone code by Chonggang Xu, and
adapted for ATS.  While this is not simple, it is called BGC simple as it is
about the least amount of complexity required to get a reasonable carbon cycle
into ATS.</p>
<p>Outputs of this include transpiration, a critical sink for hydrology, as it
solves photosynthesis based on water availability.</p>
<p>Note this is an “explicit update PK,” or effectively a forward Euler timestep
that is not written in ODE form.</p>
<p>Note this works on both the surface (vegetation) and subsurface (decomposition)
meshes.  <strong>It is required</strong> that the subsurface mesh is a “columnar” mesh, and
that build_columns in the subsurface <a class="reference internal" href="#mesh">Mesh</a> spec has been supplied.</p>
<div class="admonition-bgc-simple-spec admonition" id="bgc-simple-spec">
<p class="admonition-title">bgc-simple-spec</p>
<ul class="simple">
<li><p><cite>“initial time step</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> Initial time step size <cite>[s]</cite></p></li>
<li><p><cite>“number of carbon pools</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>7</strong> Unclear whether this can actually change?</p></li>
<li><p><cite>“soil carbon parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[soil-carbon-spec-list]</span></code> List of soil carbon parameters by soil mesh partition region name.</p></li>
<li><p><cite>“pft parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[pft-spec-list]</span></code> List of PFT parameters by PFT name.</p></li>
<li><p><cite>“latitude [degrees]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>60</strong> Latitude of the simulation in degrees.  Used in radiation balance.</p></li>
<li><p><cite>“wind speed reference height [m]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>2.0</strong> Reference height of the wind speed dataset.</p></li>
<li><p><cite>“cryoturbation mixing coefficient [cm^2/yr]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>5.0</strong> Controls diffusion of carbon into the subsurface via cryoturbation.</p></li>
<li><p><cite>“leaf biomass initial condition</cite>” <code class="docutils literal notranslate"><span class="pre">[initial-conditions-spec]</span></code> Sets the leaf biomass IC.</p></li>
<li><p><cite>“domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>domain</strong></p></li>
<li><p><cite>“surface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>surface</strong></p></li>
<li><p><cite>“transpiration key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-transpiration</strong> The distributed transpiration flux <cite>[mol s^-1]</cite></p></li>
<li><p><cite>“shaded shortwave radiation key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code>
<strong>SURFACE_DOMAIN-shaded_shortwave_radiation</strong> Shortwave radiation that gets
past the canopy and teo the bare ground for soil evaporation. <cite>[W m^-2]</cite></p></li>
<li><p><cite>“total leaf area index key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>SURFACE_DOMAIN-total_leaf_area_index</strong> Total LAI across all PFTs.</p></li>
</ul>
<p>EVALUATORS:</p>
<ul class="simple">
<li><p><cite>“temperature</cite>” The soil temperature <cite>[K]</cite></p></li>
<li><p><cite>“pressure</cite>” soil mafic potential <cite>[Pa]</cite></p></li>
<li><p><cite>“surface-cell_volume</cite>” <cite>[m^2]</cite></p></li>
<li><p><cite>“surface-incoming shortwave radiation</cite>” <cite>[W m^-2]</cite></p></li>
<li><p><cite>“surface-air_temperature</cite>” <cite>[K]</cite></p></li>
<li><p><cite>“surface-relative_humidity</cite>” <cite>[-]</cite></p></li>
<li><p><cite>“surface-wind_speed</cite>” <cite>[m s^-1]</cite></p></li>
<li><p><cite>“surface-co2_concentration</cite>” <cite>[ppm]</cite></p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="deformation">
<h3><a class="toc-backref" href="#id58">Deformation</a><a class="headerlink" href="#deformation" title="Permalink to this headline">¶</a></h3>
<p>The unstructured mesh framework we use provides the opportunity to
include deformation of the mesh.  This deformation can be done in two
ways – either node coordinate changes are provided, or volumetric
changes are provided, and the code attempts to iterate toward a global
coordinate change that satisfies these volumetric changes.  The latter
can be somewhat fragile for large deformation, but it does allow
simple deformation such as small, somewhat uniform subsidence.  The
volumetric deformation PK below does this based on a volumetric change
given by loss of bulk ice.</p>
<div class="section" id="volumetric-deformation">
<h4><a class="toc-backref" href="#id59">Volumetric Deformation</a><a class="headerlink" href="#volumetric-deformation" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Subsidence through bulk ice loss and cell volumetric change.</p>
</div></blockquote>
<p>This process kernel provides for going from a cell volumetric change to an
updated unstructured mesh, and can be coupled sequentially with flow to solve
problems of flow in a subsiding porous media.</p>
<p>Note that all deformation here is vertical, and we assume that the subsurface
mesh is <strong>perfectly columnar</strong> and that the “build columns” parameter has been
given to the subsurface mesh.  See the <a class="reference internal" href="#mesh">Mesh</a> spec for more.</p>
<p>The process here is governed through two options, the “deformation mode” and
the “deformation strategy.”</p>
<p>The deformation mode describes how the cell volume change is calculated.  There
are three options here:</p>
<ul class="simple">
<li><p>“prescribed” uses a function to precribe the volume changes as a function of (t,x,y,z).</p></li>
<li><p>“structural” decreases the cell volume if the porosity is above a prescribed
“structurally connected matrix” porosity.  Think of this as bulk ice
“propping up” the soil grains – as that bulk ice melts, it reduces porosity
toward the porosity in at which grains start to touch again and can be
structurally sound.</p></li>
<li><p>“saturation” is a heuristic that considers the liquid saturation directly,
and tries to relax the liquid saturation back toward a value that is
consistent with what the thawed soil should be.</p></li>
</ul>
<p>The deformation strategy describes how the cell volume change is turned into
node coordinate changes.  Three options are available:</p>
<ul class="simple">
<li><p>“average” simply takes the average of volume change/surface area and
horizontally averages this quantity across all neighbors.  While this has the
advantage of being simple, it has issues when thaw gradients in the
horizontal are not zero, as it may result in the loss of volume in a fully
frozen cell, blowing up the pressure and breaking the code.  This is great
when it works, but it almost never works in real problems.</p></li>
<li><p>“global optimization” attempts to directly form and solve the minimization
problem to find the nodal changes that result in the target volumetric
changes.  Note this has issues with overfitting, so penalty methods are used
to smooth the solution of the problem.  This is not particularly robust.</p></li>
<li><p>“mstk implementation” MSTK implements an iterated, local optimization method
that, one-at-a-time, moves nodes to try and match the volumes.  This has
fewer issues with overfitting, but doesn’t always do sane things, and can be
expensive if iterations don’t work well.  This is not particularly robust
either, but it seems to be the preferred method for now.</p></li>
</ul>
<div class="admonition-volumetric-deformation-pk-spec admonition" id="volumetric-deformation-pk-spec">
<p class="admonition-title">volumetric-deformation-pk-spec</p>
<ul class="simple">
<li><p><cite>“max time step [s]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>inf</strong> Sets a maximum time step size.</p></li>
<li><p><cite>“deformation mode</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>prescribed</strong> See above for
descriptions.  One of: <cite>“prescribed</cite>”, <cite>“structural</cite>”, or <cite>“saturation</cite>”.</p></li>
<li><p><cite>“deformation strategy</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>global optimization</strong> See above
for descriptions.  One of <cite>“average</cite>”, <cite>“global optimization</cite>”, or <cite>“mstk
implementation</cite>”</p></li>
<li><p><cite>“domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>domain</strong>  The mesh to deform.</p></li>
<li><p><cite>“surface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>surface</strong> The surface mesh.</p></li>
<li><p><cite>“deformation function</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> <strong>optional</strong> Only used if
“deformation mode” == “prescribed”</p></li>
<li><p><cite>“global solve operator</cite>” <code class="docutils literal notranslate"><span class="pre">[matrix-volumetric-deformation-spec]</span></code>
Old-style Matrix (not Amanzi Operator) spec.  Only used if “deformation
strategy” == “global optimization”</p></li>
<li><p><cite>“Solver</cite>” <code class="docutils literal notranslate"><span class="pre">[linear-operator-typed-spec]</span></code> Solver for the optimization
problem. Only used if “deformation strategy” == “global optimization”</p></li>
</ul>
<p>EVALUATORS:
- <cite>“saturation_ice</cite>”
- <cite>“saturation_liquid</cite>”
- <cite>“saturation_gas</cite>”
- <cite>“base_porosity</cite>”
- <cite>“porosity</cite>”
- <cite>“cell volume</cite>”</p>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-physical-default-spec]</span></code></p></li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="mpc">
<h2><a class="toc-backref" href="#id60">MPC</a><a class="headerlink" href="#mpc" title="Permalink to this headline">¶</a></h2>
<p>Multi-process-couplers or MPCs couple other PKs.  They also are PKs
themselves, in that they implement the PK interface.  So MPCs can also
couple other MPCs.  There are a few common “base” MPCs which do the
simplest form of coupling – sequential and globally implicit (with a
diagonal preconditioner).  Then there are specific couplers which know
more about their coupled sub-PKs, and can do more complicated things
(for instance, adding off-diagonal block entries to the
preconditioner).</p>
<p>MPCs are also used to couple across domains – for instance integrated
hydrology is a surface+subsurface flow coupler.  They also can do
fancier things like drape a bunch of subgrid columns off of a mesh, or
other things.  Think of these as the custom couplers.</p>
<div class="section" id="base-mpc">
<h3><a class="toc-backref" href="#id61">Base MPC</a><a class="headerlink" href="#base-mpc" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Multi process coupler base class.</p>
</div></blockquote>
<p>A multi process coupler is a PK (process kernel) which coordinates and couples
several PKs.  Each of these coordinated PKs may be MPCs themselves, or physical
PKs.  Note this does NOT provide a full implementation of PK – it does not
supply the AdvanceStep() method.  Therefore this class cannot be instantiated, but
must be inherited by derived classes which finish supplying the functionality.
Instead, this provides the data structures and methods (which may be overridden
by derived classes) for managing multiple PKs.</p>
<p>Most of these methods simply loop through the coordinated PKs, calling their
respective methods.</p>
<div class="admonition-mpc-spec admonition" id="mpc-spec">
<p class="admonition-title">mpc-spec</p>
<ul class="simple">
<li><p><cite>“PKs order</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> Provide a specific order to the
sub-PKs; most methods loop over all sub-PKs, and will call the sub-PK
method in this order.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#pk">PK</a>.</p></li>
</ul>
</div>
</div>
<div class="section" id="weakmpc">
<h3><a class="toc-backref" href="#id62">WeakMPC</a><a class="headerlink" href="#weakmpc" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Multi process coupler for sequential coupling.</p>
</div></blockquote>
<p>Noniterative sequential coupling simply calls each PK’s AdvanceStep() method in
order.</p>
<div class="admonition-weak-mpc-spec admonition" id="weak-mpc-spec">
<p class="admonition-title">weak-mpc-spec</p>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[mpc-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#mpc">MPC</a>.</p></li>
</ul>
</div>
</div>
<div class="section" id="strongmpc">
<h3><a class="toc-backref" href="#id63">StrongMPC</a><a class="headerlink" href="#strongmpc" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Multi process coupler for globally implicit (strong) coupling.</p>
</div></blockquote>
<p>Globally implicit coupling solves all sub-PKs as a single system of equations.  This can be completely automated when all PKs are also <a class="reference internal" href="#pk-bdf">PK: BDF</a> PKs, using a block-diagonal preconditioner where each diagonal block is provided by its own sub-PK.</p>
<div class="admonition-strong-mpc-spec admonition" id="strong-mpc-spec">
<p class="admonition-title">strong-mpc-spec</p>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[mpc-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#mpc">MPC</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-bdf-default-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#pk-bdf">PK: BDF</a>.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="physical-mpcs">
<h2><a class="toc-backref" href="#id64">Physical MPCs</a><a class="headerlink" href="#physical-mpcs" title="Permalink to this headline">¶</a></h2>
<p>Coupling is an art, and often requires special off-diagonal work for
globally implicit coupling, and fancy games can be played with domains
to couple across domain interfaces both implicitly and sequentially.
Physical MPCs derive from default MPCs to provide special
implementations of some methods.</p>
<div class="section" id="coupled-water-mpc">
<h3><a class="toc-backref" href="#id65">Coupled Water MPC</a><a class="headerlink" href="#coupled-water-mpc" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A coupler which integrates surface and subsurface flow implicitly.</p>
</div></blockquote>
<p>Couples Richards equation to surface water through continuity of both pressure
and fluxes.  This leverages subsurface discretizations that include face-based
unknowns, and notes that those face unknowns that correspond to surface faces
are co-located with the surface cell pressure, and therefore are equivalent.
In this approach (described in detail in a paper that is in review), the
surface equations are directly assembled into the subsurface discrete operator.</p>
<div class="admonition-mpc-coupled-water-spec admonition" id="mpc-coupled-water-spec">
<p class="admonition-title">mpc-coupled-water-spec</p>
<ul class="simple">
<li><p><cite>“PKs order</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> The use supplies the names of the
coupled PKs.  The order must be {subsurface_flow_pk, surface_flow_pk}
(subsurface first).</p></li>
<li><p><cite>“subsurface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>domain</strong></p></li>
<li><p><cite>“surface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>surface</strong></p></li>
<li><p><cite>“water delegate</cite>” <code class="docutils literal notranslate"><span class="pre">[coupled-water-delegate-spec]</span></code> A <a class="reference internal" href="#coupled-water-globalization-delegate">Coupled Water
Globalization Delegate</a> spec.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[strong-mpc-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#strongmpc">StrongMPC</a></p></li>
</ul>
</div>
</div>
<div class="section" id="coupled-cells-mpc">
<h3><a class="toc-backref" href="#id66">Coupled Cells MPC</a><a class="headerlink" href="#coupled-cells-mpc" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A coupler which solves two PDEs on the same domain.</p>
</div></blockquote>
<p>This is a StrongMPC which uses a preconditioner in which the
block-diagonal cell-local matrix is dense.  If the system looks something
like:</p>
<p>A( y1, y2, x, t ) = 0
B( y1, y2, x, t ) = 0</p>
<p>where y1,y2 are spatially varying unknowns that are discretized using the MFD
method (and therefore have both cell and face unknowns), an approximation to
the Jacobian is written as</p>
<p>[  dA_c/dy1_c  dA_c/dy1_f   dA_c/dy2_c       0      ]
[  dA_f/dy1_c  dA_f/dy1_f      0              0      ]
[  dB_c/dy1_c     0          dB_c/dy2_c  dB_c/dy2_f ]
[      0           0          dB_f/dy2_c  dB_f/dy2_f ]</p>
<p>Note that the upper left block is the standard preconditioner for the A
system, and the lower right block is the standard precon for the B system,
and we have simply added cell-based couplings, dA_c/dy2_c and dB_c/dy1_c.</p>
<p>Most commonly this is used to couple flow and energy equations on the same
mesh.  In the temperature/pressure system, these extra blocks correspond to</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \Theta}{\partial T} \; , \; \frac{\partial E}{\partial p}\]</div>
<div class="admonition-mpc-coupled-cells-spec admonition" id="mpc-coupled-cells-spec">
<p class="admonition-title">mpc-coupled-cells-spec</p>
<ul class="simple">
<li><p><cite>“domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Domain of simulation</p></li>
<li><p><cite>“conserved quantity A</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Key of the first sub-PK’s conserved quantity.</p></li>
<li><p><cite>“conserved quantity B</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Key of the second sub-PK’s conserved quantity.</p></li>
<li><p><cite>“primary variable A</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Key of the first sub-PK’s primary variable.</p></li>
<li><p><cite>“primary variable B</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Key of the second sub-PK’s primary variable.</p></li>
<li><p><cite>“no dA/dy2 block</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Excludes the dA_c/dy2_c block above.</p></li>
<li><p><cite>“no dB/dy1 block</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Excludes the dB_c/dy1_c block above.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[strong-mpc-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#strongmpc">StrongMPC</a>.</p></li>
</ul>
</div>
</div>
<div class="section" id="subsurface-mpc">
<h3><a class="toc-backref" href="#id67">Subsurface MPC</a><a class="headerlink" href="#subsurface-mpc" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A coupler which solves flow and energy in the subsurface.</p>
</div></blockquote>
<p>This MPC provides most nearly all terms for an approximate Jacobian for
coupling three-phase Richards equation (the <a class="reference internal" href="#permafrost-flow-pk">Permafrost Flow PK</a>) to the
three-phase Energy equation (the <a class="reference internal" href="#three-phase-subsurface-energy-pk">Three-Phase subsurface Energy PK</a>).</p>
<p>Many options are provided for turning on and off various aspects of this
Jacobian, so it is useful to mathematically write out these terms.  The
equations are:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{\partial \Theta}{\partial t} - \nabla \frac{k_r n_l}{\mu} K ( \nabla p + \rho g \cdot \hat{z} ) = Q_w \\
\frac{\partial E}{\partial t} - \nabla \cdot \kappa \nabla T + \nabla \cdot \mathbf{q} e(T) = Q_w e(T) + Q_e\end{split}\]</div>
<p>Note that all of the following are dependent on <span class="math notranslate nohighlight">\(p\)</span> and/or <span class="math notranslate nohighlight">\(T\)</span>:</p>
<div class="math notranslate nohighlight">
\[\Theta(p,T), k_r(p,T), n_l(p,T), \mu(T), \rho(p,T), E(p,T), \kappa(p,T), e(T)\]</div>
<p>Also, both source terms <span class="math notranslate nohighlight">\(Q_w\)</span> and <span class="math notranslate nohighlight">\(Q_e\)</span> may or may not depend on <span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(T\)</span>.</p>
<p>Note also that the Darcy flux <span class="math notranslate nohighlight">\(\mathbf{q}\)</span> used in the advection of energy is given by the Darcy flux:</p>
<div class="math notranslate nohighlight">
\[\mathbf{q} = -\frac{k_r n_l}{\mu} K ( \nabla p + \rho g \cdot \rho g \cdot \hat{z} )\]</div>
<p>Differentiating these two equations in their two unknowns gives the following four blocks in the approximate Jacobian:</p>
<p><span class="math notranslate nohighlight">\(\frac{\partial F_1}{\partial p}\)</span>: this is the Richards equation diagonal block, and is controlled inside that PK.</p>
<p><span class="math notranslate nohighlight">\(\frac{\partial F_1}{\partial T}\)</span> includes terms for:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\frac{\partial \Theta}{\partial T}\)</span> This term is the cell-local diagonal block.</p></li>
<li><p>The partial derivative of the divergence of the Darcy flux with respect to
temperature is dominated by <span class="math notranslate nohighlight">\(\frac{\partial}{\partial T} \frac{k_r
n_l}{\mu}\)</span>.  This is because the relative permeability is strongly
dependent upon phase change (the freezing equals drying approximation).  This
term is referred to as the “d div q / dT” term.</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\frac{\partial F_2}{\partial p}\)</span> includes terms for:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\frac{\partial E}{\partial p}\)</span> This term is the cell-local diagonal block.</p></li>
<li><p>The partial derivative of the energy diffusion term with respect to pressure
is dominated by <span class="math notranslate nohighlight">\(\frac{\partial \kappa}{\partial p}\)</span> through phase
change – at a constant temperature, but changing pressure, phase change can
result in large changes to thermal conductivity.  This is referred to as the
“div K grad T / dp” term.</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\frac{\partial F_2}{\partial T}\)</span>: this is the energy equation diagonal block, and is controlled inside that PK.</p>
<p>Also, at this level, where we know more about the flux used in the energy
equation (it is the Darcy flux), we can do a better approximation of the
derivative of the advection of energy term with respect to both temperature and
pressure.  For instance, enthalpy is only weakly dependent on pressure, so we
can use the derivative of the divergence of the Darcy flux with respect to
pressure (from the Richards block) in the advection term in the
<span class="math notranslate nohighlight">\(\frac{\partial F_2}{\partial p}\)</span> block, and approximate
<span class="math notranslate nohighlight">\(\frac{\partial k_r}{\partial T}\)</span> in the advection term as well.  These
terms are referred to as “div hq / dp,T terms”.  Note the missing initial “d”
here relative to other terms.</p>
<p>The behavior of this MPC’s preconditioner can be set by an option,
<cite>“preconditioner type</cite>”.  Really users should not change this from the default,
except in expert cases or for comparison’s sake, but the options are:</p>
<ul class="simple">
<li><p><cite>“picard</cite>” is the default, this uses all available terms, and enables the
“suppress” options for finer-grained control.</p></li>
<li><p><cite>“none</cite>” No preconditioner never works.</p></li>
<li><p><cite>“block diagonal</cite>” This is what one would get from the default <a class="reference internal" href="#strongmpc">StrongMPC</a>.  This probably never works.</p></li>
<li><p><cite>“no flow coupling</cite>” This keeps the accumulation terms, but turns off all the
non-local blocks.  This is equivalent to <a class="reference internal" href="#coupled-cells-mpc">Coupled Cells MPC</a>.</p></li>
<li><p><cite>“ewc</cite>” <strong>CURRENTLY DEPRECATED/BROKEN/DISABLED</strong> In addition to the
<cite>“picard</cite>” coupling, this also <em>always</em> does a change of variables, whereby
we first invert to calculate primary variable corrections, then do a change
of variables to calculate the linearized corrections in energy and water
content space.  We then apply those corrections, and invert to find the
primary variable changes that would have made those corrections.  This is
called the “energy and water content” algorithm, and is related to similar
variable changing approaches by Krabbenhoft (for flow) and Knoll (for
energy), but in the multivariate approach.  This is somewhat bad, becuase
while it fixes some corrections, it breaks others.</p></li>
<li><p><cite>“smart ewc</cite>” <strong>CURRENTLY DEPRECATED/BROKEN/DISABLED</strong> Does the <cite>“ewc</cite>”
algorithm above, but tries to be smart about when to do it.  This algorithm
helps when we are about to fall off of the latent heat cliff.  If we can
guess when to do it, we have a better chance of not breaking things.  This
seems like it ought to be helpful, but often doesn’t do as much as one might
hope.</p></li>
</ul>
<p>Note this “ewc” algorithm is just as valid, and more useful, in the predictor
(where it is not deprecated/disabled).  There, we extrapolate a change in
pressure and temperature, but often do better to extrapolate in water content
and energy space, then invert (locally) for pressure and temperature
corrections that meet that extrapolation.  Both of these globalization
algorithms are supported by the <a class="reference internal" href="#ewc-globalization-delegate">EWC Globalization Delegate</a> object.</p>
<div class="admonition-mpc-subsurface-spec admonition" id="mpc-subsurface-spec">
<p class="admonition-title">mpc-subsurface-spec</p>
<ul class="simple">
<li><p><cite>“domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Domain of simulation</p></li>
<li><p><cite>“preconditioner type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>picard</strong> See the above for
detailed descriptions of the choices.  One of: <cite>“none</cite>”, <cite>“block
diagonal</cite>”, <cite>“no flow coupling</cite>”, <cite>“picard</cite>”, <cite>“ewc</cite>”, and <cite>“smart ewc</cite>”.</p></li>
<li><p><cite>“supress Jacobian terms: div hq / dp,T</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If using picard or ewc, do not include this block in the preconditioner.</p></li>
<li><p><cite>“supress Jacobian terms: d div q / dT</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If using picard or ewc, do not include this block in the preconditioner.</p></li>
<li><p><cite>“supress Jacobian terms: d div K grad T / dp</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If using picard or ewc, do not include this block in the preconditioner.</p></li>
<li><p><cite>“ewc delegate</cite>” <code class="docutils literal notranslate"><span class="pre">[ewc-delegate-spec]</span></code> A <a class="reference internal" href="#ewc-globalization-delegate">EWC Globalization Delegate</a> spec.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[strong-mpc-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#strongmpc">StrongMPC</a>.</p></li>
</ul>
</div>
</div>
<div class="section" id="permafrost-mpc">
<h3><a class="toc-backref" href="#id68">Permafrost MPC</a><a class="headerlink" href="#permafrost-mpc" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A coupler which solves flow and energy both surface and subsurface.</p>
</div></blockquote>
<p>This MPC handles the coupling of surface energy and flow to subsurface energy
and flow for integrated hydrology with freeze/thaw processes.</p>
<div class="admonition-mpc-permafrost-spec admonition" id="mpc-permafrost-spec">
<p class="admonition-title">mpc-permafrost-spec</p>
<ul class="simple">
<li><p><cite>“PKs order</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> The user supplies the names of the
coupled PKs.  The order must be {subsurface_flow_pk, subsurface_energy_pk,
surface_flow_pk, surface_energy_pk}.</p></li>
<li><p><cite>“subsurface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>domain</strong></p></li>
<li><p><cite>“surface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>surface</strong></p></li>
<li><p><cite>“mass exchange flux key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>SURFACE_DOMAIN-surface_subsurface_flux</strong></p></li>
<li><p><cite>“energy exchange flux key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>SURFACE_DOMAIN-surface_subsurface_energy_flux</strong></p></li>
<li><p><cite>“water delegate</cite>” <code class="docutils literal notranslate"><span class="pre">[coupled-water-delegate-spec]</span></code> A <a class="reference internal" href="#coupled-water-globalization-delegate">Coupled Water
Globalization Delegate</a> spec.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[mpc-subsurface-spec]</span></code> <em>Is a</em> <a class="reference internal" href="#subsurface-mpc">Subsurface MPC</a></p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="globalization-delegates">
<h2><a class="toc-backref" href="#id69">Globalization Delegates</a><a class="headerlink" href="#globalization-delegates" title="Permalink to this headline">¶</a></h2>
<p>Globalization is the art of convincing a solver to find the solution.
Remember – physics typically cares very little about <em>how</em> you get to
a solution, only that you get there.  If you can guess or otherwise
find the solution physically, without doing fancy math, go for it!
These delegates are handy utility classes which are used by MPCs to
effeciently leverage physics understanding in the mathematical solvers
to nudge the solver in the direction of a reasonable solution, or to
keep a solver from going off into a part of space which is totally
unphysical.  These can often make the difference between converging
and not converging.</p>
<p>Much of the efficiency of ATS comes from these delegates, and more of
them are always welcome contributions.</p>
<div class="section" id="coupled-water-globalization-delegate">
<h3><a class="toc-backref" href="#id70">Coupled Water Globalization Delegate</a><a class="headerlink" href="#coupled-water-globalization-delegate" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Globalization for nonlinearity around the appearance/disappearance of surface water.</p>
</div></blockquote>
<p>The water delegate works to deal with discontinuities/strong nonlinearities
when surface cells shift from dry to wet (i.e. the surface pressure goes from &lt;
atmospheric pressure to &gt; atmospheric pressure.</p>
<p>These methods work to alter the predictor around this nonlinearity.</p>
<div class="admonition-mpc-delegate-water-spec admonition" id="mpc-delegate-water-spec">
<p class="admonition-title">mpc-delegate-water-spec</p>
<ul class="simple">
<li><p><cite>“modify predictor with heuristic</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> This simply
limits the prediction to backtrack to just above atmospheric on both the
first and second timesteps that take us over atmospheric.</p></li>
<li><p><cite>“modify predictor damp and cap the water spurt</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> The
second both limits (caps) and damps all surface cells to ensure that all
nearby cells are also not overshooting.  This is the preferred method.</p></li>
</ul>
<p>These methods work to alter the preconditioned correction for the same
reasons described above.</p>
<ul class="simple">
<li><p><cite>“global water face limiter</cite>” <code class="docutils literal notranslate"><span class="pre">[default]</span></code> <strong>INF</strong> This is simply a limit
to the maximum allowed size of the correction (in [Pa]) on all faces.  Any
correction larger than this is set to this.</p></li>
<li><p><cite>“cap the water spurt</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If a correction takes the
pressure on a surface cell from below atmospheric (dry) to above (wet),
the correction is set to a value which results in the new iterate to being
CAP_SIZE over atmospheric.</p></li>
<li><p><cite>“damp the water spurt</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> A damping factor (less than
one) is calculated to multiply the correction such that the largest
correction takes a cell to just above atmospheric.  All faces (globally)
are affected.</p></li>
<li><p><cite>“damp and cap the water spurt</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> None of the above
should really be used.  Capping, when the cap is particularly severe,
results in faces whose values are very out of equilibrium with their
neighboring cells which are not capped.  Damping results in a tiny
timestep in which, globally, at MOST one face can go from wet to dry.
This looks to do a combination, in which all things are damped, but faces
that are initially expected to go from dry to wet are pre-scaled to
ensure that, when damped, they are also (like the biggest change) allowed
to go from dry to wet (so that multiple cells can wet in the same step).
This is the preferred method.</p></li>
</ul>
<p>In these methods, the following parameters are useful:</p>
<ul class="simple">
<li><p><cite>“cap over atmospheric</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>100</strong> This sets the max size over
atmospheric to which things are capped or damped. <cite>[Pa]</cite></p></li>
</ul>
</div>
</div>
<div class="section" id="ewc-globalization-delegate">
<h3><a class="toc-backref" href="#id71">EWC Globalization Delegate</a><a class="headerlink" href="#ewc-globalization-delegate" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Globalization for nonlinearity associated with phase change and latent heat.</p>
</div></blockquote>
<p>The EWC delegate works to deal with strong nonlinearities associated with
latent heat and phase change.  Provided a change in primary variables pressure
and temperature, it works by first multiplying those changes by the local
Jacobian matrix, <span class="math notranslate nohighlight">\(\frac{\partial \left\{ \Theta, E \right\} }{ \partial
\left\{ p, T \right\} }\)</span> to calculate changes in water content and energy, then
calculating the new water content and energy and inverting the functions
<span class="math notranslate nohighlight">\(\Theta(p,T), E(p,T)\)</span> to determine what pressure and temperature would
have resulted in those values.  This provides a corrected change in the primary
variables.</p>
<p>Conceptually, this is a “more robust” choice in nonlinearities associated with
phase change, where the derivatives go from small to large to small again, and
small changes in pressure and temperature result in large changes in water
content and energy.</p>
<p>This delegate manages these globalization strategies, which can be used both in
modifying the correction supplied by a nonlinear iterate, and in modifying a
predictor, the extrapolated projection (from previous timesteps) that
provides the initial guess to the nonlinear solve.</p>
<div class="admonition-mpc-delegate-ewc-spec admonition" id="mpc-delegate-ewc-spec">
<p class="admonition-title">mpc-delegate-ewc-spec</p>
<ul class="simple">
<li><p><cite>“verbose object</cite>” <code class="docutils literal notranslate"><span class="pre">[verbose-object-spec]</span></code> See <a class="reference internal" href="#verbose-object">Verbose Object</a>.</p></li>
<li><p><cite>“PK name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Name of the owning PK – simply for logging and
debugging.</p></li>
<li><p><cite>“domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“domain”</strong> The mesh.</p></li>
<li><p><cite>“preconditioner type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> When to use EWC on the nonlinear
iterate’s correction.  One of:</p>
<ul>
<li><p><cite>“none</cite>” Never do EWC</p></li>
<li><p><cite>“ewc</cite>” Always do EWC</p></li>
<li><p><cite>“smart ewc</cite>” Attempt EWC when it seems likely it will be useful and
take the EWC correction if it is smaller than the standard correction.</p></li>
</ul>
</li>
<li><p><cite>“predictor type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> When to use EWC on the predictor.  One
of:</p>
<ul>
<li><p><cite>“none</cite>” Never do EWC</p></li>
<li><p><cite>“ewc</cite>” Always do EWC</p></li>
<li><p><cite>“smart ewc</cite>” Attempt EWC when it seems likely it will be useful and
take the EWC correction if it is smaller than the standard correction.</p></li>
</ul>
</li>
<li><p><cite>“freeze-thaw cusp width [K]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Controls a width over which
to assume we are close to the latent heat cliff, and begins applying the
EWC algorithm in <cite>“ewc smarter</cite>”.</p></li>
<li><p><cite>“freeze-thaw cusp width (freezing) [K]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Controls a width
over which to assume we are close to the latent heat cliff as we get
colder, and begins applying the EWC algorithm in <cite>“ewc smarter</cite>”.</p></li>
<li><p><cite>“freeze-thaw cusp width (thawing) [K]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Controls a width
over which to assume we are close to the latent heat cliff as we get
warmer, and begins applying the EWC algorithm in <cite>“ewc smarter</cite>”.</p></li>
<li><p><cite>“pressure key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-pressure</strong></p></li>
<li><p><cite>“temperature key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-temperature</strong></p></li>
<li><p><cite>“water content key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-water_content</strong></p></li>
<li><p><cite>“energy key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-energy</strong></p></li>
<li><p><cite>“cell volume key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-cell_volume</strong></p></li>
</ul>
<p>INCLUDES</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[debugger-spec]</span></code> Uses a <a class="reference internal" href="#debugger">Debugger</a></p></li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="state">
<h1><a class="toc-backref" href="#id72">State</a><a class="headerlink" href="#state" title="Permalink to this headline">¶</a></h1>
<p>State consists of two sublists, one for evaluators and the other for
atomic constants.  The latter is currently called <cite>“initial
conditions</cite>”, which is a terrible name which must be fixed.</p>
<p>example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;state&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;field evaluators&quot;</span><span class="nt">&gt;</span>
    ...
  <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;initial conditions&quot;</span><span class="nt">&gt;</span>
    ...
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<div class="section" id="field-evaluators">
<h2><a class="toc-backref" href="#id73">Field Evaluators</a><a class="headerlink" href="#field-evaluators" title="Permalink to this headline">¶</a></h2>
<div class="section" id="primaryvariableevaluator">
<h3><a class="toc-backref" href="#id74">PrimaryVariableEvaluator</a><a class="headerlink" href="#primaryvariableevaluator" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="independentvariableevaluator">
<h3><a class="toc-backref" href="#id75">IndependentVariableEvaluator</a><a class="headerlink" href="#independentvariableevaluator" title="Permalink to this headline">¶</a></h3>
<p>Independent variables are provided either by a function or directly loaded from a file.</p>
<div class="section" id="from-function">
<h4><a class="toc-backref" href="#id76">From Function</a><a class="headerlink" href="#from-function" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="from-file">
<h4><a class="toc-backref" href="#id77">From File</a><a class="headerlink" href="#from-file" title="Permalink to this headline">¶</a></h4>
</div>
</div>
<div class="section" id="water-content">
<h3><a class="toc-backref" href="#id78">Water Content</a><a class="headerlink" href="#water-content" title="Permalink to this headline">¶</a></h3>
<p>Water content is the conserved quantity in most flow equations, including
Richard’s equation with and without ice.  A variety of evaluators are provided
for inclusion of multiple phases.</p>
<div class="section" id="richards-equation-water-content">
<h4><a class="toc-backref" href="#id79">Richards Equation water content</a><a class="headerlink" href="#richards-equation-water-content" title="Permalink to this headline">¶</a></h4>
<p>The Richards water content evaluator is an algebraic evaluator for liquid only water content</p>
<div class="math notranslate nohighlight">
\[Theta = n * s * phi * cell volume\]</div>
<p><code class="docutils literal notranslate"><span class="pre">[field-evaluator-type-richards-water-content-spec]</span></code></p>
<ul class="simple">
<li><p><cite>“porosity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-porosity</strong></p></li>
<li><p><cite>“molar density liquid key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-molar_density_liquid</strong></p></li>
<li><p><cite>“saturation liquid key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-saturation_liquid</strong></p></li>
<li><p><cite>“cell volume key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-cell_volume</strong></p></li>
</ul>
<p>EVALUATORS:
- <cite>“porosity</cite>”
- <cite>“molar density liquid</cite>”
- <cite>“saturation liquid</cite>”
- <cite>“cell volume</cite>”</p>
</div>
<div class="section" id="liquid-gas-water-content">
<h4><a class="toc-backref" href="#id80">Liquid+Gas water content</a><a class="headerlink" href="#liquid-gas-water-content" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="liquid-ice-water-content">
<h4><a class="toc-backref" href="#id81">Liquid+Ice water content</a><a class="headerlink" href="#liquid-ice-water-content" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="liquid-ice-gas-water-content">
<h4><a class="toc-backref" href="#id82">Liquid+Ice+Gas water content</a><a class="headerlink" href="#liquid-ice-gas-water-content" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Three phase water content: vapor, liquid, and ice.</p>
</div></blockquote>
<div class="math notranslate nohighlight">
\[Theta = (n_l * s_l + n_i * s_i + n_g * s_g * \omega_g ) * \phi * |E|\]</div>
<ul class="simple">
<li><p><cite>“porosity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-porosity</strong></p></li>
<li><p><cite>“molar density liquid key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-molar_density_liquid</strong></p></li>
<li><p><cite>“saturation liquid key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-saturation_liquid</strong></p></li>
<li><p><cite>“molar density ice key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-molar_density_ice</strong></p></li>
<li><p><cite>“saturation ice key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-saturation_ice</strong></p></li>
<li><p><cite>“molar density gas key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-molar_density_gas</strong></p></li>
<li><p><cite>“saturation gas key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-saturation_gas</strong></p></li>
<li><p><cite>“mol frac gas key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-mol_frac_gas</strong> The molar fraction of water vapor in the gaseous phase.</p></li>
<li><p><cite>“cell volume key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-cell_volume</strong></p></li>
</ul>
<p>EVALUATORS:
- <cite>“porosity</cite>”
- <cite>“molar density liquid</cite>”
- <cite>“saturation liquid</cite>”
- <cite>“molar density ice</cite>”
- <cite>“saturation ice</cite>”
- <cite>“molar density gas</cite>”
- <cite>“saturation gas</cite>”
- <cite>“molar fraction gas</cite>”
- <cite>“cell volume</cite>”</p>
</div>
</div>
<div class="section" id="surface-water-potential-surfaces">
<h3><a class="toc-backref" href="#id83">Surface Water potential surfaces</a><a class="headerlink" href="#surface-water-potential-surfaces" title="Permalink to this headline">¶</a></h3>
<p>Evaluators for</p>
<div class="section" id="surfaceelevation">
<h4><a class="toc-backref" href="#id84">SurfaceElevation</a><a class="headerlink" href="#surfaceelevation" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>MeshedElevationEvaluator: evaluates the elevation (z-coordinate) and slope magnitude of a mesh.</p>
</div></blockquote>
<p>Evaluator type: <cite>“meshed elevation</cite>”</p>
<p>Evaluates the z-coordinate and the magnitude of the slope :math:<code class="docutils literal notranslate"><span class="pre">|\nambla_h</span> <span class="pre">z|</span></code></p>
<ul class="simple">
<li><p><cite>“elevation key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>elevation</strong> Name the elevation variable. [m]</p></li>
<li><p><cite>“slope magnitude key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>slope_magnitude</strong> Name the elevation variable. [-]</p></li>
<li><p><cite>“dynamic mesh</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Lets the evaluator know that the elevation changes in time, and adds the <cite>“deformation</cite>” dependency.</p></li>
<li><p><cite>“parent domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN</strong> Domain name of the parent mesh, which is the 3D version of this domain.  Attempts to generate an intelligent default by stripping “surface” from this domain.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;elevation&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;evaluator type&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;meshed elevation&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="surfacepotential">
<h4><a class="toc-backref" href="#id85">SurfacePotential</a><a class="headerlink" href="#surfacepotential" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>PresElevEvaluator: evaluates h + z</p>
</div></blockquote>
<p>Evaluator type: “”</p>
<div class="math notranslate nohighlight">
\[h + z\]</div>
<ul class="simple">
<li><p><cite>“my key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>pres_elev</strong> Names the surface water potential variable, h + z [m]</p></li>
<li><p><cite>“height key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>ponded_depth</strong> Names the height variable. [m]</p></li>
<li><p><cite>“elevation key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>elevation</strong> Names the elevation variable. [m]</p></li>
</ul>
<p>NOTE: This is a legacy evaluator, and is not in the factory, so need not be in
the input spec.  However, we include it here because this could easily be
abstracted for new potential surfaces, kinematic wave, etc, at which point it
would need to be added to the factory and the input spec.</p>
<p>NOTE: This could easily be replaced by a generic <a href="#id170"><span class="problematic" id="id171">AdditiveEvaluator_</span></a></p>
</div>
<div class="section" id="snowsurfacepotential">
<h4><a class="toc-backref" href="#id86">SnowSurfacePotential</a><a class="headerlink" href="#snowsurfacepotential" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>PresElevEvaluator: evaluates h + z</p>
</div></blockquote>
<p>Evaluator type: “snow skin potential”</p>
<div class="math notranslate nohighlight">
\[h + z + h_{{snow}} + dt * P_{{snow}}\]</div>
<ul class="simple">
<li><p><cite>“my key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>snow_skin_potential</strong> Names the potential variable evaluated [m]</p></li>
<li><p><cite>“ponded depth key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>ponded_depth</strong> Names the surface water depth variable. [m]</p></li>
<li><p><cite>“snow depth key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>snow_depth</strong> Names the snow depth variable. [m]</p></li>
<li><p><cite>“precipitation snow key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>precipitation_snow</strong> Names the snow precipitation key. [m]</p></li>
<li><p><cite>“elevation key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>elevation</strong> Names the elevation variable. [m]</p></li>
<li><p><cite>“dt factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> A free-parameter factor for providing a time scale for diffusion of snow precipitation into low-lying areas.  Typically on the order of 1e4-1e7. This timestep times the wave speed of snow provides an approximate length of how far snow precip can travel.  Extremely tunable! [s]</p></li>
</ul>
<p>NOTE: This is equivalent to a generic <a href="#id172"><span class="problematic" id="id173">AdditiveEvaluator_</span></a></p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;snow_skin_potential&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;field evaluator type&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;snow skin potential&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;dt factor&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;864000.0&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="surface-water-content">
<h4><a class="toc-backref" href="#id87">Surface water content</a><a class="headerlink" href="#surface-water-content" title="Permalink to this headline">¶</a></h4>
</div>
</div>
<div class="section" id="generic-evaluators">
<h3><a class="toc-backref" href="#id88">Generic Evaluators</a><a class="headerlink" href="#generic-evaluators" title="Permalink to this headline">¶</a></h3>
<p>Several generic evaluators are provided.</p>
<div class="section" id="additive">
<h4><a class="toc-backref" href="#id89">Additive</a><a class="headerlink" href="#additive" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="multiplicative">
<h4><a class="toc-backref" href="#id90">Multiplicative</a><a class="headerlink" href="#multiplicative" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="column-summation">
<h4><a class="toc-backref" href="#id91">Column summation</a><a class="headerlink" href="#column-summation" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="subgrid-disaggregation">
<h4><a class="toc-backref" href="#id92">Subgrid disaggregation</a><a class="headerlink" href="#subgrid-disaggregation" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>SubgridDisaggregateEvaluator restricts a field to the subgrid version of the same field.</p>
<ul class="simple">
<li><p><cite>“source domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Domain name of the source mesh.</p></li>
</ul>
</div></blockquote>
<p>ONE OF:
* <cite>“field key suffix</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>FIELD_SUFFIX from this</strong> Set the suffix of the variable
OR
* <cite>“field key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-FIELD_SUFFIX</strong></p>
</div>
</div>
</div>
<div class="section" id="initialconditions">
<h2><a class="toc-backref" href="#id93">InitialConditions</a><a class="headerlink" href="#initialconditions" title="Permalink to this headline">¶</a></h2>
<p>Initial condition specs are used in two places:</p>
<ul class="simple">
<li><p>within the <a class="reference internal" href="#pk">PK</a> spec which describes the initial condition of primary variables (true
initial conditions), and</p></li>
<li><p>in the <cite>“initial conditions</cite>” sublist of state, in which the value
of atomic constants are provided (not really initial conditions and
should be renamed).  These atomic values are not controlled by
evaluators, and are not included in the DaG.  Likely these should be
removed entirely.</p></li>
</ul>
<div class="section" id="initialization-of-constant-scalars">
<h3><a class="toc-backref" href="#id94">Initialization of constant scalars</a><a class="headerlink" href="#initialization-of-constant-scalars" title="Permalink to this headline">¶</a></h3>
<p>A constant scalar field is the global (with respect to the mesh)
constant.  At the moment, the set of such fields includes atmospheric
pressure.  The initialization requires to provide a named sublist with
a single parameter <cite>“value</cite>”.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;fluid_density&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;998.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="initialization-of-constant-vectors">
<h3><a class="toc-backref" href="#id95">Initialization of constant vectors</a><a class="headerlink" href="#initialization-of-constant-vectors" title="Permalink to this headline">¶</a></h3>
<p>A constant vector field is the global (with respect to the mesh)
vector constant.  At the moment, the set of such vector constants
includes gravity.  The initialization requires to provide a named
sublist with a single parameter <cite>“Array(double)</cite>”. In two dimensions,
is looks like</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;gravity&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{0.0, -9.81}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="initialization-of-scalar-fields">
<h3><a class="toc-backref" href="#id96">Initialization of scalar fields</a><a class="headerlink" href="#initialization-of-scalar-fields" title="Permalink to this headline">¶</a></h3>
<p>A variable scalar field is defined by a few functions (labeled for instance,
<cite>“Mesh Block i</cite>” with non-overlapping ranges.
The required parameters for each function are <cite>“region</cite>”, <cite>“component</cite>”,
and the function itself.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;porosity&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;Mesh Block 1&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;region&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;Computational domain&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;component&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;cell&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;0.2&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/ParameterList&gt;</span>
      <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;Mesh Block 2&quot;</span><span class="nt">&gt;</span>
      ...
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="initialization-of-tensor-fields">
<h3><a class="toc-backref" href="#id97">Initialization of tensor fields</a><a class="headerlink" href="#initialization-of-tensor-fields" title="Permalink to this headline">¶</a></h3>
<p>A variable tensor (or vector) field is defined similarly to a variable
scalar field.  The difference lies in the definition of the function
which is now a multi-values function.  The required parameters are
<cite>“Number of DoFs</cite>” and <cite>“Function type</cite>”.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;Number of DoFs&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;Function type&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;composite function&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;DoF 1 Function&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;1.9976e-12&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;DoF 2 Function&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;1.9976e-13&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="initialization-from-a-file">
<h3><a class="toc-backref" href="#id98">Initialization from a file</a><a class="headerlink" href="#initialization-from-a-file" title="Permalink to this headline">¶</a></h3>
<p>Some data can be initialized from files. Additional sublist has to be
added to named sublist of the <cite>“state</cite>” list with the file name and
the name of attribute.  For a serial run, the file extension must be
<cite>“.exo</cite>”.  For a parallel run, it must be <cite>“.par</cite>”.  Here is an
example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;permeability&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;exodus file initialization&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;file&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;mesh_with_data.exo&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;attribute&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;perm&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;state&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;initial conditions&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;fluid_density&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;998.0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>

    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;fluid_viscosity&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;0.001&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>

    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;gravity&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{0.0, -9.81}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>

  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="boundaryconditions">
<h2><a class="toc-backref" href="#id99">BoundaryConditions</a><a class="headerlink" href="#boundaryconditions" title="Permalink to this headline">¶</a></h2>
<p>In general, boundary conditions are provided in a heirarchical list by
boundary condition type, then functional form.  Boundary condition specs are
split between two types – those which require a user-provided function
(i.e. Dirichlet data, etc) and those which do not (i.e. zero gradient
conditions).</p>
<p>A list of conditions might pull in both Dirichlet and Neumann data on
different regions, or use different functions on different regions.  The
following example illustrates how boundary conditions are prescribed across
the domain for a typical PK:</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;DIRICHLET_TYPE&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;DIRICHLET_FUNCTION_NAME&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;101325.0&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/ParameterList&gt;</span>
      <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BC east&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{east}&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;DIRICHLET_FUNCTION_NAME&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;102325.&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/ParameterList&gt;</span>
      <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;mass flux&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BC north&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{north}&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;outward mass flux&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;0.&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/ParameterList&gt;</span>
      <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;zero gradient&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BC south&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{south}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Different PKs populate this general format with different names, replacing
DIRICHLET_TYPE and DIRICHLET_FUNCTION_NAME.</p>
<div class="section" id="flow-specific-boundary-conditions">
<h3><a class="toc-backref" href="#id100">Flow-specific Boundary Conditions</a><a class="headerlink" href="#flow-specific-boundary-conditions" title="Permalink to this headline">¶</a></h3>
<p>Flow boundary conditions must follow the general format shown in
<a class="reference internal" href="#boundaryconditions">BoundaryConditions</a>.  Specific conditions implemented include:</p>
<div class="section" id="dirichlet-pressure-boundary-conditions">
<h4><a class="toc-backref" href="#id101">Dirichlet (pressure) boundary conditions</a><a class="headerlink" href="#dirichlet-pressure-boundary-conditions" title="Permalink to this headline">¶</a></h4>
<p>Used for both surface and subsurface flows, this provides pressure data on
boundaries (in [Pa]).</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;pressure&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;boundary pressure&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;101325.0&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/ParameterList&gt;</span>
      <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="neumann-mass-flux-boundary-conditions">
<h4><a class="toc-backref" href="#id102">Neumann (mass flux) boundary conditions</a><a class="headerlink" href="#neumann-mass-flux-boundary-conditions" title="Permalink to this headline">¶</a></h4>
<p>Used for both surface and subsurface flows, this provides mass flux data (in [mol m^-2 s^-1], in the outward normal direction) on boundaries.</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;mass flux&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;outward mass flux&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;-1.e-3&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/ParameterList&gt;</span>
      <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="seepage-face-boundary-conditions">
<h4><a class="toc-backref" href="#id103">Seepage face boundary conditions</a><a class="headerlink" href="#seepage-face-boundary-conditions" title="Permalink to this headline">¶</a></h4>
<p>A variety of seepage face boundary conditions are permitted for both surface
and subsurface flow PKs.  Typically seepage conditions are of the form:</p>
<blockquote>
<div><ul class="simple">
<li><p>if <span class="math notranslate nohighlight">\(q \cdot \hat{n} &lt; 0\)</span>, then <span class="math notranslate nohighlight">\(q = 0\)</span></p></li>
<li><p>if <span class="math notranslate nohighlight">\(p &gt; p0\)</span>, then <span class="math notranslate nohighlight">\(p = p0\)</span></p></li>
</ul>
</div></blockquote>
<p>This ensures that flow is only out of the domain, but that the max pressure on
the boundary is specified by <span class="math notranslate nohighlight">\(p0\)</span>.</p>
<p>Example: pressure (for surface or subsurface)</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;seepage face pressure&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;boundary pressure&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;101325.&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/ParameterList&gt;</span>
      <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Example: head (for surface)</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;seepage face head&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;boundary head&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/ParameterList&gt;</span>
      <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Additionally, an infiltration flux may be prescribed, which describes the max
flux.  This is for surface faces on which a typical precipitation rate might
be prescribed, to be enforced until the water table rises to the surface, at
which point the precip is turned off and water seeps into runoff.  This
capability is experimental and has not been well tested.</p>
<blockquote>
<div><ul class="simple">
<li><p>if <span class="math notranslate nohighlight">\(q \cdot \hat{n} &lt; q_0\)</span>, then <span class="math notranslate nohighlight">\(q = q_0\)</span></p></li>
<li><p>if <span class="math notranslate nohighlight">\(p &gt; p_{atm}\)</span>, then <span class="math notranslate nohighlight">\(p = p_{atm}\)</span></p></li>
</ul>
</div></blockquote>
<p>Example: seepage with infiltration</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;seepage face with infiltration&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;outward mass flux&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;-1.e-5&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/ParameterList&gt;</span>
      <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Note it would be straightforward to add both p0 and q0 in the same condition;
this has simply not had a use case yet.</p>
</div>
<div class="section" id="dirichlet-head-boundary-conditions">
<h4><a class="toc-backref" href="#id104">Dirichlet (head) boundary conditions</a><a class="headerlink" href="#dirichlet-head-boundary-conditions" title="Permalink to this headline">¶</a></h4>
<p>Used for surface flows, this provides head data (in [m]) on boundaries.</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;head&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;boundary head&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;0.01&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/ParameterList&gt;</span>
      <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="fixed-level-boundary-conditions">
<h4><a class="toc-backref" href="#id105">Fixed level boundary conditions</a><a class="headerlink" href="#fixed-level-boundary-conditions" title="Permalink to this headline">¶</a></h4>
<p>For surface flows only.  This fixes the water table at a constant elevation.
It is a head condition that adapts to the surface elevation such that</p>
<div class="math notranslate nohighlight">
\[h = max( h0 - z, 0 )\]</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;fixed level&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;fixed level&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/ParameterList&gt;</span>
      <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="zero-head-gradient-boundary-conditions">
<h4><a class="toc-backref" href="#id106">Zero head gradient boundary conditions</a><a class="headerlink" href="#zero-head-gradient-boundary-conditions" title="Permalink to this headline">¶</a></h4>
<p>Used for surface flows, this is an “outlet” boundary condition which looks to
enforce the condition that</p>
<div class="math notranslate nohighlight">
\[\div h \cdot \hat{n} = 0\]</div>
<p>for head <span class="math notranslate nohighlight">\(h\)</span> and outward normal <span class="math notranslate nohighlight">\(\hat{n}\)</span>.  Note that this is an
“outlet” boundary, in the sense that it should really not be used on a
boundary in which</p>
<div class="math notranslate nohighlight">
\[\div z \cdot \hat{n} &gt; 0.\]</div>
<p>This makes it a useful boundary condition for benchmark and 2D problems, where
the elevation gradient is clear, but not so useful for DEM-based meshes.</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;zero gradient&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="critical-depth-boundary-conditions">
<h4><a class="toc-backref" href="#id107">Critical depth boundary conditions</a><a class="headerlink" href="#critical-depth-boundary-conditions" title="Permalink to this headline">¶</a></h4>
<p>Also for surface flows, this is an “outlet” boundary condition which looks to
set an outward flux to take away runoff.  This condition is given by:</p>
<div class="math notranslate nohighlight">
\[q = \sqrt{g \hat{z}} n_{liq} h^1.5\]</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;boundary conditions&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;critical depth&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{west}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="dynamic-boundary-condutions">
<h4><a class="toc-backref" href="#id108">Dynamic boundary condutions</a><a class="headerlink" href="#dynamic-boundary-condutions" title="Permalink to this headline">¶</a></h4>
<p>The type of boundary conditions maybe changed in time depending on the switch function of TIME.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;dynamic&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{surface west}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;switch function&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-tabular&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;file&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;../data/floodplain2.h5&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;x header&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;Time&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;y header&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;Switch&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;form&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{constant}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>

  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;bcs&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;bc types&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{head, mass flux}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;bc functions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{boundary head, outward mass flux}&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;mass flux&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{surface west}&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;outward mass flux&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-tabular&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;file&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;../data/floodplain2.h5&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;x header&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;Time&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;y header&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;Flux&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;form&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{linear}&quot;</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;/ParameterList&gt;</span>
         <span class="nt">&lt;/ParameterList&gt;</span>
       <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>

    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;head&quot;</span><span class="nt">&gt;</span>
       <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;BC west&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;regions&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{surface west}&quot;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;boundary head&quot;</span><span class="nt">&gt;</span>
           <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-tabular&quot;</span><span class="nt">&gt;</span>
              <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;file&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;../data/floodplain2.h5&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;x header&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;Time&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;y header&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;Head&quot;</span> <span class="nt">/&gt;</span>
              <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;form&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{linear}&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/ParameterList&gt;</span>
         <span class="nt">&lt;/ParameterList&gt;</span>
       <span class="nt">&lt;/ParameterList&gt;</span>
     <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>

<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="time-integrators-solvers-and-other-mathematical-specs">
<h1><a class="toc-backref" href="#id109">Time integrators, solvers, and other mathematical specs</a><a class="headerlink" href="#time-integrators-solvers-and-other-mathematical-specs" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>Common specs for all solvers and time integrators, used in PKs.</p>
</div></blockquote>
<p>There are three commonly used broad classes of time integration
strategies.</p>
<p>“Update” methods are the simplest – they use no formal
mathematical definition of a differential equation, but instead
implicitly use a process by which variables at the new time are
directly calculated.  Typically there <em>is</em> an implied ODE or PDE here,
but it is not stated as such and time integration routines are not
used.  Examples of these are common in biogeochemistry and vegetation
models.</p>
<p>“Explicit” time methods are the next simplest.  These include a
variety of options from forward Euler to higher order Runge-Kutta
schemes.  These only require evaluating forward models where we have
existing of the dependencies.  If they work, these are great thanks to
their deterministic nature and lack of expensive, memory-bandwith
limited solvers.  But they only work on some types of problems.
Examples of of these include transport, where we use high order time
integration schemes to preserve fronts.</p>
<p>“Implicit” and semi-implicit methods instead require the evaluation of
a residual equation – the solution is guessed at, and the residual is
calculated, which measures how far the equation is from being
satisfied.  This measure is then inverted, finding a correction to the
guess which hopefully reduces the residual.  As the residual goes to
zero, the error, a measure of the difference between the guess and the
true solution, also goes to zero.  To do this inversion, we lean on
Newton and Newton-like methods, which attempt to somehow linearize, or
approximately linearize, the residual function near the guess in order
to calculate an update.  In this case, the time integration scheme
requires both a nonlinear solver (to drive the residual to zero) and a
linear solver or approximate solver (to calculate the correction).</p>
<div class="section" id="timeintegrator">
<h2><a class="toc-backref" href="#id110">TimeIntegrator</a><a class="headerlink" href="#timeintegrator" title="Permalink to this headline">¶</a></h2>
<p>Currently there are two classes of time integration schemes used in
ATS: explicit (including a range of single and multi-stage) methods
and BDF1, or Backward Euler.</p>
<div class="section" id="explicit-time-integration">
<h3><a class="toc-backref" href="#id111">Explicit Time Integration</a><a class="headerlink" href="#explicit-time-integration" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Explicit time integration methods in a generalized form.</p>
</div></blockquote>
<p>This class implements several explicit Runge Kutta methods:</p>
<ul class="simple">
<li><p>forward Euler     (1st order)  –&gt; “forward_euler”</p></li>
<li><p>Heun-Euler method (2nd order)  –&gt; “heun_euler”</p></li>
<li><p>Midpoint method   (2nd order)  –&gt; “midpoint”</p></li>
<li><p>Ralston method    (2nd order)  –&gt; “ralston”</p></li>
<li><p>TVD RK method     (3rd order)  –&gt; “tvd_3rd_order”</p></li>
<li><p>Kutta method      (3rd order)  –&gt; “kutta_3rd_order”</p></li>
<li><p>Runge Kutta       (4th order)  –&gt; “runge_kutta_4th_order”</p></li>
<li><p>User defined      (whatever)   –&gt; user_defined, use special constructor to create</p></li>
</ul>
<p>Note that user-defined is only for developers currently, and cannot be created from an input file.</p>
<p>The RK tableau is made up of the three private objects a, b, and c below.  they
are arranged as follows:</p>
<p>Note that c[0] should always equal zero, and that the entries in the matrix a
that are not listed in this tableau are not used</p>
<p>The implemented general Runge Kutta scheme of order s based on this tableau arrangement is</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}y_{n+1} = y_n + \sum{i=0}^{s-1} b[i]*k_i\\with\\\begin{split}  k_0 = h * f(t_n, y_n) \\
  k_1 = h * f(t_n + c[1]*h, y_n + a(1,0)*k_0) \\
  k_2 = h * f(t_n + c[2]*h, y_n + a(2,0)*k_0 + a(2,1)*k_1) \\
   . \\
   . \\
   . \\
  k_{s-1} = h * f(t_n + c[s-1]*h, y_n + a(s-1,0)*k_0 + ... + a(s-1,s-2)*k_{s-2})\end{split}\end{aligned}\end{align} \]</div>
<div class="admonition-explicit-ti-rk-spec admonition" id="explicit-ti-rk-spec">
<p class="admonition-title">explicit-ti-rk-spec</p>
<ul class="simple">
<li><p><cite>“verbose object</cite>” <code class="docutils literal notranslate"><span class="pre">[verbose-object-spec]</span></code> A <a class="reference internal" href="#verbose-object">Verbose Object</a></p></li>
<li><p><cite>“RK method</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>forward euler</strong>  One of: <cite>“forward Euler</cite>”, <cite>“heun euler</cite>”, <cite>“midpoint</cite>”, <cite>“ralston</cite>”, <cite>“tvd 3rd order</cite>”, <cite>“kutta 3rd order</cite>”, <cite>“runge kutta 4th order</cite>”</p></li>
</ul>
</div>
</div>
<div class="section" id="backward-euler">
<h3><a class="toc-backref" href="#id112">Backward Euler</a><a class="headerlink" href="#backward-euler" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Solves globally implicit systems using backward Euler</p>
</div></blockquote>
<p>Backward Euler is the simplest of the implicit methods.  It solves time
integration schemes by evaluating all time derivatives at the new time.  This
makes it unconditionally stable, though potentially not very accurate.  This
unconditional stability tends to make it the workhorse of the types of stiff,
nonlinear parabolic equations such as Richards equation and the diffusion wave
approximation.</p>
<p>In this method, we look to solve:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \mathbf{u}}{\partial t} = f(\mathbf{u},\mathbf{x},t)\]</div>
<p>via the time discretization scheme:</p>
<div class="math notranslate nohighlight">
\[\frac{\mathbf{u}^{t + \Delta t} - \mathbf{u}^{t}}{\Delta t} = f(\mathbf{u}^{t + \Delta t}, \mathbf{x}, t + \Delta t)\]</div>
<div class="admonition-bdf1-ti-spec admonition" id="bdf1-ti-spec">
<p class="admonition-title">bdf1-ti-spec</p>
<ul class="simple">
<li><p><cite>“verbose object</cite>” <code class="docutils literal notranslate"><span class="pre">[verbose-object-spec]</span></code> A <a class="reference internal" href="#verbose-object">Verbose Object</a></p></li>
<li><p><cite>“residual debugger</cite>” <code class="docutils literal notranslate"><span class="pre">[residual-debugger-spec]</span></code> A <a href="#id174"><span class="problematic" id="id175">`Residual Debugger`_</span></a> object.</p></li>
<li><p><cite>“max preconditioner lag iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> specifies frequency
of preconditioner recalculation.</p></li>
<li><p><cite>“freeze preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> enforces preconditioner to
be updated only once per non-linear solver. When set to true, the above
parameter is ignored.</p></li>
<li><p><cite>“extrapolate initial guess</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> identifies forward time
extrapolation of the initial guess.</p></li>
<li><p><cite>“nonlinear iteration initial guess extrapolation order</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1</strong>
defines extrapolation algorithm. Zero value implies no extrapolation.</p></li>
<li><p><cite>“restart tolerance relaxation factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1</strong> Changes the
nonlinear tolerance on restart. The time integrator is usually restarted
when a boundary condition changes drastically. It may be beneficial to
loosen the nonlinear tolerance on the first several time steps after the
time integrator restart. The default value is 1, while a reasonable value
may be as large as 1000.</p></li>
<li><p><cite>“restart tolerance relaxation factor damping</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1</strong>
Controls how fast the loosened nonlinear tolerance will revert back to
the one specified in <cite>“nonlinear tolerance</cite>”. If the nonlinear tolerance
is “tol”, the relaxation factor is “factor”, and the damping is “d”, and
the time step count is “n” then the actual nonlinear tolerance is “tol *
max(1.0, factor * d ** n)”. Reasonable values are between 0 and 1.</p></li>
</ul>
<p>INCLUDES</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[bdf1-solver-fnbase-spec]</span></code> <em>Uses a</em> <a class="reference internal" href="#bdf1-solver-interface">BDF1 Solver Interface</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[solver-typed-spec]</span></code> <em>Uses a</em> <a class="reference internal" href="#solver">Solver</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[timestep-controller-typed-spec]</span></code> <em>Uses a</em> <a class="reference internal" href="#timestep-controller">Timestep Controller</a></p></li>
</ul>
</div>
<div class="section" id="bdf1-solver-interface">
<h4><a class="toc-backref" href="#id113">BDF1 Solver Interface</a><a class="headerlink" href="#bdf1-solver-interface" title="Permalink to this headline">¶</a></h4>
</div>
</div>
<div class="section" id="timestep-controller">
<h3><a class="toc-backref" href="#id114">Timestep Controller</a><a class="headerlink" href="#timestep-controller" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Factory for creating TimestepController objects</p>
</div></blockquote>
<p>A TimestepController object sets what size timestep to take.  This can be a
variety of things, from fixed timestep size, to adaptive based upon error
control, to adapter based upon simple nonlinear iteration counts.</p>
<p>Available types include:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#timestep-controller-fixed">Timestep Controller Fixed</a>  (type <cite>“fixed</cite>”), a constant timestep</p></li>
<li><p><a class="reference internal" href="#timestep-controller-standard">Timestep Controller Standard</a> (type <cite>‘standard</cite>”), an adaptive timestep based upon nonlinear iterations</p></li>
<li><p><a class="reference internal" href="#timestep-controller-smarter">Timestep Controller Smarter</a> (type <cite>‘smarter</cite>”), an adaptive timestep based upon nonlinear iterations with more control</p></li>
<li><p><a class="reference internal" href="#timestep-controller-adaptive">Timestep Controller Adaptive</a> (type <cite>“adaptive</cite>”), an adaptive timestep based upon error control.</p></li>
<li><p><a class="reference internal" href="#timestep-controller-from-file">Timestep Controller From File</a> (type <cite>“from file</cite>”), uses a timestep history loaded from an HDF5 file.  (Usually only used for regression testing.)</p></li>
</ul>
<div class="admonition-timestep-controller-typed-spec admonition" id="timestep-controller-typed-spec">
<p class="admonition-title">timestep-controller-typed-spec</p>
<ul class="simple">
<li><p><cite>“timestep controller type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Set the type.  One of: <cite>“fixed</cite>”, <cite>“standard</cite>”, <cite>“smarter</cite>”, <cite>“adaptive</cite>”, or <cite>“from file</cite>”</p></li>
<li><p><cite>“timestep controller X parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> List of parameters for a timestep controller of type X.</p></li>
</ul>
</div>
<div class="section" id="timestep-controller-fixed">
<h4><a class="toc-backref" href="#id115">Timestep Controller Fixed</a><a class="headerlink" href="#timestep-controller-fixed" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Timestep controller providing constant timestep size.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">TimestepControllerFixed</span></code> is a simple timestep control mechanism which sets
a constant timestep size.  Note that the actual timestep size is given by the
minimum of PK’s initial timestep sizes.</p>
<p>No parameters are required.</p>
</div>
<div class="section" id="timestep-controller-standard">
<h4><a class="toc-backref" href="#id116">Timestep Controller Standard</a><a class="headerlink" href="#timestep-controller-standard" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Simple timestep control based upon previous iteration count.</p>
</div></blockquote>
<p>This is a simple timestep control mechanism
which sets the next timestep based upon the previous timestep and how many
nonlinear iterations the previous timestep took to converge.</p>
<p>The timestep for step <span class="math notranslate nohighlight">\(k+1\)</span>, <span class="math notranslate nohighlight">\(\Delta t_{k+1}\)</span>, is given by:</p>
<ul class="simple">
<li><p>if <span class="math notranslate nohighlight">\(N_k &gt; N^{max}\)</span> then <span class="math notranslate nohighlight">\(\Delta t_{k+1} = f_{reduction} * \Delta t_{k}\)</span></p></li>
<li><p>if <span class="math notranslate nohighlight">\(N_k &lt; N^{min}\)</span> then <span class="math notranslate nohighlight">\(\Delta t_{k+1} = f_{increase} * \Delta t_{k}\)</span></p></li>
<li><p>otherwise <span class="math notranslate nohighlight">\(\Delta t_{k+1} = \Delta t_{k}\)</span></p></li>
</ul>
<p>where <span class="math notranslate nohighlight">\(\Delta t_{k}\)</span> is the previous timestep and <span class="math notranslate nohighlight">\(N_k\)</span> is the number of
nonlinear iterations required to solve step <span class="math notranslate nohighlight">\(k\)</span>:.</p>
<div class="admonition-timestep-controller-typed-standard-spec admonition" id="timestep-controller-typed-standard-spec">
<p class="admonition-title">timestep-controller-typed-standard-spec</p>
<ul class="simple">
<li><p><cite>“max iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <span class="math notranslate nohighlight">\(N^{max}\)</span>, decrease the timestep if the previous step took more than this.</p></li>
<li><p><cite>“min iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <span class="math notranslate nohighlight">\(N^{min}\)</span>, increase the timestep if the previous step took less than this.</p></li>
<li><p><cite>“time step reduction factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <span class="math notranslate nohighlight">\(f_{reduction}\)</span>, reduce the previous timestep by this multiple.</p></li>
<li><p><cite>“time step increase factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <span class="math notranslate nohighlight">\(f_{increase}\)</span>, increase the previous timestep by this multiple.</p></li>
<li><p><cite>“max time step</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> The max timestep size allowed.</p></li>
<li><p><cite>“min time step</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> The min timestep size allowed.  If the step has failed and the new step is below this cutoff, the simulation fails.</p></li>
</ul>
</div>
</div>
<div class="section" id="timestep-controller-smarter">
<h4><a class="toc-backref" href="#id117">Timestep Controller Smarter</a><a class="headerlink" href="#timestep-controller-smarter" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Slightly smarter timestep controller based upon a history of previous timesteps.</p>
</div></blockquote>
<p>This is based on <a class="reference internal" href="#timestep-controller-standard">Timestep Controller Standard</a>, but also tries to be a bit
smarter to avoid repeated increase/decrease loops where the step size
decreases, converges in few iterations, increases, but then fails again.  It
also tries to grow the step geometrically to more quickly recover from tricky
nonlinearities.</p>
<div class="admonition-timestep-controller-typed-smarter-spec admonition" id="timestep-controller-typed-smarter-spec">
<p class="admonition-title">timestep-controller-typed-smarter-spec</p>
<ul class="simple">
<li><p><cite>“max iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <span class="math notranslate nohighlight">\(N^{max}\)</span>, decrease the timestep if the previous step took more than this.</p></li>
<li><p><cite>“min iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <span class="math notranslate nohighlight">\(N^{min}\)</span>, increase the timestep if the previous step took less than this.</p></li>
<li><p><cite>“time step reduction factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <span class="math notranslate nohighlight">\(f_{reduction}\)</span>, reduce the previous timestep by this multiple.</p></li>
<li><p><cite>“time step increase factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <span class="math notranslate nohighlight">\(f_{increase}\)</span>, increase the previous timestep by this multiple.  Note that this can be modified geometrically in the case of repeated successful steps.</p></li>
<li><p><cite>“max time step increase factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>10.</strong> The max <span class="math notranslate nohighlight">\(f_{increase}\)</span> will ever get.</p></li>
<li><p><cite>“growth wait after fail</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> Wait at least this many timesteps before attempting to grow the timestep after a failed timestep.</p></li>
<li><p><cite>“count before increasing increase factor</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> Require this many successive increasions before multiplying <span class="math notranslate nohighlight">\(f_{increase}\)</span> by itself.</p></li>
</ul>
</div>
</div>
<div class="section" id="timestep-controller-adaptive">
<h4><a class="toc-backref" href="#id118">Timestep Controller Adaptive</a><a class="headerlink" href="#timestep-controller-adaptive" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Adaptive timestep control based upon previous iteration count.</p>
</div></blockquote>
<p>This is under development and is based on a posteriori error estimates.</p>
</div>
<div class="section" id="timestep-controller-from-file">
<h4><a class="toc-backref" href="#id119">Timestep Controller From File</a><a class="headerlink" href="#timestep-controller-from-file" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Timestep controller which loads a timestep history from file.</p>
</div></blockquote>
<p>This loads a timestep history from a file, then advances the step size with
those values.  This is mostly used for testing purposes, where we need to force
the same timestep history as previous runs to do regression testing.  Otherwise
even machine roundoff can eventually alter number of iterations enough to alter
the timestep history, resulting in solutions which are enough different to
cause doubt over their correctness.</p>
<div class="admonition-timestep-controller-typed-from-file-spec admonition" id="timestep-controller-typed-from-file-spec">
<p class="admonition-title">timestep-controller-typed-from-file-spec</p>
<ul class="simple">
<li><p><cite>“file name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Path to hdf5 file containing timestep information.</p></li>
<li><p><cite>“timestep header</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Name of the dataset containing the history of timestep sizes.</p></li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="nonlinear-solver">
<h2><a class="toc-backref" href="#id120">Nonlinear Solver</a><a class="headerlink" href="#nonlinear-solver" title="Permalink to this headline">¶</a></h2>
<blockquote id="solver">
<div><p>A factory for creating nonlinear solvers.</p>
</div></blockquote>
<p>Nonlinear solvers are used within implicit time integration schemes to drive
the residual to zero and thereby solve for the primary variable at the new
time.</p>
<div class="admonition-solver-typed-spec admonition" id="solver-typed-spec">
<p class="admonition-title">solver-typed-spec</p>
<ul class="simple">
<li><p><cite>“solver type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Type of the solver.  One of:</p>
<ul>
<li><p><cite>“Newton</cite>” See <a class="reference internal" href="#solver-newton-and-inexact-newton">Solver: Newton and Inexact Newton</a></p></li>
<li><p><cite>“JFNK</cite>” See <a class="reference internal" href="#solver-jacobian-free-newton-krylov">Solver: Jacobian-Free Newton Krylov</a></p></li>
<li><p><cite>“line search</cite>” See <a class="reference internal" href="#solver-newton-with-line-search">Solver: Newton with Line Search</a></p></li>
<li><p><cite>“continuation</cite>” See <a class="reference internal" href="#solver-nonlinear-continuation">Solver: Nonlinear Continuation</a></p></li>
<li><p><cite>“nka</cite>” See <a class="reference internal" href="#solver-nonlinear-krylov-acceleration">Solver: Nonlinear Krylov Acceleration</a></p></li>
<li><p><cite>“aa</cite>” See <a class="reference internal" href="#solver-anderson-acceleration">Solver: Anderson Acceleration</a></p></li>
<li><p><cite>“nka line search</cite>” See <cite>Solver: NKA with Line Search</cite>”</p></li>
<li><p><cite>“nka_ls_ats</cite>” See <a class="reference internal" href="#solver-nka-with-line-search-ats">Solver: NKA with Line Search, ATS</a></p></li>
<li><p><cite>“nka_bt_ats</cite>” See <a class="reference internal" href="#solver-nka-with-backtracking-ats">Solver: NKA with backtracking, ATS</a></p></li>
<li><p><cite>“nox</cite>” See <a class="reference internal" href="#solver-nox">Solver: NOX</a></p></li>
</ul>
</li>
<li><p><cite>“_solver_type_ parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[_solver_type_-spec]</span></code> A sublist containing
parameters specific to the type.</p></li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><cite>“JFNK</cite>”, <cite>“line search</cite>”, and <cite>“continuation</cite>” methods have not been
beaten on as much as other methods.  <cite>“nka_ls_ats</cite>” is somewhat deprecated
and probably shouldn’t be used.  Prefer <cite>“nka</cite>” for simple problems,
<cite>“nka_bt_ats</cite>” for freeze-thaw problems or other problems with strong
nonlinearities, and <cite>“Newton</cite>” when you have a good Jacobian.  While
<cite>“nox</cite>” hasn’t been used extensively, it may be quite useful.</p>
</div>
<div class="section" id="solver-newton-and-inexact-newton">
<h3><a class="toc-backref" href="#id121">Solver: Newton and Inexact Newton</a><a class="headerlink" href="#solver-newton-and-inexact-newton" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Straightforward Newton/Inexact Newton solver.</p>
</div></blockquote>
<p>The classical Newton method works well for cases where Jacobian is available
and corresponds to a stable (e.g. upwind) discretization.  The inexact Newton
methods work for cases where the discrete Jacobian is either not available, or
not stable, or computationally expensive. The discrete Jacobian is replaced by
a stable approximation of the continuum Jacobian. The choice between exact and
inexact is not made by the Solver, but instead by the PK.  Both use the
ApplyPreconditioner() method – if this applies the true Jacobian, then the
method is Newton.  If it applies an appoximation, it is inexact Newton.</p>
<div class="admonition-solver-typed-newton-spec admonition" id="solver-typed-newton-spec">
<p class="admonition-title">solver-typed-newton-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“monitor</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>monitor update</strong> specifies control of the
nonlinear residual. The available options are <cite>“monitor update</cite>” and
<cite>“monitor residual</cite>”.</p></li>
<li><p><cite>“limit iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>50</strong> defines the maximum allowed number
of iterations.</p></li>
<li><p><cite>“diverged tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> defines the error level
indicating divergence of the solver. The error is calculated by a PK.</p></li>
<li><p><cite>“max du growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e5</strong> allows the solver to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment changes drastically on two consecutive iterations,
the solver is terminated.</p></li>
<li><p><cite>“max error growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e5</strong> defines another way to
identify divergence pattern on earlier iterations. If the PK-specific
error changes drastically on two consecutive iterations, the solver is
terminated.</p></li>
<li><p><cite>“max divergent iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>3</strong> defines another way to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment grows on too many consecutive iterations, the
solver is terminated.</p></li>
<li><p><cite>“modify correction</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> allows a PK to modify the
solution increment. One example is a physics-based clipping of extreme
solution values.</p></li>
<li><p><cite>“stagnation iteration check</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>8</strong> determines the number of
iterations before the stagnation check is turned on. The stagnation
happens when the current L2-error exceeds the initial L2-error.</p></li>
</ul>
</div>
</div>
<div class="section" id="solver-jacobian-free-newton-krylov">
<h3><a class="toc-backref" href="#id122">Solver: Jacobian-Free Newton Krylov</a><a class="headerlink" href="#solver-jacobian-free-newton-krylov" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Decorator for using a Solver with JFNK as the preconditioner.</p>
</div></blockquote>
<p>Jacobian-Free Newton Krylov uses a finite difference scheme to approximate the
action of the Jacobian matrix, then uses a Krylov method (which only needs the
action of the Jacobian and not the Jacobian itself) to calculate the action of
the inverse of the Jacobian, thereby providing a Newton-like update.  As the
linear Krylov scheme converges to the inverse action, the nonlinear solution
converges to the same solution as a true Newton method.</p>
<p>This implementation simply replaces a SolverFnBase’s ApplyPreconditioner() with
a new ApplyPreconditioner() which uses the Krylov method with the action of the
forward operator to (hopefully) improve, relative to the supplied approximate
inverse, the estimate of the inverse.</p>
<div class="admonition-solver-typed-jfnk-spec admonition" id="solver-typed-jfnk-spec">
<p class="admonition-title">solver-typed-jfnk-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear solver</cite>” <code class="docutils literal notranslate"><span class="pre">[solver-typed-spec]</span></code> The outer nonlinear solver to use.</p></li>
<li><p><cite>“linear operator</cite>” <code class="docutils literal notranslate"><span class="pre">[linear-operator-typed-spec]</span></code> The Krylov method to use.</p></li>
<li><p><cite>“JF matrix parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[jf-matrix-spec]</span></code> See <a class="reference internal" href="#jf-matrix-spec">jf-matrix-spec</a></p></li>
</ul>
</div>
<p>The Jacobian-Free Matrix operator, which is used to estimate the action of the
Jacobian.</p>
<p>A variety of methods are available for choosing the epsilon used to approximate
the action of the Jacobian.  They are documented in Knoll &amp; Keyes 2004 paper.</p>
<p>..todo:: Document these</p>
<div class="admonition-jf-matrix-spec admonition" id="jf-matrix-spec">
<p class="admonition-title">jf-matrix-spec</p>
<ul class="simple">
<li><p>“typical solution value” [double] <strong>100</strong> Used in relative action
approximations. <strong>OPTION NOT IMPLEMENTED</strong></p></li>
<li><p>“finite difference epsilon” [double] <strong>1.e-8</strong> defines the base finite
difference epsilon.</p></li>
<li><p>“method for epsilon” [string] defines a method for calculating finite
difference epsilon. Available option is “Knoll-Keyes”, “Knoll-Keyes L2”,
“Brown-Saad”.  See Knoll</p></li>
</ul>
</div>
</div>
<div class="section" id="solver-newton-with-line-search">
<h3><a class="toc-backref" href="#id123">Solver: Newton with Line Search</a><a class="headerlink" href="#solver-newton-with-line-search" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Backtracking line search on the provided correction as a solver.</p>
</div></blockquote>
<p>Line Search accepts a correction from the Jacobian, then uses a
process to attempt to minimize or at least ensure a reduction in the residual
while searching <em>in that direction</em>, but not necessarily with the same
magnitude, as the provided correction.  The scalar multiple of the search
direction is given by <span class="math notranslate nohighlight">\(\alpha\)</span>.</p>
<p>This globalization recognizes that a true inverse Jacobian is a local
measurement of the steepest descent direction, and so while the direction is
guaranteed to be the direction which best reduces the residual, it may not
provide the correct magnitude.</p>
<p>Note, this always monitors the residual.</p>
<div class="admonition-solver-typed-backtracking-spec admonition" id="solver-typed-backtracking-spec">
<p class="admonition-title">solver-typed-backtracking-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“limit iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>50</strong> defines the maximum allowed number
of iterations.</p></li>
<li><p><cite>“diverged tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> defines the error level
indicating divergence of the solver. The error is calculated by a PK.</p></li>
<li><p><cite>“max error growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e5</strong> defines another way to
identify divergence pattern on earlier iterations. If the PK-specific
error changes drastically on two consecutive iterations, the solver is
terminated.</p></li>
<li><p><cite>“modify correction</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> allows a PK to modify the
solution increment. One example is a physics-based clipping of extreme
solution values.</p></li>
<li><p><cite>“accuracy of line search minimum [bits]</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong></p></li>
<li><p><cite>“min valid alpha</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0</strong></p></li>
<li><p><cite>“max valid alpha</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>10.</strong></p></li>
<li><p><cite>“max line search iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong></p></li>
</ul>
</div>
</div>
<div class="section" id="solver-nonlinear-continuation">
<h3><a class="toc-backref" href="#id124">Solver: Nonlinear Continuation</a><a class="headerlink" href="#solver-nonlinear-continuation" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>A very simple nonlinear continuation method.</p>
</div></blockquote>
<p>Continuation methods are useful when the nonlinearity can be controlled by a
single simple parameter.  In this method, the nonlinear problem is solved with
a less-nonlinear value of the parameter, and the solution of that is used as
the initial guess to solve a harder problem.  As each successive problem is
solved, the continuation parameter is changed closer and closer to the true
value.</p>
<p>Few if any PKs support this method currently – it requires the PK to provide more
interface about how to update the continuation parameter.</p>
<div class="admonition-solver-typed-continuation-spec admonition" id="solver-typed-continuation-spec">
<p class="admonition-title">solver-typed-continuation-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“number of continuation steps</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>5</strong> How many steps to take
from initial parameter to final parameter.</p></li>
<li><p><cite>“inner solver</cite>” <a href="#id6"><span class="problematic" id="id7">``</span></a>[solver-typed-spec]``A <a class="reference internal" href="#solver">Solver</a>, used at each step.</p></li>
</ul>
</div>
</div>
<div class="section" id="solver-nonlinear-krylov-acceleration">
<h3><a class="toc-backref" href="#id125">Solver: Nonlinear Krylov Acceleration</a><a class="headerlink" href="#solver-nonlinear-krylov-acceleration" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Nonlinear Krylov Acceleration as a nonlinear solver.</p>
</div></blockquote>
<p>Uses the Nonlinear Krylov acceleration method of Carlson and Miller to do
effectively a multivariant secant method, accelerating the solution of a
nonlinear solve.  This method can be significantly faster than Newton,
especially with an approximate Jacobian.</p>
<blockquote>
<div><p>Calef et al. “Nonlinear Krylov acceleration applied to a discrete ordinates
formulation of the k-eigenvalue problem.” JCP 238 (2013): 188-209.</p>
<p>N. N. Carlson, K. Miller, Design and application of a gradient-weighted
moving finite element code II: In two dimensions, SIAM J. Sci.  Comput. 19
(3) (1998) 766–798.</p>
</div></blockquote>
<div class="admonition-solver-typed-nka-spec admonition" id="solver-typed-nka-spec">
<p class="admonition-title">solver-typed-nka-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> Defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“monitor</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>monitor update</strong> Specifies control of the
nonlinear residual. The available options are <cite>“monitor update</cite>”,
<cite>“monitor residual</cite>”, <cite>“monitor preconditioned residual</cite>”, <cite>“monitor l2
residual</cite>”, and <cite>“monitor preconditioned l2 residual</cite>”.</p></li>
<li><p><cite>“limit iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>20</strong> Defines the maximum allowed number
of iterations.</p></li>
<li><p><cite>“diverged tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> Defines the error level
indicating divergence of the solver. The error is calculated by a PK.</p></li>
<li><p><cite>“diverged l2 tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> Defines another way to
identify divergence of the solver. If the relative L2 norm of the
solution increment is above this value, the solver is terminated.</p></li>
<li><p><cite>“diverged pc tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e10</strong> Defines another way to
identify divergence of the solver. If the relative maximum norm of the
solution increment (with respect to the initial increment) is above this
value, the solver is terminated.</p></li>
<li><p><cite>“diverged residual tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e10</strong> Defines another way
to identify divergence of the solver. If the relative L2 norm of the
residual (with respect to the initial residual) is above this value, the
solver is terminated.</p></li>
<li><p><cite>“max du growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e5</strong> Allows the solver to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment changes drastically on two consecutive iterations,
the solver is terminated.</p></li>
<li><p><cite>“max error growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e5</strong> Defines another way to
identify divergence pattern on earlier iterations. If the PK-specific
error changes drastically on two consecutive iterations, the solver is
terminated.</p></li>
<li><p><cite>“max divergent iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>3</strong> Defines another way to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment grows on too many consecutive iterations, the
solver is terminated.</p></li>
<li><p><cite>“modify correction</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Allows a PK to modify the
solution increment. One example is a physics-based clipping of extreme
solution values.</p></li>
<li><p><cite>“lag iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Delays the NKA acceleration, but
updates the Krylov space.</p></li>
<li><p><cite>“max nka vectors</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong> Defines the maximum number of
consecutive vectors used for a local space.</p></li>
<li><p><cite>“nka vector tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.05</strong> Defines the minimum
allowed orthogonality between vectors in the local space. If a new vector
does not satisfy this requirement, the space is modified.</p></li>
</ul>
</div>
</div>
<div class="section" id="solver-anderson-acceleration">
<h3><a class="toc-backref" href="#id126">Solver: Anderson Acceleration</a><a class="headerlink" href="#solver-anderson-acceleration" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Anderson acceleration as a nonlinear solver.</p>
</div></blockquote>
<p>This is a variation of the GMRES solver for nonlinear problems.</p>
<div class="admonition-solver-typed-aa-spec admonition" id="solver-typed-aa-spec">
<p class="admonition-title">solver-typed-aa-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> Defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“limit iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>20</strong> Defines the maximum allowed number
of iterations.</p></li>
<li><p><cite>“diverged tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> Defines the error level
indicating divergence of the solver. The error is calculated by a PK.</p></li>
<li><p><cite>“diverged l2 tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> Defines another way to
identify divergence of the solver. If the relative L2 norm of the
solution increment is above this value, the solver is terminated.</p></li>
<li><p><cite>“diverged pc tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e10</strong> Defines another way to
identify divergence of the solver. If the relative maximum norm of the
solution increment (with respect to the initial increment) is above this
value, the solver is terminated.</p></li>
<li><p><cite>“max du growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e5</strong> Allows the solver to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment changes drastically on two consecutive iterations,
the solver is terminated.</p></li>
<li><p><cite>“max divergent iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>3</strong> Defines another way to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment grows on too many consecutive iterations, the
solver is terminated.</p></li>
<li><p><cite>“max aa vectors</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong> Defines the maximum number of
consecutive vectors used for a local space.</p></li>
<li><p><cite>“modify correction</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Allows a PK to modify the
solution increment. One example is a physics-based clipping of extreme
solution values.</p></li>
<li><p><cite>“relaxation parameter</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1</strong> Damping factor for increment.</p></li>
</ul>
</div>
</div>
<div class="section" id="solver-nka-with-line-search">
<h3><a class="toc-backref" href="#id127">Solver: NKA with Line Search</a><a class="headerlink" href="#solver-nka-with-line-search" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>NKA nonlinear solver with a line-search based on a Brendt minimization algorithm.</p>
</div></blockquote>
<p>Does NKA, then checks if that correction has reduced the residual by at least a
tolerance.  If not, this uses a Brendt minimization algorithm to try and find
an <span class="math notranslate nohighlight">\(\alpha\)</span> that minimizes the reduction in the residual.</p>
<p>Note, this always monitors the residual.</p>
<span class="target" id="solver-typed-nka-ls-spec"></span></div>
<div class="section" id="solver-nka-with-line-search-ats">
<h3><a class="toc-backref" href="#id128">Solver: NKA with Line Search, ATS</a><a class="headerlink" href="#solver-nka-with-line-search-ats" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="solver-nka-with-backtracking-ats">
<h3><a class="toc-backref" href="#id129">Solver: NKA with backtracking, ATS</a><a class="headerlink" href="#solver-nka-with-backtracking-ats" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Nonlinear solve using NKA with a heuristic based backtracking.</p>
</div></blockquote>
<p>Whereas line search uses a formal minimization method, backtracking simply uses
a heuristic multiplier on <span class="math notranslate nohighlight">\(\alpha\)</span> to find a correction that sufficiently
reduces the residual.  This can be significantly faster than the full
minimization problem, and finding the true minimum may not be as important as
simply doing better and going on to the next nonlinear iteration.</p>
<p>This is the workhorse for hard ATS problems, as it is usually rather efficient,
even in problems where the linear solve results in a correction that is way too
large (e.g. for steep nonlinearities such as phase change).</p>
<p>Note this always monitors the residual, and the correction is always modified.</p>
<div class="admonition-solver-typed-nka-bt-ats-spec admonition" id="solver-typed-nka-bt-ats-spec">
<p class="admonition-title">solver-typed-nka-bt-ats-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> Defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“limit iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>20</strong> Defines the maximum allowed number
of iterations.</p></li>
<li><p><cite>“diverged tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> Defines the error level
indicating divergence of the solver. The error is calculated by a PK.</p></li>
<li><p><cite>“nka lag iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Delays the NKA acceleration, but
updates the Krylov space.</p></li>
<li><p><cite>“max nka vectors</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong> Defines the maximum number of
consecutive vectors used for a local space.</p></li>
<li><p><cite>“nka vector tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.05</strong> Defines the minimum
allowed orthogonality between vectors in the local space. If a new vector
does not satisfy this requirement, the space is modified.</p></li>
<li><p><cite>“backtrack tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.</strong> Require a reduction of at
least this much in the residual norm before accepting a correction.</p></li>
<li><p><cite>“backtrack factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.5</strong> Multiply the correction by this
factor each backtracking step.  Note, should be in (0, 1)</p></li>
<li><p><cite>“backtrack monitor</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>monitor either</strong> What norm is
checked to determine whether backtracking has improved the residual or
not?  One of <cite>“monitor enorm</cite>”, <cite>“monitor L2 residual</cite>”, or <cite>‘monitor
either</cite>”</p></li>
<li><p><cite>“backtrack max steps</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong> Controls how many multiples of
the backtrack factor are applied before declaring failure.</p></li>
<li><p><cite>“backtrack max total steps</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1e6</strong> Controls how many total
backtrack steps may be taken before declaring failure.</p></li>
<li><p><cite>“backtrack lag iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Delay requiring a reduction
in residual for this many nonlinear iterations.</p></li>
<li><p><cite>“backtrack last iteration</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1e6</strong> Stop requiring a
reductiontion in residual after this many nonlinear iterations.</p></li>
<li><p><cite>“backtrack fail on bad search direction</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If
backtracking for the full number of “backtrack max steps” is taken, and
the residual norm has still not be reduced suffiently, this determines
the behavior.  If true, the solver declares failure.  If false, it takes
the bad step anyway and hopes to recover in later iterates.</p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“Anderson mixing</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, use Anderson mixing instead of NKA.</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“relaxation parameter</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.7</strong> The relaxation parameter
for Anderson mixing.</p></li>
</ul>
<p>END</p>
</div>
</div>
<div class="section" id="solver-nox">
<h3><a class="toc-backref" href="#id130">Solver: NOX</a><a class="headerlink" href="#solver-nox" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Calls Nox nonlinear solvers/JFNK.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="linear-solvers">
<h2><a class="toc-backref" href="#id131">Linear Solvers</a><a class="headerlink" href="#linear-solvers" title="Permalink to this headline">¶</a></h2>
<blockquote id="linear-solver">
<span id="linearsolvers"></span><span id="linearoperator"></span><div><p>Iterative methods for determining the inverse of a linear operator.</p>
</div></blockquote>
<p>Linear solvers are iterative methods which wrap Operators/Matrices and provide
a solution for the true inverse.  The provided Operator must implement a
forward application (which may be an assembled Matrix-Vector product, or may be
a matrix-free forward application) and an approximate inverse (the
preconditioner).</p>
<p>Note that linear operators here differ from preconditioners not in their
exactness of the solution, but in their interface.  A <a class="reference internal" href="#preconditioner">Preconditioner</a> works with
raw vectors and matrices, and may need assembled matrices.  LinearOperators
work with the action of matrices only, and never need assembled matrices.  As
such they are templated with an arbitrary Matrix and Vector type, whereas
Preconditioners are not.</p>
<div class="admonition-linear-solver-typed-spec admonition" id="linear-solver-typed-spec">
<p class="admonition-title">linear-solver-typed-spec</p>
<ul class="simple">
<li><p><cite>“iterative method type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Iterative method to be used.</p></li>
<li><p><cite>“_iterative_method_type_ parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[_iterative_method_type_-spec]</span></code>
Parameters associated with the requested iterative method.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;linear solver&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;iterative method&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;gmres&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;verbose object&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;verbosity level&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;medium&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;gmres parameters&quot;</span> <span class="na">type=</span><span class="s">&quot;ParameterList&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;preconditioning strategy&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;left&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;error tolerance&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;1e-06&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;convergence criteria&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{relative residual,make one iteration}&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;maximum number of iteration&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;80&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<div class="section" id="linear-solver-pcg">
<h3><a class="toc-backref" href="#id132">Linear Solver: PCG</a><a class="headerlink" href="#linear-solver-pcg" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Preconditioned conjugate gradient method for a linear solver.</p>
</div></blockquote>
<div class="admonition-linear-solver-typed-pcg-spec admonition" id="linear-solver-typed-pcg-spec">
<p class="admonition-title">linear-solver-typed-pcg-spec</p>
<ul class="simple">
<li><p><cite>“error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> Tolerance on which to declare success.</p></li>
<li><p><cite>“maximum number of iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>100</strong> Maximum iterations before declaring failure.</p></li>
<li><p><cite>“overflow tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>3.e50</strong> Error above this value results in failure.</p></li>
<li><p><cite>“convergence criterial</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> <strong>“{relative rhs}”</strong> A list of
criteria, any of which can be applied.  Valid include:</p>
<ul>
<li><p><cite>“relative rhs</cite>” : measure error relative to the norm of the RHS vector</p></li>
<li><p><cite>“relative residual</cite>” : measure error relative to the norm of the residual</p></li>
<li><p><cite>“absolute residual</cite>” : measure error directly, norm of error</p></li>
<li><p><cite>“make one iteration</cite>” : require at least one iteration to be performed before declaring success</p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="linear-solver-gmres">
<h3><a class="toc-backref" href="#id133">Linear Solver: GMRES</a><a class="headerlink" href="#linear-solver-gmres" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Generalized minimum residual method for a linear solver.</p>
</div></blockquote>
<p>Based on the methods of Yu. Kuznetsov, 1968; Y.Saad, 1986.  Deflated version of
GMRES is due to R.Morgan, GMRES with deflated restarting, 2002 SISC; S.Rollin,
W.Fichtner, Improving accuracy of GMRES with deflated restarting, 2007 SISC.</p>
<div class="admonition-linear-solver-typed-gmres-spec admonition" id="linear-solver-typed-gmres-spec">
<p class="admonition-title">linear-solver-typed-gmres-spec</p>
<ul class="simple">
<li><p><cite>“error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> Tolerance on which to declare success.</p></li>
<li><p><cite>“maximum number of iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>100</strong> Maximum iterations before declaring failure.</p></li>
<li><p><cite>“overflow tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>3.e50</strong> Error above this value results in failure.</p></li>
<li><p><cite>“convergence criterial</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> <strong>“{relative rhs}”</strong> A list of
criteria, any of which can be applied.  Valid include:</p>
<ul>
<li><p><cite>“relative rhs</cite>” : measure error relative to the norm of the RHS vector</p></li>
<li><p><cite>“relative residual</cite>” : measure error relative to the norm of the residual</p></li>
<li><p><cite>“absolute residual</cite>” : measure error directly, norm of error</p></li>
<li><p><cite>“make one iteration</cite>” : require at least one iteration to be performed before declaring success</p></li>
</ul>
</li>
<li><p><cite>“size of Krylov space</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong> Size of the Krylov space used to span the residual.</p></li>
<li><p><cite>“controller training start</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Start iteration for determining
convergence rates. (Add more please!)</p></li>
<li><p><cite>“controller training end</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>3</strong> Start iteration for determining
convergence rates. (Add more please!)</p></li>
<li><p><cite>“preconditioning strategy</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>left</strong> Valid are “left” and
“right”-type preconditioning (see Saad 1986)</p></li>
<li><p><cite>“maximum size of deflation space</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Size of the deflation space, see Rollin et al.</p></li>
</ul>
</div>
</div>
<div class="section" id="linear-solver-nka">
<h3><a class="toc-backref" href="#id134">Linear Solver: NKA</a><a class="headerlink" href="#linear-solver-nka" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Uses NKA method as a linear solver.</p>
</div></blockquote>
<p>This is effectively equivalent to GMRES with a rolling restart, where vectors
fall off the end of the space.</p>
<div class="admonition-linear-solver-typed-nka-spec admonition" id="linear-solver-typed-nka-spec">
<p class="admonition-title">linear-solver-typed-nka-spec</p>
<ul class="simple">
<li><p><cite>“error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> Tolerance on which to declare success.</p></li>
<li><p><cite>“maximum number of iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>100</strong> Maximum iterations before declaring failure.</p></li>
<li><p><cite>“overflow tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>3.e50</strong> Error above this value results in failure.</p></li>
<li><p><cite>“convergence criterial</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> <strong>“{relative rhs}”</strong> A list of
criteria, any of which can be applied.  Valid include:</p>
<ul>
<li><p><cite>“relative rhs</cite>” : measure error relative to the norm of the RHS vector</p></li>
<li><p><cite>“relative residual</cite>” : measure error relative to the norm of the residual</p></li>
<li><p><cite>“absolute residual</cite>” : measure error directly, norm of error</p></li>
<li><p><cite>“make one iteration</cite>” : require at least one iteration to be performed before declaring success</p></li>
</ul>
</li>
<li><p><cite>“max nka vectors</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong> Size of the NKA space used to span the residual, conceptually equivalent to the size of the Krylov space.</p></li>
<li><p><cite>“nka vector tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.05</strong> Vectors whose dot product are within this tolerance are considered parallel, and therefore the old vector is thrown out.</p></li>
</ul>
</div>
</div>
<div class="section" id="linear-solver-amesos">
<h3><a class="toc-backref" href="#id135">Linear Solver: Amesos</a><a class="headerlink" href="#linear-solver-amesos" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Direct solvers via Trilinos.</p>
</div></blockquote>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>undocumented</p>
</div>
</div>
<div class="section" id="linear-solver-belos-gmres">
<h3><a class="toc-backref" href="#id136">Linear Solver: Belos GMRES</a><a class="headerlink" href="#linear-solver-belos-gmres" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Trilinos/Belos implementation of GMRES</p>
</div></blockquote>
<p>Generalized minimum residual method (Yu.Kuznetsov, 1968; Y.Saad, 1986)</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>undocumented</p>
</div>
</div>
</div>
<div class="section" id="preconditioners">
<h2><a class="toc-backref" href="#id137">Preconditioners</a><a class="headerlink" href="#preconditioners" title="Permalink to this headline">¶</a></h2>
<blockquote id="preconditioner">
<div><p>Base class for preconditioners.</p>
</div></blockquote>
<p>Provides approximate inverses of matrices.</p>
<p>Note that preconditioners here differ from linear operators not in the
approximate nature of their inverse, but in their interface.  Preconditioners
work with raw vectors and matrices, and may need assembled matrices.  A <a class="reference internal" href="#linear-solver">Linear
Solver</a> works with the action of matrices only, and never need assembled
matrices.  As such they are templated with an arbitrary Matrix and Vector type,
whereas Preconditioners are not.</p>
<div class="admonition-preconditioner-typed-spec admonition" id="preconditioner-typed-spec">
<p class="admonition-title">preconditioner-typed-spec</p>
<ul class="simple">
<li><p><cite>“preconditioner type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>identity</strong> Iterative method to be used.</p></li>
<li><p><cite>“_preconditioner_type_ parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[_preconditioner_type_-spec]</span></code>
Parameters associated with the requested preconditioner.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;my preconditioner&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;type&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;trilinos ml&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;trilinos ml parameters&quot;</span><span class="nt">&gt;</span> ?????? check me!
       ...
   <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<div class="section" id="identity">
<h3><a class="toc-backref" href="#id138">Identity</a><a class="headerlink" href="#identity" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Identity as a preconditioner.</p>
</div></blockquote>
<p>Simply copies the input vector to the output – uses the Identity matrix as a
preconditioner.</p>
<p>This is provided when using the <cite>“preconditioner type</cite>”=`”identity`” in the
<a class="reference internal" href="#preconditioner">Preconditioner</a> spec.</p>
<p>No parameters are required.</p>
</div>
<div class="section" id="diagonal">
<h3><a class="toc-backref" href="#id139">Diagonal</a><a class="headerlink" href="#diagonal" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Diagonal preconditioner.</p>
</div></blockquote>
<p>Simply applys the pointwise inverse of the diagonal of the matrix as an
extremely cheap matrix.</p>
<p>This is provided when using the <cite>“preconditioner type</cite>”=`”diagonal`” in the
<a class="reference internal" href="#preconditioner">Preconditioner</a> spec.</p>
<p>No parameters are required.</p>
</div>
<div class="section" id="block-ilu">
<h3><a class="toc-backref" href="#id140">Block ILU</a><a class="headerlink" href="#block-ilu" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Incomplete LU preconditioner.</p>
</div></blockquote>
<p>Incomplete LU is an approximate scheme based on partial factorization.  The
implementation here is that provided in the Ifpack package of Trilinos.  This
approach is a block solve that performs the ILU on each MPI process and uses
Additive Schwarz to combine the blocks.</p>
<p>This is provided when using the <cite>“preconditioner type</cite>”=`”block ilu`” in the
<a class="reference internal" href="#preconditioner">Preconditioner</a> spec.</p>
<div class="admonition-preconditioner-typed-block-ilu-spec admonition" id="preconditioner-typed-block-ilu-spec">
<p class="admonition-title">preconditioner-typed-block-ilu-spec:</p>
<ul class="simple">
<li><p><cite>“fact: relax value</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong></p></li>
<li><p><cite>“fact: absolute threshold</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.0</strong></p></li>
<li><p><cite>“fact: relative threshold</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong></p></li>
<li><p><cite>“fact: level-of-fill</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong></p></li>
<li><p><cite>“overlap</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Overlap of the combination.</p></li>
<li><p><cite>“schwarz: combine mode</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>Add</strong></p></li>
</ul>
</div>
<p>The internal parameters for block ILU are as follows:</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;block ilu parameters&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;fact: relax value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;fact: absolute threshold&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;fact: relative threshold&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;fact: level-of-fill&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;overlap&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;schwarz: combine mode&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;Add&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="boomer-amg">
<h3><a class="toc-backref" href="#id141">Boomer AMG</a><a class="headerlink" href="#boomer-amg" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>HYPRE’s algebraic multigrid preconditioner.</p>
</div></blockquote>
<p>Boomer AMG is a HYPRE product consisting of a variety of Algebraic Multigrid
methods.  It is accessed through Ifpack.</p>
<p>This is provided when using the <cite>“preconditioner type</cite>”=`”boomer amg`” in the
<a class="reference internal" href="#preconditioner">Preconditioner</a> spec.</p>
<div class="admonition-preconditioner-typed-boomer-amg-spec admonition" id="preconditioner-typed-boomer-amg-spec">
<p class="admonition-title">preconditioner-typed-boomer-amg-spec:</p>
<ul class="simple">
<li><p><cite>“tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.</strong> If is not zero, the preconditioner is dynamic
and approximate the inverse matrix with the prescribed tolerance (in
the energy norm ???).</p></li>
<li><p><cite>“smoother sweeps</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>3</strong> defines the number of smoothing loops. Default is 3.</p></li>
<li><p><cite>“cycle applications</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>5</strong> defines the number of V-cycles.</p></li>
<li><p><cite>“strong threshold</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.5</strong> defines the number of V-cycles. Default is 5.</p></li>
<li><p><cite>“relaxation type</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>6</strong> defines the smoother to be used. Default is 6
which specifies a symmetric hybrid Gauss-Seidel / Jacobi hybrid method. TODO: add others!</p></li>
<li><p><cite>“coarsen type</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> defines the coarsening strategy to be used. Default is 0
which specifies a Falgout method. TODO: add others!</p></li>
<li><p><cite>“max multigrid levels</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> optionally defined the maximum number of multigrid levels.</p></li>
<li><p><cite>“use block indices</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, uses the <cite>“systems of
PDEs</cite>” code with blocks given by the SuperMap, or one per DoF per entity
type.</p></li>
<li><p><cite>“number of functions</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1</strong> Any value &gt; 1 tells Boomer AMG to
use the <cite>“systems of PDEs</cite>” code with strided block type.  Note that, to use
this approach, unknowns must be ordered with DoF fastest varying (i.e. not
the native Epetra_MultiVector order).  By default, it uses the <cite>“unknown</cite>”
approach in which each equation is coarsened and interpolated independently.</p></li>
<li><p><cite>“nodal strength of connection norm</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> tells AMG to coarsen such
that each variable has the same coarse grid - sometimes this is more
“physical” for a particular problem. The value chosen here for nodal
determines how strength of connection is determined between the coupled
system.  I suggest setting nodal = 1, which uses a Frobenius norm.  This
does NOT tell AMG to use nodal relaxation.  Default is 0.</p></li>
<li><p><cite>“verbosity</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> prints a summary of run time settings and
timing information to stdout.  <cite>“1</cite>” prints coarsening info, <cite>“2</cite>” prints
smoothing info, and <cite>“3</cite>’” prints both.</p></li>
</ul>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;boomer amg parameters&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;tolerance&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;smoother sweeps&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;cycle applications&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;5&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;strong threshold&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;0.5&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;coarsen type&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;relaxation type&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;verbosity&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;number of functions&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="euclid">
<h3><a class="toc-backref" href="#id142">Euclid</a><a class="headerlink" href="#euclid" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>HYPRE’s parallel ILU as a preconditioner.</p>
</div></blockquote>
<p>Euclid is a Parallel Incomplete LU, provided as part of the HYPRE project
through the Ifpack interface.</p>
<p>This is provided when using the <cite>“preconditioner type</cite>”=`”euclid`” in the
<a class="reference internal" href="#preconditioner">Preconditioner</a> spec.</p>
<div class="admonition-preconditioner-typed-euclid-spec admonition" id="preconditioner-typed-euclid-spec">
<p class="admonition-title">preconditioner-typed-euclid-spec:</p>
<ul class="simple">
<li><p><cite>“ilu(k) fill level</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1</strong> The factorization level.</p></li>
<li><p><cite>“ilut drop tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0</strong> Defines a drop tolerance relative to the largest absolute value of any entry in the row being factored.</p></li>
<li><p><cite>“rescale row</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, values are scaled prior to factorization so that largest value in any row is +1 or -1. Note that this can destroy matrix symmetry.</p></li>
<li><p><cite>“verbosity</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Prints a summary of runtime settings and timing information to stdout.</p></li>
</ul>
</div>
</div>
<div class="section" id="ml-trilinos-amg">
<h3><a class="toc-backref" href="#id143">ML (Trilinos AMG)</a><a class="headerlink" href="#ml-trilinos-amg" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Trilinos ML smoothed aggregation multigrid.</p>
</div></blockquote>
<p>This is provided when using the <cite>“preconditioner type</cite>”=`”ml`” in the
<a class="reference internal" href="#preconditioner">Preconditioner</a> spec.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>no input spec defined</p>
</div>
<p>See also: <a class="reference external" href="https://trilinos.github.io/pdfs/mlguide5.pdf">https://trilinos.github.io/pdfs/mlguide5.pdf</a></p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;ml parameters&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;ML output&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;aggregation: damping factor&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;1.33&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;aggregation: nodes per aggregate&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;aggregation: threshold&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;aggregation: type&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;Uncoupled&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;coarse: type&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;Amesos-KLU&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;coarse: max size&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;128&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;coarse: damping factor&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;cycle applications&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;eigen-analysis: iterations&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;10&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;eigen-analysis: type&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;cg&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;max levels&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;40&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;prec type&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;MGW&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;smoother: damping factor&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;smoother: pre or post&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;both&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;smoother: sweeps&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;smoother: type&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;Gauss-Seidel&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="other-common-specs">
<h1><a class="toc-backref" href="#id144">Other Common Specs</a><a class="headerlink" href="#other-common-specs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="ioevent">
<h2><a class="toc-backref" href="#id145">IOEvent</a><a class="headerlink" href="#ioevent" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>IOEvent: base time/timestep control determing when in time to do something.</p>
</div></blockquote>
<p>The IOEvent is used for multiple objects that need to indicate simulation times or cycles on which to do something.</p>
<ul>
<li><p><cite>“cycles start period stop</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code> <strong>optional</strong></p>
<blockquote>
<div><p>The first entry is the start cycle, the second is the cycle
period, and the third is the stop cycle or -1, in which case there
is no stop cycle. A visualization dump is written at such
cycles that satisfy cycle = start + n*period, for n=0,1,2,… and
cycle &lt; stop if stop != -1.0.</p>
</div></blockquote>
</li>
<li><p><cite>“cycles start period stop 0</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code> <strong>optional</strong></p>
<blockquote>
<div><p>If multiple cycles start period stop parameters are needed, then use these
parameters.  If one with 0 is found, then one with 1 is looked for, etc,
until the Nth one is not found.</p>
</div></blockquote>
</li>
<li><p><cite>“cycles</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code>  <strong>optional</strong></p>
<blockquote>
<div><p>An array of discrete cycles that at which a visualization dump is
written.</p>
</div></blockquote>
</li>
<li><p><cite>“times start period stop</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> <strong>optional</strong></p>
<blockquote>
<div><p>The first entry is the start time, the second is the time period,
and the third is the stop time or -1, in which case there is no
stop time. A visualization dump is written at such times that
satisfy time = start + n*period, for n=0,1,2,… and time &lt; stop
if stop != -1.0.</p>
</div></blockquote>
</li>
<li><p><cite>“times start period stop units</cite>” <code class="docutils literal notranslate"><span class="pre">string</span></code> <strong>s</strong></p>
<blockquote>
<div><p>Units corresponding to this spec.  One of <cite>“s</cite>”, <cite>“d</cite>”, <cite>“yr</cite>”, or <cite>“yr 365</cite>”</p>
</div></blockquote>
</li>
<li><p><cite>“times start period stop 0</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> <strong>optional</strong></p>
<blockquote>
<div><p>If multiple start period stop parameters are needed, then use this these
parameters with N=0,1,2.  If one with 0 is found, then one with 1 is
looked for, etc, until the Nth one is not found.</p>
</div></blockquote>
</li>
<li><p><cite>“times start period stop 0 units</cite>” <code class="docutils literal notranslate"><span class="pre">string</span></code> <strong>s</strong></p>
<blockquote>
<div><p>Units corresponding to this spec.  One of <cite>“s</cite>”, <cite>“d</cite>”, <cite>“yr</cite>”, or <cite>“yr 365</cite>”
See above for continued integer listings.</p>
</div></blockquote>
</li>
<li><p><cite>“times</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> <strong>optional</strong></p>
<blockquote>
<div><p>An array of discrete times that at which a visualization dump
shall be written.</p>
</div></blockquote>
</li>
<li><p><cite>“times units</cite>” <code class="docutils literal notranslate"><span class="pre">string</span></code> <strong>s</strong></p>
<blockquote>
<div><p>Units corresponding to this spec.  One of <cite>“s</cite>”, <cite>“d</cite>”, <cite>“yr</cite>”, or <cite>“yr 365</cite>”</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="verbose-object">
<h2><a class="toc-backref" href="#id146">Verbose Object</a><a class="headerlink" href="#verbose-object" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>VerboseObject: a controller for writing log files on multiple cores with varying verbosity.</p>
</div></blockquote>
<p>This allows control of log-file verbosity for a wide variety of objects
and physics.</p>
<ul>
<li><p><cite>“verbosity level</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>GLOBAL_VERBOSITY</strong>, <cite>“low</cite>”, <cite>“medium</cite>”, <cite>“high</cite>”, <cite>“extreme</cite>”</p>
<blockquote>
<div><p>The default is set by the global verbosity spec, (fix me!)  Typically,
<cite>“low</cite>” prints out minimal information, <cite>“medium</cite>” prints out errors and
overall high level information, <cite>“high</cite>” prints out basic debugging, and
<cite>“extreme</cite>” prints out local debugging information.</p>
</div></blockquote>
</li>
</ul>
<p>Note: while there are other options, users should typically not need them.
Instead, developers can use them to control output.</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;verbose object&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;verbosity level&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;medium&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;my header&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;hide line prefix&quot;</span> <span class="na">type=</span><span class="s">&quot;bool&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;write on rank&quot;</span> <span class="na">type=</span><span class="s">&quot;int&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="debugger">
<h2><a class="toc-backref" href="#id147">Debugger</a><a class="headerlink" href="#debugger" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>A mesh and vector structure aware utility for printing info.</p>
</div></blockquote>
<p>This is a utility that makes it easier for the user to control output written
to the screen.  It allows the user to provide element IDs, and then provides
functionality for a PK to write mesh geometry information and vector values of
those elements to screen based upon verbosity levels.</p>
<p>Note, most information is only written if the owning object’s verbosity level
from the <cite>“Verbose Object</cite>” spec is set to <cite>“high</cite>” or higher.</p>
<div class="admonition-debugger-spec admonition">
<p class="admonition-title">debugger-spec</p>
<ul class="simple">
<li><p><cite>“debug cells</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code> For each global ID of a cell provided
here, controls writing of vectors inside of the using PK.</p></li>
<li><p><cite>“debug faces</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code> For each global ID of a face provided
here, writes all adjoining cell information as if each cell was included
in <cite>“debug cells</cite>”.</p></li>
</ul>
</div>
</div>
<div class="section" id="function">
<h2><a class="toc-backref" href="#id148">Function</a><a class="headerlink" href="#function" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Function: base class for all functions of space and time.</p>
</div></blockquote>
<p>Analytic, algabraic functions of space and time are used for a variety of
purposes, including boundary conditions, initial conditions, and independent
variables.</p>
<p>For initial conditions, functions are prescribed of space only, i.e.</p>
<p><span class="math notranslate nohighlight">\(u = f(x,y,z)\)</span></p>
<p>For boundary conditions and independent variables, functions are also a
function of time:</p>
<p><span class="math notranslate nohighlight">\(u = f(t,x,y,z)\)</span></p>
<p>Note, this does not follow the <cite>“typed</cite>” format for legacy reasons.</p>
<div class="admonition-function-spec admonition">
<p class="admonition-title">function-spec</p>
<p>ONE OF:</p>
<ul class="simple">
<li><p><cite>“function: constant</cite>” <code class="docutils literal notranslate"><span class="pre">[constant-function-spec]</span></code></p></li>
</ul>
<p>OR:</p>
<ul class="simple">
<li><p><cite>“function: tabular</cite>” <code class="docutils literal notranslate"><span class="pre">[tabular-function-spec]</span></code></p></li>
</ul>
<p>OR:</p>
<ul class="simple">
<li><p><cite>“function: smooth step</cite>” <code class="docutils literal notranslate"><span class="pre">[smooth-step-function-spec]</span></code></p></li>
</ul>
<p>OR:</p>
<ul class="simple">
<li><p><cite>“function: polynomial</cite>” <code class="docutils literal notranslate"><span class="pre">[polynomial-function-spec]</span></code></p></li>
</ul>
<p>OR:</p>
<ul class="simple">
<li><p><cite>“function: monomial</cite>” <code class="docutils literal notranslate"><span class="pre">[monomial-function-spec]</span></code></p></li>
</ul>
<p>OR:</p>
<ul class="simple">
<li><p><cite>“function: linear</cite>” <code class="docutils literal notranslate"><span class="pre">[linear-function-spec]</span></code></p></li>
</ul>
<p>OR:</p>
<ul class="simple">
<li><p><cite>“function: separable</cite>” <code class="docutils literal notranslate"><span class="pre">[separable-function-spec]</span></code></p></li>
</ul>
<p>OR:</p>
<ul class="simple">
<li><p><cite>“function: additive</cite>” <code class="docutils literal notranslate"><span class="pre">[additive-function-spec]</span></code></p></li>
</ul>
<p>OR:</p>
<ul class="simple">
<li><p><cite>“function: multiplicative</cite>” <code class="docutils literal notranslate"><span class="pre">[multiplicative-function-spec]</span></code></p></li>
</ul>
<p>OR:</p>
<ul class="simple">
<li><p><cite>“function: composition</cite>” <code class="docutils literal notranslate"><span class="pre">[composition-function-spec]</span></code></p></li>
</ul>
<p>OR:</p>
<ul class="simple">
<li><p><cite>“function: static head</cite>” <code class="docutils literal notranslate"><span class="pre">[static-head-function-spec]</span></code></p></li>
</ul>
<p>OR:</p>
<ul class="simple">
<li><p><cite>“function: standard math</cite>” <code class="docutils literal notranslate"><span class="pre">[standard-math-function-spec]</span></code></p></li>
</ul>
<p>OR:</p>
<ul class="simple">
<li><p><cite>“function: bilinear</cite>” <code class="docutils literal notranslate"><span class="pre">[bilinear-function-spec]</span></code></p></li>
</ul>
<p>OR:</p>
<ul class="simple">
<li><p><cite>“function: distance</cite>” <code class="docutils literal notranslate"><span class="pre">[distance-function-spec]</span></code></p></li>
</ul>
<p>END</p>
</div>
<p>It is straightforward to add new functions as needed.</p>
<div class="section" id="constant-function">
<h3><a class="toc-backref" href="#id149">Constant Function</a><a class="headerlink" href="#constant-function" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>FunctionConstant: Implements the Function interface using a constant value.</p>
</div></blockquote>
<p>Constant function is defined as <span class="math notranslate nohighlight">\(f(x) = a\)</span>, for all <span class="math notranslate nohighlight">\(x\)</span>.</p>
<ul class="simple">
<li><p><cite>“value</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> The constant to be applied.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-constant&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="tabular-function">
<h3><a class="toc-backref" href="#id150">Tabular Function</a><a class="headerlink" href="#tabular-function" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>FunctionTabular: Piecewise-defined function.</p>
</div></blockquote>
<p>A piecewise function of one variable.</p>
<p>A tabular function is tabulated on a series of intervals; given values
<span class="math notranslate nohighlight">\({{x_i}}, {{y_i}},, i=0, ... n-1\)</span> and functional forms <span class="math notranslate nohighlight">\({{f_j}},,
j=0, ... n-2\)</span> a tabular function <span class="math notranslate nohighlight">\(f(x)\)</span> is defined as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{matrix}
f(x) &amp;=&amp; y_0, &amp; x \le x_0,\\
f(x) &amp;=&amp; f_{{i-1}}(x)  &amp; x \in (x_{{i-1}}, x_i],\\
f(x) &amp;=&amp; y_{{n-1}}, &amp; x &gt; x_{{n-1}}.
\end{matrix}\end{split}\]</div>
<p>The functional forms <span class="math notranslate nohighlight">\({f_j}\)</span> may be constant, which uses the left endpoint, i.e.</p>
<p><span class="math notranslate nohighlight">\(f_i(x) = y_i\)</span>,</p>
<p>linear, i.e.</p>
<p><span class="math notranslate nohighlight">\(f_i(x) = ( y_i * (x - x_i) + y_{{i+1}} * (x_{{i+1}} - x) ) / (x_{{i+1}} - x_i)\)</span></p>
<p>or arbitrary, in which the <span class="math notranslate nohighlight">\(f_j\)</span> must be provided.</p>
<p>The <span class="math notranslate nohighlight">\(x_i\)</span> and <span class="math notranslate nohighlight">\(y_i\)</span> may be provided in one of two ways – explicitly in the input spec or from an HDF5 file.  The length of these must be equal, and the <span class="math notranslate nohighlight">\(x_i\)</span> must be monotonically increasing.  Forms, as defined on intervals, must be of length equal to the length of the <span class="math notranslate nohighlight">\(x_i\)</span> less one.</p>
<p>Explicitly specifying the data:</p>
<ul class="simple">
<li><p><cite>“x values</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> the <span class="math notranslate nohighlight">\(x_i\)</span></p></li>
<li><p><cite>“y values</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> the <span class="math notranslate nohighlight">\(y_i\)</span></p></li>
<li><p><cite>“forms</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> <strong>{linear,…}</strong> Form of the interpolant, either <cite>“constant</cite>”, <cite>“linear</cite>”, or <cite>“USER_DEFINED</cite>”</p></li>
<li><p><cite>“USER_DEFINED</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> user-provided functional forms on the interval</p></li>
<li><p><cite>“x coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>t</strong>, <cite>“x</cite>”, <cite>“y</cite>”, <cite>“z</cite>” defines which coordinate direction the <span class="math notranslate nohighlight">\(x_i\)</span> are formed, defaulting to time.</p></li>
</ul>
<p>The below example defines a function that is zero on interval <span class="math notranslate nohighlight">\((-\infty,\,0]\)</span>,
linear on interval <span class="math notranslate nohighlight">\((0,\,1]\)</span>, constant (<cite>f(x)=1</cite>) on interval <span class="math notranslate nohighlight">\((1,\,2]\)</span>,
square root of <cite>t</cite> on interval <span class="math notranslate nohighlight">\((2,\,3]\)</span>,
and constant (<cite>f(x)=2</cite>) on interval <span class="math notranslate nohighlight">\((3,\,\infty]\)</span>.</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-tabular&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;x values&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{0.0, 1.0, 2.0, 3.0}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;x coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;t&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;y values&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{0.0, 1.0, 2.0, 2.0}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;forms&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{linear, constant, USER_FUNC}&quot;</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;USER_FUNC&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-standard-math&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;operator&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;sqrt&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Loading table from file (note that <cite>“USER_DEFINED</cite>” is not an option here, but could be made so if requested):</p>
<ul class="simple">
<li><p><cite>“file</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> filename of the HDF5 data</p></li>
<li><p><cite>“x header</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> name of the dataset for the <span class="math notranslate nohighlight">\(x_i\)</span> in the file</p></li>
<li><p><cite>“y header</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> name of the dataset for the <span class="math notranslate nohighlight">\(y_i\)</span> in the file</p></li>
<li><p><cite>“forms</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> <strong>{linear,…}</strong>, Form of the interpolant, either <cite>“constant</cite>”, <cite>“linear</cite>”, or <cite>“USER_DEFINED</cite>”.</p></li>
</ul>
<p>The example below would perform linear-interpolation on the intervals provided by data within the hdf5 file <cite>“my_data.h5</cite>”.</p>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-tabular&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;file&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;my_data.h5&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;x coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;t&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;x header&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;/time&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;y header&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;/data&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="smooth-step-function">
<h3><a class="toc-backref" href="#id151">Smooth step Function</a><a class="headerlink" href="#smooth-step-function" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>FunctionSmoothStep: a smoothed discontinuity.</p>
</div></blockquote>
<p>A smooth <span class="math notranslate nohighlight">\(C^2\)</span> function <cite>f(x)</cite> on interval <span class="math notranslate nohighlight">\([x_0,\,x_1]\)</span> is
defined such that <cite>f(x) = y_0</cite> for <cite>x &lt; x0</cite>, <cite>f(x) = y_1</cite> for <cite>x &gt; x_1</cite>, and
monotonically increasing for <span class="math notranslate nohighlight">\(x \in [x_0, x_1]\)</span> through cubic
interpolation.</p>
<ul class="simple">
<li><p><cite>“x0</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> First fitting point</p></li>
<li><p><cite>“y0</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> First fitting value</p></li>
<li><p><cite>“x1</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Second fitting point</p></li>
<li><p><cite>“y1</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Second fitting value</p></li>
</ul>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-smooth-step&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;x0&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;y0&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;x1&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;y1&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;2.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="polynomial-function">
<h3><a class="toc-backref" href="#id152">Polynomial Function</a><a class="headerlink" href="#polynomial-function" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>FunctionPolynomial: a polynomial</p>
</div></blockquote>
<p>A generic polynomial function is given by the following expression:</p>
<div class="math notranslate nohighlight">
\[f(x) = \sum_{{j=0}}^n c_j (x - x_0)^{{p_j}}\]</div>
<p>where <span class="math notranslate nohighlight">\(c_j\)</span> are coefficients of monomials,
<span class="math notranslate nohighlight">\(p_j\)</span> are integer exponents, and <span class="math notranslate nohighlight">\(x_0\)</span> is the reference point.</p>
<ul class="simple">
<li><p><cite>“coefficients</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> c_j polynomial coefficients</p></li>
<li><p><cite>“exponents</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code> p_j polynomail exponents</p></li>
<li><p><cite>“reference point</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> x0 to which polynomial argument is normalized.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-polynomial&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;coefficients&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{1.0, 1.0}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;exponents&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span> <span class="na">value=</span><span class="s">&quot;{2, 4}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;reference point&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="multi-variable-linear-function">
<h3><a class="toc-backref" href="#id153">Multi-variable linear Function</a><a class="headerlink" href="#multi-variable-linear-function" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>FunctionLinear: a multivariate linear function.</p>
</div></blockquote>
<p>A multi-variable linear function is formally defined by</p>
<div class="math notranslate nohighlight">
\[f(x) = y_0 + \sum_{{j=0}}^{{n-1}} g_j (x_j - x_{{0,j}})\]</div>
<p>with the constant term “math:<cite>y_0</cite> and gradient <span class="math notranslate nohighlight">\(g_0,\, g_1\,..., g_{{n-1}}\)</span>.
If the reference point <span class="math notranslate nohighlight">\(x_0\)</span> is specified, it must have the same
number of values as the gradient.  Otherwise, it defaults to zero.
Note that one of the parameters in a multi-valued linear function can be time.</p>
<ul class="simple">
<li><p><cite>“y0</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> y_0 in f = y0 + g * (x - x0)</p></li>
<li><p><cite>“gradient</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> g in f = y0 + g * (x - x0)</p></li>
<li><p><cite>“x0</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> x0 in f = y0 + g * (x - x0)</p></li>
</ul>
<p>Conditions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-linear&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;y0&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;gradient&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{{1.0, 2.0, 3.0}}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;x0&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{{2.0, 3.0, 1.0}}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="separable-function">
<h3><a class="toc-backref" href="#id154">Separable Function</a><a class="headerlink" href="#separable-function" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>FunctionSeparable: f(x,y) = f1(x)*f2(y)</p>
</div></blockquote>
<p>A separable function is defined as the product of other functions such as</p>
<div class="math notranslate nohighlight">
\[f(x_0, x_1,...,x_{{n-1}}) = f_1(x_0)\, f_2(x_1,...,x_{{n-1}})\]</div>
<p>where <span class="math notranslate nohighlight">\(f_1\)</span> is defined by the <cite>“function1</cite>” sublist, and
<span class="math notranslate nohighlight">\(f_2\)</span> by the <cite>“function2</cite>” sublist.</p>
<ul class="simple">
<li><p><cite>“function1</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> f_1 in f(x) = f_1(x0) * f_2(x1…)</p></li>
<li><p><cite>“function2</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> f_2 in f(x) = f_1(x0) * f_2(x1…)</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-separable&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function1&quot;</span><span class="nt">&gt;</span>
    function-specification
  <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function2&quot;</span><span class="nt">&gt;</span>
    function-specification
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="additive-function">
<h3><a class="toc-backref" href="#id155">Additive Function</a><a class="headerlink" href="#additive-function" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>FunctionAdditive: f(x,y) = f1(x,y) + f2(x,y)</p>
</div></blockquote>
<p>An additive function simply adds two other function results together.</p>
<div class="math notranslate nohighlight">
\[f(x) = f_1(x) + f_2(x)\]</div>
<p>where <span class="math notranslate nohighlight">\(f_1\)</span> is defined by the <cite>“function1</cite>” sublist, and
<span class="math notranslate nohighlight">\(f_2\)</span> by the <cite>“function2</cite>” sublist.</p>
<ul class="simple">
<li><p><cite>“function1</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> f_1 in f(x) = f_1(x) + f_2(x)</p></li>
<li><p><cite>“function2</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> f_2 in f(x) = f_1(x) + f_2(x)</p></li>
</ul>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-additive&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function1&quot;</span><span class="nt">&gt;</span>
    function-specification
  <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function2&quot;</span><span class="nt">&gt;</span>
    function-specification
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="multiplicative-function">
<h3><a class="toc-backref" href="#id156">Multiplicative Function</a><a class="headerlink" href="#multiplicative-function" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>FunctionMultiplicative: f(x,y) = f1(x,y) * f2(x,y)</p>
</div></blockquote>
<p>A multiplicative function simply multiplies two other function results together.</p>
<div class="math notranslate nohighlight">
\[f(x) = f_1(x) * f_2(x)\]</div>
<p>where <span class="math notranslate nohighlight">\(f_1\)</span> is defined by the <cite>“function1</cite>” sublist, and
<span class="math notranslate nohighlight">\(f_2\)</span> by the <cite>“function2</cite>” sublist.</p>
<ul class="simple">
<li><p><cite>“function1</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> f_1 in f(x) = f_1(x) + f_2(x)</p></li>
<li><p><cite>“function2</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> f_2 in f(x) = f_1(x) + f_2(x)</p></li>
</ul>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-multiplicative&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function1&quot;</span><span class="nt">&gt;</span>
    function-specification
  <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function2&quot;</span><span class="nt">&gt;</span>
    function-specification
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="composition-function">
<h3><a class="toc-backref" href="#id157">Composition Function</a><a class="headerlink" href="#composition-function" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>FunctionComposition: f(x,y) = f1(x,y) * f2(x,y)</p>
</div></blockquote>
<p>Function composition simply applies one function to the result of another.</p>
<div class="math notranslate nohighlight">
\[f(x) = f_1( f_2(x) )\]</div>
<p>where <span class="math notranslate nohighlight">\(f_1\)</span> is defined by the <cite>“function1</cite>” sublist, and
<span class="math notranslate nohighlight">\(f_2\)</span> by the <cite>“function2</cite>” sublist.</p>
<ul class="simple">
<li><p><cite>“function1</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> f_1 in f(x) = f_1(f_2(x))</p></li>
<li><p><cite>“function2</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> f_2 in f(x) = f_1(f_2(x))</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-composition&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function1&quot;</span><span class="nt">&gt;</span>
    function-specification
  <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function2&quot;</span><span class="nt">&gt;</span>
    function-specification
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="piecewise-bilinear-function">
<h3><a class="toc-backref" href="#id158">Piecewise Bilinear Function</a><a class="headerlink" href="#piecewise-bilinear-function" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>FunctionBilinear: a piecewise bilinear function.</p>
</div></blockquote>
<p>A piecewise bilinear function extends the linear form of the tabular function to two variables.</p>
<p>Define <span class="math notranslate nohighlight">\(i(x) = i : x_i &lt; x &lt;= x_{{i+1}}\)</span> and similarly <span class="math notranslate nohighlight">\(j(y) = j : y_j &lt; y &lt;= y_{{j+1}}\)</span> for monotonically increasing <span class="math notranslate nohighlight">\(x_i\)</span> and <span class="math notranslate nohighlight">\(y_j\)</span>.</p>
<p>Given a two-dimensional array <span class="math notranslate nohighlight">\(u_{{i,j}}\)</span>, <span class="math notranslate nohighlight">\(f\)</span> is then defined by
bilinear interpolation on <span class="math notranslate nohighlight">\(u_{{i(x),j(y)}}, u_{{i(x)+1,j(y)}},
u_{{i(x),j(y)+1}}, u_{{i(x)+1,j(y)+1}}, if :math:\)</span> is in
<span class="math notranslate nohighlight">\([x_0,x_n] \times [y_0,y_m]\)</span>, linear interpolation if one of <span class="math notranslate nohighlight">\(x,y\)</span>
are out of those bounds, and constant at the corner value if both are out of
bounds.</p>
<ul class="simple">
<li><p><cite>“file</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> HDF5 filename of the data</p></li>
<li><p><cite>“row header</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> name of the row dataset, the <span class="math notranslate nohighlight">\(x_i\)</span></p></li>
<li><p><cite>“row coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> one of <cite>“t</cite>”,`”x`”,`”y`”,`”z`”</p></li>
<li><p><cite>“column header</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> name of the column dataset, the <span class="math notranslate nohighlight">\(y_i\)</span></p></li>
<li><p><cite>“column coordinate</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> one of <cite>“t</cite>”,`”x`”,`”y`”,`”z`”</p></li>
<li><p><cite>“value header</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> name of the values dataset, the <span class="math notranslate nohighlight">\(u_{{i,j}}\)</span></p></li>
</ul>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-bilinear&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;file&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;pressure.h5&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;row header&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;/time&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;row coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;t&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;column header&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;/x&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;column coordinate&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;x&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;value header&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;/pressure&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="distance-function">
<h3><a class="toc-backref" href="#id159">Distance Function</a><a class="headerlink" href="#distance-function" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>FunctionDistance: distance from a reference point.</p>
</div></blockquote>
<p>A distance function calculates distance from reference point <span class="math notranslate nohighlight">\(x_0\)</span>
using by the following expression:</p>
<div class="math notranslate nohighlight">
\[f(x) = \sqrt( \sum_{j=0}^{n} m_j (x_j - x_{0,j})^2 )\]</div>
<p>Note that the first parameter in <span class="math notranslate nohighlight">\(x\)</span> can be time.</p>
<ul class="simple">
<li><p><cite>“x0</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Point from which distance is measured.</p></li>
<li><p><cite>“metric</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> Linear scaling metric, typically all 1s.</p></li>
</ul>
<p>Here is an example of a distance function using isotropic metric:</p>
<p>Example:
.. code-block:: xml</p>
<blockquote>
<div><dl class="simple">
<dt>&lt;ParameterList name=”function-distance”&gt;</dt><dd><p>&lt;Parameter name=”x0” type=”Array(double)” value=”{1.0, 3.0, 0.0}”/&gt;
&lt;Parameter name=”metric” type=”Array(double)” value=”{1.0, 1.0, 1.0}”/&gt;</p>
</dd>
</dl>
<p>&lt;/ParameterList&gt;</p>
</div></blockquote>
</div>
<div class="section" id="monomial-function">
<h3><a class="toc-backref" href="#id160">Monomial Function</a><a class="headerlink" href="#monomial-function" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>FunctionMonomial: a multivariate monomial function.</p>
</div></blockquote>
<p>A multi-variable monomial function is given by the following expression:</p>
<div class="math notranslate nohighlight">
\[f(x) = c \prod_{j=0}^{n} (x_j - x_{0,j})^{p_j}\]</div>
<p>with the constant factor <span class="math notranslate nohighlight">\(c\)</span>, the reference point <span class="math notranslate nohighlight">\(x_0\)</span>, and
integer exponents <span class="math notranslate nohighlight">\(p_j\)</span>.
Note that the first parameter in <span class="math notranslate nohighlight">\(x\)</span> can be time.</p>
<ul class="simple">
<li><p><cite>“c</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> c in f = c prod_{j=0}^{n} (x_j - x_{0,j})^{p_j}</p></li>
<li><p><cite>“x0</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> x0 in f = c prod_{j=0}^{n} (x_j - x_{0,j})^{p_j}</p></li>
<li><p><cite>“exponents</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(int)]</span></code> p in f = c prod_{j=0}^{n} (x_j - x_{0,j})^{p_j}</p></li>
</ul>
<p>Conditions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">exponents</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is an example of monomial of degree 6 in three variables:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-monomial&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;c&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;x0&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(double)&quot;</span> <span class="na">value=</span><span class="s">&quot;{1.0, 3.0, 0.0}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;exponents&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span> <span class="na">value=</span><span class="s">&quot;{2, 3, 1}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="standard-math-function">
<h3><a class="toc-backref" href="#id161">Standard Math Function</a><a class="headerlink" href="#standard-math-function" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>FunctionStandardMath: provides access to many common mathematical functions.</p>
</div></blockquote>
<p>These functions allow to set up non-trivial time-dependent boundary conditions
which increases a set of analytic solutions that can be used in convergence
analysis tests.</p>
<div class="math notranslate nohighlight">
\[f(x) = A * operator( p * (x - s) )\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[f(x) = A * operator(x-s, p)\]</div>
<p>Note that these operate only on the first coordinate, which is often time.
Function composition can be used to apply these to other coordinates (or
better yet a dimension could/should be added upon request).</p>
<ul class="simple">
<li><p><cite>“operator</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> specifies the name of a standard mathematical function.
Available options are <cite>“cos</cite>”, <cite>“sin</cite>”, <cite>“tan</cite>”, <cite>“acos</cite>”, <cite>“asin</cite>”, <cite>“atan</cite>”,
<cite>“cosh</cite>”, <cite>“sinh</cite>”, <cite>“tanh</cite>”, <cite>“exp</cite>”, <cite>“log</cite>”, <cite>“log10</cite>”, <cite>“sqrt</cite>”, <cite>“ceil</cite>”,
<cite>“fabs</cite>”, <cite>“floor</cite>”, <cite>“mod</cite>”, and <cite>“pow</cite>”.</p></li>
<li><p><cite>“amplitude</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> specifies a multiplication factor <cite>a</cite> in formula <cite>a f(x)</cite>.
The multiplication factor is ignored by function <cite>mod</cite>. Default value is 1.</p></li>
<li><p><cite>“parameter</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> specifies additional parameter <cite>p</cite> for
math functions with two arguments. These functions are <cite>“a pow(x[0], p)</cite>”
and <cite>“a mod(x[0], p)</cite>”.  Alternative, scales the argument before
application, for use in changing the period of trig functions.</p></li>
<li><p><cite>“shift</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> specifies a shift of the function argument. Default is 0.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;function-standard-math&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;operator&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;sqrt&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;amplitude&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;1e-7&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;shift&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span> <span class="na">value=</span><span class="s">&quot;0.1&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>This example defines function <cite>1e-7 sqrt(t-0.1)</cite>.</p>
</div>
</div>
<div class="section" id="operator">
<h2><a class="toc-backref" href="#id162">Operator</a><a class="headerlink" href="#operator" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Operator represents a linear map, and typically encapsulates a discretization.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">Operator</span></code> represents a map from linear space X to linear space Y.  Typically,
this map is a linear map, and encapsulates much of the discretization involved
in moving from continuous to discrete equations. The spaces X and Y are described
by CompositeVectors (CV). A few maps X-&gt;Y are supported.</p>
<p>An <code class="docutils literal notranslate"><span class="pre">Operator</span></code> provides an interface for applying both the forward and inverse
linear map (assuming the map is invertible).</p>
<p>Typically the <code class="docutils literal notranslate"><span class="pre">Operator</span></code> is never seen by the user; instead the user provides
input information for helper classes based on the continuous mathematical
operator and the desired discretization.  These helpers build the needed
<code class="docutils literal notranslate"><span class="pre">Operator</span></code>, which may include information from multiple helpers (i.e. in the
case of Jacobian Operators for a PDE).</p>
<p>However, one option may be provided by the user, which is related to dealing
with nearly singular operators:</p>
<ul class="simple">
<li><p><cite>“diagonal shift</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.0</strong> Adds a scalar shift to the diagonal
of the <code class="docutils literal notranslate"><span class="pre">Operator</span></code>, which can be useful if the <code class="docutils literal notranslate"><span class="pre">Operator</span></code> is singular or
near-singular.</p></li>
</ul>
<div class="section" id="pde-accumulation">
<h3><a class="toc-backref" href="#id163">PDE_Accumulation</a><a class="headerlink" href="#pde-accumulation" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">PDE_Accumulation</span></code> assembles the discrete form of <span class="math notranslate nohighlight">\(\frac{\partial A}{\partial t}\)</span>.</p>
<p>This class is usually used as part of a preconditioner, providing the linearization:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial}{\partial A} \left[ \frac{\partial A}{\partial t} \right]_{A_0} i
= \frac{|\Omega_E|}{\Delta t}\]</div>
<p>for a grid element <span class="math notranslate nohighlight">\(\Omega_E\)</span>.</p>
<p>No options are available here.</p>
</div>
<div class="section" id="pde-diffusion">
<h3><a class="toc-backref" href="#id164">PDE_Diffusion</a><a class="headerlink" href="#pde-diffusion" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">PDE_Diffusion</span></code> forms local <code class="docutils literal notranslate"><span class="pre">Op</span></code> s and global <code class="docutils literal notranslate"><span class="pre">Operator</span></code> s for elliptic equations:</p>
<div class="math notranslate nohighlight">
\[\nabla \cdot k \nabla u\]</div>
<p>with a variety of discretizations. Note also, for reasons that are one part historical
and potentially not that valid, this also supports and implementation with an advective
source, i.e.:</p>
<div class="math notranslate nohighlight">
\[\nabla \cdot k (\nabla u + \hat{z})\]</div>
<p>for gravitational terms in Richards equations.</p>
<p>The input spec for a diffusion operator consists of:</p>
<ul class="simple">
<li><p><cite>“discretization primary</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> See below for supported options.</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p><cite>“fv: default</cite>” the standard two-point flux finite volume discretization</p></li>
<li><p><cite>“nlfv: default</cite>” the nonlinear finite volume method of ???</p></li>
<li><p>MFD methods, including:</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p><cite>“mfd: default</cite>”</p></li>
<li><p><cite>“mfd: monotone for hex</cite>”</p></li>
<li><p><cite>“mfd: optimized for monotonicity</cite>”</p></li>
<li><p><cite>“mfd: two-point flux approximation</cite>”</p></li>
<li><p><cite>“mfd: optimized for sparsity</cite>”</p></li>
<li><p><cite>“mfd: support operator</cite>”</p></li>
</ul>
</div></blockquote>
<p>Note that the most commonly used are <cite>“fv: default</cite>” for simple test
problems (this method is not particularly accurate for distorted
meshes), <cite>“mfd: optimized for sparsity</cite>” for most real problems on
unstructured meshes, and <cite>“mfd: optimized for monotonicity</cite>” for
orthogonal meshes with diagonal tensor/scalar coefficients.</p>
</div></blockquote>
<ul class="simple">
<li><p><cite>“gravity</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> specifies if the gravitational flow term is included</p></li>
<li><p><cite>“Newton correction</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> specifies a model for non-physical terms
that must be added to the matrix. These terms represent Jacobian and are needed
for the preconditioner. Available options are <cite>“true Jacobian</cite>” and <cite>“approximate Jacobian</cite>”.
The FV scheme accepts only the first options. The other schemes accept only the second option.</p></li>
<li><p><cite>“scaled constraint equation</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> rescales flux continuity equations
on mesh faces.  These equations are formed without the nonlinear
coefficient. This option allows us to treat the case of zero nonlinear
coefficient, which otherwise generates zero rows in the operator, which is
then singular.  At moment this feature does not work with non-zero gravity
term.</p></li>
<li><p><cite>“constraint equation scaling cutoff</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> specifies the cutoff value for
applying rescaling strategy described above.</p></li>
</ul>
<blockquote>
<div><p>Diffusion generates local Ops and global Operators for an elliptic operator.</p>
</div></blockquote>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;OPERATOR_NAME&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;discretization primary&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;mfd: optimized for monotonicity&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;discretization secondary&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;mfd: two-point flux approximation&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;schema&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{face, cell}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;preconditioner schema&quot;</span> <span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span> <span class="na">value=</span><span class="s">&quot;{face}&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;gravity&quot;</span> <span class="na">type=</span><span class="s">&quot;bool&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;gravity term discretization&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;hydraulic head&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;nonlinear coefficient&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;upwind: face&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;Newton correction&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="na">value=</span><span class="s">&quot;true Jacobian&quot;</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;consistent faces&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;linear solver&quot;</span><span class="nt">&gt;</span>
      ...
    <span class="nt">&lt;/ParameterList&gt;</span>
    <span class="nt">&lt;ParameterList</span> <span class="na">name=</span><span class="s">&quot;preconditioner&quot;</span><span class="nt">&gt;</span>
      ...
    <span class="nt">&lt;/ParameterList&gt;</span>
  <span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>Additional options available only for the MFD family of discretizations include:</p>
<ul class="simple">
<li><p><cite>“nonlinear coefficient</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> specifies a method for treating nonlinear
diffusion coefficient, if any. Available options are <cite>“none</cite>”, <cite>“upwind:
face</cite>”, <cite>“divk: cell-face</cite>” (default), <cite>“divk: face</cite>”, <cite>“standard: cell</cite>”,
<cite>“divk: cell-face-twin</cite>” and <cite>“divk: cell-grad-face-twin</cite>”.  Symmetry
preserving methods are the divk-family of methods and the classical
cell-centered method (<cite>“standard: cell</cite>”). The first part of the name
indicates the base scheme.  The second part (after the semi-column)
indicates required components of the composite vector that must be provided
by a physical PK.</p></li>
<li><p><cite>“discretization secondary</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> specifies the most robust
discretization method that is used when the primary selection fails to
satisfy all a priori conditions.  This is typically <cite>“mfd: default</cite>”, and is
used only when an MFD <cite>“discretization primary</cite>” is used.</p></li>
<li><p><cite>“schema</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> defines the operator stencil. It is a collection of
geometric objects.  Typically this is set by the implementation and is not provided.</p></li>
<li><p><cite>“preconditioner schema</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> <strong>{face,cell}</strong> Defines the
preconditioner stencil.  It is needed only when the default assembling
procedure is not desirable. If skipped, the <cite>“schema</cite>” is used instead.
In addition to the default, <strong>{face}</strong> may be used, which forms the Schur
complement.</p></li>
<li><p><cite>“consistent faces</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> may contain a <cite>“preconditioner</cite>” and
<cite>“linear operator</cite>” list (see sections <a class="reference internal" href="#preconditioners">Preconditioners</a> and <a class="reference internal" href="#linearsolvers">LinearSolvers</a>
respectively).  If these lists are provided, and the <cite>“discretization
primary</cite>” is of type <cite>“mfd: *</cite>”, then the diffusion method
UpdateConsistentFaces() can be used.  This method, given a set of cell
values, determines the faces constraints that satisfy the constraint
equation in MFD by assembling and inverting the face-only system.  This is
not currently used by any Amanzi PKs.</p></li>
<li><p><cite>“diffusion tensor</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> allows us to solve problems with symmetric and
non-symmetric (but positive definite) tensors. Available options are <em>symmetric</em>
(default) and <em>nonsymmetric</em>.</p></li>
</ul>
<p>Additional options for MFD with the gravity term include:</p>
<ul class="simple">
<li><p><cite>“gravity term discretization</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> selects a model for discretizing the
gravity term. Available options are <cite>“hydraulic head</cite>” (default) and <cite>“finite volume</cite>”.
The first option starts with equation for the shifted solution, i.e. the hydraulic
head, and derives gravity discretization by the reserve shifting.
The second option is based on the divergence formula.</p></li>
</ul>
</div>
<div class="section" id="pde-advection">
<h3><a class="toc-backref" href="#id165">PDE_Advection</a><a class="headerlink" href="#pde-advection" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">PDE_AdvectionUpwind</span></code> assembles the discrete form of:</p>
<div class="math notranslate nohighlight">
\[\nabla \cdot (q C)\]</div>
<p>which advects quantity <span class="math notranslate nohighlight">\(C\)</span> with fluxes <span class="math notranslate nohighlight">\(q\)</span>.</p>
<p>This is a simple, first-order donor-upwind scheme, and is recommended
for use in diffusion-dominated advection-diffusion equations.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, jointly shared by contributor institutions

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>