

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Nonlinear Solver &#8212; Amanzi-ATS</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/custom_theme.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'input_spec/math/nonlinear_solvers';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.3';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://raw.githubusercontent.com/amanzi/ats/master/docs/documentation/source/_static/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'v1.5';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <script src="https://cdn.datatables.net/2.0.8/js/dataTables.js"></script>
    <script src="../../_static/main.js"></script>
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Linear Solvers" href="linear_solvers.html" />
    <link rel="prev" title="Time Integrators" href="time_integrators.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo_full.png" class="logo__image only-light" alt="Amanzi-ATS documentation -- Home"/>
    <script>document.write(`<img src="../../_static/logo_full.png" class="logo__image only-dark" alt="Amanzi-ATS documentation -- Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../../demos.html">
    ATS Demo Problems
  </a>
</li>


<li class="nav-item pst-header-nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    ATS Input Specification
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../../demos.html">
    ATS Demo Problems
  </a>
</li>


<li class="nav-item pst-header-nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    ATS Input Specification
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><!-- This will display the version of the docs -->
Version 1.5</div>
        <div class="sidebar-primary-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">About the Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main.html">Main</a></li>

<li class="toctree-l1"><a class="reference internal" href="../mesh.html">Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../region.html">Region</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../io/index.html">IO</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../io/ioevent.html">IOEvent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/visualization.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/observations.html">Observations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/checkpoint.html">Checkpoint</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../process_kernels/index.html">Process Kernels</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../process_kernels/base.html">Base PKs</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../process_kernels/physical/index.html">Physical PKs</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../process_kernels/physical/flow.html">Flow PKs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process_kernels/physical/transport.html">Transport PK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process_kernels/physical/energy.html">Energy PKs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process_kernels/physical/seb.html">Surface Energy Balance PKs</a></li>


</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../process_kernels/mpcs/index.html">MPC</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../process_kernels/mpcs/base.html">Base MPCs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process_kernels/mpcs/physical.html">Physical MPCs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process_kernels/mpcs/globalization.html">Globalization Delegates</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../state/index.html">State</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../state/primary.html">Primary Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/independent.html">Independent Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/secondary.html">Secondary Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/conserved.html">Conserved quantities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/subsurface_flow.html">Subsurface flow evaluators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/surface_flow.html">Surface flow evaluators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/thermo.html">Thermodynamic evaluators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/eos.html">Equations of State</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/seb.html">Surface energy balance evaluators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/snow.html">Snow evaluators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/canopy.html">Canopy evaluators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/bgc.html">Carbon and Biogeochemistry Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/multiscale.html">Multiscale Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/geometric.html">Geometric evaluators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/generic.html">Generic evaluators</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Time integrators, solvers, and other mathematical specs</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="time_integrators.html">Time Integrators</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Nonlinear Solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="linear_solvers.html">Linear Solvers</a></li>
<li class="toctree-l2"><a class="reference internal" href="preconditioners.html">Preconditioners</a></li>
<li class="toctree-l2"><a class="reference internal" href="operators.html">Operators</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../common.html">Shared Specs</a></li>
</ul>
</div>
</nav></div>
        <div class="sidebar-primary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solver-newton-and-inexact-newton">Solver: Newton and Inexact Newton</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solver-jacobian-free-newton-krylov">Solver: Jacobian-Free Newton Krylov</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solver-newton-with-line-search">Solver: Newton with Line Search</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solver-nonlinear-continuation">Solver: Nonlinear Continuation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solver-nonlinear-krylov-acceleration">Solver: Nonlinear Krylov Acceleration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solver-anderson-acceleration">Solver: Anderson Acceleration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solver-nka-with-line-search">Solver: NKA with Line Search</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solver-nka-with-line-search-ats">Solver: NKA with Line Search, ATS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solver-nka-with-backtracking-ats">Solver: NKA with backtracking, ATS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solver-nox">Solver: NOX</a></li>
</ul>
  </nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">ATS Input Specification</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Time integrators, solvers, and other mathematical specs</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Nonlinear Solver</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="nonlinear-solver">
<h1>Nonlinear Solver<a class="headerlink" href="#nonlinear-solver" title="Permalink to this heading">#</a></h1>
<blockquote id="solver">
<div><p>A factory for creating nonlinear solvers.</p>
</div></blockquote>
<p>Nonlinear solvers are used within implicit time integration schemes to drive
the residual to zero and thereby solve for the primary variable at the new
time.</p>
<div class="admonition-solver-typed-spec admonition" id="solver-typed-spec">
<p class="admonition-title">solver-typed-spec</p>
<ul class="simple">
<li><p><cite>“solver type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> Type of the solver.  One of:</p>
<ul>
<li><p><cite>“Newton</cite>” See <a class="reference internal" href="#solver-newton-and-inexact-newton">Solver: Newton and Inexact Newton</a></p></li>
<li><p><cite>“JFNK</cite>” See <a class="reference internal" href="#solver-jacobian-free-newton-krylov">Solver: Jacobian-Free Newton Krylov</a></p></li>
<li><p><cite>“line search</cite>” See <a class="reference internal" href="#solver-newton-with-line-search">Solver: Newton with Line Search</a></p></li>
<li><p><cite>“continuation</cite>” See <a class="reference internal" href="#solver-nonlinear-continuation">Solver: Nonlinear Continuation</a></p></li>
<li><p><cite>“nka</cite>” See <a class="reference internal" href="#solver-nonlinear-krylov-acceleration">Solver: Nonlinear Krylov Acceleration</a></p></li>
<li><p><cite>“aa</cite>” See <a class="reference internal" href="#solver-anderson-acceleration">Solver: Anderson Acceleration</a></p></li>
<li><p><cite>“nka line search</cite>” See <cite>Solver: NKA with Line Search</cite>”</p></li>
<li><p><cite>“nka_ls_ats</cite>” See <a class="reference internal" href="#solver-nka-with-line-search-ats">Solver: NKA with Line Search, ATS</a></p></li>
<li><p><cite>“nka_bt_ats</cite>” See <a class="reference internal" href="#solver-nka-with-backtracking-ats">Solver: NKA with backtracking, ATS</a></p></li>
<li><p><cite>“nox</cite>” See <a class="reference internal" href="#solver-nox">Solver: NOX</a></p></li>
</ul>
</li>
<li><p><cite>“_solver_type_ parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[_solver_type_-spec]</span></code> A sublist containing
parameters specific to the type.</p></li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><cite>“JFNK</cite>”, <cite>“line search</cite>”, and <cite>“continuation</cite>” methods have not been
beaten on as much as other methods.  <cite>“nka_ls_ats</cite>” is somewhat deprecated
and probably shouldn’t be used.  Prefer <cite>“nka</cite>” for simple problems,
<cite>“nka_bt_ats</cite>” for freeze-thaw problems or other problems with strong
nonlinearities, and <cite>“Newton</cite>” when you have a good Jacobian.  While
<cite>“nox</cite>” hasn’t been used extensively, it may be quite useful.</p>
</div>
<section id="solver-newton-and-inexact-newton">
<h2>Solver: Newton and Inexact Newton<a class="headerlink" href="#solver-newton-and-inexact-newton" title="Permalink to this heading">#</a></h2>
<blockquote>
<div><p>Straightforward Newton/Inexact Newton solver.</p>
</div></blockquote>
<p>The classical Newton method works well for cases where Jacobian is available
and corresponds to a stable (e.g. upwind) discretization.  The inexact Newton
methods work for cases where the discrete Jacobian is either not available, or
not stable, or computationally expensive. The discrete Jacobian is replaced by
a stable approximation of the continuum Jacobian. The choice between exact and
inexact is not made by the Solver, but instead by the PK.  Both use the
ApplyPreconditioner() method – if this applies the true Jacobian, then the
method is Newton.  If it applies an appoximation, it is inexact Newton.</p>
<div class="admonition-solver-newton-spec admonition" id="solver-newton-spec">
<p class="admonition-title">solver-newton-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“monitor</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>monitor update</strong> specifies control of the
nonlinear residual. The available options are <cite>“monitor update</cite>” and
<cite>“monitor residual</cite>”.</p></li>
<li><p><cite>“limit iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>50</strong> defines the maximum allowed number
of iterations.</p></li>
<li><p><cite>“diverged tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> defines the error level
indicating divergence of the solver. The error is calculated by a PK.</p></li>
<li><p><cite>“max du growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e5</strong> allows the solver to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment changes drastically on two consecutive iterations,
the solver is terminated.</p></li>
<li><p><cite>“max error growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e5</strong> defines another way to
identify divergence pattern on earlier iterations. If the PK-specific
error changes drastically on two consecutive iterations, the solver is
terminated.</p></li>
<li><p><cite>“max divergent iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>3</strong> defines another way to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment grows on too many consecutive iterations, the
solver is terminated.</p></li>
<li><p><cite>“make one iteration</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> require at least one iteration
to be performed before declaring success. This options makes any effect
only when <cite>“monitor residual</cite>” is choose.</p></li>
<li><p><cite>“modify correction</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> allows a PK to modify the
solution increment. One example is a physics-based clipping of extreme
solution values.</p></li>
<li><p><cite>“stagnation iteration check</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>8</strong> determines the number of
iterations before the stagnation check is turned on. The stagnation
happens when the current l2-error exceeds the initial l2-error.</p></li>
</ul>
</div>
</section>
<section id="solver-jacobian-free-newton-krylov">
<h2>Solver: Jacobian-Free Newton Krylov<a class="headerlink" href="#solver-jacobian-free-newton-krylov" title="Permalink to this heading">#</a></h2>
<blockquote>
<div><p>Decorator for using a Solver with JFNK as the preconditioner.</p>
</div></blockquote>
<p>Jacobian-Free Newton Krylov uses a finite difference scheme to approximate the
action of the Jacobian matrix, then uses a Krylov method (which only needs the
action of the Jacobian and not the Jacobian itself) to calculate the action of
the inverse of the Jacobian, thereby providing a Newton-like update.  As the
linear Krylov scheme converges to the inverse action, the nonlinear solution
converges to the same solution as a true Newton method.</p>
<p>This implementation simply replaces a SolverFnBase’s ApplyPreconditioner() with
a new ApplyPreconditioner() which uses the Krylov method with the action of the
forward operator to (hopefully) improve, relative to the supplied approximate
inverse, the estimate of the inverse.</p>
<div class="admonition-solver-jfnk-spec admonition" id="solver-jfnk-spec">
<p class="admonition-title">solver-jfnk-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear solver</cite>” <code class="docutils literal notranslate"><span class="pre">[solver-typed-spec]</span></code> The outer nonlinear solver to use.</p></li>
<li><p><cite>“inverse</cite>” <code class="docutils literal notranslate"><span class="pre">[inverse-typed-spec]</span></code> The Krylov method to use.</p></li>
<li><p><cite>“JF matrix parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[jf-matrix-spec]</span></code> See <a class="reference internal" href="#jf-matrix-spec">jf-matrix-spec</a></p></li>
</ul>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;solver type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;JFNK&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;JFNK parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;typical solution value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;JF matrix parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;finite difference epsilon&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0e-8&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;method for epsilon&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Knoll-Keyes L2&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nonlinear solver&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nonlinear tolerance&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0e-05&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;diverged tolerance&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0e+10&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;limit iterations&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;20&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;max divergent iterations&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;linear operator&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;iterative method&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;gmres&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gmres parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span>...
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>The Jacobian-Free Matrix operator, which is used to estimate the action of the
Jacobian.</p>
<p>A variety of methods are available for choosing the epsilon used to approximate
the action of the Jacobian.  They are documented in Knoll &amp; Keyes 2004 paper.</p>
<p>..todo:: Document these</p>
<div class="admonition-jf-matrix-spec admonition" id="jf-matrix-spec">
<p class="admonition-title">jf-matrix-spec</p>
<ul class="simple">
<li><p><cite>“typical solution value</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>100</strong> Used in relative action
approximations. OPTION NOT IMPLEMENTED</p></li>
<li><p><cite>“finite difference epsilon</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-8</strong> defines the base finite
difference epsilon.</p></li>
<li><p><cite>“method for epsilon</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> defines a method for calculating finite
difference epsilon. Available option is “Knoll-Keyes”, “Knoll-Keyes L2”,
“Brown-Saad”.  See Knoll</p></li>
</ul>
</div>
</section>
<section id="solver-newton-with-line-search">
<h2>Solver: Newton with Line Search<a class="headerlink" href="#solver-newton-with-line-search" title="Permalink to this heading">#</a></h2>
<blockquote>
<div><p>Line search on the provided correction as a solver.</p>
</div></blockquote>
<p>Line Search accepts a correction from the Jacobian, then uses a
process to attempt to minimize or at least ensure a reduction in the residual
while searching <em>in that direction</em>, but not necessarily with the same
magnitude, as the provided correction.  The scalar multiple of the search
direction is given by <span class="math notranslate nohighlight">\(\alpha\)</span>.</p>
<p>This globalization recognizes that a true inverse Jacobian is a local
measurement of the steepest descent direction, and so while the direction is
guaranteed to be the direction which best reduces the residual, it may not
provide the correct magnitude.</p>
<p>The algorithm is a reimplementation based on PETSc SNES type BT, which in turn
is from Numerical Methods for Unconstrained Optimization and Nonlinear
Equations by Dennis &amp; Schnabel, pg 325.</p>
<p>Note, this always monitors the residual.</p>
<div class="admonition-solver-line-search-spec admonition" id="solver-line-search-spec">
<p class="admonition-title">solver-line-search-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“limit iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>50</strong> defines the maximum allowed number
of iterations.</p></li>
<li><p><cite>“diverged tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> defines the error level
indicating divergence of the solver. The error is calculated by a PK.
Set to a negative value to ignore this check.</p></li>
<li><p><cite>“max error growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e5</strong> defines another way to
identify divergence pattern on earlier iterations. If the PK-specific
error changes drastically on two consecutive iterations, the solver is
terminated.</p></li>
<li><p><cite>“modify correction</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> allows a PK to modify the
solution increment. One example is a physics-based clipping of extreme
solution values.</p></li>
<li><p><cite>“accuracy of line search minimum [bits]</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong></p></li>
<li><p><cite>“min valid alpha</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0</strong></p></li>
<li><p><cite>“max valid alpha</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>10.</strong></p></li>
<li><p><cite>“max line search iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong></p></li>
</ul>
</div>
</section>
<section id="solver-nonlinear-continuation">
<h2>Solver: Nonlinear Continuation<a class="headerlink" href="#solver-nonlinear-continuation" title="Permalink to this heading">#</a></h2>
<blockquote>
<div><p>A very simple nonlinear continuation method.</p>
</div></blockquote>
<p>Continuation methods are useful when the nonlinearity can be controlled by a
single simple parameter.  In this method, the nonlinear problem is solved with
a less-nonlinear value of the parameter, and the solution of that is used as
the initial guess to solve a harder problem.  As each successive problem is
solved, the continuation parameter is changed closer and closer to the true
value.</p>
<p>Few if any PKs support this method currently – it requires the PK to provide more
interface about how to update the continuation parameter.</p>
<div class="admonition-solver-continuation-spec admonition" id="solver-continuation-spec">
<p class="admonition-title">solver-continuation-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“number of continuation steps</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>5</strong> How many steps to take
from initial parameter to final parameter.</p></li>
<li><p><cite>“inner solver</cite>” <code class="docutils literal notranslate"><span class="pre">[solver-typed-spec]</span></code> A <a class="reference internal" href="#solver">Solver</a>, used at each step.</p></li>
</ul>
</div>
</section>
<section id="solver-nonlinear-krylov-acceleration">
<h2>Solver: Nonlinear Krylov Acceleration<a class="headerlink" href="#solver-nonlinear-krylov-acceleration" title="Permalink to this heading">#</a></h2>
<blockquote>
<div><p>Nonlinear Krylov Acceleration as a nonlinear solver.</p>
</div></blockquote>
<p>Uses the Nonlinear Krylov acceleration method of Carlson and Miller to do
effectively a multivariant secant method, accelerating the solution of a
nonlinear solve.  This method can be significantly faster than Newton,
especially with an approximate Jacobian.</p>
<blockquote>
<div><p>Calef et al. “Nonlinear Krylov acceleration applied to a discrete ordinates
formulation of the k-eigenvalue problem.” JCP 238 (2013): 188-209.</p>
<p>N. N. Carlson, K. Miller, Design and application of a gradient-weighted
moving finite element code II: In two dimensions, SIAM J. Sci.  Comput. 19
(3) (1998) 766–798.</p>
</div></blockquote>
<div class="admonition-solver-nka-spec admonition" id="solver-nka-spec">
<p class="admonition-title">solver-nka-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> Defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“monitor</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>monitor update</strong> Specifies control of the
nonlinear residual. The available options are <cite>“monitor update</cite>”,
<cite>“monitor residual</cite>”, <cite>“monitor preconditioned residual</cite>”, <cite>“monitor l2
residual</cite>”, and <cite>“monitor preconditioned l2 residual</cite>”.</p></li>
<li><p><cite>“limit iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>20</strong> Defines the maximum allowed number
of iterations.</p></li>
<li><p><cite>“diverged tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> Defines the error level
indicating divergence of the solver. The error is calculated by a PK.
Set to a negative value to ignore this check.</p></li>
<li><p><cite>“diverged l2 tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> Defines another way to
identify divergence of the solver. If the relative l2 (little l) norm of
the solution increment is above this value, the solver is terminated.
Set to a negative value to ignore this check.</p></li>
<li><p><cite>“diverged pc tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e10</strong> Defines another way to
identify divergence of the solver. If the relative maximum norm of the
solution increment (with respect to the initial increment) is above this
value, the solver is terminated.
Set to a negative value to ignore this check.</p></li>
<li><p><cite>“diverged residual tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e10</strong> Defines another way
to identify divergence of the solver. If the relative l2 norm of the
residual (with respect to the initial residual) is above this value, the
solver is terminated.  Set to a negative value to ignore this check.</p></li>
<li><p><cite>“max du growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e5</strong> Allows the solver to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment changes drastically on two consecutive iterations,
the solver is terminated.</p></li>
<li><p><cite>“max error growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e5</strong> Defines another way to
identify divergence pattern on earlier iterations. If the PK-specific
error changes drastically on two consecutive iterations, the solver is
terminated.</p></li>
<li><p><cite>“max divergent iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>3</strong> Defines another way to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment grows on too many consecutive iterations, the
solver is terminated.</p></li>
<li><p><cite>“make one iteration</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> require at least one iteration
to be performed before declaring success. This options makes any effect
only when <cite>“monitor residual</cite>” is choose.</p></li>
<li><p><cite>“modify correction</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Allows a PK to modify the
solution increment. One example is a physics-based clipping of extreme
solution values.</p></li>
<li><p><cite>“lag iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Delays the NKA acceleration, but
updates the Krylov space.</p></li>
<li><p><cite>“max nka vectors</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong> Defines the maximum number of
consecutive vectors used for a local space.</p></li>
<li><p><cite>“nka vector tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.05</strong> Defines the minimum
allowed orthogonality between vectors in the local space. If a new vector
does not satisfy this requirement, the space is modified.</p></li>
</ul>
</div>
</section>
<section id="solver-anderson-acceleration">
<h2>Solver: Anderson Acceleration<a class="headerlink" href="#solver-anderson-acceleration" title="Permalink to this heading">#</a></h2>
<blockquote>
<div><p>Anderson acceleration as a nonlinear solver.</p>
</div></blockquote>
<p>This is a variation of the GMRES solver for nonlinear problems.</p>
<div class="admonition-solver-aa-spec admonition" id="solver-aa-spec">
<p class="admonition-title">solver-aa-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> Defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“limit iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>20</strong> Defines the maximum allowed number
of iterations.</p></li>
<li><p><cite>“diverged tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> Defines the error level
indicating divergence of the solver. The error is calculated by a PK.
Set to a negative value to ignore this check.</p></li>
<li><p><cite>“diverged l2 tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> Defines another way to
identify divergence of the solver. If the relative L2 norm of the
solution increment is above this value, the solver is terminated.
Set to a negative value to ignore this check.</p></li>
<li><p><cite>“max du growth factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e5</strong> Allows the solver to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment changes drastically on two consecutive iterations,
the solver is terminated.</p></li>
<li><p><cite>“max divergent iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>3</strong> Defines another way to
identify divergence pattern on earlier iterations. If the maximum norm of
the solution increment grows on too many consecutive iterations, the
solver is terminated.</p></li>
<li><p><cite>“max aa vectors</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong> Defines the maximum number of
consecutive vectors used for a local space.</p></li>
<li><p><cite>“modify correction</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Allows a PK to modify the
solution increment. One example is a physics-based clipping of extreme
solution values.</p></li>
<li><p><cite>“relaxation parameter</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1</strong> Damping factor for increment.</p></li>
</ul>
</div>
</section>
<section id="solver-nka-with-line-search">
<h2>Solver: NKA with Line Search<a class="headerlink" href="#solver-nka-with-line-search" title="Permalink to this heading">#</a></h2>
<blockquote>
<div><p>NKA nonlinear solver with a line-search based on a Brendt minimization algorithm.</p>
</div></blockquote>
<p>Does NKA, then checks if that correction has reduced the residual by at least a
tolerance.  If not, this uses a Brendt minimization algorithm to try and find
an <span class="math notranslate nohighlight">\(\alpha\)</span> that minimizes the reduction in the residual.</p>
<p>Note, this always monitors the residual.</p>
<span class="target" id="solver-nka-ls-spec"></span></section>
<section id="solver-nka-with-line-search-ats">
<h2>Solver: NKA with Line Search, ATS<a class="headerlink" href="#solver-nka-with-line-search-ats" title="Permalink to this heading">#</a></h2>
</section>
<section id="solver-nka-with-backtracking-ats">
<h2>Solver: NKA with backtracking, ATS<a class="headerlink" href="#solver-nka-with-backtracking-ats" title="Permalink to this heading">#</a></h2>
<blockquote>
<div><p>Nonlinear solve using NKA with a heuristic based backtracking.</p>
</div></blockquote>
<p>Whereas line search uses a formal minimization method, backtracking simply uses
a heuristic multiplier on <span class="math notranslate nohighlight">\(\alpha\)</span> to find a correction that sufficiently
reduces the residual.  This can be significantly faster than the full
minimization problem, and finding the true minimum may not be as important as
simply doing better and going on to the next nonlinear iteration.</p>
<p>This is the workhorse for hard ATS problems, as it is usually rather efficient,
even in problems where the linear solve results in a correction that is way too
large (e.g. for steep nonlinearities such as phase change).</p>
<p>Note this always monitors the residual, and the correction is always modified.</p>
<div class="admonition-solver-nka-bt-ats-spec admonition" id="solver-nka-bt-ats-spec">
<p class="admonition-title">solver-nka-bt-ats-spec</p>
<ul class="simple">
<li><p><cite>“nonlinear tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-6</strong> Defines the required error
tolerance. The error is calculated by a PK.</p></li>
<li><p><cite>“limit iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>20</strong> Defines the maximum allowed number
of iterations.</p></li>
<li><p><cite>“diverged tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e10</strong> Defines the error level
indicating divergence of the solver. The error is calculated by a PK.
Set to a negative value to ignore this check.</p></li>
<li><p><cite>“nka lag iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Delays the NKA acceleration, but
updates the Krylov space.</p></li>
<li><p><cite>“max nka vectors</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong> Defines the maximum number of
consecutive vectors used for a local space.</p></li>
<li><p><cite>“nka vector tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.05</strong> Defines the minimum
allowed orthogonality between vectors in the local space. If a new vector
does not satisfy this requirement, the space is modified.</p></li>
<li><p><cite>“backtrack tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.</strong> Require a reduction of at
least this much in the residual norm before accepting a correction.</p></li>
<li><p><cite>“backtrack factor</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.5</strong> Multiply the correction by this
factor each backtracking step.  Note, should be in (0, 1)</p></li>
<li><p><cite>“backtrack monitor</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>monitor either</strong> What norm is
checked to determine whether backtracking has improved the residual or
not?  One of <cite>“monitor enorm</cite>”, <cite>“monitor L2 residual</cite>”, or <cite>‘monitor
either</cite>”</p></li>
<li><p><cite>“backtrack max steps</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>10</strong> Controls how many multiples of
the backtrack factor are applied before declaring failure.</p></li>
<li><p><cite>“backtrack max total steps</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1e6</strong> Controls how many total
backtrack steps may be taken before declaring failure.</p></li>
<li><p><cite>“backtrack lag iterations</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> Delay requiring a reduction
in residual for this many nonlinear iterations.</p></li>
<li><p><cite>“backtrack last iteration</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>1e6</strong> Stop requiring a
reductiontion in residual after this many nonlinear iterations.</p></li>
<li><p><cite>“backtrack fail on bad search direction</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If
backtracking for the full number of “backtrack max steps” is taken, and
the residual norm has still not be reduced suffiently, this determines
the behavior.  If true, the solver declares failure.  If false, it takes
the bad step anyway and hopes to recover in later iterates.</p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“Anderson mixing</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, use Anderson mixing instead of NKA.</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“relaxation parameter</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.7</strong> The relaxation parameter
for Anderson mixing.</p></li>
</ul>
<p>END</p>
</div>
</section>
<section id="solver-nox">
<h2>Solver: NOX<a class="headerlink" href="#solver-nox" title="Permalink to this heading">#</a></h2>
<blockquote>
<div><p>Calls Nox nonlinear solvers/JFNK.</p>
</div></blockquote>
<p>The interface to Trilinos NOX solver is as follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;solver type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;nox&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nox parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;typical solution value&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;JF matrix parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;finite difference epsilon&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1.0e-8&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;method for epsilon&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Knoll-Keyes L2&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>

<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nonlinear solver&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;solver type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Newton&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Newton parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>...
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>

<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;linear operator&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;iterative method&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;gmres&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gmres parameters&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span>...
<span class="w">      </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="time_integrators.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Time Integrators</p>
      </div>
    </a>
    <a class="right-next"
       href="linear_solvers.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Linear Solvers</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 202X, jointly shared by contributor institutions.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>