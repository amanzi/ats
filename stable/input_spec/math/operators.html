

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Operators &#8212; Amanzi-ATS</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/custom_theme.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'input_spec/math/operators';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.3';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://raw.githubusercontent.com/amanzi/ats/master/docs/documentation/source/_static/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'v1.5';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <script src="https://cdn.datatables.net/2.0.8/js/dataTables.js"></script>
    <script src="../../_static/main.js"></script>
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Shared Specs" href="../common.html" />
    <link rel="prev" title="Preconditioners" href="preconditioners.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo_full.png" class="logo__image only-light" alt="Amanzi-ATS documentation -- Home"/>
    <script>document.write(`<img src="../../_static/logo_full.png" class="logo__image only-dark" alt="Amanzi-ATS documentation -- Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../../demos.html">
    ATS Demo Problems
  </a>
</li>


<li class="nav-item pst-header-nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    ATS Input Specification
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../../demos.html">
    ATS Demo Problems
  </a>
</li>


<li class="nav-item pst-header-nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    ATS Input Specification
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><!-- This will display the version of the docs -->
Version 1.5</div>
        <div class="sidebar-primary-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">About the Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main.html">Main</a></li>

<li class="toctree-l1"><a class="reference internal" href="../mesh.html">Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../region.html">Region</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../io/index.html">IO</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../io/ioevent.html">IOEvent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/visualization.html">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/observations.html">Observations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/checkpoint.html">Checkpoint</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../process_kernels/index.html">Process Kernels</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../process_kernels/base.html">Base PKs</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../process_kernels/physical/index.html">Physical PKs</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../process_kernels/physical/flow.html">Flow PKs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process_kernels/physical/transport.html">Transport PK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process_kernels/physical/energy.html">Energy PKs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process_kernels/physical/seb.html">Surface Energy Balance PKs</a></li>


</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../process_kernels/mpcs/index.html">MPC</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../process_kernels/mpcs/base.html">Base MPCs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process_kernels/mpcs/physical.html">Physical MPCs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process_kernels/mpcs/globalization.html">Globalization Delegates</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../state/index.html">State</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../state/primary.html">Primary Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/independent.html">Independent Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/secondary.html">Secondary Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/conserved.html">Conserved quantities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/subsurface_flow.html">Subsurface flow evaluators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/surface_flow.html">Surface flow evaluators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/thermo.html">Thermodynamic evaluators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/eos.html">Equations of State</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/seb.html">Surface energy balance evaluators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/snow.html">Snow evaluators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/canopy.html">Canopy evaluators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/bgc.html">Carbon and Biogeochemistry Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/multiscale.html">Multiscale Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/geometric.html">Geometric evaluators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../state/generic.html">Generic evaluators</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Time integrators, solvers, and other mathematical specs</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="time_integrators.html">Time Integrators</a></li>
<li class="toctree-l2"><a class="reference internal" href="nonlinear_solvers.html">Nonlinear Solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="linear_solvers.html">Linear Solvers</a></li>
<li class="toctree-l2"><a class="reference internal" href="preconditioners.html">Preconditioners</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Operators</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../common.html">Shared Specs</a></li>
</ul>
</div>
</nav></div>
        <div class="sidebar-primary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#schema">Schema</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pde-accumulation">PDE_Accumulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pde-diffusion">PDE_Diffusion</a></li>
</ul>
  </nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">ATS Input Specification</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Time integrators, solvers, and other mathematical specs</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Operators</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="operators">
<h1>Operators<a class="headerlink" href="#operators" title="Permalink to this heading">#</a></h1>
<blockquote>
<div><p>Operator represents a linear map, and typically encapsulates a discretization.</p>
</div></blockquote>
<p>Operators are discrete forms of linearized PDEs operators.
They form a layer between physical process kernels and solvers
and include accumulation, diffusion, advection, elasticity, reaction,
and source operators.
The residual associated with an operator <span class="math notranslate nohighlight">\(L_h\)</span> helps to
understand the employed sign convention:</p>
<div class="math notranslate nohighlight">
\[r = f - L_h u.\]</div>
<p>Operator represents a map from linear space X to linear space Y.  Typically,
this map is a linear map, and encapsulates much of the discretization involved
in moving from continuous to discrete equations. The spaces X and Y are described
by CompositeVectors (CV). A few maps X-&gt;Y are supported.</p>
<p>An operator provides an interface for applying both the forward and inverse
linear map (assuming the map is invertible).</p>
<p>Typically the Operator is never seen by the user; instead the user provides
input information for helper classes based on the continuous mathematical
operator and the desired discretization.  These helpers build the needed
<code class="docutils literal notranslate"><span class="pre">Operator</span></code>, which may include information from multiple helpers (i.e. in the
case of Jacobian Operators for a PDE).</p>
<p>However, one option may be provided by the user, which is related to dealing
with nearly singular operators:</p>
<ul class="simple">
<li><p><cite>“diagonal shift</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.0</strong> Adds a scalar shift to the diagonal
of the <code class="docutils literal notranslate"><span class="pre">Operator</span></code>, which can be useful if the <code class="docutils literal notranslate"><span class="pre">Operator</span></code> is singular or
near-singular.</p></li>
</ul>
<p>A PK decides how to bundle operators in a collection of operators.
For example, an advection-diffusion problem may benefit from using
a single operator that combines two operators representing diffusion and advection process.
Collection of operators must be used for implicit solvers and for building preconditioners.
In such a case, the collections acts as a single operator.</p>
<p>Operators use a few tools that are generic in nature and can be used independently by PKs.
The list includes reconstruction and limiting algorithms.</p>
<section id="schema">
<h2>Schema<a class="headerlink" href="#schema" title="Permalink to this heading">#</a></h2>
<p>The operators use notion of schema to describe operator’s abstract structure.
Old operators use a simple schema which is simply the list of geometric objects where
scalar degrees of freedom are defined.
New operators use a list to define location, type, and number of degrees of freedom.
In addition, the base of local stencil is either <em>face</em> or <em>cell</em>.
A rectangular operator needs two schemas do describe its domain (called <cite>“schema domain</cite>”)
and its range (called <cite>“schema range</cite>”).
A square operator may use either two identical schema lists or a single list called <cite>“schema</cite>”.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pks operator name&quot;</span><span class="nt">&gt;</span><span class="w">  </span><span class="cm">&lt;!-- parent list--&gt;</span>
<span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema domain&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;cell&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;location&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{node, face}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{scalar, normal component}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;number&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{2, 1}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema domain&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;base&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;cell&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;location&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{node, face}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;type&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{scalar, normal component}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;number&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(int)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{2, 1}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>This example describes a square operator with two degrees of freedom per mesh node and one
degree of freedom per mesh face.
The face-based degree of freedom is the normal component of a vector field.
Such set of degrees of freedom is used in the Bernardi-Raugel element for discretizing
Stokes equations.
Parameter <cite>“base</cite>” indicates that local matrices are associated with mesh cells.</p>
</section>
<section id="pde-accumulation">
<h2>PDE_Accumulation<a class="headerlink" href="#pde-accumulation" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">PDE_Accumulation</span></code> assembles the discrete form of <span class="math notranslate nohighlight">\(\frac{\partial A}{\partial t}\)</span>.</p>
<p>This class is usually used as part of a preconditioner, providing the linearization:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial}{\partial A} \left[ \frac{\partial A}{\partial t} \right]_{A_0} i
= \frac{|\Omega_E|}{\Delta t}\]</div>
<p>for a grid element <span class="math notranslate nohighlight">\(\Omega_E\)</span>.</p>
<div class="admonition-pde-accumulation-spec admonition" id="pde-accumulation-spec">
<p class="admonition-title">pde-accumulation-spec</p>
<ul class="simple">
<li><p><cite>“entity kind</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong> Typically set by the PK</p></li>
<li><p><cite>“number of vectors</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>optional</strong> Typically set by the PK</p></li>
</ul>
</div>
</section>
<section id="pde-diffusion">
<h2>PDE_Diffusion<a class="headerlink" href="#pde-diffusion" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">PDE_Diffusion</span></code> forms local <code class="docutils literal notranslate"><span class="pre">Op</span></code> s and global <code class="docutils literal notranslate"><span class="pre">Operator</span></code> s for elliptic equations:</p>
<div class="math notranslate nohighlight">
\[\nabla \cdot k \nabla u\]</div>
<p>with a variety of discretizations. Note also, for reasons that are one part historical
and potentially not that valid, this also supports and implementation with an advective
source, i.e.:</p>
<div class="math notranslate nohighlight">
\[\nabla \cdot K k (\nabla (u + b g z))\]</div>
<p>for gravitational terms in Richards equations.</p>
<p>The input spec for a diffusion operator consists of:</p>
<ul class="simple">
<li><p><cite>“discretization primary</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> See below for supported options.</p>
<ul>
<li><p><cite>“fv: default</cite>” the standard two-point flux finite volume discretization</p></li>
<li><p><cite>“nlfv: default</cite>” the nonlinear finite volume method of ???</p></li>
<li><p>MFD methods, including:</p>
<ul>
<li><p><cite>“mfd: default</cite>”</p></li>
<li><p><cite>“mfd: monotone for hex</cite>”</p></li>
<li><p><cite>“mfd: optimized for monotonicity</cite>”</p></li>
<li><p><cite>“mfd: two-point flux approximation</cite>”</p></li>
<li><p><cite>“mfd: optimized for sparsity</cite>”</p></li>
<li><p><cite>“mfd: support operator</cite>”</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<div><p>Note that the most commonly used are <cite>“fv: default</cite>” for simple test
problems (this method is not particularly accurate for distorted
meshes), <cite>“mfd: optimized for sparsity</cite>” for most real problems on
unstructured meshes, and <cite>“mfd: optimized for monotonicity</cite>” for
orthogonal meshes with diagonal tensor/scalar coefficients.</p>
</div></blockquote>
<ul class="simple">
<li><p><cite>“gravity</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> specifies if the gravitational flow term is included</p></li>
<li><p><cite>“Newton correction</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> specifies a model for non-physical terms
that must be added to the matrix. These terms represent Jacobian and are needed
for the preconditioner. Available options are <cite>“true Jacobian</cite>” and <cite>“approximate Jacobian</cite>”.
The FV scheme accepts only the first options. The other schemes accept only the second option.</p></li>
<li><p><cite>“scaled constraint equation</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> rescales flux continuity equations
on mesh faces.  These equations are formed without the nonlinear
coefficient. This option allows us to treat the case of zero nonlinear
coefficient, which otherwise generates zero rows in the operator, which is
then singular.  At moment this feature does not work with non-zero gravity
term.</p></li>
<li><p><cite>“constraint equation scaling cutoff</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> specifies the cutoff value for
applying rescaling strategy described above.</p></li>
</ul>
<blockquote>
<div><p>Diffusion generates local Ops and global Operators for an elliptic operator.</p>
</div></blockquote>
<p>Diffusion is the most frequently used operator. It employs the old schema.</p>
<ul class="simple">
<li><p><cite>“pks operator name</cite>” [list] a PK specific name for the diffusion operator.</p>
<ul>
<li><p><cite>“discretization primary</cite>” [string] specifies an advanced discretization method that
has useful properties under some a priori conditions on the mesh and/or permeability tensor.
The available options are <cite>“mfd: optimized for sparsity</cite>”, <cite>“mfd: optimized for monotonicity</cite>”,
<cite>“mfd: default</cite>”, <cite>“mfd: support operator</cite>”, <cite>“mfd: two-point flux approximation</cite>”,
<cite>“fv: default</cite>”, and <cite>“nlfv: default</cite>”.
The first option is recommended for general meshes.
The second option is recommended for orthogonal meshes and diagonal absolute
permeability tensor.</p></li>
<li><p><cite>“discretization secondary</cite>” [string] specifies the most robust discretization method
that is used when the primary selection fails to satisfy all a priori conditions.
Default value is equal to that for the primary discretization.</p></li>
<li><p><cite>“diffusion tensor</cite>” [string] specifies additional properties of the diffusion tensor.
It allows us to solve problems with non-symmetric but positive definite tensors.
Available options are <em>symmetric</em> (default) and <em>nonsymmetric</em>.</p></li>
<li><p><cite>“nonlinear coefficient</cite>” [string] specifies a method for treating nonlinear diffusion
coefficient, if any. Available options are <cite>“none</cite>”, <cite>“upwind: face</cite>”, <cite>“divk: cell-face</cite>” (default),
<cite>“divk: face</cite>”, <cite>“standard: cell</cite>”, and <cite>“divk: cell-face-twin</cite>”.
Symmetry preserving methods are the divk-family of methods and the classical cell-centered
method (<cite>“standard: cell</cite>”). The first part of the name indicates the base scheme.
The second part (after the semi-column) indicates required components of the composite vector
that must be provided by a physical PK.
Default is <cite>“none</cite>”.</p></li>
<li><p><cite>“schema</cite>” [Array(string)] defines the operator stencil. It is a collection of
geometric objects. It equals to <cite>“{cell}</cite>” for finite volume schemes.
It is typically <cite>“{face, cell}</cite>” for mimetic discretizations.</p></li>
<li><p><cite>“preconditioner schema</cite>” [Array(string)] defines the preconditioner stencil.
It is needed only when the default assembling procedure is not desirable.
If skipped, the <cite>“schema</cite>” is used instead.</p></li>
<li><p><cite>“gravity</cite>” [bool] specifies if flow is driven also by the gravity.</p></li>
<li><p><cite>“gravity term discretization</cite>” [string] selects a model for discretizing the
gravity term. Available options are <cite>“hydraulic head</cite>” [default] and <cite>“finite volume</cite>”.
The first option starts with equation for the shifted solution, i.e. the hydraulic head,
and derives gravity discretization by the reserve shifting.
The second option is based on the divergence formula.</p></li>
<li><p><cite>“gravity magnitude</cite>” [double] defined magnitude of the gravity vector.</p></li>
<li><p><cite>“Newton correction</cite>” [string] specifies a model for correction (non-physical) terms
that must be added to the preconditioner. These terms approximate some Jacobian terms.
Available options are <cite>“true Jacobian</cite>” and <cite>“approximate Jacobian</cite>”.
The FV scheme accepts only the first options. The othre schemes accept only the second option.</p></li>
<li><p><cite>“scaled constraint equation</cite>” [bool] rescales flux continuity equations on mesh faces.
These equations are divided by the nonlinear coefficient. This option allows us to
treat the case of zero nonlinear coefficient. At moment this feature does not work
with non-zero gravity term. Default is <em>false</em>.</p></li>
<li><p><cite>“constraint equation scaling cutoff”</cite>” [double] specifies the cutoff value for
applying rescaling strategy described above.</p></li>
<li><p><cite>“consistent faces</cite>” [list] may contain a <cite>“preconditioner</cite>” and
<cite>“linear operator</cite>” list (see sections <a href="#id1"><span class="problematic" id="id2">Preconditioners_</span></a> and <a href="#id3"><span class="problematic" id="id4">LinearSolvers_</span></a>
respectively).  If these lists are provided, and the <cite>“discretization
primary</cite>” is of type <cite>“mfd: *</cite>”, then the diffusion method
UpdateConsistentFaces() can be used.  This method, given a set of cell
values, determines the faces constraints that satisfy the constraint
equation in MFD by assembling and inverting the face-only system.  This is
not currently used by any Amanzi PKs.</p></li>
<li><p><cite>“fracture</cite>” [Array(string)] provides list of regions that defines a fracture network.
This parameter is used only by the coupled flow PK.</p></li>
</ul>
</li>
</ul>
<p>Example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pks operator name&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;discretization primary&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;mfd: optimized for monotonicity&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;discretization secondary&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;mfd: two-point flux approximation&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{face, cell}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;preconditioner schema&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{face}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gravity&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;bool&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gravity term discretization&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;hydraulic head&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gravity magnitude&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;9.81&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nonlinear coefficient&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;upwind: face&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Newton correction&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true Jacobian&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;consistent faces&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;linear solver&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span>...
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">    </span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;preconditioner&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span>...
<span class="w">    </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ParameterList&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<p>This example creates a p-lambda system, i.e. the pressure is
discretized in mesh cells and on mesh faces.
The preconditioner is defined on faces only, i.e. cell-based unknowns
are eliminated explicitly and the preconditioner is applied to the
Schur complement.</p>
<p>Additional options available only for the MFD family of discretizations include:</p>
<ul class="simple">
<li><p><cite>“nonlinear coefficient</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> specifies a method for treating nonlinear
diffusion coefficient, if any. Available options are <cite>“none</cite>”, <cite>“upwind:
face</cite>”, <cite>“divk: cell-face</cite>” (default), <cite>“divk: face</cite>”, <cite>“standard: cell</cite>”,
<cite>“divk: cell-face-twin</cite>” and <cite>“divk: cell-grad-face-twin</cite>”.  Symmetry
preserving methods are the divk-family of methods and the classical
cell-centered method (<cite>“standard: cell</cite>”). The first part of the name
indicates the base scheme.  The second part (after the semi-column)
indicates required components of the composite vector that must be provided
by a physical PK.</p></li>
<li><p><cite>“discretization secondary</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> specifies the most robust
discretization method that is used when the primary selection fails to
satisfy all a priori conditions.  This is typically <cite>“mfd: default</cite>”, and is
used only when an MFD <cite>“discretization primary</cite>” is used.</p></li>
<li><p><cite>“schema</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> defines the operator stencil. It is a collection of
geometric objects.  Typically this is set by the implementation and is not provided.</p></li>
<li><p><cite>“preconditioner schema</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> <strong>{face,cell}</strong> Defines the
preconditioner stencil.  It is needed only when the default assembling
procedure is not desirable. If skipped, the <cite>“schema</cite>” is used instead.
In addition to the default, <strong>{face}</strong> may be used, which forms the Schur
complement.</p></li>
<li><p><cite>“consistent faces</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> may contain a <cite>“preconditioner</cite>” and
<cite>“linear operator</cite>” list (see sections <a href="#id5"><span class="problematic" id="id6">Preconditioners_</span></a> and <a href="#id7"><span class="problematic" id="id8">LinearSolvers_</span></a>
respectively).  If these lists are provided, and the <cite>“discretization
primary</cite>” is of type <cite>“mfd: *</cite>”, then the diffusion method
UpdateConsistentFaces() can be used.  This method, given a set of cell
values, determines the faces constraints that satisfy the constraint
equation in MFD by assembling and inverting the face-only system.  This is
not currently used by any Amanzi PKs.</p></li>
<li><p><cite>“diffusion tensor</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> allows us to solve problems with symmetric and
non-symmetric (but positive definite) tensors. Available options are <em>symmetric</em>
(default) and <em>nonsymmetric</em>.</p></li>
<li><p><cite>“use manifold flux</cite>”  <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Computes the flux using algorithms
and data structures for manifolds or fracture networks.</p></li>
</ul>
<p>Additional options for MFD with the gravity term include:</p>
<ul class="simple">
<li><p><cite>“gravity term discretization</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> selects a model for discretizing the
gravity term. Available options are <cite>“hydraulic head</cite>” (default) and <cite>“finite volume</cite>”.
The first option starts with equation for the shifted solution, i.e. the hydraulic
head, and derives gravity discretization by the reserve shifting.
The second option is based on the divergence formula.</p></li>
</ul>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="preconditioners.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Preconditioners</p>
      </div>
    </a>
    <a class="right-next"
       href="../common.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Shared Specs</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 202X, jointly shared by contributor institutions.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>