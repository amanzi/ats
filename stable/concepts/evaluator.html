
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Evaluators and the Dependency Graph &#8212; Amanzi-ATS</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/custom_theme.css?v=a03f4c85" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=3ce10a4d"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'concepts/evaluator';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.4';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://raw.githubusercontent.com/amanzi/ats/master/docs/documentation/source/_static/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'v1.5';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <script src="https://cdn.datatables.net/2.0.8/js/dataTables.js"></script>
    <script src="../_static/main.js?v=b10558fa"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Process Kernels" href="pk.html" />
    <link rel="prev" title="Variable Naming Conventions" href="variables.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo_full.png" class="logo__image only-light" alt="Amanzi-ATS documentation -- Home"/>
    <script>document.write(`<img src="../_static/logo_full.png" class="logo__image only-dark" alt="Amanzi-ATS documentation -- Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Amanzi-ATS Concepts
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../demos.html">
    ATS Demo Problems
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../input_spec/index.html">
    ATS Input Specification
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Amanzi-ATS Concepts
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../demos.html">
    ATS Demo Problems
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../input_spec/index.html">
    ATS Input Specification
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><!-- This will display the version of the docs -->
Version dev</div>
        <div class="sidebar-primary-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="domain.html">Model Domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="region.html">Region</a></li>
<li class="toctree-l1"><a class="reference internal" href="tag.html">Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="variables.html">Variable Naming Conventions</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Evaluators and the Dependency Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="pk.html">Process Kernels</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Amanzi-ATS Concepts</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Evaluators...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="evaluators-and-the-dependency-graph">
<h1>Evaluators and the Dependency Graph<a class="headerlink" href="#evaluators-and-the-dependency-graph" title="Link to this heading">#</a></h1>
<p>Previously, all concepts were used to describe data – now we will
describe the concepts used to describe how we compute data.</p>
<p><strong>Evaluators</strong> are the finest-grained unit of computation done in
Amanzi-ATS. Typically, they are used to define a term in an equation,
calculating one or more data values.  Evaluators are used for nearly
all persistent data; those data and evaluators are split into four
categories:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>primary variables</strong> are used to refer to the variables
solved for by solving a PDE.  For instance, the primary variable of
an energy equation is typically a temperature; an energy PDE would
create a primary variable evaluator to tell the code that it intends
to compute this value.</p></li>
<li><p><strong>independent variables</strong> are functions of space and time, but
nothing else.  Independent variable evaluators compute functions, or
load user-provided data from files.</p></li>
<li><p><strong>secondary variables</strong> are functions of other variables.
Secondary variable evaluators implement models to compute
secondary variables, e.g. water density as a function of
temperature, or saturation as a function of pressure.</p></li>
<li><p><strong>aliased variables</strong> are simply a way of creating multiple
logical references to the same data.  This is solely for
performance concerns, and is only ever used across multiple tags
of the same variable.  For instance, if a transport equation is
being subcycled, the <cite>“concentration&#64;NEXT</cite>” and
<cite>“concentration&#64;transport_subcycled_next</cite>” may not actually need
to be independent copies of the same data.  Once subcycling is
complete and the outer step is done, they will refer to the same
values, and can share the same data.  In this case, we create an
aliased evaluator that indicates that <cite>“concentration&#64;NEXT</cite>”
points to the same data stored as
<cite>“concentration&#64;transport_subcycled_next</cite>”.</p></li>
<li><p><strong>time-advanced variables</strong> are a way of creating a variable that
is computed by copying a <cite>“next</cite>” tag to a <cite>“current</cite>” tag.
These may be the global tags, or they may be subcycled tags.
These are secondary variables, because they depend upon the thing
they are advancing to.  These are most frequently used to store
things that are needed in case the step fails, but are also used
when, for instance, time derivatives are needed.</p></li>
</ul>
</div></blockquote>
<p>Evaluators are combined into a single <strong>dependency graph</strong>, whereby a
given evaluator points to all of its dependencies.  This graph is a
directed, acyclic graph.  Leaf nodes of the graph are either primary
or independent variable evaluators; internal nodes are secondary or
aliased variable evaluators.  This is a very powerful concept, and
forms one of the two core capabilities that makes Arcos useful.</p>
<p>For example, a simple dependency graph might be used to describe how
the code computes water content.  At runtime, the user might define a
set of evaluators that, together, form a dependecy graph for water
content.</p>
<img alt="Simple dependency graph for water content." class="align-center" src="../_images/dag1.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Here and throughout, primary variables are shown in red, independent
variables in brown, secondary variables in blue, aliased variables in
gray, and time-advanced variables in purple.  Arrows in the graph
point from an evaluator to its dependencies.  Leaf nodes in the
dependency graph are the primary variable <span class="math notranslate nohighlight">\(p\)</span> (pressure) and the
independent variables <span class="math notranslate nohighlight">\(T\)</span> (temperature) and <span class="math notranslate nohighlight">\(\phi\)</span>
(porosity), which must therefore be provided by the user as functions
of space and time or as data.  Secondary variable include <span class="math notranslate nohighlight">\(s\)</span>
(saturation) computed as a function of pressure, <span class="math notranslate nohighlight">\(\rho\)</span>
(density) computed as a function of temperature and pressure, and
<span class="math notranslate nohighlight">\(\Theta\)</span> (water content), computed as a function of saturation,
density, and porosity.  Implied here (and in many of our figures) is
the fact that these evaluators are all at the same tag.</p>
<p>Now presume we wish to compute a time derivative,
e.g. <span class="math notranslate nohighlight">\(\frac{\partial \Theta}{\partial t}\)</span>.  First we would have
to define tags between which to difference – let’s say the global
<cite>“CURRENT</cite>” and <cite>“NEXT</cite>” tags.  Note that we typically don’t use
evaluators for time, and so time does not appear on dependency graphs.
Logically it could, and maybe should!  Then, we have two choices.  We
could replicate the above graph at each of the two tags:</p>
<img alt="Dependency graph for the time derivative of water content." class="align-center" src="../_images/dag3.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Note that we have to use a <cite>“time-advanced evaluator</cite>” to save
pressure at the <cite>“CURRENT</cite>” time, while independent variables may be
computed at either <cite>“time&#64;CURRENT</cite>” or <cite>“time&#64;NEXT</cite>”, and secondary
variables are recomputed.  Alternatively, we could simply use a
<cite>“time-advanced evaluator</cite>” to copy water content to the <cite>“CURRENT</cite>”
time:</p>
<img alt="Second option for the dependency graph for the time derivative of water content." class="align-center" src="../_images/dag2.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Note we typically woud use the second, as it requires less computation
and less memory, but both are valid.</p>
<p>Given these examples, it becomes easier to define what an evaluator
is: it is a small piece of code that knows how to compute something,
and knows what it needs to compute that thing.  Nearly 75% of ATS
physics is implemented in evaluators.  Evaluators can be generic, for
example the <cite>“additive</cite>” evaluator, which simply takes a list of
dependencies and adds them up.  They can be very specific, for example
a van Genuchten water retention model which computes liquid saturation
as a function of water pressure.  They can compute multiple things,
for instance we often compute mass and molar density at the same time,
since these differ only by a factor of molar mass.  Occassionally, we
lump common quantities together, for instance computing an entire
multi-bounce radiation balance between a canopy, bare ground, and
snow-covered ground in a single evaluator.  Even external models can
be used as evaluators, as long as they require an input and compute an
output.</p>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="variables.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Variable Naming Conventions</p>
      </div>
    </a>
    <a class="right-next"
       href="pk.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Process Kernels</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 202X, jointly shared by contributor institutions.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.0.2.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>