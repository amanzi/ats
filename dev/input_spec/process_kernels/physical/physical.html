
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Physical PKs &#8212; Amanzi-ATS</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/custom_theme.css?v=a03f4c85" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../../_static/documentation_options.js?v=3ce10a4d"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'input_spec/process_kernels/physical/physical';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.4';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://raw.githubusercontent.com/amanzi/ats/master/docs/documentation/source/_static/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'v1.5';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <script src="https://cdn.datatables.net/2.0.8/js/dataTables.js"></script>
    <script src="../../../_static/main.js?v=b10558fa"></script>
    <link rel="icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo_full.png" class="logo__image only-light" alt="Amanzi-ATS documentation -- Home"/>
    <script>document.write(`<img src="../../../_static/logo_full.png" class="logo__image only-dark" alt="Amanzi-ATS documentation -- Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../concepts/index.html">
    Amanzi-ATS Concepts
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../demos.html">
    ATS Demo Problems
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../index.html">
    ATS Input Specification
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../concepts/index.html">
    Amanzi-ATS Concepts
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../demos.html">
    ATS Demo Problems
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../index.html">
    ATS Input Specification
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><!-- This will display the version of the docs -->
Version dev</div>
        <div class="sidebar-primary-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        <div class="sidebar-primary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#flow-pks">Flow PKs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#richards-pk">Richards PK</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#permafrost-flow-pk">Permafrost Flow PK</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overland-flow-pk">Overland Flow PK</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overland-flow-with-ice">Overland Flow with Ice</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#snow-distribution-pk">Snow Distribution PK</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transport-pk">Transport PK</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#energy-pks">Energy PKs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#energy-base-pk">Energy Base PK</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#two-phase-subsurface-energy-pk">Two-Phase subsurface Energy PK</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#three-phase-subsurface-energy-pk">Three-Phase subsurface Energy PK</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overland-energy-with-ice">Overland energy with Ice</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#surface-energy-balance-pks">Surface Energy Balance PKs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#balance-equation">Balance Equation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#snow-balance-equation">Snow Balance Equation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#biogeochemistry">Biogeochemistry</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#biogeochemistry-monolithic-version">Biogeochemistry – Monolithic Version</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deformation">Deformation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#volumetric-deformation">Volumetric Deformation</a></li>
</ul>
</li>
</ul>
  </nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Physical PKs</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="physical-pks">
<h1>Physical PKs<a class="headerlink" href="#physical-pks" title="Link to this heading">#</a></h1>
<p>Physical PKs are the physical capability implemented within ATS.</p>
<section id="flow-pks">
<h2>Flow PKs<a class="headerlink" href="#flow-pks" title="Link to this heading">#</a></h2>
<p>Flow PKs describe the conservation of mass of water as it flows both
above and below-ground.  Subsurface flow PKs are based on 3D Richards
equation, which describes variably saturated flow in porous media.
Minor variations to this include the incorporation of freeze-thaw
processes.  Surface flow PKs are based on a diffusion wave equation
and Manning’s model for sheet flow.  Variations to this also include
the incorporation of freeze-thaw processes.  Finally we include in
flow a “snow distribution” algorithm which takes as input
precipitation and applies it based on the existing surface level
(elevation + water + snowpack), thereby “filling in” low-lying areas
preferentially.  This makes for more accurate snowpacks at fine
scales.</p>
<section id="richards-pk">
<h3>Richards PK<a class="headerlink" href="#richards-pk" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>Two-phase, variable density Richards equation.</p>
</div></blockquote>
<p>Solves Richards equation:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \Theta}{\partial t} - \nabla \cdot \frac{k_r n_l}{\mu} K ( \nabla p + \rho g \hat{z} ) = Q_w\]</div>
<div class="admonition-richards-spec admonition" id="richards-spec">
<p class="admonition-title">richards-spec</p>
<ul class="simple">
<li><p><cite>“domain</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“domain”</strong>  Defaults to the subsurface mesh.</p></li>
<li><p><cite>“primary variable key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The primary variable associated with
this PK, typically <cite>“DOMAIN-pressure</cite>” Note there is no default – this
must be provided by the user.</p></li>
<li><p><cite>“boundary conditions</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> Defaults to Neuman, 0 normal
flux.  See <a href="#id3"><span class="problematic" id="id4">`Flow-specific Boundary Conditions`_</span></a></p></li>
<li><p><cite>“permeability type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>scalar</strong> This controls the
number of values needed to specify the absolute permeability.
One of:</p>
<ul>
<li><p><cite>“scalar</cite>” Requires one scalar value.</p></li>
<li><p><cite>“horizontal and vertical</cite>” Requires two values, horizontal
then vertical.</p></li>
<li><p><cite>“diagonal tensor</cite>” Requires dim values: {xx, yy} or {xx, yy,
zz}</p></li>
<li><p><cite>“full tensor</cite>”. (Note symmetry is required.)  Either {xx, yy,
xy} or {xx,yy,zz,xy,xz,yz}.</p></li>
</ul>
</li>
<li><p><cite>“water retention evaluator</cite>” <code class="docutils literal notranslate"><span class="pre">[wrm-evaluator-spec]</span></code> The water
retention curve.  This needs to go away, and should get moved to
State.</p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“source term</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Is there a source term?</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“source key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-water_source</strong> Typically not
set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[mol</span> <span class="pre">s^-1]</span></code></p></li>
<li><p><cite>“source term is differentiable</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> Can the
source term be differentiated with respect to the primary
variable?</p></li>
<li><p><cite>“explicit source term</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Apply the source
term from the previous time step.</p></li>
</ul>
<p>END</p>
<p>Math and solver algorithm options:</p>
<ul class="simple">
<li><p><cite>“diffusion</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> The (forward) diffusion
operator, see <a href="#id5"><span class="problematic" id="id6">PDE_Diffusion_</span></a>.</p></li>
<li><p><cite>“diffusion preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code>
<strong>optional</strong> The inverse of the diffusion operator.  See
<a href="#id7"><span class="problematic" id="id8">PDE_Diffusion_</span></a>.  Typically this is only needed to set Jacobian
options, as all others probably should match those in
<cite>“diffusion</cite>”, and default to those values.</p></li>
<li><p><cite>“surface rel perm strategy</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>none</strong> Approach for
specifying the relative permeabiilty on the surface face.
<cite>“clobber</cite>” is frequently used for cases where a surface rel
perm will be provided.  One of:</p>
<ul>
<li><p><cite>“none</cite>” : use the upwind direction to determine whether to
use the boundary face or internal cell</p></li>
<li><p><cite>“clobber</cite>” : always use the boundary face rel perm</p></li>
<li><p><cite>“max</cite>” : use the max of the boundary face and internal cell
values</p></li>
<li><p><cite>“unsaturated</cite>” : Uses the boundary face when the internal
cell is not saturated.</p></li>
</ul>
</li>
<li><p><cite>“relative permeability method</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>upwind with Darcy
flux</strong> Relative permeability is defined on cells, but must be
calculated on faces to multiply a flux.  There are several
methods commonly used.  Note these can significantly change
answers – you don’t want to change these unless you know what
they mean.  One of:</p>
<ul>
<li><p><cite>“upwind with Darcy flux</cite>” First-order upwind method that is
most common</p></li>
<li><p><cite>“upwind with gravity</cite>” Upwinds according to the gravitational
flux direction</p></li>
<li><p><cite>“cell centered</cite>” This corresponds to the harmonic mean, and is
most accurate if the problem is always wet, but has issues
when it is dry.</p></li>
<li><p><cite>“arithmetic mean</cite>” Face value is the mean of the neighboring
cells.  Not a good method.</p></li>
</ul>
</li>
</ul>
<p>Globalization and other process-based hacks:</p>
<ul class="simple">
<li><p><cite>“modify predictor with consistent faces</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> In a
face+cell diffusion discretization, this modifies the predictor to make
sure that faces, which are a DAE, are consistent with the predicted cells
(i.e. face fluxes from each sides match).</p></li>
<li><p><cite>“modify predictor for flux BCs</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Infiltration into
dry ground can be hard on solvers – this tries to do the local nonlinear
problem to ensure that face pressures are consistent with the
prescribed flux in a predictor.</p></li>
<li><p><cite>“modify predictor via water content</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Modifies the
predictor using the method of Krabbenhoft [??] paper.  Effectively does a
change of variables, extrapolating not in pressure but in water content,
then takes the smaller of the two extrapolants.</p></li>
<li><p><cite>“max valid change in saturation in a time step [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong>
Rejects timesteps whose max saturation change is greater than this value.
This can be useful to ensure temporally resolved solutions.  Usually a
good value is 0.1 or 0.2.</p></li>
<li><p><cite>“max valid change in ice saturation in a time step [-]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code>
<strong>-1</strong> Rejects timesteps whose max ice saturation change is greater than
this value.  This can be useful to ensure temporally resolved solutions.
Usually a good value is 0.1 or 0.2.</p></li>
<li><p><cite>“limit correction to pressure change [Pa]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong> If &gt; 0,
this limits an iterate’s max pressure change to this value.  Not usually
helpful.</p></li>
<li><p><cite>“limit correction to pressure change when crossing atmospheric [Pa]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong>
If &gt; 0, this limits an iterate’s max pressure change
to this value when they cross atmospheric pressure.  Not usually helpful.</p></li>
</ul>
<p>Discretization / operators / solver controls:</p>
<ul class="simple">
<li><p><cite>“accumulation preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-accumulation-spec]</span></code> <strong>optional</strong>
The inverse of the accumulation operator.  See <a href="#id9"><span class="problematic" id="id10">PDE_Accumulation_</span></a>.
Typically not provided by users, as defaults are correct.</p></li>
<li><p><cite>“absolute error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>2750.0</strong> in units of [mol].</p></li>
<li><p><cite>“compute boundary values</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Used to include boundary
face unknowns on discretizations that are cell-only (e.g. FV).  This can
be useful for surface flow or other wierd boundary conditions.  Usually
provided by MPCs that need them.</p></li>
</ul>
<p>Physics control:</p>
<ul class="simple">
<li><p><cite>“permeability rescaling</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1e7</strong> Typically 1e7 or order
<span class="math notranslate nohighlight">\(sqrt(K)\)</span> is about right.  This rescales things to stop from
multiplying by small numbers (permeability) and then by large number
(<span class="math notranslate nohighlight">\(\rho / \mu\)</span>).</p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“coupled to surface via flux</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, apply
surface boundary conditions from an exchange flux.  Note, if this is a
coupled problem, it is probably set by the MPC.  No need for a user to
set it.</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“surface-subsurface flux key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-surface_subsurface_flux</strong></p></li>
</ul>
<p>END</p>
<ul class="simple">
<li><p><cite>“coupled to surface via head</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, apply
surface boundary conditions from the surface pressure (Dirichlet).</p></li>
</ul>
</div>
</section>
<section id="permafrost-flow-pk">
<h3>Permafrost Flow PK<a class="headerlink" href="#permafrost-flow-pk" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>A three-phase, thermal Richard’s equation with water, water vapor, and ice for permafrost applications.</p>
</div></blockquote>
<p>Note that the only difference between permafrost and richards is in
constitutive relations – the WRM changes to provide three saturations,
while the water content changes to account for water in ice phase.  As these
are now drop-in field evaluators, there is very little to change in the PK.</p>
<p>In the future, this should not even need a different PK.</p>
<div class="admonition-permafrost-spec admonition" id="permafrost-spec">
<p class="admonition-title">permafrost-spec</p>
<ul class="simple">
<li><p><cite>“saturation ice key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“DOMAIN-saturation_ice”</strong> volume fraction of the ice phase (only when relevant) <code class="docutils literal notranslate"><span class="pre">[-]</span></code> Typically the default is correct.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[richards-spec]</span></code> See <a class="reference internal" href="#richards-pk">Richards PK</a></p></li>
</ul>
</div>
</section>
<section id="overland-flow-pk">
<h3>Overland Flow PK<a class="headerlink" href="#overland-flow-pk" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>Overland flow using the diffusion wave equation.</p>
</div></blockquote>
<p>Solves the diffusion wave equation for overland flow with pressure as a primary variable:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \Theta}{\partial t} - \nabla n_l k \nabla h(p) = Q_w\]</div>
<div class="admonition-overland-pressure-spec admonition" id="overland-pressure-spec">
<p class="admonition-title">overland-pressure-spec</p>
<p>Keys name variables:</p>
<ul class="simple">
<li><p><cite>“domain</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“surface”</strong>  Defaults to the extracted surface mesh.</p></li>
<li><p><cite>“primary variable</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The primary variable associated with
this PK, typically <cite>“DOMAIN-pressure</cite>” Note there is no default – this
must be provided by the user.</p></li>
<li><p><cite>“boundary conditions</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> Defaults to Neuman, 0 normal flux.</p></li>
<li><p><cite>“overland conductivity evaluator</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code>
See <a href="#id11"><span class="problematic" id="id12">`Overland Conductivity Evaluator`_</span></a>.</p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“source term</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Is there a source term?</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“source key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-water_source</strong> Typically
not set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[m</span> <span class="pre">s^-1]</span></code> or <code class="docutils literal notranslate"><span class="pre">[mol</span> <span class="pre">s^-1]</span></code></p></li>
<li><p><cite>“water source in meters</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> Is the source term in <code class="docutils literal notranslate"><span class="pre">[m</span> <span class="pre">s^-1]</span></code>?</p></li>
<li><p><cite>“source term is differentiable</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> Can the source term
be differentiated with respect to the primary variable?</p></li>
</ul>
<p>END</p>
<p>Math and solver algorithm options:</p>
<ul class="simple">
<li><p><cite>“diffusion</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> The (forward) diffusion operator,
see <a href="#id13"><span class="problematic" id="id14">PDE_Diffusion_</span></a>.</p></li>
<li><p><cite>“diffusion preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> <strong>optional</strong> The
inverse of the diffusion operator.  See <a href="#id15"><span class="problematic" id="id16">PDE_Diffusion_</span></a>.  Typically this
is only needed to set Jacobian options, as all others probably should
match those in <cite>“diffusion</cite>”, and default to those values.</p></li>
<li><p><cite>“absolute error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>550.</strong> Defaults to 1 cm of
water.  A small, but significant, amount of water.</p></li>
<li><p><cite>“limit correction to pressure change [Pa]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong> If &gt; 0,
this limits an iterate’s max pressure change to this value.  Not usually
helpful.</p></li>
<li><p><cite>“limit correction to pressure change when crossing atmospheric [Pa]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1</strong>
If &gt; 0, this limits an iterate’s max pressure change
to this value when they cross atmospheric pressure.  Not usually helpful.</p></li>
<li><p><cite>“allow no negative ponded depths</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Modifies all
correction updates to ensure only positive ponded depth is allowed.</p></li>
<li><p><cite>“min ponded depth for velocity calculation</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.e-2</strong> For
ponded depth below this height, declare the velocity 0.</p></li>
<li><p><cite>“min ponded depth for tidal bc</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.02</strong> Control on the
tidal boundary condition.  TODO: This should live in the BC spec?</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-physical-bdf-default-spec]</span></code> A <a href="#id17"><span class="problematic" id="id18">`PK: Physical and BDF`_</span></a> spec.</p></li>
</ul>
<p>Everything below this point is usually not provided by the user, but are
documented here for completeness.</p>
<p>Keys name variables:</p>
<ul class="simple">
<li><p><cite>“conserved quantity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-water_content</strong> Typically
not set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[mol]</span></code></p></li>
<li><p><cite>“elevation key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-elevation</strong> Typically
not set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[mol]</span></code></p></li>
<li><p><cite>“slope magnitude key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-slope_magnitude</strong> Typically
not set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[mol]</span></code></p></li>
</ul>
<p>Algorithmic parameters:</p>
<ul class="simple">
<li><p><cite>“coupled to subsurface via flux</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Set by MPC.</p></li>
<li><p><cite>“coupled to subsurface via head</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Set by MPC.</p></li>
<li><p><cite>“accumulation preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-accumulation-spec]</span></code> <strong>optional</strong>
The inverse of the accumulation operator.  See <a href="#id19"><span class="problematic" id="id20">PDE_Accumulation_</span></a>.
Typically not provided by users, as defaults are correct.</p></li>
</ul>
<p>EVALUATORS:</p>
<ul class="simple">
<li><p><cite>“conserved quantity</cite>”</p></li>
<li><p><cite>“water content</cite>”</p></li>
<li><p><cite>“cell volume</cite>”</p></li>
<li><p><cite>“surface_subsurface_flux</cite>”</p></li>
<li><p><cite>“elevation</cite>”</p></li>
<li><p><cite>“slope magnitude</cite>”</p></li>
<li><p><cite>“overland_conductivity</cite>”</p></li>
<li><p><cite>“ponded_depth</cite>”</p></li>
<li><p><cite>“pres_elev</cite>”</p></li>
<li><p><cite>“source</cite>”</p></li>
</ul>
</div>
</section>
<section id="overland-flow-with-ice">
<h3>Overland Flow with Ice<a class="headerlink" href="#overland-flow-with-ice" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>Two-phase overland flow equation.</p>
</div></blockquote>
<p>This modifies the diffusion wave equation for overland flow that includes
freeze-thaw processes.  This class could completely go away, but it does some
error checking on the input file to make sure freeze-thaw processes are done
correctly.  In the future this service should be done by a preprocessor
generating the input file, and this class would go away.</p>
<div class="admonition-icy-overland-spec admonition" id="icy-overland-spec">
<p class="admonition-title">icy-overland-spec</p>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[overland-pressure-spec]</span></code> See <a class="reference internal" href="#overland-flow-pk">Overland Flow PK</a>.</p></li>
</ul>
</div>
</section>
<section id="snow-distribution-pk">
<h3>Snow Distribution PK<a class="headerlink" href="#snow-distribution-pk" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>Preferential distribution of snow precip in low-lying areas.</p>
</div></blockquote>
<p>This PK is a heuristic PK that distributes incoming snow precipitation using a
diffusion wave equation.  Think of it as an analogue to overland flow – it
effectively ensures that new snow “flows downhill,” due to a uniformly random
direction and strength wind, and lands on the lowest lying areas.</p>
<p>Tweaking the snow-manning_coefficient lets you play with how uniform the snow
layer ends up.  Most of the parameters are set by your snow precipitation input
data interval.  The details of this are a bit tricky mathematically, and it may
take some fiddling with parameters to do this correctly if your data is not
daily (which all defaults are set for).</p>
<div class="admonition-snow-distribution-spec admonition" id="snow-distribution-spec">
<p class="admonition-title">snow-distribution-spec</p>
<ul class="simple">
<li><p><cite>“distribution time</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>86400.</strong> Interval of snow precip input dataset. <cite>[s]</cite></p></li>
<li><p><cite>“precipitation function</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> Snow precipitation function, see <a href="#id21"><span class="problematic" id="id22">Functions_</span></a>.</p></li>
<li><p><cite>“diffusion</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> Diffusion drives the distribution.
Typically we use finite volume here.  See <a href="#id23"><span class="problematic" id="id24">PDE_Diffusion_</span></a></p></li>
<li><p><cite>“diffusion preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> Inverse of the
above.  Likely only Jacobian term options are needed here, as the others
default to the same as the <cite>“diffusion</cite>” list.  See <a href="#id25"><span class="problematic" id="id26">PDE_Diffusion_</span></a>.</p></li>
<li><p><cite>“inverse</cite>” <code class="docutils literal notranslate"><span class="pre">[inverse-typed-spec]</span></code> <a href="#id27"><span class="problematic" id="id28">Inverse_</span></a> method for the solve.</p></li>
</ul>
<p>Not typically provided by the user, defaults are good:</p>
<ul class="simple">
<li><p><cite>“accumulation preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-accumulation-spec]</span></code> See <a href="#id29"><span class="problematic" id="id30">PDE_Accumulation_</span></a>.</p></li>
</ul>
</div>
</section>
</section>
<section id="transport-pk">
<h2>Transport PK<a class="headerlink" href="#transport-pk" title="Link to this heading">#</a></h2>
<p>The Transport PK describes the conservation of mass of components transported
with water as it flows. The transport PK is based on the advection-diffusion
equation, applies to one or more components that are dissolved in the aqueous
phase, and is currently used in both surface and subsurface compartments.
The key difference between surface and subsurface transport is in capturing
the volume of water. In the subsurface, the volume of water is set by the
porosity and saturation of the porous medium, while in the surface it is set
by the ponded depth.</p>
<p>The advection-diffusion equation for component <em>i</em> in partially saturated porous media may be written as</p>
<div class="math notranslate nohighlight">
\[\frac{\partial (\phi s_l C_i)}{\partial t}
=
- \boldsymbol{\nabla} \cdot (\boldsymbol{q} C_i)
+ \boldsymbol{\nabla} \cdot (\phi s_l\, (\boldsymbol{D^*}_l + \tau \boldsymbol{D}_i) \boldsymbol{\nabla} C_i) + Q_s,\]</div>
<p>The advection-diffusion equation for component <em>i</em> in the surface may be written as</p>
<div class="math notranslate nohighlight">
\[\frac{\partial (C_i)}{\partial t}
=
- \boldsymbol{\nabla} \cdot (\boldsymbol{q_s} C_i)
+ \boldsymbol{\nabla} \cdot ( (\boldsymbol{D^*}_l + \tau \boldsymbol{D}_i) \boldsymbol{\nabla} C_i) + Q_s,\]</div>
<div class="admonition-transport-spec admonition" id="transport-spec">
<p class="admonition-title">transport-spec</p>
<ul class="simple">
<li><p><cite>“PK type</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“transport ats”</strong></p></li>
<li><p><cite>“domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>domain</strong> specifies mesh name that defines
the domain of this PK.</p></li>
<li><p><cite>“component names</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> No default. Provides the names of the
components that will be transported. Must be in the order: aqueous, gaseous, solid.</p></li>
<li><p><cite>“number of aqueous components</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>-1</strong> The total number of
aqueous components.  Default value is the length of <cite>“component names</cite>”</p></li>
<li><p><cite>“number of gaseous components</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>0</strong> The total number of
gaseous components.</p></li>
<li><p><cite>“boundary conditions</cite>” <code class="docutils literal notranslate"><span class="pre">[transport-bc-spec]</span></code> Boundary conditions for
transport are dependent on the boundary conditions for flow. See
<a href="#id31"><span class="problematic" id="id32">`Flow-specific Boundary Conditions`_</span></a> and <a href="#id33"><span class="problematic" id="id34">`Transport-specific Boundary Conditions`_</span></a></p></li>
<li><p><cite>“component molar masses</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(double)]</span></code> No default. Molar mass of
each component.</p></li>
<li><p><cite>“molecular diffusion</cite>” <code class="docutils literal notranslate"><span class="pre">[molecular-diffusion-spec]</span></code> defines names of
solutes in aqueous and gaseous phases and related diffusivity values.</p></li>
<li><p>“material properties” <code class="docutils literal notranslate"><span class="pre">[material-properties-spec-list]</span></code> Defines material
properties see below).</p></li>
</ul>
<p>Source terms:</p>
<ul class="simple">
<li><p><cite>“source terms</cite>” <code class="docutils literal notranslate"><span class="pre">[transport-source-spec-list]</span></code> Provides solute source.</p></li>
</ul>
<p>Physical model and assumptions:</p>
<ul class="simple">
<li><p><cite>“physical models and assumptions</cite>” [material-properties-spec] Defines material properties.</p></li>
<li><p><cite>“effective transport porosity</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If <em>true</em>, effective transport porosity
will be used by dispersive-diffusive fluxes instead of total porosity.</p></li>
</ul>
<p>Math and solver algorithm options:</p>
<ul class="simple">
<li><p><cite>“diffusion</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> Diffusion drives the distribution.
Typically we use finite volume here.  See <a href="#id35"><span class="problematic" id="id36">PDE_Diffusion_</span></a></p></li>
<li><p><cite>“diffusion preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> Inverse of the
above.  Likely only Jacobian term options are needed here, as the others
default to the same as the <cite>“diffusion</cite>” list.  See <a href="#id37"><span class="problematic" id="id38">PDE_Diffusion_</span></a>.</p></li>
<li><p><cite>“inverse</cite>” <code class="docutils literal notranslate"><span class="pre">[inverse-typed-spec]</span></code> <a href="#id39"><span class="problematic" id="id40">Inverse_</span></a> method for the solve.</p></li>
<li><p><cite>“cfl</cite>” [double] Time step limiter, a number less than 1. Default value is 1.</p></li>
<li><p><cite>“spatial discretization order</cite>” [int] defines accuracy of spatial discretization.
It permits values 1 or 2. Default value is 1.</p></li>
<li><p><cite>“temporal discretization order</cite>” [int] defines accuracy of temporal discretization.
It permits values 1 or 2 and values 3 or 4 when expert parameter
<cite>“generic RK implementation</cite>” is set to true. Note that RK3 is not monotone.
Default value is 1.</p></li>
<li><dl class="simple">
<dt><cite>“reconstruction</cite>” [list] collects reconstruction parameters. The available options are</dt><dd><p>describe in the separate section below.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><cite>“transport subcycling</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> The code will default to</dt><dd><p>subcycling for transport within the master PK if there is one.</p>
</dd>
</dl>
</li>
</ul>
<p>Developer parameters:</p>
<ul class="simple">
<li><dl class="simple">
<dt><cite>“enable internal tests</cite>” [bool] turns on various internal tests during</dt><dd><p>run time. Default value is <cite>“false</cite>”.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><cite>“generic RK implementation</cite>” [bool] leads to generic implementation of</dt><dd><p>all Runge-Kutta methods. Default value is <cite>“false</cite>”.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><cite>“internal tests tolerance</cite>” [double] tolerance for internal tests such as the</dt><dd><p>divergence-free condition. The default value is 1e-6.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><cite>“runtime diagnostics: solute names</cite>” [Array(string)] defines solutes that will be</dt><dd><p>tracked closely each time step if verbosity <cite>“high</cite>”. Default value is the first
solute in the global list of <cite>“aqueous names</cite>” and the first gas in the global list
of <cite>“gaseous names</cite>”.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><cite>“runtime diagnostics: regions</cite>” [Array(string)] defines a boundary region for</dt><dd><p>tracking solutes. Default value is a seepage face boundary, see Flow PK.</p>
</dd>
</dl>
</li>
</ul>
<p>KEYS</p>
<ul>
<li><dl class="simple">
<dt><cite>“saturation liquid</cite>” This variable is a multiplier in in the</dt><dd><p>accumulation term. For subsurface transport, this will typically be the
saturation (<cite>“saturation_liquid</cite>”). For surface transport, this will
typically be the ponded depth (<cite>“ponded_depth</cite>”).</p>
</dd>
</dl>
</li>
<li><p><cite>“previous saturation liquid</cite>”</p></li>
<li><dl class="simple">
<dt><cite>“molar density liquid</cite>”  Transport is solved</dt><dd><p>for concentrations in units of mol fractions. Molar density is needed for conversion.</p>
</dd>
</dl>
</li>
<li><p><cite>“water flux</cite>”</p></li>
<li><dl>
<dt><cite>“water source</cite>” Defines the water injection rate [mol H2O m^-2 s^-1] in</dt><dd><p>surface and [mol H2O m^-3 s^-1] in subsurface) which applies to
concentrations specified by the <cite>“geochemical conditions</cite>”.  Note that if
this PK is coupled to a surface flow PK, the unit of the water source
there <em>must</em> be in [mol m^-2 s^-1], <em>not</em> in [m s^-1] as is an option for
that PK (e.g. <cite>“water source in meters</cite>” must be set to <cite>“false</cite>” in the
overland flow PK).</p>
<p>The injection rate of a solute [molC s^-1], when given as the product of
a concentration and a water source, is evaluated as:</p>
<dl class="simple">
<dt>Concentration [mol C L^-1] *</dt><dd><p>1000 [L m^-3] of water *
water source [mol H2O m^-3 s^-1] *
volume of injection domain [m^3] /
molar density of water [mol H2O m^-3]</p>
</dd>
</dl>
</dd>
</dl>
</li>
</ul>
</div>
<div class="admonition-molecular-diffusion-spec admonition" id="molecular-diffusion-spec">
<p class="admonition-title">molecular-diffusion-spec</p>
<ul class="simple">
<li><p><cite>“aqueous names</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> List of aqueous component names to
be diffused.</p></li>
<li><p><cite>“aqueous values</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> Diffusivities of each component.</p></li>
</ul>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ParameterList</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;molecular diffusion&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;aqueous names&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">Array(string)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{CO2(l),Tc-99}&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;aqueous values&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">Array(double)&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;{1e-8,1e-9}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ParameterList&gt;</span>
</pre></div>
</div>
<div class="admonition-material-properties-spec admonition" id="material-properties-spec">
<p class="admonition-title">material-properties-spec</p>
<ul class="simple">
<li><p><cite>“region</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> Defines geometric regions for material SOIL.</p></li>
<li><p><cite>“model</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>scalar</strong> Defines dispersivity model.  One of:</p>
<ul>
<li><p><cite>“scalar</cite>” : scalar dispersivity</p></li>
<li><p><cite>“Bear</cite>” : dispersion split into along- and across- velocity</p></li>
<li><p><cite>“Burnett-Frind</cite>”</p></li>
<li><p><cite>“Lichtner-Kelkar-Robinson</cite>”</p></li>
</ul>
</li>
<li><p><cite>“parameters for MODEL</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> where <cite>“MODEL</cite>” is the model name.</p></li>
</ul>
<p>IF model == scalar</p>
<p>ONE OF</p>
<ul class="simple">
<li><p><cite>“alpha</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> defines dispersivity in all directions, [m].</p></li>
</ul>
<p>OR</p>
<ul class="simple">
<li><p><cite>“dispersion coefficient</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> defines dispersion coefficient [m^2 s^-1].</p></li>
</ul>
<p>END</p>
<p>ELSE IF model == Bear</p>
<ul class="simple">
<li><p><cite>“alpha_l</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> defines dispersion in the direction of Darcy velocity, [m].</p></li>
<li><p><cite>“alpha_t</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> defines dispersion in the orthogonal direction, [m].</p></li>
</ul>
<p>ELSE IF model == Burnett-Frind</p>
<ul class="simple">
<li><p><cite>“alphaL</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> defines the longitudinal dispersion in the direction
of Darcy velocity, [m].</p></li>
<li><p><cite>“alpha_th</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Defines the transverse dispersion in the horizonal
direction orthogonal directions, [m].</p></li>
<li><p><cite>“alpha_tv</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Defines dispersion in the orthogonal directions,
[m].  When <cite>“alpha_th</cite>” equals to <cite>“alpha_tv</cite>”, we obtain dispersion in
the direction of the Darcy velocity.</p></li>
</ul>
<p>ELSE IF model == Lichtner-Kelker-Robinson</p>
<ul class="simple">
<li><p><cite>“alpha_lh</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> defines the longitudinal dispersion in the
horizontal direction, [m].</p></li>
<li><p><cite>“alpha_lv</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Defines the longitudinal dispersion in the vertical
direction, [m].  When <cite>“alpha_lh</cite>” equals to <cite>“alpha_lv</cite>”, we obtain
dispersion in the direction of the Darcy velocity.</p></li>
<li><p><cite>“alpha_th</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Defines the transverse dispersion in the horizontal
direction orthogonal directions, [m].</p></li>
<li><p><cite>“alpha_tv” ``[double]`</cite> Defines dispersion in the orthogonal directions.
When <cite>“alpha_th</cite>” equals to <cite>“alpha_tv</cite>”, we obtain dispersion in the
direction of the Darcy velocity.</p></li>
</ul>
<p>END</p>
<ul class="simple">
<li><p><cite>“aqueous tortuosity</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Defines tortuosity for calculating
diffusivity of liquid solutes, [-].</p></li>
<li><p><cite>“gaseous tortuosity</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> Defines tortuosity for calculating
diffusivity of gas solutes, [-].</p></li>
</ul>
</div>
<div class="admonition-transport-source-spec admonition" id="transport-source-spec">
<p class="admonition-title">transport-source-spec</p>
<ul>
<li><p><cite>“component mass source</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code>  Defines solute source injection rate.</p>
<ul>
<li><p><cite>“spatial distribution method</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> One of:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>“volume</cite>”, source is considered as extensive quantity [molC s^-1] and is evenly distributed across the region.</p></li>
<li><p><cite>“none</cite>”, source is considered as intensive quantity. [molC m^-2 s^-1] in surface and [molC m^-3 s^-1] in subsurface</p></li>
</ul>
</div></blockquote>
</li>
<li><p><cite>“geochemical</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code>  Defines a source by setting solute concentration for all components (in moles/L) and an injection
rate given by the water source.  Currently, this option is only available for Alquimia provided geochemical conditions.</p>
<ul class="simple">
<li><p><cite>“geochemical conditions</cite>” <code class="docutils literal notranslate"><span class="pre">[Array(string)]</span></code> List of geochemical constraints providing concentration for solute injection.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</section>
<section id="energy-pks">
<h2>Energy PKs<a class="headerlink" href="#energy-pks" title="Link to this heading">#</a></h2>
<p>Energy PKs describe the conservation of energy as it is advected and
diffuses both above and below-ground.  Both surface and subsurface
energy equations are based on a simple advection-diffusion equation,
and include variants with and without freeze-thaw processes.</p>
<section id="energy-base-pk">
<h3>Energy Base PK<a class="headerlink" href="#energy-base-pk" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>An advection-diffusion equation for energy.</p>
</div></blockquote>
<p>Solves an advection-diffusion equation for energy:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial E}{\partial t} - \nabla \cdot \kappa \nabla T + \nabla \cdot \mathbf{q} e(T) = Q_w e(T) + Q_e\]</div>
<div class="admonition-energy-pk-spec admonition" id="energy-pk-spec">
<p class="admonition-title">energy-pk-spec</p>
<ul class="simple">
<li><p><cite>“domain</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>“domain”</strong>  Defaults to the subsurface mesh.</p></li>
<li><p><cite>“primary variable</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The primary variable associated with
this PK, typically <cite>“DOMAIN-temperature</cite>” Note there is no default – this
must be provided by the user.</p></li>
<li><p><cite>“boundary conditions</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> Defaults to 0 diffusive flux
boundary condition.  See <a href="#id41"><span class="problematic" id="id42">`Energy-specific Boundary Conditions`_</span></a></p></li>
<li><p><cite>“thermal conductivity evaluator</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code>
The thermal conductivity.  This
needs to go away, and should get moved to State.</p></li>
<li><p><cite>“absolute error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>76.e-6</strong> A small amount of
energy, see error norm. <cite>[MJ]</cite></p></li>
<li><p><cite>“upwind conductivity method</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>arithmetic mean</strong> Method of
moving cell-based thermal conductivities onto faces.  One of:</p>
<ul>
<li><p><cite>“arithmetic mean</cite>” the default, average of neighboring cells</p></li>
<li><p><cite>“cell centered</cite>” harmonic mean</p></li>
</ul>
</li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“explicit advection</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Treat the advection term implicitly.</p></li>
</ul>
<p>ELSE</p>
<ul class="simple">
<li><p><cite>“supress advective terms in preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong>
Typically subsurface energy equations are strongly diffusion dominated,
and the advective terms may add little.  With this flag on, we ignore
theem in the preconditioner, making an easier linear solve and often not
negatively impacting the nonlinear solve.</p></li>
<li><p><cite>“advection preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> <strong>optional</strong>
Typically defaults are correct.</p></li>
</ul>
<p>END</p>
<ul class="simple">
<li><p><cite>“diffusion</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> See <a href="#id43"><span class="problematic" id="id44">PDE_Diffusion_</span></a>, the diffusion operator.</p></li>
<li><p><cite>“diffusion preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-diffusion-spec]</span></code> See
<a href="#id45"><span class="problematic" id="id46">PDE_Diffusion_</span></a>, the inverse operator.  Typically only adds Jacobian
terms, as all the rest default to those values from <cite>“diffusion</cite>”.</p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“source term</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> Is there a source term?</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“source key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-total_energy_source</strong> Typically
not set, as the default is good. <code class="docutils literal notranslate"><span class="pre">[MJ</span> <span class="pre">s^-1]</span></code></p></li>
<li><p><cite>“source term is differentiable</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>true</strong> Can the source term
be differentiated with respect to the primary variable?</p></li>
<li><p><cite>“source term finite difference</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If the source term
is not diffferentiable, we can do a finite difference approximation of
this derivative anyway.  This is useful for difficult-to-differentiate
terms like a surface energy balance, which includes many terms.</p></li>
</ul>
<p>END</p>
<p>Globalization:</p>
<ul class="simple">
<li><p><cite>“modify predictor with consistent faces</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> In a
face+cell diffusion discretization, this modifies the predictor to make
sure that faces, which are a DAE, are consistent with the predicted cells
(i.e. face fluxes from each sides match).</p></li>
<li><p><cite>“modify predictor for freezing</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> A simple limiter
that keeps temperature corrections from jumping over the phase change.</p></li>
<li><p><cite>“limit correction to temperature change [K]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>-1.0</strong> If &gt;
0, stops nonlinear updates from being too big through clipping.</p></li>
</ul>
<p>The following are rarely set by the user, as the defaults are typically right.</p>
<ul class="simple">
<li><p><cite>“advection</cite>” <code class="docutils literal notranslate"><span class="pre">[list]</span></code> <strong>optional</strong> The <a href="#id47"><span class="problematic" id="id48">PDE_Advection_</span></a> spec.  Only one
current implementation, so defaults are typically fine.</p></li>
<li><p><cite>“accumulation preconditioner</cite>” <code class="docutils literal notranslate"><span class="pre">[pde-accumulation-spec]</span></code> <strong>optional</strong>
The inverse of the accumulation operator.  See <a href="#id49"><span class="problematic" id="id50">PDE_Accumulation_</span></a>.
Typically not provided by users, as defaults are correct.</p></li>
</ul>
<p>IF</p>
<ul class="simple">
<li><p><cite>“coupled to surface via flux</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, apply
surface boundary conditions from an exchange flux.  Note, if this is a
coupled problem, it is probably set by the MPC.  No need for a user to
set it.</p></li>
</ul>
<p>THEN</p>
<ul class="simple">
<li><p><cite>“surface-subsurface energy flux key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-surface_subsurface_energy_flux</strong></p></li>
</ul>
<p>END</p>
<ul class="simple">
<li><p><cite>“coupled to surface via temperature</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true, apply
surface boundary conditions from the surface temperature (Dirichlet).</p></li>
</ul>
<p>KEYS:</p>
<ul class="simple">
<li><p><cite>“conserved quantity</cite>” <strong>DOMAIN-energy</strong> The total energy <span class="math notranslate nohighlight">\(E\)</span> <cite>[MJ]</cite></p></li>
<li><p><cite>“energy</cite>” <strong>DOMAIN-energy</strong> The total energy <span class="math notranslate nohighlight">\(E\)</span>, also the conserved quantity. <cite>[MJ]</cite></p></li>
<li><p><cite>“water content</cite>” <strong>DOMAIN-water_content</strong> The total mass <span class="math notranslate nohighlight">\(\Theta\)</span>, used in error norm <cite>[mol]</cite></p></li>
<li><p><cite>“enthalpy</cite>” <strong>DOMAIN-enthalpy</strong> The specific enthalpy :math`e` <cite>[MJ mol^-1]</cite></p></li>
<li><p><cite>“flux</cite>” <strong>DOMAIN-water_flux</strong> The water flux <span class="math notranslate nohighlight">\(\mathbf{q}\)</span> used in advection. <cite>[mol s^-1]</cite></p></li>
<li><p><cite>“diffusive energy</cite>” <strong>DOMAIN-diffusive_energy_flux</strong> <span class="math notranslate nohighlight">\(\mathbf{q_e}\)</span> <cite>[MJ s^-1]</cite></p></li>
<li><p><cite>“advected energy</cite>” <strong>DOMAIN-advected_energy_flux</strong> <span class="math notranslate nohighlight">\(\mathbf{q_e^{adv}} = q e\)</span> <cite>[MJ s^-1]</cite></p></li>
<li><p><cite>“thermal conductivity</cite>” <strong>DOMAIN-thermal_conductivity</strong> Thermal conductivity on cells <cite>[W m^-1 K^-1]</cite></p></li>
<li><p><cite>“upwinded thermal conductivity</cite>” <strong>DOMAIN-upwinded_thermal_conductivity</strong> Thermal conductivity on faces <cite>[W m^-1 K^-1]</cite></p></li>
</ul>
<p>EVALUATORS:</p>
<ul class="simple">
<li><p><cite>“source term</cite>” <strong>optional</strong> If source key is provided.</p></li>
<li><p><cite>“enthalpy</cite>”</p></li>
<li><p><cite>“cell volume</cite>”</p></li>
<li><p><cite>“thermal conductivity</cite>”</p></li>
<li><p><cite>“conserved quantity</cite>”</p></li>
<li><p><cite>“energy</cite>”</p></li>
</ul>
</div>
</section>
<section id="two-phase-subsurface-energy-pk">
<h3>Two-Phase subsurface Energy PK<a class="headerlink" href="#two-phase-subsurface-energy-pk" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>An advection-diffusion equation for energy in two phases.</p>
</div></blockquote>
<p>This is simply a subsurface energy equation that places a few more requirements
on the base class.  It could probably go away if we refactor to remove
hard-coded evaluators.</p>
<div class="admonition-energy-two-phase-pk-spec admonition" id="energy-two-phase-pk-spec">
<p class="admonition-title">energy-two-phase-pk-spec</p>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[energy-pk-spec]</span></code>  See <a class="reference internal" href="#energy-base-pk">Energy Base PK</a></p></li>
</ul>
</div>
</section>
<section id="three-phase-subsurface-energy-pk">
<h3>Three-Phase subsurface Energy PK<a class="headerlink" href="#three-phase-subsurface-energy-pk" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>An advection-diffusion equation for energy in three phases.</p>
</div></blockquote>
<p>This is simply a subsurface energy equation that places a few more requirements
on the base class.  It could probably go away if we refactor to remove
hard-coded evaluators.</p>
<div class="admonition-energy-three-phase-pk-spec admonition" id="energy-three-phase-pk-spec">
<p class="admonition-title">energy-three-phase-pk-spec</p>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[energy-two-phase-pk-spec]</span></code> See  <a class="reference internal" href="#two-phase-subsurface-energy-pk">Two-Phase subsurface Energy PK</a></p></li>
</ul>
</div>
</section>
<section id="overland-energy-with-ice">
<h3>Overland energy with Ice<a class="headerlink" href="#overland-energy-with-ice" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>An advection-diffusion equation for surface energy in two phases.</p>
</div></blockquote>
<p>This is simply a surface energy equation that places a few more requirements
on the base class.  It could probably go away if we refactor to remove
hard-coded evaluators.</p>
<div class="admonition-energy-surface-ice-pk-spec admonition" id="energy-surface-ice-pk-spec">
<p class="admonition-title">energy-surface-ice-pk-spec</p>
<p>These are typically not set by the user:</p>
<ul class="simple">
<li><p><cite>“coupled to subsurface via temperature</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> A coupling
scheme, provided by MPC.</p></li>
<li><p><cite>“coupled to subsurface via flux</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> A coupling
scheme, provided by MPC.</p></li>
<li><p><cite>“subsurface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>optional</strong> If one of the above
coupling schemes is turned on, we need to know the subsurface mesh.
Provided by MPC.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[energy-pk-spec]</span></code>  See <a class="reference internal" href="#energy-base-pk">Energy Base PK</a></p></li>
</ul>
</div>
</section>
</section>
<section id="surface-energy-balance-pks">
<h2>Surface Energy Balance PKs<a class="headerlink" href="#surface-energy-balance-pks" title="Link to this heading">#</a></h2>
<p>Integrated hydrology is not much use without significant process
complexity in source terms coming from the ecohydrologic environment.
These include straightforward sources, like precipitation, but also
more complicated ones such as evaporation and transpiration.</p>
<p>These terms are almost always tied up in a surface energy balance –
evaporation and transpiration are driven by vapor pressure gradients
between the atmosphere and the surface (either snow, ponded water,
soil, or leaf).  Solving a surface energy balance often requires
providing a bunch of terms, including radiated energy, conducted
energy, latent and sensible heat models, etc.</p>
<p>ATS currently has several approaches to calculating these – see
<a class="reference external" href="https://github.com/amanzi/ats-demos">ats-demos</a> examples on
ecohydrology for a more in-depth discussion.</p>
<section id="balance-equation">
<h3>Balance Equation<a class="headerlink" href="#balance-equation" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>A simple conservation ODE.</p>
</div></blockquote>
<p>This is a very simple vector of ODEs, useful in balance equations, where the
time derivative of a conserved quantity is determined by a bunch of sources and
sinks.</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \Phi }{\partial t} = \sum_i Q_i\]</div>
<div class="admonition-balance-pk-spec admonition" id="balance-pk-spec">
<p class="admonition-title">balance-pk-spec</p>
<ul class="simple">
<li><p><cite>“primary variable key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The primary variable associated with
this PK.  Note there is no default – this must be provided by the user.</p></li>
<li><p><cite>“conserved quantity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> The conserved quantity <span class="math notranslate nohighlight">\(\Phi\)</span></p></li>
<li><p><cite>“source key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-source_sink</strong> Units are in conserved
quantity per second per cell volume.</p></li>
<li><p><cite>“time discretization theta</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> <span class="math notranslate nohighlight">\(\theta\)</span> in a
Crank-Nicholson time integration scheme.  1.0 implies fully implicit, 0.0
implies explicit, 0.5 implies C-N.</p></li>
<li><p><cite>“modify predictor positivity preserving</cite>” <code class="docutils literal notranslate"><span class="pre">[bool]</span></code> <strong>false</strong> If true,
predictors are modified to ensure that the conserved quantity is always &gt; 0.</p></li>
<li><p><cite>“absolute error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>550.0</strong> a_tol in the standard
error norm calculation.  Defaults to a small amount of water.  Units are
the same as the conserved quantity.</p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-physical-bdf-default-spec]</span></code></p></li>
</ul>
</div>
</section>
<section id="snow-balance-equation">
<h3>Snow Balance Equation<a class="headerlink" href="#snow-balance-equation" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>An implicit PK for surface balance snow SWE conservation.</p>
</div></blockquote>
<p>This is a balance PK whose conserved quantity is snow SWE.  The energy balance
comes in as it provides the energy needed to melt snow.  So source terms
include snow precipitation and snowmelt.  It also manages snow density, which
should get rethought a bit.</p>
<p>There is also some wierd hackiness here about area fractions – see ATS Issue
#8</p>
<div class="admonition-subgrid-balance-pk-spec admonition" id="subgrid-balance-pk-spec">
<p class="admonition-title">subgrid-balance-pk-spec</p>
<ul class="simple">
<li><p><cite>“absolute error tolerance</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>0.01</strong> <code class="docutils literal notranslate"><span class="pre">[m]</span></code></p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[balance-pk-spec]</span></code> This <em>is a</em> <a class="reference internal" href="#balance-equation">Balance Equation</a></p></li>
</ul>
<p>Not typically set by user, defaults work:</p>
<ul class="simple">
<li><p><cite>“conserved quantity key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-snow_water_equivalent</strong>
Sets the default conserved quantity key, so this is likely not supplied
by the user. <cite>[m]</cite></p></li>
<li><p><cite>“snow density key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-density</strong> Default snow density
key. <cite>[kg m^-3]</cite></p></li>
<li><p><cite>“snow age key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-age</strong> Default snow age key. <cite>[d]</cite></p></li>
<li><p><cite>“new snow key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-source</strong> Default new snow key. <cite>[m SWE s^-1]</cite></p></li>
<li><p><cite>“area fractions key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-fractional_areas</strong> Subgrid
model fractional areas, see note above. <cite>[-]</cite></p></li>
<li><p><cite>“snow death rate key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-death_rate</strong> Deals with last
tiny bit of snowmelt.</p></li>
</ul>
</div>
</section>
</section>
<section id="biogeochemistry">
<h2>Biogeochemistry<a class="headerlink" href="#biogeochemistry" title="Link to this heading">#</a></h2>
<p>To accurately predict watershed ecohydrology, a carbon cycle model is
needed to predict transpiration.  By simulating a carbon cycle, we are
able to predict the rate of photosynthesis as a function of space and
time, and photosynthesis governs root water uptake.  Currently only
one big-leaf model is available, but ongoing work is wrapping a
generalized Common/Colorado Land Model based on that developed within
the ParFlow team, and another ongoing project is working on wrapping
kernels from E3SM’s Land Model.</p>
<section id="biogeochemistry-monolithic-version">
<h3>Biogeochemistry – Monolithic Version<a class="headerlink" href="#biogeochemistry-monolithic-version" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>Above and below-ground carbon cycle model.</p>
</div></blockquote>
<p>This is a multi-leaf layer, big-leaf vegetation model coupled to a Century
model for belowground carbon decomposition.</p>
<p>It leverages a PFT-based structure which allows multiple height-sorted PFTs to
coexist on the same grid cells, with the shorter PFTs getting whatever light is
left in the understory.</p>
<p>The implementation is based on an old, standalone code by Chonggang Xu, and
adapted for ATS.  While this is not simple, it is called BGC simple as it is
about the least amount of complexity required to get a reasonable carbon cycle
into ATS.</p>
<p>Outputs of this include transpiration, a critical sink for hydrology, as it
solves photosynthesis based on water availability.</p>
<p>Note this is an “explicit update PK,” or effectively a forward Euler timestep
that is not written in ODE form.</p>
<p>Note this works on both the surface (vegetation) and subsurface (decomposition)
meshes.  <strong>It is required</strong> that the subsurface mesh is a “columnar” mesh, and
that build_columns in the subsurface <a href="#id51"><span class="problematic" id="id52">Mesh_</span></a> spec has been supplied.</p>
<div class="admonition-bgc-simple-spec admonition" id="bgc-simple-spec">
<p class="admonition-title">bgc-simple-spec</p>
<ul class="simple">
<li><p><cite>“initial time step</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>1.0</strong> Initial time step size <cite>[s]</cite></p></li>
<li><p><cite>“number of carbon pools</cite>” <code class="docutils literal notranslate"><span class="pre">[int]</span></code> <strong>7</strong> Unclear whether this can actually change?</p></li>
<li><p><cite>“soil carbon parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[soil-carbon-spec-list]</span></code> List of soil carbon parameters by soil mesh partition region name.</p></li>
<li><p><cite>“pft parameters</cite>” <code class="docutils literal notranslate"><span class="pre">[pft-spec-list]</span></code> List of PFT parameters by PFT name.</p></li>
<li><p><cite>“latitude [degrees]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>60</strong> Latitude of the simulation in degrees.  Used in radiation balance.</p></li>
<li><p><cite>“wind speed reference height [m]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>2.0</strong> Reference height of the wind speed dataset.</p></li>
<li><p><cite>“cryoturbation mixing coefficient [cm^2/yr]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>5.0</strong> Controls diffusion of carbon into the subsurface via cryoturbation.</p></li>
<li><p><cite>“leaf biomass initial condition</cite>” <code class="docutils literal notranslate"><span class="pre">[initial-conditions-spec]</span></code> Sets the leaf biomass IC.</p></li>
<li><p><cite>“domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>domain</strong></p></li>
<li><p><cite>“surface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>surface</strong></p></li>
<li><p><cite>“transpiration key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>DOMAIN-transpiration</strong> The distributed transpiration flux <cite>[mol s^-1]</cite></p></li>
<li><p><cite>“shaded shortwave radiation key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code>
<strong>SURFACE_DOMAIN-shaded_shortwave_radiation</strong> Shortwave radiation that gets
past the canopy and teo the bare ground for soil evaporation. <cite>[W m^-2]</cite></p></li>
<li><p><cite>“total leaf area index key</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>SURFACE_DOMAIN-total_leaf_area_index</strong> Total LAI across all PFTs.</p></li>
</ul>
<p>EVALUATORS:</p>
<ul class="simple">
<li><p><cite>“temperature</cite>” The soil temperature <cite>[K]</cite></p></li>
<li><p><cite>“pressure</cite>” soil mafic potential <cite>[Pa]</cite></p></li>
<li><p><cite>“surface-cell_volume</cite>” <cite>[m^2]</cite></p></li>
<li><p><cite>“surface-incoming shortwave radiation</cite>” <cite>[W m^-2]</cite></p></li>
<li><p><cite>“surface-air_temperature</cite>” <cite>[K]</cite></p></li>
<li><p><cite>“surface-vapor_pressure_air</cite>” <cite>[Pa]</cite></p></li>
<li><p><cite>“surface-wind_speed</cite>” <cite>[m s^-1]</cite></p></li>
<li><p><cite>“surface-co2_concentration</cite>” <cite>[ppm]</cite></p></li>
</ul>
</div>
</section>
</section>
<section id="deformation">
<h2>Deformation<a class="headerlink" href="#deformation" title="Link to this heading">#</a></h2>
<p>The unstructured mesh framework we use provides the opportunity to
include deformation of the mesh.  This deformation can be done in two
ways – either node coordinate changes are provided, or volumetric
changes are provided, and the code attempts to iterate toward a global
coordinate change that satisfies these volumetric changes.  The latter
can be somewhat fragile for large deformation, but it does allow
simple deformation such as small, somewhat uniform subsidence.  The
volumetric deformation PK below does this based on a volumetric change
given by loss of bulk ice.</p>
<section id="volumetric-deformation">
<h3>Volumetric Deformation<a class="headerlink" href="#volumetric-deformation" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>Subsidence through bulk ice loss and cell volumetric change.</p>
</div></blockquote>
<p>This process kernel provides for going from a cell volumetric change to an
updated unstructured mesh, and can be coupled sequentially with flow to solve
problems of flow in a subsiding porous media.</p>
<p>Note that this PK is slaved to the flow PK.  This PK must be advanced first,
and be weakly coupled to the flow PK (or an MPC that advances the flow PK), and
the timestep of this PK must match that of the flow PK (e.g. do not try to
subcyle one or the other).  This uses a rather hacky, unconventional use of
time tags, where we use saturations and porosities at the NEXT time, but ASSUME
they are actually the values of the CURRENT time.  This saves having to stash a
copy of these variables at the CURRENT time, which would otherwise not be used.</p>
<p>Note that all deformation here is vertical, and we assume that the subsurface
mesh is <strong>perfectly columnar</strong> and that the “build columns” parameter has been
given to the subsurface mesh.  See the <a href="#id53"><span class="problematic" id="id54">Mesh_</span></a> spec for more.</p>
<p>The process here is governed through two options, the “deformation mode” and
the “deformation strategy.”</p>
<p>The deformation mode describes how the cell volume change is calculated.  There
are three options here:</p>
<ul class="simple">
<li><p>“prescribed” uses a function to precribe the volume changes as a function of (t,x,y,z).</p></li>
<li><p>“structural” decreases the cell volume if the porosity is above a prescribed
“structurally connected matrix” porosity.  Think of this as bulk ice
“propping up” the soil grains – as that bulk ice melts, it reduces porosity
toward the porosity in at which grains start to touch again and can be
structurally sound.</p></li>
<li><p>“saturation” is a heuristic that considers the liquid saturation directly,
and tries to relax the liquid saturation back toward a value that is
consistent with what the thawed soil should be.</p></li>
</ul>
<p>The deformation strategy describes how the cell volume change is turned into
node coordinate changes.  Three options are available:</p>
<ul class="simple">
<li><p>“average” simply takes the average of volume change/surface area and
horizontally averages this quantity across all neighbors.  While this has the
advantage of being simple, it has issues when thaw gradients in the
horizontal are not zero, as it may result in the loss of volume in a fully
frozen cell, blowing up the pressure and breaking the code.  This is great
when it works, but it almost never works in real problems, except in
column-based models, where it is perfect.</p></li>
<li><p>“mstk implementation” MSTK implements an iterated, local optimization method
that, one-at-a-time, moves nodes to try and match the volumes.  This has
fewer issues with overfitting, but doesn’t always do sane things, and can be
expensive if iterations don’t work well.  This is not particularly robust
either, but it seems to be the preferred method for 2D/3D problems.</p></li>
<li><p>“global optimization” attempts to directly form and solve the minimization
problem to find the nodal changes that result in the target volumetric
changes.  Note this has issues with overfitting, so penalty methods are used
to smooth the solution of the problem.  This is currently disabled.</p></li>
</ul>
<p>NOTE: all deformation options are treated EXPLICITLY, and depend only upon
values from the old time.</p>
<div class="admonition-volumetric-deformation-pk-spec admonition" id="volumetric-deformation-pk-spec">
<p class="admonition-title">volumetric-deformation-pk-spec</p>
<ul class="simple">
<li><p><cite>“max time step [s]</cite>” <code class="docutils literal notranslate"><span class="pre">[double]</span></code> <strong>inf</strong> Sets a maximum time step size.</p></li>
<li><p><cite>“deformation mode</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>prescribed</strong> See above for
descriptions.  One of: <cite>“prescribed</cite>”, <cite>“structural</cite>”, or <cite>“saturation</cite>”.</p></li>
<li><p><cite>“deformation strategy</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>global optimization</strong> See above
for descriptions.  One of <cite>“average</cite>”, <cite>“global optimization</cite>”, or <cite>“mstk
implementation</cite>”</p></li>
<li><p><cite>“domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>domain</strong>  The mesh to deform.</p></li>
<li><p><cite>“surface domain name</cite>” <code class="docutils literal notranslate"><span class="pre">[string]</span></code> <strong>surface</strong> The surface mesh.</p></li>
<li><p><cite>“deformation function</cite>” <code class="docutils literal notranslate"><span class="pre">[function-spec]</span></code> <strong>optional</strong> Only used if
“deformation mode” == “prescribed”</p></li>
</ul>
<p>EVALUATORS:</p>
<ul class="simple">
<li><p><cite>“saturation_ice</cite>” <strong>DOMAIN-saturation_ice</strong></p></li>
<li><p><cite>“saturation_liquid</cite>” <strong>DOMAIN-saturation_liquid</strong></p></li>
<li><p><cite>“saturation_gas</cite>” <strong>DOMAIN-saturation_gas</strong></p></li>
<li><p><cite>“porosity</cite>” <strong>DOMAIN-porosity</strong></p></li>
<li><p><cite>“cell volume</cite>” <strong>DOMAIN-cell_volume</strong></p></li>
</ul>
<p>INCLUDES:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[pk-physical-default-spec]</span></code></p></li>
</ul>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 202X, jointly shared by contributor institutions.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.0.2.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>